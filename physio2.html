<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhysioTech - Physiotherapy Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- EmailJS for sending real emails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#0F766E',
                        secondary: '#0D9488',
                        medical: '#2C7A7B',
                        sage: '#10B981',
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <!-- User Type Selection -->
    <div id="userTypeSelection" class="min-h-screen flex items-center justify-center relative overflow-hidden bg-gradient-to-br from-slate-50 to-cyan-50">
        <div class="max-w-4xl mx-4 bg-white rounded-3xl shadow-2xl overflow-hidden relative z-10">
            <div class="p-8 lg:p-12 text-center">
                <div class="mb-8">
                    <div class="inline-flex items-center justify-center w-24 h-24 bg-white rounded-2xl mb-6 shadow-lg border-2 border-gray-100">
                        <img src="https://pfst.cf2.poecdn.net/base/image/8b6401e48101612f660ccec8b51614f103f2770892e0de9e4ad8f101949526a1?w=225&h=225"
                             alt="Bahrain Mobility International"
                             class="w-20 h-20 object-contain rounded-xl">
                    </div>
                    <h1 class="text-4xl font-bold text-gray-900 mb-2">Welcome to PhysioTech</h1>
                    <p class="text-gray-600">Choose your login type</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                    <button id="adminLoginBtn" class="group p-8 border-2 border-gray-200 rounded-2xl hover:border-primary hover:shadow-lg transition-all duration-200">
                        <div class="w-16 h-16 bg-primary bg-opacity-10 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-opacity-20 transition-colors">
                            <i class="fas fa-user-shield text-3xl text-primary"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">Administrator</h3>
                        <p class="text-gray-600">Access admin dashboard and manage the system</p>
                    </button>

                    <button id="physioLoginBtn" class="group p-8 border-2 border-gray-200 rounded-2xl hover:border-secondary hover:shadow-lg transition-all duration-200">
                        <div class="w-16 h-16 bg-secondary bg-opacity-10 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-opacity-20 transition-colors">
                            <i class="fas fa-user-md text-3xl text-secondary"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">Physiotherapist</h3>
                        <p class="text-gray-600">Access your schedule and patient information</p>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Page -->
    <div id="adminLoginPage" class="hidden min-h-screen flex items-center justify-center relative overflow-hidden bg-gradient-to-br from-slate-50 to-cyan-50">
        <div class="flex w-full max-w-6xl mx-4 bg-white rounded-3xl shadow-2xl overflow-hidden relative z-10">
            <div class="w-full lg:w-1/2 p-8 lg:p-12">
                <div class="max-w-md mx-auto">
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-24 h-24 bg-white rounded-2xl mb-6 shadow-lg border-2 border-gray-100">
                            <img src="https://pfst.cf2.poecdn.net/base/image/8b6401e48101612f660ccec8b51614f103f2770892e0de9e4ad8f101949526a1?w=225&h=225"
                                 alt="Bahrain Mobility International"
                                 class="w-20 h-20 object-contain rounded-xl">
                        </div>
                        <h1 class="text-4xl font-bold text-gray-900 mb-2">Admin Login</h1>
                        <p class="text-gray-600">Welcome back to Bahrain Mobility International</p>
                    </div>

                    <form id="loginForm" class="space-y-6">
                        <div>
                            <label for="loginEmail" class="block text-sm font-semibold text-gray-700 mb-3">Email</label>
                            <div class="relative">
                                <input type="email" id="loginEmail" name="email" required autocomplete="email" placeholder="Enter your email address" class="w-full px-4 py-4 pl-12 border-2 border-gray-200 rounded-xl bg-white text-gray-900 text-base focus:ring-2 focus:ring-primary focus:border-primary focus:outline-none transition-colors z-10 relative">
                                <i class="fas fa-envelope absolute left-4 top-5 text-gray-400 pointer-events-none z-0"></i>
                            </div>
                        </div>

                        <div>
                            <label for="loginPassword" class="block text-sm font-semibold text-gray-700 mb-3">Password</label>
                            <div class="relative">
                                <input type="password" id="loginPassword" name="password" required autocomplete="current-password" placeholder="Enter your password" class="w-full px-4 py-4 pl-12 pr-12 border-2 border-gray-200 rounded-xl bg-white text-gray-900 text-base focus:ring-2 focus:ring-primary focus:border-primary focus:outline-none transition-colors z-10 relative">
                                <i class="fas fa-lock absolute left-4 top-5 text-gray-400 pointer-events-none z-0"></i>
                                <button type="button" id="togglePassword" class="absolute right-4 top-5 text-gray-400 hover:text-gray-600 focus:outline-none z-20">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-primary to-secondary text-white py-4 px-4 rounded-xl hover:from-secondary hover:to-medical transition-all duration-200 font-semibold text-lg shadow-lg">
                            Log In
                        </button>

                        <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm"></div>
                    </form>

                    <div class="mt-8 text-center">
                        <button id="backToSelectionFromAdmin" class="text-primary hover:text-secondary font-medium">← Back to login selection</button>
                    </div>
                </div>
            </div>

            <div class="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary via-secondary to-sage items-center justify-center p-12 relative">
                <div class="text-center text-white z-10">
                    <h2 class="text-4xl font-bold mb-6">Welcome to PhysioTech</h2>
                    <p class="text-xl text-white text-opacity-90 mb-8 leading-relaxed">Professional physiotherapy management system for modern healthcare providers</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Physiotherapist Login Page -->
    <div id="physioLoginPage" class="hidden min-h-screen flex items-center justify-center relative overflow-hidden bg-gradient-to-br from-teal-50 to-emerald-50">
        <div class="flex w-full max-w-5xl mx-4 bg-white rounded-3xl shadow-2xl overflow-hidden relative z-10">
            <div class="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-secondary via-sage to-primary items-center justify-center p-12 relative">
                <div class="text-center text-white z-10">
                    <div class="w-24 h-24 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-user-md text-4xl"></i>
                    </div>
                    <h2 class="text-4xl font-bold mb-6">Physiotherapist Portal</h2>
                    <p class="text-xl text-white text-opacity-90 mb-8 leading-relaxed">Access your schedule, patient information, and treatment tools</p>
                </div>
            </div>

            <div class="w-full lg:w-1/2 p-8 lg:p-12">
                <div class="max-w-md mx-auto">
                    <button id="backToSelection" class="mb-6 text-gray-600 hover:text-gray-800 flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span>Back to login selection</span>
                    </button>

                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-secondary bg-opacity-10 rounded-2xl mb-6">
                            <i class="fas fa-user-md text-3xl text-secondary"></i>
                        </div>
                        <h1 class="text-4xl font-bold text-gray-900 mb-2">Physiotherapist Login</h1>
                        <p class="text-gray-600">Enter your credentials to access your dashboard</p>
                    </div>

                    <form id="physioLoginForm" class="space-y-6">
                        <div>
                            <label for="physioLoginEmail" class="block text-sm font-semibold text-gray-700 mb-3">Email</label>
                            <div class="relative">
                                <input type="email" id="physioLoginEmail" name="email" required autocomplete="email" placeholder="Enter your email address" class="w-full px-4 py-4 pl-12 border-2 border-gray-200 rounded-xl bg-white text-gray-900 text-base focus:ring-2 focus:ring-secondary focus:border-secondary focus:outline-none transition-colors z-10 relative">
                                <i class="fas fa-envelope absolute left-4 top-5 text-gray-400 pointer-events-none z-0"></i>
                            </div>
                        </div>

                        <div>
                            <label for="physioLoginPassword" class="block text-sm font-semibold text-gray-700 mb-3">Password</label>
                            <div class="relative">
                                <input type="password" id="physioLoginPassword" name="password" required autocomplete="current-password" placeholder="Enter your password" class="w-full px-4 py-4 pl-12 pr-12 border-2 border-gray-200 rounded-xl bg-white text-gray-900 text-base focus:ring-2 focus:ring-secondary focus:border-secondary focus:outline-none transition-colors z-10 relative">
                                <i class="fas fa-lock absolute left-4 top-5 text-gray-400 pointer-events-none z-0"></i>
                                <button type="button" id="togglePhysioPassword" class="absolute right-4 top-5 text-gray-400 hover:text-gray-600 focus:outline-none z-20">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-secondary to-sage text-white py-4 px-4 rounded-xl hover:from-sage hover:to-primary transition-all duration-200 font-semibold text-lg shadow-lg">
                            <i class="fas fa-sign-in-alt mr-2"></i>Log In
                        </button>

                        <div id="physioLoginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <nav class="bg-gradient-to-r from-primary via-secondary to-primary shadow-2xl fixed top-0 left-0 right-0 z-50">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <div class="flex items-center">
                        <i class="fas fa-heartbeat text-white text-3xl mr-4 animate-pulse"></i>
                        <span class="text-white text-2xl font-bold">PhysioTech - Admin</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-3 text-white">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-lg"></i>
                            </div>
                            <div class="hidden lg:block">
                                <p class="text-sm font-medium">Admin User</p>
                                <p class="text-xs text-gray-200">Administrator</p>
                            </div>
                        </div>
                        
                        <button id="adminLogoutBtn" class="bg-red-500 text-white px-4 py-3 rounded-lg hover:bg-red-600 transition-colors text-sm font-semibold">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex pt-16">
            <div class="w-64 bg-gray-50 dark:bg-gray-800 min-h-screen p-4 fixed left-0 top-16 bottom-0 overflow-y-auto z-40">
                <nav class="space-y-2">
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors bg-primary text-white" data-view="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="patients">
                        <i class="fas fa-users mr-3"></i>Patients
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="appointments">
                        <i class="fas fa-calendar mr-3"></i>Appointments
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="physiotherapists">
                        <i class="fas fa-user-md mr-3"></i>Physiotherapists
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="users">
                        <i class="fas fa-users-cog mr-3"></i>Users & Admins
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="exercises">
                        <i class="fas fa-dumbbell mr-3"></i>Exercises
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="reports">
                        <i class="fas fa-chart-bar mr-3"></i>Reports
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="settings">
                        <i class="fas fa-cog mr-3"></i>Settings
                    </button>
                </nav>
            </div>

            <div class="flex-1 ml-64 p-6 min-h-screen">
                <!-- Dashboard View -->
                <div id="dashboard" class="view">
                    <!-- Dashboard Header -->
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
                        <div>
                            <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">Admin Dashboard</h1>
                            <p class="text-gray-600 dark:text-gray-400">Welcome back! Here's what's happening today.</p>
                        </div>
                        <div class="flex items-center space-x-3 mt-4 lg:mt-0">
                            <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                <i class="fas fa-clock mr-2"></i>
                                <span id="currentDateTime">Loading...</span>
                            </div>
                            <button id="refreshDashboard" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Enhanced Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showView('patients')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm font-medium">Total Patients</p>
                                    <p class="text-3xl font-bold" id="totalPatientsCount">0</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-xs mr-1"></i>
                                        <span class="text-xs text-blue-100">+2 this week</span>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                    <i class="fas fa-users text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showView('appointments')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm font-medium">Appointments Today</p>
                                    <p class="text-3xl font-bold" id="todayAppointmentsCount">8</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-xs mr-1"></i>
                                        <span class="text-xs text-green-100">+3 pending</span>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                    <i class="fas fa-calendar-day text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm font-medium">Active Treatments</p>
                                    <p class="text-3xl font-bold" id="activeTreatmentsCount">25</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-xs mr-1"></i>
                                        <span class="text-xs text-purple-100">+5 this month</span>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                    <i class="fas fa-stethoscope text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showView('reports')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm font-medium">Monthly Revenue</p>
                                    <p class="text-3xl font-bold" id="monthlyRevenue">BD 4,250</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-xs mr-1"></i>
                                        <span class="text-xs text-orange-100">+12% vs last month</span>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                    <i class="fas fa-chart-line text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Dashboard Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                        <!-- Left Column - Charts and Analytics -->
                        <div class="lg:col-span-2 space-y-8">
                            <!-- Patient Registration Trends -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                        <i class="fas fa-chart-line text-primary mr-2"></i>
                                        Patient Registration Trends
                                    </h3>
                                    <select id="chartTimeRange" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700">
                                        <option value="7">Last 7 days</option>
                                        <option value="30" selected>Last 30 days</option>
                                        <option value="90">Last 90 days</option>
                                    </select>
                                </div>
                                <div class="h-80">
                                    <canvas id="patientRegistrationChart"></canvas>
                                </div>
                            </div>

                            <!-- Treatment Types Distribution -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-chart-pie text-secondary mr-2"></i>
                                    Treatment Types Distribution
                                </h3>
                                <div class="h-80">
                                    <canvas id="treatmentTypesChart"></canvas>
                                </div>
                            </div>

                            <!-- Monthly Revenue Trend -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-chart-area text-green-600 mr-2"></i>
                                    Monthly Revenue Trends
                                </h3>
                                <div class="h-80">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>

                            <!-- Appointment Volume Analytics -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
                                    Weekly Appointment Volume
                                </h3>
                                <div class="h-80">
                                    <canvas id="appointmentVolumeChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Activity Feed and Quick Actions -->
                        <div class="space-y-8">
                            <!-- System Status -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
                                    <i class="fas fa-server text-green-600 mr-2"></i>
                                    System Status
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Database</span>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-green-600">Online</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">API Services</span>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-green-600">Operational</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Backup System</span>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-yellow-600">Syncing</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Security</span>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-green-600">Secure</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-bolt text-yellow-600 mr-2"></i>
                                    Quick Actions
                                </h3>
                                <div class="space-y-3">
                                    <button onclick="showAddPatientModal()" class="w-full flex items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors group">
                                        <div class="bg-blue-600 text-white p-3 rounded-lg mr-4 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-user-plus"></i>
                                        </div>
                                        <div class="text-left">
                                            <p class="font-semibold text-blue-900 dark:text-blue-100">Add New Patient</p>
                                            <p class="text-sm text-blue-600 dark:text-blue-300">Register patient information</p>
                                        </div>
                                    </button>

                                    <button onclick="showScheduleAppointmentModal()" class="w-full flex items-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors group">
                                        <div class="bg-green-600 text-white p-3 rounded-lg mr-4 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-calendar-plus"></i>
                                        </div>
                                        <div class="text-left">
                                            <p class="font-semibold text-green-900 dark:text-green-100">Schedule Appointment</p>
                                            <p class="text-sm text-green-600 dark:text-green-300">Book new session</p>
                                        </div>
                                    </button>

                                    <button onclick="showAddPhysiotherapistModal()" class="w-full flex items-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-colors group">
                                        <div class="bg-purple-600 text-white p-3 rounded-lg mr-4 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-user-md"></i>
                                        </div>
                                        <div class="text-left">
                                            <p class="font-semibold text-purple-900 dark:text-purple-100">Add Staff Member</p>
                                            <p class="text-sm text-purple-600 dark:text-purple-300">Register physiotherapist</p>
                                        </div>
                                    </button>

                                    <button onclick="generateReport()" class="w-full flex items-center p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/30 transition-colors group">
                                        <div class="bg-orange-600 text-white p-3 rounded-lg mr-4 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div class="text-left">
                                            <p class="font-semibold text-orange-900 dark:text-orange-100">Generate Report</p>
                                            <p class="text-sm text-orange-600 dark:text-orange-300">Create analytics report</p>
                                        </div>
                                    </button>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-clock text-gray-600 mr-2"></i>
                                    Recent Activity
                                </h3>
                                <div class="space-y-4" id="recentActivityList">
                                    <div class="flex items-start space-x-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-user-plus text-blue-600"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">New patient registered</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Fatima Al-Zahra joined the system</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="text-xs text-gray-400">2 min ago</span>
                                        </div>
                                    </div>

                                    <div class="flex items-start space-x-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-calendar-check text-green-600"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Appointment completed</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Ahmed Al-Khalifa session finished</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="text-xs text-gray-400">1 hour ago</span>
                                        </div>
                                    </div>

                                    <div class="flex items-start space-x-3 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-file-medical text-purple-600"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Treatment plan updated</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Dr. Mariam updated therapy schedule</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="text-xs text-gray-400">3 hours ago</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Schedule Preview -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                <i class="fas fa-calendar-day text-primary mr-2"></i>
                                Today's Schedule Preview
                            </h3>
                            <button onclick="showView('appointments')" class="text-primary hover:text-secondary font-semibold text-sm">
                                View All Appointments →
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="todaysSchedule">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-semibold text-primary">10:00 AM</span>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">upcoming</span>
                                </div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-1">Ahmed Al-Khalifa</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Back Pain Therapy</p>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>60 min</span>
                                </div>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-semibold text-primary">11:30 AM</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">confirmed</span>
                                </div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-1">Fatima Al-Zahra</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Knee Rehabilitation</p>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>45 min</span>
                                </div>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-semibold text-primary">2:00 PM</span>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">upcoming</span>
                                </div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-1">Dhari Fakhroo</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Follow-up Session</p>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>45 min</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Patient Satisfaction</h4>
                                <i class="fas fa-star text-yellow-500"></i>
                            </div>
                            <div class="flex items-end">
                                <span class="text-3xl font-bold text-yellow-500">4.8</span>
                                <span class="text-sm text-gray-500 ml-2 mb-1">/5.0</span>
                            </div>
                            <p class="text-sm text-green-600">+0.2 from last month</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Treatment Success</h4>
                                <i class="fas fa-check-circle text-green-500"></i>
                            </div>
                            <div class="flex items-end">
                                <span class="text-3xl font-bold text-green-500">92</span>
                                <span class="text-sm text-gray-500 ml-2 mb-1">%</span>
                            </div>
                            <p class="text-sm text-green-600">+3% improvement</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Avg Session Time</h4>
                                <i class="fas fa-clock text-blue-500"></i>
                            </div>
                            <div class="flex items-end">
                                <span class="text-3xl font-bold text-blue-500">45</span>
                                <span class="text-sm text-gray-500 ml-2 mb-1">min</span>
                            </div>
                            <p class="text-sm text-blue-600">Optimal duration</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Equipment Usage</h4>
                                <i class="fas fa-dumbbell text-purple-500"></i>
                            </div>
                            <div class="flex items-end">
                                <span class="text-3xl font-bold text-purple-500">78</span>
                                <span class="text-sm text-gray-500 ml-2 mb-1">%</span>
                            </div>
                            <p class="text-sm text-purple-600">High utilization</p>
                        </div>
                    </div>
                </div>

                <!-- Patients View -->
                <div id="patients" class="view hidden">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Patient Management</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage patient records, medical history, and treatment plans</p>
                        </div>
                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400 mt-4 lg:mt-0">
                            <i class="fas fa-users mr-2"></i>
                            <span id="patientCount">Total: 0 patients</span>
                        </div>
                    </div>

                    <!-- Patient Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Active Patients</p>
                                    <p class="text-2xl font-bold text-green-600" id="activePatientsCount">0</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-user-check text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">New This Week</p>
                                    <p class="text-2xl font-bold text-blue-600" id="newPatientsCount">2</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-user-plus text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Avg Age</p>
                                    <p class="text-2xl font-bold text-purple-600">32</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-birthday-cake text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Recovery Rate</p>
                                    <p class="text-2xl font-bold text-yellow-600">89%</p>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3">
                                    <i class="fas fa-chart-line text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Search and Filter Bar -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
                            <div class="flex-1 w-full lg:w-auto">
                                <div class="relative">
                                    <input type="text" id="patientSearchInput" placeholder="Search by name, CPR, phone, or condition..." class="w-full px-4 py-3 pl-12 pr-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <select id="patientStatusFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Status</option>
                                    <option value="active">Active Treatment</option>
                                    <option value="completed">Treatment Completed</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                
                                <select id="patientPhysioFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Physiotherapists</option>
                                    <option value="Dr. Mariam Abdulatheem Ali">Dr. Mariam Abdulatheem Ali</option>
                                </select>
                                
                                <button id="clearFiltersBtn" class="px-4 py-3 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-times mr-2"></i>Clear
                                </button>
                                
                                <button onclick="exportPatients()" class="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                    <i class="fas fa-download mr-2"></i>Export
                                </button>
                                
                                <button onclick="showAddPatientModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                    <i class="fas fa-user-plus mr-2"></i>Add New Patient
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Patients Grid -->
                    <div id="patientsGrid">
                        <div id="patientsGridContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                        <div id="noPatientsFound" class="text-center py-12">
                            <div class="max-w-md mx-auto">
                                <i class="fas fa-users text-gray-300 dark:text-gray-600 text-6xl mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">No Patients Yet</h3>
                                <p class="text-gray-500 dark:text-gray-500 mb-6">Add your first patient to get started with comprehensive patient management.</p>
                                <button onclick="showAddPatientModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                    <i class="fas fa-user-plus mr-2"></i>Add First Patient
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Appointments View -->
                <div id="appointments" class="view hidden">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Appointment Management</h1>
                            <p class="text-gray-600 dark:text-gray-400">Schedule and manage patient appointments with calendar integration</p>
                        </div>
                        <div class="flex gap-3 mt-4 lg:mt-0">
                            <button onclick="showCalendarView()" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-calendar-alt mr-2"></i>Calendar View
                            </button>
                            <div class="flex gap-3">
                                <button onclick="showScheduleAppointmentModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                    <i class="fas fa-calendar-plus mr-2"></i>Schedule Appointment
                                </button>
                                <button onclick="showBulkAppointmentModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                                    <i class="fas fa-calendar-week mr-2"></i>Bulk Schedule
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Appointment Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Today</p>
                                    <p class="text-2xl font-bold text-blue-600" id="todayAppointments">3</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-calendar-day text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">This Week</p>
                                    <p class="text-2xl font-bold text-green-600">18</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-calendar-week text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Pending</p>
                                    <p class="text-2xl font-bold text-yellow-600">5</p>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3">
                                    <i class="fas fa-clock text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Completed</p>
                                    <p class="text-2xl font-bold text-purple-600">42</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-check-circle text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Cancelled</p>
                                    <p class="text-2xl font-bold text-red-600">2</p>
                                </div>
                                <div class="bg-red-100 dark:bg-red-900/30 rounded-lg p-3">
                                    <i class="fas fa-times-circle text-red-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Appointment Filters and Search -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
                            <div class="flex-1 w-full">
                                <div class="relative">
                                    <input type="text" id="appointmentSearchInput" placeholder="Search appointments..." class="w-full px-4 py-3 pl-12 pr-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <input type="date" id="appointmentDateFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                
                                <select id="appointmentStatusFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Status</option>
                                    <option value="scheduled">Scheduled</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                
                                <select id="appointmentPhysioFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Physiotherapists</option>
                                    <option value="Dr. Mariam Abdulatheem Ali">Dr. Mariam Abdulatheem Ali</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Appointments Highlight -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-6 mb-6 border border-blue-200 dark:border-blue-800">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-blue-900 dark:text-blue-100">
                                <i class="fas fa-calendar-day text-blue-600 mr-2"></i>
                                Today's Schedule
                            </h3>
                            <span class="px-3 py-1 bg-blue-600 text-white rounded-full text-sm font-medium">
                                3 appointments
                            </span>
                        </div>
                        <div class="text-center py-8">
                            <i class="fas fa-calendar-times text-gray-300 dark:text-gray-600 text-4xl mb-4"></i>
                            <h4 class="text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2">No Appointments Today</h4>
                            <p class="text-gray-500 dark:text-gray-500 mb-4">Your schedule is clear for today. Time to catch up on administrative tasks!</p>
                            <button onclick="showScheduleAppointmentModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-calendar-plus mr-2"></i>Schedule First Appointment
                            </button>
                        </div>
                    </div>



                    <!-- Appointments Table -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">All Appointments</h3>
                            <div class="flex gap-2">
                                <button onclick="exportAppointments()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                    <i class="fas fa-download mr-1"></i>Export
                                </button>
                                <button onclick="printSchedule()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm">
                                    <i class="fas fa-print mr-1"></i>Print
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date & Time</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Patient</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Physiotherapist</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Treatment</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Duration</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="appointmentsTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="mt-6 flex items-center justify-between">
                            <div class="flex items-center text-sm text-gray-500 dark:text-gray-400">
                                <span>Showing <span class="font-medium text-gray-900 dark:text-white">1</span> to <span class="font-medium text-gray-900 dark:text-white">10</span> of <span class="font-medium text-gray-900 dark:text-white">20</span> results</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="px-3 py-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="px-3 py-2 bg-primary text-white border border-primary rounded-lg text-sm">1</button>
                                <button class="px-3 py-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">2</button>
                                <button class="px-3 py-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>


                </div>

                <!-- Physiotherapists View -->
                <div id="physiotherapists" class="view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Physiotherapist Management</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage your physiotherapy staff</p>
                        </div>
                        <button onclick="showAddPhysiotherapistModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                            <i class="fas fa-user-plus mr-2"></i>Add New Physiotherapist
                        </button>
                    </div>



                    <div id="physiotherapistsGrid">
                        <div id="physiotherapistsGridContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                        <div id="noPhysiotherapistsFound" class="text-center py-12">
                            <div class="max-w-md mx-auto">
                                <i class="fas fa-user-md text-gray-300 dark:text-gray-600 text-6xl mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">No Physiotherapists Yet</h3>
                                <p class="text-gray-500 dark:text-gray-500 mb-6">Add your first physiotherapist.</p>
                                <button onclick="showAddPhysiotherapistModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                    <i class="fas fa-user-plus mr-2"></i>Add First Physiotherapist
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users & Admins View -->
                <div id="users" class="view hidden">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Users & Admins</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage system administrators and user permissions</p>
                        </div>
                        <div class="flex gap-3 mt-4 lg:mt-0">
                            <button onclick="showAddUserModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-user-plus mr-2"></i>Add New Admin
                            </button>
                            <button onclick="exportUsers()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold">
                                <i class="fas fa-download mr-2"></i>Export Users
                            </button>
                        </div>
                    </div>

                    <!-- Search and Filters -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
                            <div class="flex-1 w-full lg:w-auto">
                                <div class="relative">
                                    <input type="text" placeholder="Search users by name, email, or role..." class="w-full px-4 py-3 pl-12 pr-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <select class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Roles</option>
                                    <option value="administrator">Administrator</option>
                                    <option value="physiotherapist">Physiotherapist</option>
                                    <option value="manager">Manager</option>
                                    <option value="staff">Staff</option>
                                </select>
                                
                                <select class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="pending">Pending</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Users Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total Admins</p>
                                    <p class="text-2xl font-bold text-red-600">1</p>
                                </div>
                                <div class="bg-red-100 dark:bg-red-900/30 rounded-lg p-3">
                                    <i class="fas fa-user-shield text-red-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total Staff</p>
                                    <p class="text-2xl font-bold text-blue-600">1</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Active Users</p>
                                    <p class="text-2xl font-bold text-green-600">2</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Last 24h Logins</p>
                                    <p class="text-2xl font-bold text-purple-600">3</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-sign-in-alt text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User Management Content -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">System Users</h3>
                        <div class="text-center py-8">
                            <i class="fas fa-users text-gray-300 dark:text-gray-600 text-4xl mb-4"></i>
                            <h4 class="text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2">User Management</h4>
                            <p class="text-gray-500 dark:text-gray-500 mb-4">Add administrators and manage user permissions</p>
                        </div>
                    </div>
                </div>

                <!-- Exercises View -->
                <div id="exercises" class="view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Exercise Library</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage exercises and track patient progress</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="showBulkUploadModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                                <i class="fas fa-file-word mr-2"></i>Upload Word Doc
                            </button>
                            <button onclick="showAddExerciseModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-plus mr-2"></i>Add New Exercise
                            </button>
                            <button onclick="exportExerciseLibrary()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold">
                                <i class="fas fa-download mr-2"></i>Export Library
                            </button>
                        </div>
                    </div>

                    <!-- New Exercises Alert -->
                    <div id="newExercisesAlert" class="hidden bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg p-4 mb-6 border border-green-200 dark:border-green-800">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-plus-circle text-green-600 text-xl mr-3"></i>
                                <div>
                                    <h3 class="text-lg font-semibold text-green-900 dark:text-green-100">New Exercises Added!</h3>
                                    <p class="text-sm text-green-700 dark:text-green-300" id="newExercisesText">3 new exercises have been added to your library</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="viewNewExercises()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium">
                                    <i class="fas fa-eye mr-2"></i>View New Exercises
                                </button>
                                <button onclick="hideNewExercisesAlert()" class="text-green-600 hover:text-green-800 p-2">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total Exercises</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white total-exercises-count">3</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-dumbbell text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Categories</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">3</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-list text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Completed Sessions</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">25</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-check-circle text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Progress Rate</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">92%</p>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3">
                                    <i class="fas fa-trophy text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Exercise Categories -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Exercise Categories</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-blue-900 dark:text-blue-100">Strength Training</h4>
                                    <i class="fas fa-dumbbell text-blue-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-blue-900 dark:text-blue-100">12</p>
                                <p class="text-sm text-blue-600 dark:text-blue-300">Exercises</p>
                            </div>

                            <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-green-900 dark:text-green-100">Flexibility</h4>
                                    <i class="fas fa-expand-arrows-alt text-green-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-green-900 dark:text-green-100">8</p>
                                <p class="text-sm text-green-600 dark:text-green-300">Exercises</p>
                            </div>

                            <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-purple-900 dark:text-purple-100">Balance</h4>
                                    <i class="fas fa-balance-scale text-purple-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-purple-900 dark:text-purple-100">6</p>
                                <p class="text-sm text-purple-600 dark:text-purple-300">Exercises</p>
                            </div>

                            <div class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-orange-900 dark:text-orange-100">Rehabilitation</h4>
                                    <i class="fas fa-heart text-orange-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-orange-900 dark:text-orange-100">16</p>
                                <p class="text-sm text-orange-600 dark:text-orange-300">Exercises</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Exercise Activity -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Recent Exercise Activity</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-dumbbell text-white text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-900 dark:text-white">Shoulder Strengthening</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Completed by Ahmed Al-Khalifa</p>
                                    </div>
                                </div>
                                <span class="text-sm text-gray-500 dark:text-gray-400">2 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports View -->
                <div id="reports" class="view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Reports & Analytics</h1>
                            <p class="text-gray-600 dark:text-gray-400">Generate comprehensive reports and analyze clinic performance</p>
                        </div>
                        <button onclick="generateCustomReport()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                            <i class="fas fa-chart-line mr-2"></i>Generate Custom Report
                        </button>
                    </div>

                    <!-- Report Types -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Patient Reports</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Generate detailed patient progress and treatment reports.</p>
                            <button onclick="generatePatientReport()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-file-pdf mr-2"></i>Generate Report
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Financial Reports</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Track revenue, expenses, and financial performance.</p>
                            <button onclick="generateFinancialReport()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-chart-bar mr-2"></i>Generate Report
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-calendar-alt text-purple-600 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Appointment Reports</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Analyze appointment trends and scheduling patterns.</p>
                            <button onclick="generateAppointmentReport()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                <i class="fas fa-calendar-check mr-2"></i>Generate Report
                            </button>
                        </div>
                    </div>

                    <!-- Comprehensive Financial Reports Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-pie text-green-600 mr-2"></i>Revenue by Payment Method
                            </h3>
                            <div class="h-80">
                                <canvas id="paymentMethodChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-line text-blue-600 mr-2"></i>Year-over-Year Revenue Comparison
                            </h3>
                            <div class="h-80">
                                <canvas id="monthlyRevenueCompareChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Patient Analytics -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-bar text-blue-600 mr-2"></i>Patient Age Distribution
                            </h3>
                            <div class="h-64">
                                <canvas id="patientAgeChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-pie text-pink-600 mr-2"></i>Gender Distribution
                            </h3>
                            <div class="h-64">
                                <canvas id="patientGenderChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-doughnut text-green-600 mr-2"></i>Treatment Status
                            </h3>
                            <div class="h-64">
                                <canvas id="treatmentStatusChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Treatment Outcomes Analytics -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-bar text-purple-600 mr-2"></i>Success Rate by Condition
                            </h3>
                            <div class="h-80">
                                <canvas id="successRateChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-scatter text-orange-600 mr-2"></i>Treatment Duration vs Success Rate
                            </h3>
                            <div class="h-80">
                                <canvas id="treatmentDurationChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Summary -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Performance Summary & KPIs</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600 mb-1">94%</div>
                                <div class="text-sm text-blue-600">Patient Satisfaction</div>
                            </div>
                            <div class="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-green-600 mb-1">89%</div>
                                <div class="text-sm text-green-600">Treatment Success</div>
                            </div>
                            <div class="text-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600 mb-1">76%</div>
                                <div class="text-sm text-purple-600">Patient Return Rate</div>
                            </div>
                            <div class="text-center p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-orange-600 mb-1">12.5</div>
                                <div class="text-sm text-orange-600">Avg Sessions/Patient</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">This Month's Performance</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">New Patients:</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">12</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Appointments:</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">156</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Revenue:</span>
                                        <span class="font-semibold text-green-600">BD 4,250</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Completed Treatments:</span>
                                        <span class="font-semibold text-blue-600">142</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Quality Metrics</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Avg Treatment Duration:</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">8.2 weeks</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Cancellation Rate:</span>
                                        <span class="font-semibold text-red-600">4.2%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">No-show Rate:</span>
                                        <span class="font-semibold text-red-600">2.1%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Equipment Utilization:</span>
                                        <span class="font-semibold text-purple-600">78%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settings" class="view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">System Settings</h1>
                            <p class="text-gray-600 dark:text-gray-400">Configure system preferences and clinic settings</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="showSupabaseConnectionModal()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors font-semibold">
                                <i class="fas fa-database mr-2"></i>Connect Supabase
                            </button>
                            <button onclick="saveAllSettings()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-save mr-2"></i>Save All Settings
                            </button>
                        </div>
                    </div>

                    <!-- Supabase Connection Status -->
                    <div id="supabaseStatusCard" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-database text-purple-600 mr-2"></i>Database Connection Status
                        </h3>
                        
                        <div id="supabaseConnected" class="hidden">
                            <div class="flex items-center justify-between p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3 animate-pulse"></div>
                                    <div>
                                        <p class="text-sm font-medium text-green-900 dark:text-green-100">Connected to Supabase</p>
                                        <p class="text-xs text-green-700 dark:text-green-300" id="supabaseProjectUrl">Project: Loading...</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="testSupabaseConnection()" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                        <i class="fas fa-check-circle mr-1"></i>Test Connection
                                    </button>
                                    <button onclick="disconnectSupabase()" class="bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                        <i class="fas fa-unlink mr-1"></i>Disconnect
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="supabaseDisconnected">
                            <div class="flex items-center justify-between p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                    <div>
                                        <p class="text-sm font-medium text-yellow-900 dark:text-yellow-100">Not Connected to Database</p>
                                        <p class="text-xs text-yellow-700 dark:text-yellow-300">Connect to Supabase to enable real-time data synchronization</p>
                                    </div>
                                </div>
                                <button onclick="showSupabaseConnectionModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium">
                                    <i class="fas fa-plug mr-2"></i>Connect Now
                                </button>
                            </div>
                        </div>

                        <!-- Connection Details -->
                        <div id="supabaseDetails" class="hidden mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500 dark:text-gray-400">Connection Status:</span>
                                    <span class="font-medium text-green-600" id="connectionStatus">Active</span>
                                </div>
                                <div>
                                    <span class="text-gray-500 dark:text-gray-400">Last Connected:</span>
                                    <span class="font-medium text-gray-900 dark:text-white" id="lastConnected">Just now</span>
                                </div>
                                <div>
                                    <span class="text-gray-500 dark:text-gray-400">Data Sync:</span>
                                    <span class="font-medium text-blue-600" id="dataSyncStatus">Real-time</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- General Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">General Settings</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Clinic Name</label>
                                    <input type="text" value="Bahrain Mobility International" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Default Session Duration</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="30">30 minutes</option>
                                        <option value="45" selected>45 minutes</option>
                                        <option value="60">60 minutes</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Time Zone</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="GMT+3" selected>GMT+3 (Bahrain)</option>
                                        <option value="GMT+4">GMT+4 (UAE)</option>
                                        <option value="GMT+2">GMT+2 (Egypt)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Notification Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Notification Settings</h3>
                            <div class="space-y-4">
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Email Notifications</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">SMS Reminders</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Push Notifications</span>
                                    <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Appointment Reminders</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                            </div>
                        </div>

                        <!-- System Preferences -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">System Preferences</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Language</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="en" selected>English</option>
                                        <option value="ar">العربية</option>
                                        <option value="fr">Français</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date Format</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Currency</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="BHD" selected>Bahraini Dinar (BD)</option>
                                        <option value="USD">US Dollar ($)</option>
                                        <option value="EUR">Euro (€)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Security Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Security Settings</h3>
                            <div class="space-y-4">
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Require Strong Passwords</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Two-Factor Authentication</span>
                                    <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Auto Logout (30 min)</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <button onclick="changeAdminPassword()" class="w-full bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">
                                    <i class="fas fa-key mr-2"></i>Change Admin Password
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Physiotherapist Dashboard -->
    <div id="physioDashboard" class="hidden">
        <nav class="bg-gradient-to-r from-secondary via-sage to-secondary shadow-2xl fixed top-0 left-0 right-0 z-50">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <div class="flex items-center">
                        <i class="fas fa-user-md text-white text-3xl mr-4 animate-pulse"></i>
                        <span class="text-white text-2xl font-bold">PhysioTech - Dr. Mariam Portal</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-3 text-white">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user-md text-lg"></i>
                            </div>
                            <div class="hidden lg:block">
                                <p class="text-sm font-medium">Dr. Mariam Abdulatheem Ali</p>
                                <p class="text-xs text-gray-200">Physiotherapist</p>
                            </div>
                        </div>
                        
                        <button id="physioLogoutBtn" class="bg-red-500 text-white px-4 py-3 rounded-lg hover:bg-red-600 transition-colors text-sm font-semibold">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex pt-16">
            <div class="w-64 bg-gray-50 dark:bg-gray-800 min-h-screen p-4 fixed left-0 top-16 bottom-0 overflow-y-auto z-40">
                <nav class="space-y-2">
                    <button class="physio-nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors bg-secondary text-white" data-view="physio-dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                    </button>
                    <button class="physio-nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="physio-patients">
                        <i class="fas fa-users mr-3"></i>All Patients
                    </button>
                    <button class="physio-nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="physio-schedule">
                        <i class="fas fa-calendar mr-3"></i>Schedule
                    </button>
                    <button class="physio-nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="physio-exercises">
                        <i class="fas fa-dumbbell mr-3"></i>Exercise Library
                    </button>
                </nav>
            </div>

            <div class="flex-1 ml-64 p-6 min-h-screen">
                <!-- Physiotherapist Dashboard View -->
                <div id="physio-dashboard" class="physio-view">
                    <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-8">Dr. Mariam's Dashboard</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-semibold">Today's Appointments</h3>
                            <p class="text-3xl font-bold">3</p>
                        </div>
                        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-semibold">My Active Patients</h3>
                            <p class="text-3xl font-bold" id="physioActivePatients">12</p>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-semibold">Active Treatments</h3>
                            <p class="text-3xl font-bold">18</p>
                        </div>
                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-semibold">Success Rate</h3>
                            <p class="text-3xl font-bold">94%</p>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">Welcome, Dr. Mariam!</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">Here's your personalized physiotherapist dashboard to manage your patients and appointments.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="showPhysioView('physio-patients')" class="bg-secondary text-white px-6 py-3 rounded-lg hover:bg-sage transition-colors">
                                <i class="fas fa-users mr-2"></i>View My Patients
                            </button>
                            <button onclick="showPhysioView('physio-schedule')" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-calendar mr-2"></i>View Schedule
                            </button>
                        </div>
                    </div>
                </div>

                <!-- All Patients View -->
                <div id="physio-patients" class="physio-view hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">All Patients</h1>
                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                            <i class="fas fa-users mr-2"></i>
                            <span id="physioPatientCount">Assigned: 0 patients</span>
                        </div>
                    </div>

                    <div id="physioMyPatientsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                    <div id="physioNoPatientsFound" class="text-center py-12 hidden">
                        <div class="max-w-md mx-auto">
                            <i class="fas fa-user-md text-gray-300 dark:text-gray-600 text-6xl mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">No Patients Assigned</h3>
                            <p class="text-gray-500 dark:text-gray-500 mb-6">Ask your administrator to assign patients to you.</p>
                        </div>
                    </div>
                </div>

                <!-- Schedule View -->
                <div id="physio-schedule" class="physio-view hidden">
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">My Schedule</h1>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Weekly Schedule</h3>
                        <p class="text-gray-600 dark:text-gray-400">Schedule functionality coming soon!</p>
                    </div>
                </div>

                <!-- Exercise Library View -->
                <div id="physio-exercises" class="physio-view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Exercise Library</h1>
                            <p class="text-gray-600 dark:text-gray-400">Browse and assign exercises to your patients</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="physioAddExercise()" class="bg-secondary text-white px-6 py-3 rounded-lg hover:bg-sage transition-colors font-semibold">
                                <i class="fas fa-plus mr-2"></i>Add Exercise
                            </button>
                            <button onclick="physioExportExercises()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold">
                                <i class="fas fa-download mr-2"></i>Export
                            </button>
                        </div>
                    </div>

                    <!-- Stats Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Available Exercises</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white total-exercises-count">3</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-dumbbell text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Categories</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">3</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-list text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Assigned Today</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">5</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-clipboard-list text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Completion Rate</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">94%</p>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3">
                                    <i class="fas fa-trophy text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search and Filter -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
                            <div class="flex-1 w-full lg:w-auto">
                                <div class="relative">
                                    <input type="text" id="physioExerciseSearch" placeholder="Search exercises by name, category, or body part..." class="w-full px-4 py-3 pl-12 pr-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:ring-2 focus:ring-secondary focus:border-secondary">
                                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <select id="physioExerciseCategory" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Categories</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="flexibility">Flexibility</option>
                                    <option value="balance">Balance</option>
                                    <option value="rehabilitation">Rehabilitation</option>
                                    <option value="cardio">Cardiovascular</option>
                                </select>
                                
                                <select id="physioExerciseDifficulty" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Difficulty</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Categories -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Exercise Categories</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800 cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors" onclick="filterPhysioExercises('strength')">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-blue-900 dark:text-blue-100">Strength Training</h4>
                                    <i class="fas fa-dumbbell text-blue-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-blue-900 dark:text-blue-100">12</p>
                                <p class="text-sm text-blue-600 dark:text-blue-300">Exercises</p>
                            </div>

                            <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800 cursor-pointer hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors" onclick="filterPhysioExercises('flexibility')">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-green-900 dark:text-green-100">Flexibility</h4>
                                    <i class="fas fa-expand-arrows-alt text-green-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-green-900 dark:text-green-100">8</p>
                                <p class="text-sm text-green-600 dark:text-green-300">Exercises</p>
                            </div>

                            <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800 cursor-pointer hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-colors" onclick="filterPhysioExercises('balance')">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-purple-900 dark:text-purple-100">Balance</h4>
                                    <i class="fas fa-balance-scale text-purple-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-purple-900 dark:text-purple-100">6</p>
                                <p class="text-sm text-purple-600 dark:text-purple-300">Exercises</p>
                            </div>

                            <div class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800 cursor-pointer hover:bg-orange-100 dark:hover:bg-orange-900/30 transition-colors" onclick="filterPhysioExercises('rehabilitation')">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-orange-900 dark:text-orange-100">Rehabilitation</h4>
                                    <i class="fas fa-heart text-orange-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-orange-900 dark:text-orange-100">16</p>
                                <p class="text-sm text-orange-600 dark:text-orange-300">Exercises</p>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Grid -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Exercise Library</h3>
                        
                        <div id="physioExerciseGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Sample Exercise Cards -->
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-dumbbell text-white"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900 dark:text-white">Shoulder Strengthening</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Upper Body • Intermediate</p>
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 rounded-full text-xs font-medium">Strength</span>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Resistance band exercises to improve shoulder stability and strength.</p>
                                <div class="flex items-center justify-between">
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        <span>15-20 reps • 3 sets</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="physioViewExercise('shoulder-strengthening')" class="bg-secondary text-white px-3 py-1 rounded text-xs hover:bg-sage transition-colors">
                                            <i class="fas fa-eye mr-1"></i>View
                                        </button>
                                        <button onclick="physioAssignExercise('shoulder-strengthening')" class="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 transition-colors">
                                            <i class="fas fa-plus mr-1"></i>Assign
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-expand-arrows-alt text-white"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900 dark:text-white">Hamstring Stretch</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Lower Body • Beginner</p>
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 rounded-full text-xs font-medium">Flexibility</span>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Gentle stretching exercise to improve hamstring flexibility.</p>
                                <div class="flex items-center justify-between">
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        <span>30 sec hold • 3 sets</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="physioViewExercise('hamstring-stretch')" class="bg-secondary text-white px-3 py-1 rounded text-xs hover:bg-sage transition-colors">
                                            <i class="fas fa-eye mr-1"></i>View
                                        </button>
                                        <button onclick="physioAssignExercise('hamstring-stretch')" class="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 transition-colors">
                                            <i class="fas fa-plus mr-1"></i>Assign
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex items-center">
                                        <div class="w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-balance-scale text-white"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900 dark:text-white">Single Leg Stand</h4>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Balance • Intermediate</p>
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300 rounded-full text-xs font-medium">Balance</span>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Improve balance and proprioception with single leg exercises.</p>
                                <div class="flex items-center justify-between">
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                        <span>30 sec hold • 5 sets</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="physioViewExercise('single-leg-stand')" class="bg-secondary text-white px-3 py-1 rounded text-xs hover:bg-sage transition-colors">
                                            <i class="fas fa-eye mr-1"></i>View
                                        </button>
                                        <button onclick="physioAssignExercise('single-leg-stand')" class="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 transition-colors">
                                            <i class="fas fa-plus mr-1"></i>Assign
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode setup with error handling
        try {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            if (window.matchMedia) {
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    try {
                        if (event.matches) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                        // Update charts when theme changes
                        if (typeof updateChartsForTheme === 'function') {
                            updateChartsForTheme();
                        }
                    } catch (error) {
                        console.log('Dark mode change error:', error.message);
                    }
                });
            }
        } catch (error) {
            console.log('Dark mode setup error:', error.message);
        }

        // Initialize application
        console.log('✅ PhysioTech Application loaded successfully');
        console.log('📧 Admin login: DhariBmi@gmail.com / Dharui1979');
        console.log('👩‍⚕️ Physiotherapist login: Mariambmi@gmail.com / Mariam1979!');

        // EmailJS Configuration - Initialize EmailJS for sending real emails
        let emailJSInitialized = false;
        let emailJSConfig = {
            serviceId: '',
            templateId: '',
            publicKey: ''
        };

        // Storage fallback for sandboxed environment
        const SafeStorage = {
            storage: new Map(),
            
            setItem: function(key, value) {
                try {
                    localStorage.setItem(key, value);
                } catch (error) {
                    console.log('localStorage not available, using memory storage');
                    this.storage.set(key, value);
                }
            },
            
            getItem: function(key) {
                try {
                    return localStorage.getItem(key);
                } catch (error) {
                    console.log('localStorage not available, using memory storage');
                    return this.storage.get(key) || null;
                }
            },
            
            removeItem: function(key) {
                try {
                    localStorage.removeItem(key);
                } catch (error) {
                    console.log('localStorage not available, using memory storage');
                    this.storage.delete(key);
                }
            }
        };

        const SafeSessionStorage = {
            storage: new Map(),
            
            setItem: function(key, value) {
                try {
                    sessionStorage.setItem(key, value);
                } catch (error) {
                    console.log('sessionStorage not available, using memory storage');
                    this.storage.set(key, value);
                }
            },
            
            getItem: function(key) {
                try {
                    return sessionStorage.getItem(key);
                } catch (error) {
                    console.log('sessionStorage not available, using memory storage');
                    return this.storage.get(key) || null;
                }
            },
            
            removeItem: function(key) {
                try {
                    sessionStorage.removeItem(key);
                } catch (error) {
                    console.log('sessionStorage not available, using memory storage');
                    this.storage.delete(key);
                }
            }
        };
        
        function initializeEmailJS() {
            if (typeof emailjs !== 'undefined') {
                try {
                    // Show configuration modal if not configured
                    if (!emailJSConfig.publicKey) {
                        showEmailJSConfigModal();
                        return;
                    }
                    
                    // Initialize EmailJS with configured public key
                    emailjs.init(emailJSConfig.publicKey);
                    emailJSInitialized = true;
                    console.log('📧 EmailJS initialized successfully');
                    showNotification('📧 EmailJS connected - Real emails will be sent to patients!', 'success');
                } catch (error) {
                    console.log('EmailJS initialization error:', error.message);
                    showNotification('⚠️ EmailJS initialization failed', 'error');
                }
            } else {
                console.log('⚠️ EmailJS library not loaded');
            }
        }

        function showEmailJSConfigModal() {
            const content = `
                <div class="space-y-6">
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800">
                        <h4 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3 flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>EmailJS Configuration Required
                        </h4>
                        <p class="text-sm text-blue-800 dark:text-blue-300 mb-4">
                            To send real emails to patients, you need to configure EmailJS with your account credentials.
                            This enables automatic appointment confirmations and notifications.
                        </p>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4">
                            <h5 class="font-semibold text-gray-900 dark:text-white mb-2">📋 Setup Instructions:</h5>
                            <ol class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-decimal list-inside">
                                <li>Create a free account at <a href="https://emailjs.com" target="_blank" class="text-blue-600 hover:underline">EmailJS.com</a></li>
                                <li>Create an email service (Gmail, Outlook, etc.)</li>
                                <li>Create an email template for appointment confirmations</li>
                                <li>Get your Public Key from the dashboard</li>
                                <li>Enter the credentials below</li>
                            </ol>
                        </div>
                    </div>

                    <form id="emailJSConfigForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-white mb-2">EmailJS Public Key *</label>
                            <input type="text" id="emailjsPublicKey" name="publicKey" required placeholder="Enter your EmailJS public key" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <p class="text-xs text-gray-400 mt-1">Found in your EmailJS dashboard under "Account" → "General"</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-white mb-2">Service ID *</label>
                            <input type="text" id="emailjsServiceId" name="serviceId" required placeholder="Enter your service ID" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <p class="text-xs text-gray-400 mt-1">Found in your EmailJS dashboard under "Email Services"</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-white mb-2">Template ID *</label>
                            <input type="text" id="emailjsTemplateId" name="templateId" required placeholder="Enter your template ID" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <p class="text-xs text-gray-400 mt-1">Found in your EmailJS dashboard under "Email Templates"</p>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800">
                            <h5 class="font-semibold text-yellow-900 dark:text-yellow-100 mb-2 flex items-center">
                                <i class="fas fa-lightbulb text-yellow-600 mr-2"></i>Template Variables
                            </h5>
                            <p class="text-sm text-yellow-800 dark:text-yellow-300 mb-2">
                                Your EmailJS template should include these variables:
                            </p>
                            <div class="grid grid-cols-2 gap-2 text-xs font-mono bg-gray-800 text-gray-300 p-3 rounded">
                                <div>{{patient_name}}</div>
                                <div>{{appointment_date}}</div>
                                <div>{{appointment_time}}</div>
                                <div>{{physiotherapist}}</div>
                                <div>{{treatment_type}}</div>
                                <div>{{duration}}</div>
                                <div>{{notes}}</div>
                                <div>{{patient_email}}</div>
                            </div>
                        </div>
                    </form>

                    <div class="bg-gray-700 rounded-lg p-4">
                        <h5 class="font-semibold text-gray-300 mb-2">🔒 Privacy & Security</h5>
                        <p class="text-sm text-gray-400">
                            Your EmailJS credentials are stored locally in your browser and are not sent to any external servers. 
                            They are only used to send emails directly through the EmailJS service.
                        </p>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-envelope-open-text text-blue-400 mr-2"></i>Configure Real Email Sending
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <button class="skip-config px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Skip (Show Preview Only)
                        </button>
                        <div class="flex gap-3">
                            <button class="test-config px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                <i class="fas fa-paper-plane mr-2"></i>Test Configuration
                            </button>
                            <button class="save-config px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
                                <i class="fas fa-save mr-2"></i>Save & Enable
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const skipBtn = modal.querySelector('.skip-config');
            const testBtn = modal.querySelector('.test-config');
            const saveBtn = modal.querySelector('.save-config');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            skipBtn.onclick = () => {
                showNotification('📧 Email configuration skipped - Will show preview only', 'success');
                closeModal();
            };
            
            testBtn.onclick = () => {
                const form = document.getElementById('emailJSConfigForm');
                const formData = new FormData(form);
                
                const publicKey = formData.get('publicKey')?.trim();
                const serviceId = formData.get('serviceId')?.trim();
                const templateId = formData.get('templateId')?.trim();
                
                if (!publicKey || !serviceId || !templateId) {
                    showNotification('⚠️ Please fill in all required fields', 'error');
                    return;
                }
                
                // Test EmailJS configuration
                testEmailJSConfiguration(publicKey, serviceId, templateId);
            };
            
            saveBtn.onclick = () => {
                const form = document.getElementById('emailJSConfigForm');
                const formData = new FormData(form);
                
                const publicKey = formData.get('publicKey')?.trim();
                const serviceId = formData.get('serviceId')?.trim();
                const templateId = formData.get('templateId')?.trim();
                
                if (!publicKey || !serviceId || !templateId) {
                    showNotification('⚠️ Please fill in all required fields', 'error');
                    return;
                }
                
                // Save configuration
                emailJSConfig = { publicKey, serviceId, templateId };
                localStorage.setItem('emailJSConfig', JSON.stringify(emailJSConfig));
                
                // Initialize EmailJS
                try {
                    emailjs.init(publicKey);
                    emailJSInitialized = true;
                    showNotification('✅ EmailJS configured successfully! Real emails will now be sent to patients.', 'success');
                    closeModal();
                } catch (error) {
                    showNotification('❌ Failed to initialize EmailJS. Please check your credentials.', 'error');
                    console.log('EmailJS init error:', error.message);
                }
            };
        }

        function testEmailJSConfiguration(publicKey, serviceId, templateId) {
            // Show loading state
            const testBtn = document.querySelector('.test-config');
            const originalText = testBtn.innerHTML;
            testBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';
            testBtn.disabled = true;
            
            try {
                // Initialize with test config
                emailjs.init(publicKey);
                
                // Send test email
                const testParams = {
                    patient_name: 'Test Patient',
                    patient_email: 'test@example.com',
                    appointment_date: 'Test Date',
                    appointment_time: 'Test Time',
                    physiotherapist: 'Dr. Test',
                    treatment_type: 'Test Treatment',
                    duration: '45 minutes',
                    notes: 'This is a test email to verify EmailJS configuration.'
                };
                
                emailjs.send(serviceId, templateId, testParams)
                    .then(() => {
                        showNotification('✅ Test email sent successfully! Check your email.', 'success');
                    })
                    .catch((error) => {
                        showNotification('❌ Test failed: ' + (error.text || error.message || 'Unknown error'), 'error');
                        console.log('EmailJS test error:', error);
                    })
                    .finally(() => {
                        testBtn.innerHTML = originalText;
                        testBtn.disabled = false;
                    });
                    
            } catch (error) {
                showNotification('❌ Configuration test failed: ' + error.message, 'error');
                testBtn.innerHTML = originalText;
                testBtn.disabled = false;
            }
        }

        // Load saved EmailJS configuration on startup
        function loadEmailJSConfig() {
            try {
                const saved = localStorage.getItem('emailJSConfig');
                if (saved) {
                    emailJSConfig = JSON.parse(saved);
                    if (emailJSConfig.publicKey) {
                        initializeEmailJS();
                    }
                }
            } catch (error) {
                console.log('Failed to load EmailJS config:', error.message);
            }
        }

        // Data Store - Clean system with only Dr. Mariam Abdulatheem Ali
        const appData = {
            patients: [],
            appointments: [],
            physiotherapists: [
                {
                    id: 'physio-001',
                    firstName: 'Mariam',
                    lastName: 'Abdulatheem Ali',
                    email: 'Mariambmi@gmail.com',
                    phone: '+973 3333 9999',
                    licenseNumber: 'BH-PT-2024-001',
                    specializations: ['Orthopedic', 'Sports Medicine', 'Manual Therapy'],
                    experience: '8 years',
                    status: 'active',
                    assignedPatients: 0,
                    tempPassword: 'Mariam1979!'
                }
            ],
            exercises: [
                // Sample shared exercises visible to everyone
                {
                    id: 'ex-001',
                    name: 'Shoulder Strengthening',
                    category: 'strength',
                    difficulty: 'intermediate',
                    description: 'Resistance band exercises to improve shoulder stability and strength.',
                    targetAreas: ['shoulders', 'upper-back'],
                    equipment: 'resistance-band',
                    duration: '15 minutes',
                    sets: 3,
                    reps: '15-20',
                    createdBy: 'Dr. Mariam Abdulatheem Ali',
                    createdDate: new Date().toISOString(),
                    version: '1.0'
                },
                {
                    id: 'ex-002',
                    name: 'Hamstring Stretch',
                    category: 'flexibility',
                    difficulty: 'beginner',
                    description: 'Gentle stretching exercise to improve hamstring flexibility.',
                    targetAreas: ['legs', 'lower-back'],
                    equipment: 'mat',
                    duration: '10 minutes',
                    sets: 3,
                    reps: '30 sec hold',
                    createdBy: 'Admin User',
                    createdDate: new Date().toISOString(),
                    version: '1.0'
                },
                {
                    id: 'ex-003',
                    name: 'Single Leg Stand',
                    category: 'balance',
                    difficulty: 'intermediate',
                    description: 'Improve balance and proprioception with single leg exercises.',
                    targetAreas: ['legs', 'balance', 'core-abs'],
                    equipment: '',
                    duration: '10 minutes',
                    sets: 5,
                    reps: '30 sec hold',
                    createdBy: 'Dr. Mariam Abdulatheem Ali',
                    createdDate: new Date().toISOString(),
                    version: '1.0'
                }
            ]
        };

        // Utility Functions
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancel</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            const cancelBtn = modal.querySelector('.cancel-btn');
            const confirmBtn = modal.querySelector('.confirm-btn');
            
            cancelBtn.onclick = () => modal.remove();
            confirmBtn.onclick = () => {
                modal.remove();
                if (typeof onConfirm === 'function') onConfirm();
            };
        }

        // Login Functions
        document.getElementById('adminLoginBtn').onclick = () => {
            document.getElementById('userTypeSelection').classList.add('hidden');
            document.getElementById('adminLoginPage').classList.remove('hidden');
        };

        document.getElementById('physioLoginBtn').onclick = () => {
            document.getElementById('userTypeSelection').classList.add('hidden');
            document.getElementById('physioLoginPage').classList.remove('hidden');
        };

        document.getElementById('backToSelection').onclick = () => {
            document.getElementById('physioLoginPage').classList.add('hidden');
            document.getElementById('userTypeSelection').classList.remove('hidden');
        };

        document.getElementById('backToSelectionFromAdmin').onclick = () => {
            document.getElementById('adminLoginPage').classList.add('hidden');
            document.getElementById('userTypeSelection').classList.remove('hidden');
        };

        document.getElementById('togglePassword').onclick = function() {
            const passwordInput = document.getElementById('loginPassword');
            const icon = this.querySelector('i');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        };

        document.getElementById('togglePhysioPassword').onclick = function() {
            const passwordInput = document.getElementById('physioLoginPassword');
            const icon = this.querySelector('i');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        };

        // Login handlers
        document.getElementById('loginForm').onsubmit = (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (email === 'DhariBmi@gmail.com' && password === 'Dharui1979') {
                document.getElementById('adminLoginPage').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                setTimeout(() => {
                    initializeDashboard();
                    setupNavigation();
                }, 100);
                showNotification('✅ Admin login successful!', 'success');
            } else {
                errorDiv.textContent = '❌ Invalid credentials. Use: DhariBmi@gmail.com / Dharui1979';
                errorDiv.classList.remove('hidden');
                setTimeout(() => errorDiv.classList.add('hidden'), 5000);
            }
        };

        document.getElementById('physioLoginForm').onsubmit = (e) => {
            e.preventDefault();
            const email = document.getElementById('physioLoginEmail').value.trim();
            const password = document.getElementById('physioLoginPassword').value;
            const errorDiv = document.getElementById('physioLoginError');

            // Check against registered physiotherapists
            const physiotherapist = appData.physiotherapists.find(p => 
                p.email.toLowerCase() === email.toLowerCase() && 
                (p.tempPassword === password || p.password === password) &&
                p.status === 'active'
            );

            if (physiotherapist) {
                // Store logged-in physiotherapist info
                SafeSessionStorage.setItem('loggedInPhysiotherapist', JSON.stringify(physiotherapist));
                
                document.getElementById('physioLoginPage').classList.add('hidden');
                document.getElementById('physioDashboard').classList.remove('hidden');
                
                setTimeout(() => initializePhysioDashboard(), 100);
                showNotification(`✅ Welcome back, Dr. ${physiotherapist.firstName} ${physiotherapist.lastName}!`, 'success');
            } else {
                errorDiv.textContent = '❌ Invalid credentials or account inactive. Please contact your administrator.';
                errorDiv.classList.remove('hidden');
                setTimeout(() => errorDiv.classList.add('hidden'), 5000);
            }
        };

        // Logout handlers
        document.getElementById('adminLogoutBtn').onclick = () => {
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('userTypeSelection').classList.remove('hidden');
            showNotification('👋 Logged out successfully', 'success');
        };

        document.getElementById('physioLogoutBtn').onclick = () => {
            document.getElementById('physioDashboard').classList.add('hidden');
            document.getElementById('userTypeSelection').classList.remove('hidden');
            showNotification('👋 Logged out successfully', 'success');
        };

        // Navigation
        function setupNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.onclick = () => {
                    const view = btn.dataset.view;
                    showView(view);
                    document.querySelectorAll('.nav-btn').forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                    });
                    btn.classList.add('bg-primary', 'text-white');
                };
            });
        }

        function showView(viewName) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            const targetView = document.getElementById(viewName);
            if (targetView) {
                targetView.classList.remove('hidden');
                if (viewName === 'patients') {
                    updatePatientsDisplay();
                }
                if (viewName === 'appointments') {
                    updateAppointmentDisplay();
                }
                if (viewName === 'physiotherapists') {
                    updatePhysiotherapistsDisplay();
                }
            }
        }

        // Dashboard Functions
        function initializeDashboard() {
            updateDashboardStats();
            updateExerciseStatistics();
            initializeAllCharts();
            console.log('📊 Dashboard initialized successfully');
        }

        function updateDashboardStats() {
            const patients = appData.patients || [];
            const totalPatientsEl = document.getElementById('totalPatientsCount');
            if (totalPatientsEl) {
                totalPatientsEl.textContent = patients.length;
            }
            const patientCountEl = document.getElementById('patientCount');
            if (patientCountEl) {
                patientCountEl.textContent = `Total: ${patients.length} patient${patients.length !== 1 ? 's' : ''}`;
            }
        }

        // Patient Management
        function updatePatientsDisplay() {
            const patients = appData.patients || [];
            const gridContainer = document.getElementById('patientsGridContainer');
            const emptyState = document.getElementById('noPatientsFound');
            const patientCountEl = document.getElementById('patientCount');

            if (patientCountEl) {
                patientCountEl.textContent = `Total: ${patients.length} patient${patients.length !== 1 ? 's' : ''}`;
            }

            if (patients.length === 0) {
                if (gridContainer) gridContainer.innerHTML = '';
                if (emptyState) emptyState.style.display = 'block';
            } else {
                if (emptyState) emptyState.style.display = 'none';
                
                if (gridContainer) {
                    gridContainer.innerHTML = patients.map(patient => `
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center text-white font-bold mr-3">
                                        ${patient.firstName.charAt(0)}${patient.lastName.charAt(0)}
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                            ${patient.firstName} ${patient.lastName}
                                        </h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            CPR: ${patient.cprNumber}
                                        </p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 ${patient.treatmentStatus === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} rounded-full text-xs font-semibold">
                                    ${(patient.treatmentStatus || 'Active').charAt(0).toUpperCase() + (patient.treatmentStatus || 'active').slice(1)}
                                </span>
                            </div>

                            <div class="space-y-2 mb-4">
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-envelope w-5 mr-2"></i>
                                    <span>${patient.email}</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-phone w-5 mr-2"></i>
                                    <span>${patient.phone}</span>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">
                                    <strong>Current Condition:</strong>
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    ${patient.currentCondition}
                                </p>
                            </div>

                            <div class="flex gap-2 mt-4">
                                <button onclick="viewPatientDetails('${patient.id}')" class="flex-1 bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-colors text-sm">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                <button onclick="editPatient('${patient.id}')" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                                <button onclick="deletePatientWithConfirm('${patient.id}')" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                    <i class="fas fa-trash mr-1"></i>Delete
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            }
            updateDashboardStats();
        }

        function showAddPatientModal() {
            const content = `
                <form id="addPatientForm" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-user text-teal-400 mr-2"></i>Personal Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">First Name *</label>
                                <input type="text" id="firstName" name="firstName" required placeholder="Enter first name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Last Name *</label>
                                <input type="text" id="lastName" name="lastName" required placeholder="Enter last name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" required placeholder="+973 XXXX XXXX" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">CPR Number *</label>
                                <input type="text" id="cprNumber" name="cprNumber" required placeholder="000000000" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date of Birth *</label>
                                <input type="date" id="dateOfBirth" name="dateOfBirth" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Gender *</label>
                                <select id="gender" name="gender" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                            <input type="email" id="email" name="email" placeholder="patient@example.com" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Current Condition *</label>
                            <textarea id="currentCondition" name="currentCondition" rows="3" required placeholder="Describe the patient's current condition and symptoms..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Assigned Physiotherapist *</label>
                            <select id="assignedPhysiotherapist" name="assignedPhysiotherapist" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="">Choose physiotherapist</option>
                                ${appData.physiotherapists.map(physio => `
                                    <option value="Dr. ${physio.firstName} ${physio.lastName}">Dr. ${physio.firstName} ${physio.lastName} - ${physio.specializations.join(', ')}</option>
                                `).join('')}
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Assignment Notes</label>
                            <textarea id="assignmentNotes" name="assignmentNotes" rows="3" placeholder="Add any specific notes for the assigned physiotherapist..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Treatment Status</label>
                            <select id="treatmentStatus" name="treatmentStatus" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="active">Active Treatment</option>
                                <option value="completed">Treatment Completed</option>
                                <option value="inactive">Inactive</option>
                                <option value="on-hold">On Hold</option>
                            </select>
                        </div>
                    </div>

                    <!-- Generate Treatment Document Section -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-file-medical text-teal-400 mr-2"></i>Generate Treatment Document
                        </h4>
                        
                        <div class="bg-gray-700 rounded-lg p-4 mb-4">
                            <p class="text-sm text-gray-300 mb-3">Create a professional treatment form template</p>
                            <button type="button" id="generateTemplateBtn" class="bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700 transition-colors font-medium">
                                <i class="fas fa-file-word mr-2"></i>Generate Template
                            </button>
                        </div>
                    </div>

                    <!-- Upload Media & Documents Section -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-upload text-teal-400 mr-2"></i>Upload Media & Documents
                        </h4>
                        
                        <div class="bg-gray-700 rounded-lg p-4 mb-4">
                            <!-- Upload Area -->
                            <div id="uploadArea" class="border-2 border-dashed border-gray-500 rounded-lg p-6 text-center hover:border-teal-400 transition-colors cursor-pointer">
                                <i class="fas fa-cloud-upload-alt text-gray-400 text-4xl mb-3"></i>
                                <p class="text-lg text-gray-300 mb-2">Drop files here or click to browse</p>
                                <p class="text-sm text-gray-400 mb-4">Support for images, videos, documents, and PDFs</p>
                                <input type="file" id="treatmentDocuments" name="treatmentDocuments" multiple accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif,.bmp,.webp,.mp4,.avi,.mov,.wmv,.flv,.webm,.mkv" class="hidden">
                                <div class="flex flex-wrap gap-2 justify-center">
                                    <button type="button" onclick="document.getElementById('treatmentDocuments').click()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        <i class="fas fa-folder-open mr-2"></i>Choose Files
                                    </button>
                                    <button type="button" onclick="clearAllFiles()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                        <i class="fas fa-trash mr-2"></i>Clear All
                                    </button>
                                </div>
                            </div>

                            <!-- File Type Categories -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 mb-4">
                                <div class="bg-gray-600 rounded-lg p-3 text-center">
                                    <i class="fas fa-image text-blue-400 text-2xl mb-2"></i>
                                    <p class="text-sm text-gray-300 font-medium">Images</p>
                                    <p class="text-xs text-gray-400">JPG, PNG, GIF, WebP</p>
                                </div>
                                <div class="bg-gray-600 rounded-lg p-3 text-center">
                                    <i class="fas fa-video text-red-400 text-2xl mb-2"></i>
                                    <p class="text-sm text-gray-300 font-medium">Videos</p>
                                    <p class="text-xs text-gray-400">MP4, AVI, MOV, WebM</p>
                                </div>
                                <div class="bg-gray-600 rounded-lg p-3 text-center">
                                    <i class="fas fa-file-alt text-green-400 text-2xl mb-2"></i>
                                    <p class="text-sm text-gray-300 font-medium">Documents</p>
                                    <p class="text-xs text-gray-400">PDF, DOC, DOCX, TXT</p>
                                </div>
                            </div>
                            
                            <!-- Uploaded Files Display -->
                            <div id="uploadedFiles" class="space-y-3"></div>
                        </div>
                    </div>
                </form>
            `;
            
            // Create custom modal with dark theme
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-user-plus text-teal-400 mr-2"></i>Add New Patient
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-modal px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-user-plus mr-2"></i>Add Patient
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-modal');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            
            // Set up generate template button functionality
            const generateTemplateBtn = modal.querySelector('#generateTemplateBtn');
            if (generateTemplateBtn) {
                generateTemplateBtn.onclick = () => {
                    const form = document.getElementById('addPatientForm');
                    const formData = new FormData(form);
                    generateTreatmentDocument(formData);
                };
            }

            // Set up enhanced file upload functionality
            const treatmentDocsInput = modal.querySelector('#treatmentDocuments');
            const uploadedFilesDiv = modal.querySelector('#uploadedFiles');
            const uploadArea = modal.querySelector('#uploadArea');
            let uploadedFilesList = [];

            if (treatmentDocsInput && uploadedFilesDiv && uploadArea) {
                // Drag and Drop functionality
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('border-teal-400', 'bg-gray-600');
                });

                uploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('border-teal-400', 'bg-gray-600');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('border-teal-400', 'bg-gray-600');
                    const files = Array.from(e.dataTransfer.files);
                    handleFileSelection(files);
                });

                uploadArea.addEventListener('click', () => {
                    treatmentDocsInput.click();
                });

                treatmentDocsInput.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    handleFileSelection(files);
                });

                function handleFileSelection(files) {
                    files.forEach(file => {
                        if (!uploadedFilesList.find(f => f.name === file.name && f.size === file.size)) {
                            uploadedFilesList.push(file);
                        }
                    });
                    displayUploadedFiles();
                }

                function displayUploadedFiles() {
                    if (uploadedFilesList.length === 0) {
                        uploadedFilesDiv.innerHTML = '';
                        return;
                    }

                    uploadedFilesDiv.innerHTML = `
                        <h5 class="text-sm font-medium text-gray-300 mb-3 flex items-center">
                            <i class="fas fa-paperclip text-teal-400 mr-2"></i>
                            Uploaded Files (${uploadedFilesList.length})
                        </h5>
                        <div class="space-y-3">
                            ${uploadedFilesList.map((file, index) => createFilePreview(file, index)).join('')}
                        </div>
                    `;
                }

                function createFilePreview(file, index) {
                    const fileSize = formatFileSize(file.size);
                    const fileType = getFileType(file);
                    const fileIcon = getFileIcon(fileType);
                    const isImage = fileType === 'image';
                    const isVideo = fileType === 'video';

                    let preview = '';
                    if (isImage) {
                        const imageUrl = URL.createObjectURL(file);
                        preview = `
                            <div class="w-16 h-16 bg-gray-500 rounded-lg overflow-hidden flex-shrink-0">
                                <img src="${imageUrl}" alt="${file.name}" class="w-full h-full object-cover">
                            </div>
                        `;
                    } else if (isVideo) {
                        const videoUrl = URL.createObjectURL(file);
                        preview = `
                            <div class="w-16 h-16 bg-gray-500 rounded-lg overflow-hidden flex-shrink-0 relative">
                                <video class="w-full h-full object-cover" muted>
                                    <source src="${videoUrl}" type="${file.type}">
                                </video>
                                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30">
                                    <i class="fas fa-play text-white text-sm"></i>
                                </div>
                            </div>
                        `;
                    } else {
                        preview = `
                            <div class="w-16 h-16 bg-gray-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i class="${fileIcon} text-2xl text-white"></i>
                            </div>
                        `;
                    }

                    return `
                        <div class="flex items-center justify-between bg-gray-600 p-3 rounded-lg hover:bg-gray-550 transition-colors">
                            <div class="flex items-center space-x-3 flex-1 min-w-0">
                                ${preview}
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-white truncate">${file.name}</p>
                                    <div class="flex items-center space-x-4 mt-1">
                                        <span class="text-xs text-gray-300">${fileSize}</span>
                                        <span class="text-xs text-gray-400 capitalize">${fileType}</span>
                                        ${isImage || isVideo ? `<button onclick="previewMedia(${index})" class="text-xs text-teal-400 hover:text-teal-300">Preview</button>` : ''}
                                    </div>
                                </div>
                            </div>
                            <button onclick="removeFile(${index})" class="ml-3 text-red-400 hover:text-red-300 p-2 hover:bg-red-900/30 rounded">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    `;
                }

                function getFileType(file) {
                    if (file.type.startsWith('image/')) return 'image';
                    if (file.type.startsWith('video/')) return 'video';
                    if (file.type.startsWith('audio/')) return 'audio';
                    if (file.type.includes('pdf')) return 'pdf';
                    if (file.type.includes('word') || file.name.endsWith('.doc') || file.name.endsWith('.docx')) return 'document';
                    if (file.type.includes('text')) return 'text';
                    return 'other';
                }

                function getFileIcon(fileType) {
                    const icons = {
                        image: 'fas fa-image',
                        video: 'fas fa-video',
                        audio: 'fas fa-music',
                        pdf: 'fas fa-file-pdf',
                        document: 'fas fa-file-word',
                        text: 'fas fa-file-alt',
                        other: 'fas fa-file'
                    };
                    return icons[fileType] || icons.other;
                }

                function formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                }

                // Make functions global for onclick handlers
                window.removeFile = function(index) {
                    uploadedFilesList.splice(index, 1);
                    displayUploadedFiles();
                    showNotification('🗑️ File removed', 'success');
                };

                window.previewMedia = function(index) {
                    const file = uploadedFilesList[index];
                    const fileUrl = URL.createObjectURL(file);
                    const isVideo = file.type.startsWith('video/');
                    
                    const previewModal = document.createElement('div');
                    previewModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
                    previewModal.innerHTML = `
                        <div class="max-w-4xl max-h-full bg-gray-800 rounded-lg overflow-hidden">
                            <div class="flex items-center justify-between p-4 border-b border-gray-600">
                                <h3 class="text-white font-medium">${file.name}</h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="p-4">
                                ${isVideo ? 
                                    `<video controls class="max-w-full max-h-96 mx-auto">
                                        <source src="${fileUrl}" type="${file.type}">
                                        Your browser does not support the video tag.
                                    </video>` :
                                    `<img src="${fileUrl}" alt="${file.name}" class="max-w-full max-h-96 mx-auto object-contain">`
                                }
                            </div>
                        </div>
                    `;
                    document.body.appendChild(previewModal);
                };

                window.clearAllFiles = function() {
                    uploadedFilesList = [];
                    displayUploadedFiles();
                    treatmentDocsInput.value = '';
                    showNotification('🧹 All files cleared', 'success');
                };
            }
            
            saveBtn.onclick = () => {
                const form = document.getElementById('addPatientForm');
                const formData = new FormData(form);
                
                // Validate required fields
                const firstName = formData.get('firstName')?.trim();
                const lastName = formData.get('lastName')?.trim();
                const phone = formData.get('phone')?.trim();
                const cprNumber = formData.get('cprNumber')?.trim();
                const dateOfBirth = formData.get('dateOfBirth');
                const gender = formData.get('gender');
                const currentCondition = formData.get('currentCondition')?.trim();
                const assignedPhysiotherapist = formData.get('assignedPhysiotherapist');

                if (!firstName || !lastName || !phone || !cprNumber || !dateOfBirth || !gender || !currentCondition || !assignedPhysiotherapist) {
                    showNotification('⚠️ Please fill in all required fields', 'error');
                    return;
                }

                // Create new patient object
                const newPatient = {
                    id: `patient-${Date.now()}`,
                    firstName,
                    lastName,
                    phone,
                    cprNumber,
                    dateOfBirth,
                    gender,
                    email: formData.get('email')?.trim() || '',
                    currentCondition,
                    assignedPhysiotherapist,
                    treatmentStatus: 'active',
                    dateRegistered: new Date().toISOString()
                };

                // Add patient to data store
                appData.patients.push(newPatient);
                
                // Update assignedPatients count for the physiotherapist
                const assignedPhysio = appData.physiotherapists.find(p => 
                    `Dr. ${p.firstName} ${p.lastName}` === assignedPhysiotherapist
                );
                if (assignedPhysio) {
                    assignedPhysio.assignedPatients = (assignedPhysio.assignedPatients || 0) + 1;
                }

                // Update displays
                updatePatientsDisplay();
                loadPhysioPatients(); // Update physiotherapist's patient list
                
                showNotification(`✅ Patient ${firstName} ${lastName} registered successfully!`, 'success');
                closeModal();
            };
        }

        function viewPatientDetails(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`👁️ Viewing ${patient.firstName} ${patient.lastName}`, 'success');
            }
        }

        function editPatient(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`✏️ Editing ${patient.firstName} ${patient.lastName}`, 'success');
            }
        }

        function deletePatientWithConfirm(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showConfirmDialog(
                    `Are you sure you want to delete ${patient.firstName} ${patient.lastName}?`,
                    () => {
                        appData.patients = appData.patients.filter(p => p.id !== patientId);
                        updatePatientsDisplay();
                        showNotification(`✅ Patient deleted`, 'success');
                    }
                );
            }
        }

        // Appointment Management
        function updateAppointmentDisplay() {
            const appointments = [...appData.appointments];
            const tbody = document.getElementById('appointmentsTableBody');
            
            if (tbody) {
                if (appointments.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                                <i class="fas fa-calendar-times text-4xl mb-4 block"></i>
                                No appointments scheduled yet
                            </td>
                        </tr>
                    `;
                }
            }
        }

        function showScheduleAppointmentModal() {
            const content = `
                <form id="scheduleAppointmentForm" class="space-y-6">
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-calendar-plus text-teal-400 mr-2"></i>Schedule New Appointment
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Select Patient *</label>
                                <select id="appointmentPatient" name="patientId" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Choose a patient</option>
                                    ${appData.patients.map(patient => `
                                        <option value="${patient.id}">${patient.firstName} ${patient.lastName} - ${patient.cprNumber}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Physiotherapist *</label>
                                <select id="appointmentPhysiotherapist" name="physiotherapist" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Choose physiotherapist</option>
                                    ${appData.physiotherapists.map(physio => `
                                        <option value="Dr. ${physio.firstName} ${physio.lastName}">Dr. ${physio.firstName} ${physio.lastName}</option>
                                    `).join('')}
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date *</label>
                                <input type="date" id="appointmentDate" name="date" required min="${new Date().toISOString().split('T')[0]}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Time *</label>
                                <select id="appointmentTime" name="time" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select time</option>
                                    <option value="08:00">08:00 AM</option>
                                    <option value="08:30">08:30 AM</option>
                                    <option value="09:00">09:00 AM</option>
                                    <option value="09:30">09:30 AM</option>
                                    <option value="10:00">10:00 AM</option>
                                    <option value="10:30">10:30 AM</option>
                                    <option value="11:00">11:00 AM</option>
                                    <option value="11:30">11:30 AM</option>
                                    <option value="12:00">12:00 PM</option>
                                    <option value="12:30">12:30 PM</option>
                                    <option value="13:00">01:00 PM</option>
                                    <option value="13:30">01:30 PM</option>
                                    <option value="14:00">02:00 PM</option>
                                    <option value="14:30">02:30 PM</option>
                                    <option value="15:00">03:00 PM</option>
                                    <option value="15:30">03:30 PM</option>
                                    <option value="16:00">04:00 PM</option>
                                    <option value="16:30">04:30 PM</option>
                                    <option value="17:00">05:00 PM</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Duration</label>
                                <select id="appointmentDuration" name="duration" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="30">30 minutes</option>
                                    <option value="45" selected>45 minutes</option>
                                    <option value="60">60 minutes</option>
                                    <option value="90">90 minutes</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Treatment Type</label>
                                <select id="treatmentType" name="treatmentType" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="Initial Assessment">Initial Assessment</option>
                                    <option value="Follow-up Session">Follow-up Session</option>
                                    <option value="Back Pain Therapy">Back Pain Therapy</option>
                                    <option value="Knee Rehabilitation">Knee Rehabilitation</option>
                                    <option value="Shoulder Treatment">Shoulder Treatment</option>
                                    <option value="Sports Rehabilitation">Sports Rehabilitation</option>
                                    <option value="Manual Therapy">Manual Therapy</option>
                                    <option value="Exercise Therapy">Exercise Therapy</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Appointment Notes</label>
                            <textarea id="appointmentNotes" name="notes" rows="3" placeholder="Add any specific notes or special instructions for this appointment..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Status</label>
                            <select id="appointmentStatus" name="status" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="scheduled">Scheduled</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="pending">Pending Confirmation</option>
                            </select>
                        </div>

                        <!-- Quick Patient Creation -->
                        <div class="border-t border-gray-600 pt-4">
                            <div class="flex items-center justify-between mb-3">
                                <h5 class="text-sm font-semibold text-gray-300">No suitable patient found?</h5>
                                <button type="button" onclick="showAddPatientModal(); document.querySelector('.close-modal').click();" class="text-teal-400 hover:text-teal-300 text-sm font-medium">
                                    <i class="fas fa-user-plus mr-1"></i>Add New Patient First
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-calendar-plus text-teal-400 mr-2"></i>Schedule New Appointment
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-appointment px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-calendar-check mr-2"></i>Schedule Appointment
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-appointment');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            
            saveBtn.onclick = () => {
                const form = document.getElementById('scheduleAppointmentForm');
                const formData = new FormData(form);
                
                const patientId = formData.get('patientId');
                const physiotherapist = formData.get('physiotherapist');
                const date = formData.get('date');
                const time = formData.get('time');
                const duration = formData.get('duration') || '45';
                const treatmentType = formData.get('treatmentType');
                const notes = formData.get('notes')?.trim() || '';
                const status = formData.get('status') || 'scheduled';

                if (!patientId || !physiotherapist || !date || !time) {
                    showNotification('⚠️ Please fill in all required fields', 'error');
                    return;
                }

                const patient = appData.patients.find(p => p.id === patientId);
                if (!patient) {
                    showNotification('❌ Patient not found', 'error');
                    return;
                }

                const newAppointment = {
                    id: `appointment-${Date.now()}`,
                    patientId,
                    patientName: `${patient.firstName} ${patient.lastName}`,
                    physiotherapist,
                    date,
                    time,
                    duration: parseInt(duration),
                    treatmentType,
                    status,
                    notes,
                    createdDate: new Date().toISOString()
                };

                appData.appointments.push(newAppointment);
                updateAppointmentDisplay();
                
                // Send appointment confirmation email to patient
                sendAppointmentConfirmationEmail(patient, newAppointment);
                
                showNotification(`✅ Appointment scheduled for ${patient.firstName} ${patient.lastName} on ${date} at ${time}. Confirmation email sent!`, 'success');
                closeModal();
            };
        }

        function viewAppointment(appointmentId) {
            const appointment = appData.appointments.find(a => a.id === appointmentId);
            if (!appointment) {
                showNotification('❌ Appointment not found', 'error');
                return;
            }

            const patient = appData.patients.find(p => p.id === appointment.patientId);
            const patientInfo = patient ? `${patient.firstName} ${patient.lastName} (${patient.cprNumber})` : appointment.patientName;

            const content = `
                <div class="space-y-6">
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800">
                        <h4 class="text-xl font-semibold text-blue-900 dark:text-blue-100 mb-4 flex items-center">
                            <i class="fas fa-calendar-check text-blue-600 mr-2"></i>Appointment Details
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-3">
                                <div>
                                    <span class="text-sm font-medium text-blue-700 dark:text-blue-300">Patient:</span>
                                    <p class="text-blue-900 dark:text-blue-100 font-semibold">${patientInfo}</p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-blue-700 dark:text-blue-300">Date & Time:</span>
                                    <p class="text-blue-900 dark:text-blue-100 font-semibold">${new Date(appointment.date + 'T' + appointment.time).toLocaleString('en-US', {
                                        weekday: 'long',
                                        year: 'numeric',
                                        month: 'long',
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}</p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-blue-700 dark:text-blue-300">Duration:</span>
                                    <p class="text-blue-900 dark:text-blue-100 font-semibold">${appointment.duration} minutes</p>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div>
                                    <span class="text-sm font-medium text-blue-700 dark:text-blue-300">Physiotherapist:</span>
                                    <p class="text-blue-900 dark:text-blue-100 font-semibold">${appointment.physiotherapist}</p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-blue-700 dark:text-blue-300">Treatment Type:</span>
                                    <p class="text-blue-900 dark:text-blue-100 font-semibold">${appointment.treatmentType}</p>
                                </div>
                                <div>
                                    <span class="text-sm font-medium text-blue-700 dark:text-blue-300">Status:</span>
                                    <span class="px-3 py-1 text-xs font-semibold rounded-full ${getStatusBadgeClass(appointment.status)}">
                                        ${appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1)}
                                    </span>
                                </div>
                            </div>
                        </div>

                        ${appointment.notes ? `
                            <div class="mt-4 pt-4 border-t border-blue-200 dark:border-blue-800">
                                <span class="text-sm font-medium text-blue-700 dark:text-blue-300">Notes:</span>
                                <p class="text-blue-800 dark:text-blue-200 mt-1">${appointment.notes}</p>
                            </div>
                        ` : ''}
                    </div>

                    ${patient ? `
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                            <h5 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Patient Information</h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-600 dark:text-gray-400">Phone:</span>
                                    <span class="font-medium text-gray-800 dark:text-gray-200 ml-2">${patient.phone}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600 dark:text-gray-400">Email:</span>
                                    <span class="font-medium text-gray-800 dark:text-gray-200 ml-2">${patient.email || 'Not provided'}</span>
                                </div>
                                <div class="md:col-span-2">
                                    <span class="text-gray-600 dark:text-gray-400">Current Condition:</span>
                                    <p class="font-medium text-gray-800 dark:text-gray-200 mt-1">${patient.currentCondition}</p>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-eye text-blue-400 mr-2"></i>View Appointment Details
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <div class="flex gap-3">
                            ${appointment.status === 'scheduled' || appointment.status === 'pending' ? `
                                <button onclick="confirmAppointment('${appointmentId}'); this.closest('.fixed').remove();" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium">
                                    <i class="fas fa-check mr-2"></i>Confirm
                                </button>
                            ` : ''}
                            <button onclick="editAppointment('${appointmentId}'); this.closest('.fixed').remove();" class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition-colors font-medium">
                                <i class="fas fa-edit mr-2"></i>Edit
                            </button>
                            <button onclick="cancelAppointment('${appointmentId}'); this.closest('.fixed').remove();" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors font-medium">
                                <i class="fas fa-times mr-2"></i>Cancel
                            </button>
                        </div>
                        <button class="close-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtns = modal.querySelectorAll('.close-modal');
            closeBtns.forEach(btn => {
                btn.onclick = () => modal.remove();
            });
        }

        function editAppointment(appointmentId) {
            const appointment = appData.appointments.find(a => a.id === appointmentId);
            if (!appointment) {
                showNotification('❌ Appointment not found', 'error');
                return;
            }

            const content = `
                <form id="editAppointmentForm" class="space-y-6">
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-edit text-teal-400 mr-2"></i>Edit Appointment
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Select Patient *</label>
                                <select id="editAppointmentPatient" name="patientId" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    ${appData.patients.map(patient => `
                                        <option value="${patient.id}" ${patient.id === appointment.patientId ? 'selected' : ''}>${patient.firstName} ${patient.lastName} - ${patient.cprNumber}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Physiotherapist *</label>
                                <select id="editAppointmentPhysiotherapist" name="physiotherapist" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    ${appData.physiotherapists.map(physio => `
                                        <option value="Dr. ${physio.firstName} ${physio.lastName}" ${`Dr. ${physio.firstName} ${physio.lastName}` === appointment.physiotherapist ? 'selected' : ''}>Dr. ${physio.firstName} ${physio.lastName}</option>
                                    `).join('')}
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date *</label>
                                <input type="date" id="editAppointmentDate" name="date" required value="${appointment.date}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Time *</label>
                                <select id="editAppointmentTime" name="time" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="08:00" ${appointment.time === '08:00' ? 'selected' : ''}>08:00 AM</option>
                                    <option value="08:30" ${appointment.time === '08:30' ? 'selected' : ''}>08:30 AM</option>
                                    <option value="09:00" ${appointment.time === '09:00' ? 'selected' : ''}>09:00 AM</option>
                                    <option value="09:30" ${appointment.time === '09:30' ? 'selected' : ''}>09:30 AM</option>
                                    <option value="10:00" ${appointment.time === '10:00' ? 'selected' : ''}>10:00 AM</option>
                                    <option value="10:30" ${appointment.time === '10:30' ? 'selected' : ''}>10:30 AM</option>
                                    <option value="11:00" ${appointment.time === '11:00' ? 'selected' : ''}>11:00 AM</option>
                                    <option value="11:30" ${appointment.time === '11:30' ? 'selected' : ''}>11:30 AM</option>
                                    <option value="12:00" ${appointment.time === '12:00' ? 'selected' : ''}>12:00 PM</option>
                                    <option value="12:30" ${appointment.time === '12:30' ? 'selected' : ''}>12:30 PM</option>
                                    <option value="13:00" ${appointment.time === '13:00' ? 'selected' : ''}>01:00 PM</option>
                                    <option value="13:30" ${appointment.time === '13:30' ? 'selected' : ''}>01:30 PM</option>
                                    <option value="14:00" ${appointment.time === '14:00' ? 'selected' : ''}>02:00 PM</option>
                                    <option value="14:30" ${appointment.time === '14:30' ? 'selected' : ''}>02:30 PM</option>
                                    <option value="15:00" ${appointment.time === '15:00' ? 'selected' : ''}>03:00 PM</option>
                                    <option value="15:30" ${appointment.time === '15:30' ? 'selected' : ''}>03:30 PM</option>
                                    <option value="16:00" ${appointment.time === '16:00' ? 'selected' : ''}>04:00 PM</option>
                                    <option value="16:30" ${appointment.time === '16:30' ? 'selected' : ''}>04:30 PM</option>
                                    <option value="17:00" ${appointment.time === '17:00' ? 'selected' : ''}>05:00 PM</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Duration</label>
                                <select id="editAppointmentDuration" name="duration" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="30" ${appointment.duration === 30 ? 'selected' : ''}>30 minutes</option>
                                    <option value="45" ${appointment.duration === 45 ? 'selected' : ''}>45 minutes</option>
                                    <option value="60" ${appointment.duration === 60 ? 'selected' : ''}>60 minutes</option>
                                    <option value="90" ${appointment.duration === 90 ? 'selected' : ''}>90 minutes</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Treatment Type</label>
                                <select id="editTreatmentType" name="treatmentType" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="Initial Assessment" ${appointment.treatmentType === 'Initial Assessment' ? 'selected' : ''}>Initial Assessment</option>
                                    <option value="Follow-up Session" ${appointment.treatmentType === 'Follow-up Session' ? 'selected' : ''}>Follow-up Session</option>
                                    <option value="Back Pain Therapy" ${appointment.treatmentType === 'Back Pain Therapy' ? 'selected' : ''}>Back Pain Therapy</option>
                                    <option value="Knee Rehabilitation" ${appointment.treatmentType === 'Knee Rehabilitation' ? 'selected' : ''}>Knee Rehabilitation</option>
                                    <option value="Shoulder Treatment" ${appointment.treatmentType === 'Shoulder Treatment' ? 'selected' : ''}>Shoulder Treatment</option>
                                    <option value="Sports Rehabilitation" ${appointment.treatmentType === 'Sports Rehabilitation' ? 'selected' : ''}>Sports Rehabilitation</option>
                                    <option value="Manual Therapy" ${appointment.treatmentType === 'Manual Therapy' ? 'selected' : ''}>Manual Therapy</option>
                                    <option value="Exercise Therapy" ${appointment.treatmentType === 'Exercise Therapy' ? 'selected' : ''}>Exercise Therapy</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Status</label>
                            <select id="editAppointmentStatus" name="status" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="scheduled" ${appointment.status === 'scheduled' ? 'selected' : ''}>Scheduled</option>
                                <option value="confirmed" ${appointment.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                                <option value="pending" ${appointment.status === 'pending' ? 'selected' : ''}>Pending Confirmation</option>
                                <option value="completed" ${appointment.status === 'completed' ? 'selected' : ''}>Completed</option>
                                <option value="cancelled" ${appointment.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Appointment Notes</label>
                            <textarea id="editAppointmentNotes" name="notes" rows="3" placeholder="Add any specific notes or special instructions..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">${appointment.notes}</textarea>
                        </div>
                    </div>
                </form>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-edit text-yellow-400 mr-2"></i>Edit Appointment
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-edit-appointment px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-edit-appointment');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            
            saveBtn.onclick = () => {
                const form = document.getElementById('editAppointmentForm');
                const formData = new FormData(form);
                
                const patientId = formData.get('patientId');
                const physiotherapist = formData.get('physiotherapist');
                const date = formData.get('date');
                const time = formData.get('time');
                const duration = formData.get('duration');
                const treatmentType = formData.get('treatmentType');
                const notes = formData.get('notes')?.trim() || '';
                const status = formData.get('status');

                if (!patientId || !physiotherapist || !date || !time) {
                    showNotification('⚠️ Please fill in all required fields', 'error');
                    return;
                }

                const patient = appData.patients.find(p => p.id === patientId);
                if (!patient) {
                    showNotification('❌ Patient not found', 'error');
                    return;
                }

                // Update appointment
                appointment.patientId = patientId;
                appointment.patientName = `${patient.firstName} ${patient.lastName}`;
                appointment.physiotherapist = physiotherapist;
                appointment.date = date;
                appointment.time = time;
                appointment.duration = parseInt(duration);
                appointment.treatmentType = treatmentType;
                appointment.status = status;
                appointment.notes = notes;

                updateAppointmentDisplay();
                showNotification(`✅ Appointment updated successfully!`, 'success');
                closeModal();
            };
        }

        function confirmAppointment(appointmentId) {
            const appointment = appData.appointments.find(a => a.id === appointmentId);
            if (appointment) {
                appointment.status = 'confirmed';
                updateAppointmentDisplay();
                showNotification(`✅ Appointment confirmed for ${appointment.patientName}!`, 'success');
            }
        }

        function cancelAppointment(appointmentId) {
            const appointment = appData.appointments.find(a => a.id === appointmentId);
            if (appointment) {
                showConfirmDialog(
                    `Are you sure you want to cancel the appointment with ${appointment.patientName}?`,
                    () => {
                        appointment.status = 'cancelled';
                        updateAppointmentDisplay();
                        showNotification(`❌ Appointment cancelled for ${appointment.patientName}`, 'success');
                    }
                );
            }
        }

        function getStatusBadgeClass(status) {
            const classes = {
                'scheduled': 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300',
                'confirmed': 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300',
                'pending': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300',
                'completed': 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300',
                'cancelled': 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300'
            };
            return classes[status] || classes.scheduled;
        }

        // Physiotherapist Management
        function updatePhysiotherapistsDisplay() {
            const physiotherapists = appData.physiotherapists || [];
            const gridContainer = document.getElementById('physiotherapistsGridContainer');
            const emptyState = document.getElementById('noPhysiotherapistsFound');

            if (physiotherapists.length === 0) {
                if (gridContainer) gridContainer.innerHTML = '';
                if (emptyState) emptyState.style.display = 'block';
            } else {
                if (emptyState) emptyState.style.display = 'none';
                
                if (gridContainer) {
                    gridContainer.innerHTML = physiotherapists.map(physio => `
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-secondary rounded-full flex items-center justify-center text-white font-bold mr-3">
                                        ${physio.firstName.charAt(0)}${physio.lastName.charAt(0)}
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                            Dr. ${physio.firstName} ${physio.lastName}
                                        </h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            License: ${physio.licenseNumber}
                                        </p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 ${physio.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} rounded-full text-xs font-semibold">
                                    ${physio.status.charAt(0).toUpperCase() + physio.status.slice(1)}
                                </span>
                            </div>

                            <div class="space-y-2 mb-4">
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-envelope w-5 mr-2"></i>
                                    <span>${physio.email}</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-phone w-5 mr-2"></i>
                                    <span>${physio.phone}</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-briefcase w-5 mr-2"></i>
                                    <span>${physio.experience} experience</span>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">
                                    <strong>Specializations:</strong>
                                </p>
                                <div class="flex flex-wrap gap-1">
                                    ${physio.specializations.map(spec => `
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                                            ${spec}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="flex gap-2 mt-4">
                                <button onclick="viewPhysioDetails('${physio.id}')" class="flex-1 bg-secondary text-white px-4 py-2 rounded-lg hover:bg-sage transition-colors text-sm">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                <button onclick="editPhysio('${physio.id}')" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        function showAddPhysiotherapistModal() {
            const content = `
                <form id="addPhysiotherapistForm" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-user text-teal-400 mr-2"></i>Personal Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">First Name *</label>
                                <input type="text" id="physioFirstName" name="firstName" required placeholder="Enter first name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Last Name *</label>
                                <input type="text" id="physioLastName" name="lastName" required placeholder="Enter last name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date of Birth *</label>
                                <input type="date" id="physioDateOfBirth" name="dateOfBirth" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Gender *</label>
                                <select id="physioGender" name="gender" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">CPR Number *</label>
                                <input type="text" id="physioCprNumber" name="cprNumber" required placeholder="000000000" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-address-book text-teal-400 mr-2"></i>Contact Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Email *</label>
                                <input type="email" id="physioEmail" name="email" required placeholder="doctor@example.com" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Secondary Email</label>
                                <input type="email" id="physioSecondaryEmail" name="secondaryEmail" placeholder="secondary@example.com" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number *</label>
                                <input type="tel" id="physioPhone" name="phone" required placeholder="+973 XXXX XXXX" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Emergency Contact</label>
                                <input type="tel" id="physioEmergencyContact" name="emergencyContact" placeholder="+973 XXXX XXXX" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Full Residential Address</label>
                            <textarea id="physioAddress" name="address" rows="3" placeholder="Enter complete address..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Professional Credentials -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-certificate text-teal-400 mr-2"></i>Professional Credentials
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">License Number *</label>
                                <input type="text" id="physioLicenseNumber" name="licenseNumber" required placeholder="BH-PT-2024-XXX" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Years of Experience *</label>
                                <select id="physioExperience" name="experience" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Experience</option>
                                    <option value="1-2 years">1-2 years</option>
                                    <option value="3-5 years">3-5 years</option>
                                    <option value="6-10 years">6-10 years</option>
                                    <option value="11-15 years">11-15 years</option>
                                    <option value="16-20 years">16-20 years</option>
                                    <option value="20+ years">20+ years</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Education Level</label>
                                <select id="physioEducation" name="education" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Education Level</option>
                                    <option value="Bachelor's Degree">Bachelor's Degree in Physiotherapy</option>
                                    <option value="Master's Degree">Master's Degree in Physiotherapy</option>
                                    <option value="Doctorate">Doctorate in Physical Therapy</option>
                                    <option value="PhD">PhD in Physiotherapy</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Certification Status</label>
                                <select id="physioCertification" name="certification" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="certified">Certified</option>
                                    <option value="pending">Pending Certification</option>
                                    <option value="renewal">Renewal Required</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Professional Summary</label>
                            <textarea id="physioSummary" name="professionalSummary" rows="3" placeholder="Brief summary of professional background and expertise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Specializations & Skills -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-stethoscope text-teal-400 mr-2"></i>Specializations & Skills
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-3">Treatment Specializations</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="specializations" value="Orthopedic" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Orthopedic</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="specializations" value="Sports Medicine" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Sports Medicine</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="specializations" value="Neurological" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Neurological</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="specializations" value="Pediatric" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Pediatric</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="specializations" value="Geriatric" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Geriatric</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-3">Treatment Methods</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="methods" value="Manual Therapy" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Manual Therapy</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="methods" value="Exercise Therapy" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Exercise Therapy</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="methods" value="Electrotherapy" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Electrotherapy</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="methods" value="Aquatic Therapy" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Aquatic Therapy</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="methods" value="Dry Needling" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Dry Needling</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-3">Additional Skills</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="skills" value="Arabic Language" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Arabic Language</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="skills" value="English Language" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">English Language</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="skills" value="Patient Education" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Patient Education</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="skills" value="Research" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Research</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="skills" value="Team Leadership" class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Team Leadership</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Employment Details -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-briefcase text-teal-400 mr-2"></i>Employment Details
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Employment Type *</label>
                                <select id="physioEmploymentType" name="employmentType" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Type</option>
                                    <option value="full-time">Full-time</option>
                                    <option value="part-time">Part-time</option>
                                    <option value="contract">Contract</option>
                                    <option value="consultant">Consultant</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Start Date *</label>
                                <input type="date" id="physioStartDate" name="startDate" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Department</label>
                                <select id="physioDepartment" name="department" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Department</option>
                                    <option value="General Physiotherapy">General Physiotherapy</option>
                                    <option value="Sports Medicine">Sports Medicine</option>
                                    <option value="Orthopedic Rehabilitation">Orthopedic Rehabilitation</option>
                                    <option value="Neurological Rehabilitation">Neurological Rehabilitation</option>
                                    <option value="Pediatric Physiotherapy">Pediatric Physiotherapy</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Salary Range (BD)</label>
                                <select id="physioSalary" name="salary" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Range</option>
                                    <option value="500-800">BD 500-800</option>
                                    <option value="800-1200">BD 800-1200</option>
                                    <option value="1200-1500">BD 1200-1500</option>
                                    <option value="1500-2000">BD 1500-2000</option>
                                    <option value="2000+">BD 2000+</option>
                                    <option value="negotiable">Negotiable</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Status</label>
                                <select id="physioStatus" name="status" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="on-leave">On Leave</option>
                                    <option value="probation">Probation</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Working Schedule -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-calendar-week text-teal-400 mr-2"></i>Working Schedule
                        </h4>
                        
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="space-y-3">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center py-2 border-b border-gray-600">
                                    <div class="font-medium text-gray-300">Day</div>
                                    <div class="font-medium text-gray-300">Working</div>
                                    <div class="font-medium text-gray-300">Start Time</div>
                                    <div class="font-medium text-gray-300">End Time</div>
                                </div>
                                
                                ${['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'].map(day => `
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-center py-2">
                                        <div class="text-gray-300">${day}</div>
                                        <div>
                                            <input type="checkbox" name="workingDays" value="${day.toLowerCase()}" class="text-teal-500 focus:ring-teal-500 rounded">
                                        </div>
                                        <div>
                                            <input type="time" name="${day.toLowerCase()}StartTime" class="w-full px-3 py-2 bg-gray-600 border border-gray-600 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                        </div>
                                        <div>
                                            <input type="time" name="${day.toLowerCase()}EndTime" class="w-full px-3 py-2 bg-gray-600 border border-gray-600 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Profile & Documentation Upload -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-upload text-teal-400 mr-2"></i>Profile & Documentation Upload
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Profile Photo Upload -->
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-md font-semibold text-gray-300 mb-3">Profile Photo</h5>
                                <div id="profilePhotoUpload" class="border-2 border-dashed border-gray-500 rounded-lg p-4 text-center hover:border-teal-400 transition-colors cursor-pointer">
                                    <i class="fas fa-camera text-gray-400 text-2xl mb-2"></i>
                                    <p class="text-sm text-gray-300 mb-2">Upload Profile Photo</p>
                                    <p class="text-xs text-gray-400">JPG, PNG up to 5MB</p>
                                    <input type="file" id="profilePhotoInput" name="profilePhoto" accept=".jpg,.jpeg,.png" class="hidden">
                                </div>
                                <div id="profilePhotoPreview" class="mt-3 hidden"></div>
                            </div>

                            <!-- Professional Documents Upload -->
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h5 class="text-md font-semibold text-gray-300 mb-3">Professional Documents</h5>
                                <div id="documentsUpload" class="border-2 border-dashed border-gray-500 rounded-lg p-4 text-center hover:border-teal-400 transition-colors cursor-pointer">
                                    <i class="fas fa-file-upload text-gray-400 text-2xl mb-2"></i>
                                    <p class="text-sm text-gray-300 mb-2">Upload Documents</p>
                                    <p class="text-xs text-gray-400">License, Certificates, CV (PDF)</p>
                                    <input type="file" id="documentsInput" name="documents" multiple accept=".pdf,.doc,.docx" class="hidden">
                                </div>
                                <div id="documentsPreview" class="mt-3 space-y-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Login Credentials -->
                    <div class="border-t border-gray-600 pt-6">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-key text-teal-400 mr-2"></i>Login Credentials & Account Access
                        </h4>
                        
                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4 border border-blue-200 dark:border-blue-800">
                            <p class="text-sm text-blue-800 dark:text-blue-300">
                                <i class="fas fa-info-circle mr-2"></i>
                                The physiotherapist will use their email address as username to log into the system.
                            </p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Temporary Password *</label>
                                <div class="relative">
                                    <input type="password" id="physioTempPassword" name="tempPassword" required placeholder="Create temporary password" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500 pr-12">
                                    <button type="button" id="togglePhysioTempPassword" class="absolute right-4 top-4 text-gray-400 hover:text-gray-200">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-400 mt-1">Physiotherapist will be asked to change this on first login</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Account Permissions</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="permissions" value="view_patients" checked class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">View All Patients</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="permissions" value="manage_assigned_patients" checked class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">Manage Assigned Patients</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="permissions" value="view_schedule" checked class="text-teal-500 focus:ring-teal-500 rounded">
                                        <span class="ml-2 text-sm text-gray-300">View Schedule</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-user-md text-teal-400 mr-2"></i>Add New Physiotherapist
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-physiotherapist px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-user-plus mr-2"></i>Add Physiotherapist
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-physiotherapist');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;

            // Set up file upload functionality
            setupPhysiotherapistFileUploads(modal);

            // Set up password toggle
            const togglePasswordBtn = modal.querySelector('#togglePhysioTempPassword');
            const passwordInput = modal.querySelector('#physioTempPassword');
            
            if (togglePasswordBtn && passwordInput) {
                togglePasswordBtn.onclick = function() {
                    const icon = this.querySelector('i');
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        passwordInput.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                };
            }
            
            saveBtn.onclick = () => {
                const form = document.getElementById('addPhysiotherapistForm');
                const formData = new FormData(form);
                
                // Validate required fields
                const firstName = formData.get('firstName')?.trim();
                const lastName = formData.get('lastName')?.trim();
                const email = formData.get('email')?.trim();
                const phone = formData.get('phone')?.trim();
                const licenseNumber = formData.get('licenseNumber')?.trim();
                const cprNumber = formData.get('cprNumber')?.trim();
                const dateOfBirth = formData.get('dateOfBirth');
                const gender = formData.get('gender');
                const experience = formData.get('experience');
                const employmentType = formData.get('employmentType');
                const startDate = formData.get('startDate');
                const tempPassword = formData.get('tempPassword')?.trim();

                if (!firstName || !lastName || !email || !phone || !licenseNumber || !cprNumber || !dateOfBirth || !gender || !experience || !employmentType || !startDate || !tempPassword) {
                    showNotification('⚠️ Please fill in all required fields', 'error');
                    return;
                }

                // Get selected specializations
                const specializations = Array.from(form.querySelectorAll('input[name="specializations"]:checked'))
                    .map(cb => cb.value);

                // Get selected methods
                const methods = Array.from(form.querySelectorAll('input[name="methods"]:checked'))
                    .map(cb => cb.value);

                // Get selected skills
                const skills = Array.from(form.querySelectorAll('input[name="skills"]:checked'))
                    .map(cb => cb.value);

                // Get working schedule
                const workingDays = Array.from(form.querySelectorAll('input[name="workingDays"]:checked'))
                    .map(cb => cb.value);

                // Get permissions
                const permissions = Array.from(form.querySelectorAll('input[name="permissions"]:checked'))
                    .map(cb => cb.value);

                const newPhysiotherapist = {
                    id: `physio-${Date.now()}`,
                    firstName,
                    lastName,
                    email,
                    phone,
                    licenseNumber,
                    cprNumber,
                    dateOfBirth,
                    gender,
                    secondaryEmail: formData.get('secondaryEmail')?.trim() || '',
                    emergencyContact: formData.get('emergencyContact')?.trim() || '',
                    address: formData.get('address')?.trim() || '',
                    experience,
                    education: formData.get('education') || '',
                    certification: formData.get('certification') || 'certified',
                    professionalSummary: formData.get('professionalSummary')?.trim() || '',
                    specializations: specializations.length > 0 ? specializations : ['General Physiotherapy'],
                    methods,
                    skills,
                    employmentType,
                    startDate,
                    department: formData.get('department') || '',
                    salary: formData.get('salary') || '',
                    status: formData.get('status') || 'active',
                    workingDays,
                    tempPassword,
                    permissions,
                    assignedPatients: 0,
                    dateRegistered: new Date().toISOString()
                };

                // Add to data store
                appData.physiotherapists.push(newPhysiotherapist);
                
                // Update display
                updatePhysiotherapistsDisplay();
                
                showNotification(`✅ Dr. ${firstName} ${lastName} has been successfully added as a physiotherapist!`, 'success');
                closeModal();
            };
        }

        function setupPhysiotherapistFileUploads(modal) {
            // Profile Photo Upload
            const profilePhotoUpload = modal.querySelector('#profilePhotoUpload');
            const profilePhotoInput = modal.querySelector('#profilePhotoInput');
            const profilePhotoPreview = modal.querySelector('#profilePhotoPreview');

            if (profilePhotoUpload && profilePhotoInput && profilePhotoPreview) {
                profilePhotoUpload.onclick = () => profilePhotoInput.click();
                
                profilePhotoInput.onchange = function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            profilePhotoPreview.innerHTML = `
                                <div class="flex items-center justify-between bg-gray-600 p-3 rounded-lg">
                                    <div class="flex items-center">
                                        <img src="${e.target.result}" alt="Profile Preview" class="w-12 h-12 rounded-full object-cover mr-3">
                                        <div>
                                            <p class="text-sm font-medium text-white">${file.name}</p>
                                            <p class="text-xs text-gray-400">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                                        </div>
                                    </div>
                                    <button type="button" onclick="clearProfilePhoto()" class="text-red-400 hover:text-red-300">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            `;
                            profilePhotoPreview.classList.remove('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                };
            }

            // Documents Upload
            const documentsUpload = modal.querySelector('#documentsUpload');
            const documentsInput = modal.querySelector('#documentsInput');
            const documentsPreview = modal.querySelector('#documentsPreview');

            if (documentsUpload && documentsInput && documentsPreview) {
                documentsUpload.onclick = () => documentsInput.click();
                
                documentsInput.onchange = function(e) {
                    const files = Array.from(e.target.files);
                    documentsPreview.innerHTML = '';
                    
                    files.forEach((file, index) => {
                        const fileDiv = document.createElement('div');
                        fileDiv.className = 'flex items-center justify-between bg-gray-600 p-3 rounded-lg';
                        fileDiv.innerHTML = `
                            <div class="flex items-center">
                                <i class="fas fa-file-pdf text-red-400 text-lg mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-white">${file.name}</p>
                                    <p class="text-xs text-gray-400">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                                </div>
                            </div>
                            <button type="button" onclick="removeDocument(${index})" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        `;
                        documentsPreview.appendChild(fileDiv);
                    });
                };
            }

            // Global functions for file management
            window.clearProfilePhoto = function() {
                profilePhotoInput.value = '';
                profilePhotoPreview.innerHTML = '';
                profilePhotoPreview.classList.add('hidden');
            };

            window.removeDocument = function(index) {
                // In a real implementation, you'd need to manage the FileList
                // For now, just remove the preview
                const documentDivs = documentsPreview.children;
                if (documentDivs[index]) {
                    documentDivs[index].remove();
                }
            };
        }

        function viewPhysioDetails(physioId) {
            showNotification('👁️ View physiotherapist details coming soon!', 'success');
        }

        function editPhysio(physioId) {
            showNotification('✏️ Edit physiotherapist coming soon!', 'success');
        }

        // Physiotherapist Dashboard
        function initializePhysioDashboard() {
            setupPhysioNavigation();
            loadPhysioPatients();
            updateExerciseStatistics();
            displaySharedExerciseLibrary();
            console.log('👩‍⚕️ Physiotherapist dashboard initialized');
        }

        function setupPhysioNavigation() {
            const navButtons = document.querySelectorAll('.physio-nav-btn');
            navButtons.forEach(btn => {
                btn.onclick = () => {
                    const view = btn.dataset.view;
                    showPhysioView(view);
                    document.querySelectorAll('.physio-nav-btn').forEach(b => {
                        b.classList.remove('bg-secondary', 'text-white');
                    });
                    btn.classList.add('bg-secondary', 'text-white');
                };
            });
        }

        function showPhysioView(viewName) {
            document.querySelectorAll('.physio-view').forEach(view => {
                view.classList.add('hidden');
            });
            const targetView = document.getElementById(viewName);
            if (targetView) {
                targetView.classList.remove('hidden');
                if (viewName === 'physio-patients') {
                    loadPhysioPatients();
                }
            }
        }

        function loadPhysioPatients() {
            const patientsGrid = document.getElementById('physioMyPatientsGrid');
            const emptyState = document.getElementById('physioNoPatientsFound');
            const patientCountEl = document.getElementById('physioPatientCount');
            
            // Show ALL patients in the system, not just assigned ones
            const allPatients = appData.patients || [];
            const assignedPatients = allPatients.filter(p => 
                p.assignedPhysiotherapist === 'Dr. Mariam Abdulatheem Ali'
            );

            if (patientCountEl) {
                patientCountEl.textContent = `Total: ${allPatients.length} patient${allPatients.length !== 1 ? 's' : ''} (${assignedPatients.length} assigned)`;
            }

            const physioActivePatientsEl = document.getElementById('physioActivePatients');
            if (physioActivePatientsEl) {
                physioActivePatientsEl.textContent = allPatients.length;
            }

            if (allPatients.length === 0) {
                if (patientsGrid) patientsGrid.innerHTML = '';
                if (emptyState) emptyState.classList.remove('hidden');
            } else {
                if (emptyState) emptyState.classList.add('hidden');
                
                if (patientsGrid) {
                    patientsGrid.innerHTML = allPatients.map(patient => {
                        const isAssigned = patient.assignedPhysiotherapist === 'Dr. Mariam Abdulatheem Ali';
                        const cardClass = isAssigned ? 'border-l-4 border-secondary' : 'border-l-4 border-gray-300 dark:border-gray-600';
                        const statusBadge = isAssigned ? 
                            'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' : 
                            'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300';
                        const statusText = isAssigned ? 
                            (patient.treatmentStatus || 'Active').charAt(0).toUpperCase() + (patient.treatmentStatus || 'active').slice(1) :
                            'Available';
                        
                        return `
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow ${cardClass}">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 ${isAssigned ? 'bg-secondary' : 'bg-gray-500'} rounded-full flex items-center justify-center text-white font-bold mr-3">
                                        ${patient.firstName.charAt(0)}${patient.lastName.charAt(0)}
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                            ${patient.firstName} ${patient.lastName}
                                        </h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            CPR: ${patient.cprNumber}
                                        </p>
                                        ${!isAssigned ? `
                                            <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">
                                                <i class="fas fa-info-circle mr-1"></i>Assigned to: ${patient.assignedPhysiotherapist}
                                            </p>
                                        ` : ''}
                                    </div>
                                </div>
                                <div class="flex flex-col items-end gap-2">
                                    <span class="px-3 py-1 ${statusBadge} rounded-full text-xs font-semibold">
                                        ${statusText}
                                    </span>
                                    ${!isAssigned ? `
                                        <button onclick="requestPatientAssignment('${patient.id}')" class="px-2 py-1 bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300 rounded text-xs hover:bg-yellow-200 transition-colors">
                                            <i class="fas fa-hand-paper mr-1"></i>Request
                                        </button>
                                    ` : ''}
                                </div>
                            </div>

                            <div class="${isAssigned ? 'bg-blue-50 dark:bg-blue-900/20' : 'bg-gray-50 dark:bg-gray-700'} rounded-lg p-3 mb-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-1">
                                    <strong>Current Condition:</strong>
                                </p>
                                <p class="text-sm ${isAssigned ? 'text-blue-800 dark:text-blue-300' : 'text-gray-600 dark:text-gray-400'}">
                                    ${patient.currentCondition}
                                </p>
                            </div>
                            
                            <div class="flex gap-2">
                                <button onclick="physioViewPatient('${patient.id}')" class="flex-1 ${isAssigned ? 'bg-secondary hover:bg-sage' : 'bg-gray-500 hover:bg-gray-600'} text-white px-4 py-2 rounded-lg transition-colors text-sm">
                                    <i class="fas fa-eye mr-1"></i>View Details
                                </button>
                                ${isAssigned ? `
                                    <button onclick="physioManagePatientFiles('${patient.id}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        <i class="fas fa-folder mr-1"></i>Files
                                    </button>
                                    <button onclick="physioUpdateProgress('${patient.id}')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                        <i class="fas fa-chart-line mr-1"></i>Progress
                                    </button>
                                ` : `
                                    <button onclick="physioViewPatientFiles('${patient.id}')" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm" title="View Only">
                                        <i class="fas fa-folder-open mr-1"></i>View Files
                                    </button>
                                `}
                            </div>
                        </div>
                        `;
                    }).join('');
                }
            }
        }

        function physioViewPatient(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`👁️ Viewing patient: ${patient.firstName} ${patient.lastName}`, 'success');
            }
        }

        function physioUpdateProgress(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`📈 Updating progress for: ${patient.firstName} ${patient.lastName}`, 'success');
            }
        }

        // Request Patient Assignment Function
        function requestPatientAssignment(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`📋 Assignment request sent for ${patient.firstName} ${patient.lastName} to admin`, 'success');
            }
        }

        // View Patient Files (Read-only for unassigned patients)
        function physioViewPatientFiles(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (!patient) {
                showNotification('❌ Patient not found', 'error');
                return;
            }

            const content = `
                <!-- Patient Information Header -->
                <div class="bg-gradient-to-r from-gray-600 to-gray-700 rounded-lg p-6 mb-6 text-white">
                    <div class="flex items-center mb-4">
                        <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-white font-bold mr-4 text-xl">
                            ${patient.firstName.charAt(0)}${patient.lastName.charAt(0)}
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">${patient.firstName} ${patient.lastName}</h3>
                            <p class="text-white text-opacity-90">CPR: ${patient.cprNumber}</p>
                            <p class="text-sm text-yellow-300 mt-1">
                                <i class="fas fa-eye mr-1"></i>View-Only Mode (Not your assigned patient)
                            </p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div>
                            <span class="text-white text-opacity-70">Phone:</span>
                            <span class="font-medium ml-2">${patient.phone}</span>
                        </div>
                        <div>
                            <span class="text-white text-opacity-70">Assigned to:</span>
                            <span class="font-medium ml-2">${patient.assignedPhysiotherapist}</span>
                        </div>
                        <div>
                            <span class="text-white text-opacity-70">Status:</span>
                            <span class="font-medium ml-2 px-2 py-1 bg-blue-500 rounded-full text-xs">
                                ${(patient.treatmentStatus || 'Active').charAt(0).toUpperCase() + (patient.treatmentStatus || 'active').slice(1)}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Current Condition -->
                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6 border border-blue-200 dark:border-blue-800">
                    <h4 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2 flex items-center">
                        <i class="fas fa-stethoscope text-blue-600 mr-2"></i>Current Condition
                    </h4>
                    <p class="text-blue-800 dark:text-blue-300">${patient.currentCondition}</p>
                </div>

                <!-- Info Message -->
                <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-6 border border-yellow-200 dark:border-yellow-800">
                    <div class="flex items-center">
                        <i class="fas fa-info-circle text-yellow-600 mr-3"></i>
                        <div>
                            <h4 class="font-semibold text-yellow-900 dark:text-yellow-100">View-Only Access</h4>
                            <p class="text-sm text-yellow-700 dark:text-yellow-300">This patient is assigned to another physiotherapist. You can view information but cannot modify files or progress.</p>
                        </div>
                    </div>
                </div>

                <!-- Patient Files (if any exist) -->
                <div class="space-y-4">
                    <h4 class="text-lg font-semibold text-gray-300 mb-4 flex items-center">
                        <i class="fas fa-folder-open text-gray-400 mr-2"></i>Patient Files (Read-Only)
                    </h4>
                    <div class="text-center py-8 bg-gray-700 rounded-lg">
                        <i class="fas fa-folder-open text-gray-500 text-4xl mb-4"></i>
                        <p class="text-gray-400">No files uploaded yet for this patient</p>
                        <p class="text-sm text-gray-500 mt-2">Files will appear here when uploaded by the assigned physiotherapist</p>
                    </div>
                </div>
            `;
            
            // Create view-only patient files modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-folder-open text-gray-400 mr-2"></i>Patient Files (View-Only) - ${patient.firstName} ${patient.lastName}
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between p-6 border-t border-gray-700">
                        <button onclick="requestPatientAssignment('${patient.id}')" class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition-colors font-medium">
                            <i class="fas fa-hand-paper mr-2"></i>Request Patient Assignment
                        </button>
                        <button class="close-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtns = modal.querySelectorAll('.close-modal');
            closeBtns.forEach(btn => {
                btn.onclick = () => modal.remove();
            });
        }

        // Patient File Manager for Physiotherapists
        function physioManagePatientFiles(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (!patient) {
                showNotification('❌ Patient not found', 'error');
                return;
            }

            const content = `
                <!-- Patient Information Header -->
                <div class="bg-gradient-to-r from-secondary to-sage rounded-lg p-6 mb-6 text-white">
                    <div class="flex items-center mb-4">
                        <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-white font-bold mr-4 text-xl">
                            ${patient.firstName.charAt(0)}${patient.lastName.charAt(0)}
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">${patient.firstName} ${patient.lastName}</h3>
                            <p class="text-white text-opacity-90">CPR: ${patient.cprNumber}</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div>
                            <span class="text-white text-opacity-70">Phone:</span>
                            <span class="font-medium ml-2">${patient.phone}</span>
                        </div>
                        <div>
                            <span class="text-white text-opacity-70">Email:</span>
                            <span class="font-medium ml-2">${patient.email || 'Not provided'}</span>
                        </div>
                        <div>
                            <span class="text-white text-opacity-70">Status:</span>
                            <span class="font-medium ml-2 px-2 py-1 bg-green-500 rounded-full text-xs">
                                ${(patient.treatmentStatus || 'Active').charAt(0).toUpperCase() + (patient.treatmentStatus || 'active').slice(1)}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Current Condition -->
                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6 border border-blue-200 dark:border-blue-800">
                    <h4 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-2 flex items-center">
                        <i class="fas fa-stethoscope text-blue-600 mr-2"></i>Current Condition
                    </h4>
                    <p class="text-blue-800 dark:text-blue-300">${patient.currentCondition}</p>
                </div>

                <!-- File Management Section -->
                <div class="space-y-6">
                    <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                        <i class="fas fa-folder-open text-teal-400 mr-2"></i>Patient File Management
                    </h4>
                    
                    <div class="bg-gray-700 rounded-lg p-4 mb-4">
                        <!-- Upload Area -->
                        <div id="physioUploadArea" class="border-2 border-dashed border-gray-500 rounded-lg p-6 text-center hover:border-teal-400 transition-colors cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-gray-400 text-4xl mb-3"></i>
                            <p class="text-lg text-gray-300 mb-2">Drop patient files here or click to browse</p>
                            <p class="text-sm text-gray-400 mb-4">Support for images, videos, documents, and PDFs</p>
                            <input type="file" id="physioTreatmentDocuments" name="physioTreatmentDocuments" multiple accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif,.bmp,.webp,.mp4,.avi,.mov,.wmv,.flv,.webm,.mkv" class="hidden">
                            <div class="flex flex-wrap gap-2 justify-center">
                                <button type="button" onclick="document.getElementById('physioTreatmentDocuments').click()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                    <i class="fas fa-folder-open mr-2"></i>Choose Files
                                </button>
                                <button type="button" onclick="physioGenerateReport('${patient.id}')" class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700 transition-colors text-sm">
                                    <i class="fas fa-file-medical mr-2"></i>Generate Progress Report
                                </button>
                                <button type="button" onclick="physioClearAllFiles()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                    <i class="fas fa-trash mr-2"></i>Clear All
                                </button>
                            </div>
                        </div>

                        <!-- File Type Categories -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4 mb-4">
                            <div class="bg-gray-600 rounded-lg p-3 text-center">
                                <i class="fas fa-image text-blue-400 text-2xl mb-2"></i>
                                <p class="text-sm text-gray-300 font-medium">Progress Images</p>
                                <p class="text-xs text-gray-400">Before/After photos</p>
                            </div>
                            <div class="bg-gray-600 rounded-lg p-3 text-center">
                                <i class="fas fa-video text-red-400 text-2xl mb-2"></i>
                                <p class="text-sm text-gray-300 font-medium">Exercise Videos</p>
                                <p class="text-xs text-gray-400">Patient demonstrations</p>
                            </div>
                            <div class="bg-gray-600 rounded-lg p-3 text-center">
                                <i class="fas fa-file-medical text-green-400 text-2xl mb-2"></i>
                                <p class="text-sm text-gray-300 font-medium">Medical Records</p>
                                <p class="text-xs text-gray-400">Reports, X-rays</p>
                            </div>
                            <div class="bg-gray-600 rounded-lg p-3 text-center">
                                <i class="fas fa-clipboard-list text-purple-400 text-2xl mb-2"></i>
                                <p class="text-sm text-gray-300 font-medium">Assessment Forms</p>
                                <p class="text-xs text-gray-400">Progress notes</p>
                            </div>
                        </div>
                        
                        <!-- Uploaded Files Display -->
                        <div id="physioUploadedFiles" class="space-y-3"></div>
                    </div>

                    <!-- Treatment Notes Section -->
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h5 class="text-lg font-semibold text-gray-300 mb-3 flex items-center">
                            <i class="fas fa-sticky-note text-yellow-400 mr-2"></i>Treatment Notes
                        </h5>
                        <textarea id="treatmentNotes" rows="4" placeholder="Add treatment notes, progress updates, observations..." class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500 placeholder-gray-400"></textarea>
                    </div>
                </div>
            `;
            
            // Create patient file management modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-folder-open text-teal-400 mr-2"></i>Patient File Manager - ${patient.firstName} ${patient.lastName}
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Close
                        </button>
                        <button class="save-physio-files px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-save mr-2"></i>Save Files & Notes
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-physio-files');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;

            // Set up enhanced file upload functionality for physiotherapist
            const treatmentDocsInput = modal.querySelector('#physioTreatmentDocuments');
            const uploadedFilesDiv = modal.querySelector('#physioUploadedFiles');
            const uploadArea = modal.querySelector('#physioUploadArea');
            let physioUploadedFilesList = [];

            if (treatmentDocsInput && uploadedFilesDiv && uploadArea) {
                // Drag and Drop functionality
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('border-teal-400', 'bg-gray-600');
                });

                uploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('border-teal-400', 'bg-gray-600');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('border-teal-400', 'bg-gray-600');
                    const files = Array.from(e.dataTransfer.files);
                    handlePhysioFileSelection(files);
                });

                uploadArea.addEventListener('click', () => {
                    treatmentDocsInput.click();
                });

                treatmentDocsInput.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    handlePhysioFileSelection(files);
                });

                function handlePhysioFileSelection(files) {
                    files.forEach(file => {
                        if (!physioUploadedFilesList.find(f => f.name === file.name && f.size === file.size)) {
                            physioUploadedFilesList.push(file);
                        }
                    });
                    displayPhysioUploadedFiles();
                }

                function displayPhysioUploadedFiles() {
                    if (physioUploadedFilesList.length === 0) {
                        uploadedFilesDiv.innerHTML = '';
                        return;
                    }

                    uploadedFilesDiv.innerHTML = `
                        <h5 class="text-sm font-medium text-gray-300 mb-3 flex items-center">
                            <i class="fas fa-paperclip text-teal-400 mr-2"></i>
                            Patient Files (${physioUploadedFilesList.length})
                        </h5>
                        <div class="space-y-3">
                            ${physioUploadedFilesList.map((file, index) => createPhysioFilePreview(file, index)).join('')}
                        </div>
                    `;
                }

                function createPhysioFilePreview(file, index) {
                    const fileSize = formatFileSize(file.size);
                    const fileType = getFileType(file);
                    const fileIcon = getFileIcon(fileType);
                    const isImage = fileType === 'image';
                    const isVideo = fileType === 'video';

                    let preview = '';
                    if (isImage) {
                        const imageUrl = URL.createObjectURL(file);
                        preview = `
                            <div class="w-16 h-16 bg-gray-500 rounded-lg overflow-hidden flex-shrink-0">
                                <img src="${imageUrl}" alt="${file.name}" class="w-full h-full object-cover">
                            </div>
                        `;
                    } else if (isVideo) {
                        const videoUrl = URL.createObjectURL(file);
                        preview = `
                            <div class="w-16 h-16 bg-gray-500 rounded-lg overflow-hidden flex-shrink-0 relative">
                                <video class="w-full h-full object-cover" muted>
                                    <source src="${videoUrl}" type="${file.type}">
                                </video>
                                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30">
                                    <i class="fas fa-play text-white text-sm"></i>
                                </div>
                            </div>
                        `;
                    } else {
                        preview = `
                            <div class="w-16 h-16 bg-gray-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i class="${fileIcon} text-2xl text-white"></i>
                            </div>
                        `;
                    }

                    return `
                        <div class="flex items-center justify-between bg-gray-600 p-3 rounded-lg hover:bg-gray-550 transition-colors">
                            <div class="flex items-center space-x-3 flex-1 min-w-0">
                                ${preview}
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm font-medium text-white truncate">${file.name}</p>
                                    <div class="flex items-center space-x-4 mt-1">
                                        <span class="text-xs text-gray-300">${fileSize}</span>
                                        <span class="text-xs text-gray-400 capitalize">${fileType}</span>
                                        ${isImage || isVideo ? `<button onclick="physioPreviewMedia(${index})" class="text-xs text-teal-400 hover:text-teal-300">Preview</button>` : ''}
                                    </div>
                                </div>
                            </div>
                            <button onclick="physioRemoveFile(${index})" class="ml-3 text-red-400 hover:text-red-300 p-2 hover:bg-red-900/30 rounded">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    `;
                }

                // Make functions global for onclick handlers
                window.physioRemoveFile = function(index) {
                    physioUploadedFilesList.splice(index, 1);
                    displayPhysioUploadedFiles();
                    showNotification('🗑️ File removed', 'success');
                };

                window.physioPreviewMedia = function(index) {
                    const file = physioUploadedFilesList[index];
                    const fileUrl = URL.createObjectURL(file);
                    const isVideo = file.type.startsWith('video/');
                    
                    const previewModal = document.createElement('div');
                    previewModal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
                    previewModal.innerHTML = `
                        <div class="max-w-4xl max-h-full bg-gray-800 rounded-lg overflow-hidden">
                            <div class="flex items-center justify-between p-4 border-b border-gray-600">
                                <h3 class="text-white font-medium">${file.name}</h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-white">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                            <div class="p-4">
                                ${isVideo ? 
                                    `<video controls class="max-w-full max-h-96 mx-auto">
                                        <source src="${fileUrl}" type="${file.type}">
                                        Your browser does not support the video tag.
                                    </video>` :
                                    `<img src="${fileUrl}" alt="${file.name}" class="max-w-full max-h-96 mx-auto object-contain">`
                                }
                            </div>
                        </div>
                    `;
                    document.body.appendChild(previewModal);
                };

                window.physioClearAllFiles = function() {
                    physioUploadedFilesList = [];
                    displayPhysioUploadedFiles();
                    treatmentDocsInput.value = '';
                    showNotification('🧹 All files cleared', 'success');
                };

                window.physioGenerateReport = function(patientId) {
                    const patient = appData.patients.find(p => p.id === patientId);
                    if (patient) {
                        const currentDate = new Date().toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });

                        // Create Progress Report RTF
                        const reportContent = `{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}{\\f1 Arial;}}
{\\colortbl;\\red0\\green0\\blue0;\\red0\\green0\\blue255;\\red255\\green0\\blue0;}

\\f0\\fs24\\qc\\b\\fs32 BAHRAIN MOBILITY INTERNATIONAL\\par
\\fs28 PATIENT PROGRESS REPORT\\par\\par
\\b0\\fs24\\ql

{\\b\\fs26\\ul PATIENT INFORMATION}\\par\\par

{\\b Patient Name:} ${patient.firstName} ${patient.lastName}\\par
{\\b CPR Number:} ${patient.cprNumber}\\par
{\\b Physiotherapist:} ${patient.assignedPhysiotherapist}\\par
{\\b Report Date:} ${currentDate}\\par\\par

{\\b\\fs26\\ul TREATMENT PROGRESS}\\par\\par

{\\b Initial Condition:} ${patient.currentCondition}\\par\\par

{\\b Session Summary:}\\par
\\u9744? Total Sessions Completed: _______________\\par
\\u9744? Current Session Number: _________________\\par
\\u9744? Treatment Duration: ____________________\\par\\par

{\\b Progress Assessment:}\\par
\\u9744? Pain Level (0-10): Before _____ Current _____\\par
\\u9744? Range of Motion: Improved / Same / Declined\\par
\\u9744? Functional Capacity: ___________________\\par
\\u9744? Patient Compliance: ____________________\\par\\par

{\\b\\fs26\\ul TREATMENT MODIFICATIONS}\\par\\par

{\\b Exercise Program Updates:}\\par
\\u9744? _________________________________________\\par
\\u9744? _________________________________________\\par
\\u9744? _________________________________________\\par\\par

{\\b Next Session Goals:}\\par
\\u9744? _________________________________________\\par
\\u9744? _________________________________________\\par
\\u9744? _________________________________________\\par\\par

{\\b\\fs26\\ul PHYSIOTHERAPIST NOTES}\\par\\par

{\\b Treatment Notes:} ________________________________\\par
________________________________________________\\par
________________________________________________\\par\\par

{\\b Recommendations:} _______________________________\\par
________________________________________________\\par
________________________________________________\\par\\par

{\\b\\fs26\\ul SIGNATURE}\\par\\par

{\\b Physiotherapist:} Dr. Mariam Abdulatheem Ali\\par
{\\b Date:} ${currentDate}\\par
{\\b Signature:} ____________________________________\\par\\par

\\qc\\fs18\\i This progress report is confidential and intended for medical use only.\\par
\\u169? ${new Date().getFullYear()} Bahrain Mobility International\\par
}`;

                        // Create and download the report
                        const blob = new Blob([reportContent], { type: 'application/rtf' });
                        const url = URL.createObjectURL(blob);
                        
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `Progress_Report_${patient.firstName}_${patient.lastName}_${new Date().toISOString().split('T')[0]}.rtf`;
                        
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        URL.revokeObjectURL(url);
                        
                        showNotification(`📄 Progress report generated for ${patient.firstName} ${patient.lastName}!`, 'success');
                    }
                };
            }
            
            saveBtn.onclick = () => {
                const treatmentNotes = modal.querySelector('#treatmentNotes').value.trim();
                
                // Here you would typically save the files and notes to the patient record
                // For now, we'll just show a success message
                showNotification(`💾 Files and notes saved for ${patient.firstName} ${patient.lastName}!`, 'success');
                closeModal();
            };
        }

        // Bulk Appointment Scheduling
        function showBulkAppointmentModal() {
            const content = `
                <div class="space-y-6">
                    <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                        <i class="fas fa-calendar-week text-teal-400 mr-2"></i>Bulk Appointment Scheduling
                    </h4>
                    
                    <!-- Bulk Scheduling Type Selection -->
                    <div class="bg-gray-700 rounded-lg p-4 mb-6">
                        <h5 class="text-md font-semibold text-gray-300 mb-3">Choose Scheduling Type</h5>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button type="button" id="multiplePatientBtn" class="bulk-type-btn p-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors border-2 border-blue-600">
                                <i class="fas fa-users text-2xl mb-2 block"></i>
                                <div class="text-sm font-medium">Multiple Patients</div>
                                <div class="text-xs opacity-90">Same time slot, different patients</div>
                            </button>
                            <button type="button" id="samePatientBtn" class="bulk-type-btn p-4 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors border-2 border-gray-600">
                                <i class="fas fa-user-clock text-2xl mb-2 block"></i>
                                <div class="text-sm font-medium">Same Patient</div>
                                <div class="text-xs opacity-90">Multiple appointments for one patient</div>
                            </button>
                            <button type="button" id="recurringBtn" class="bulk-type-btn p-4 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors border-2 border-gray-600">
                                <i class="fas fa-redo text-2xl mb-2 block"></i>
                                <div class="text-sm font-medium">Recurring</div>
                                <div class="text-xs opacity-90">Weekly/bi-weekly sessions</div>
                            </button>
                        </div>
                    </div>

                    <!-- Multiple Patients Section -->
                    <div id="multiplePatientSection" class="bulk-section">
                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4 border border-blue-200 dark:border-blue-800">
                            <h5 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3 flex items-center">
                                <i class="fas fa-users text-blue-600 mr-2"></i>Schedule Multiple Patients
                            </h5>
                            <p class="text-sm text-blue-800 dark:text-blue-300">Book the same time slot for multiple patients (useful for group sessions or adjacent time slots)</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date *</label>
                                <input type="date" id="multiPatientDate" name="multiPatientDate" required min="${new Date().toISOString().split('T')[0]}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Starting Time *</label>
                                <select id="multiPatientTime" name="multiPatientTime" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select starting time</option>
                                    <option value="08:00">08:00 AM</option>
                                    <option value="08:30">08:30 AM</option>
                                    <option value="09:00">09:00 AM</option>
                                    <option value="09:30">09:30 AM</option>
                                    <option value="10:00">10:00 AM</option>
                                    <option value="10:30">10:30 AM</option>
                                    <option value="11:00">11:00 AM</option>
                                    <option value="11:30">11:30 AM</option>
                                    <option value="12:00">12:00 PM</option>
                                    <option value="12:30">12:30 PM</option>
                                    <option value="13:00">01:00 PM</option>
                                    <option value="13:30">01:30 PM</option>
                                    <option value="14:00">02:00 PM</option>
                                    <option value="14:30">02:30 PM</option>
                                    <option value="15:00">03:00 PM</option>
                                    <option value="15:30">03:30 PM</option>
                                    <option value="16:00">04:00 PM</option>
                                    <option value="16:30">04:30 PM</option>
                                    <option value="17:00">05:00 PM</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Physiotherapist *</label>
                                <select id="multiPatientPhysio" name="multiPatientPhysio" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Choose physiotherapist</option>
                                    ${appData.physiotherapists.map(physio => `
                                        <option value="Dr. ${physio.firstName} ${physio.lastName}">Dr. ${physio.firstName} ${physio.lastName}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Duration per Patient</label>
                                <select id="multiPatientDuration" name="multiPatientDuration" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="30">30 minutes</option>
                                    <option value="45" selected>45 minutes</option>
                                    <option value="60">60 minutes</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Scheduling Method</label>
                            <div class="flex gap-4">
                                <label class="flex items-center">
                                    <input type="radio" name="multiPatientMethod" value="same_time" checked class="text-teal-500 focus:ring-teal-500">
                                    <span class="ml-2 text-sm text-gray-300">Same Time (Group Session)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="multiPatientMethod" value="consecutive" class="text-teal-500 focus:ring-teal-500">
                                    <span class="ml-2 text-sm text-gray-300">Consecutive Slots</span>
                                </label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Select Patients *</label>
                            <div class="bg-gray-600 rounded-lg p-4 max-h-48 overflow-y-auto">
                                ${appData.patients.length > 0 ? appData.patients.map(patient => `
                                    <label class="flex items-center mb-2 p-2 hover:bg-gray-500 rounded">
                                        <input type="checkbox" name="selectedPatients" value="${patient.id}" class="text-teal-500 focus:ring-teal-500">
                                        <div class="ml-3 flex-1">
                                            <span class="text-white font-medium">${patient.firstName} ${patient.lastName}</span>
                                            <div class="text-xs text-gray-300">CPR: ${patient.cprNumber} | ${patient.currentCondition}</div>
                                        </div>
                                    </label>
                                `).join('') : '<p class="text-gray-400 text-center py-4">No patients available. Please add patients first.</p>'}
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Bulk Notes</label>
                            <textarea id="multiPatientNotes" name="multiPatientNotes" rows="3" placeholder="Notes that will apply to all selected appointments..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Same Patient Section -->
                    <div id="samePatientSection" class="bulk-section hidden">
                        <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 mb-4 border border-green-200 dark:border-green-800">
                            <h5 class="text-lg font-semibold text-green-900 dark:text-green-100 mb-3 flex items-center">
                                <i class="fas fa-user-clock text-green-600 mr-2"></i>Multiple Appointments for One Patient
                            </h5>
                            <p class="text-sm text-green-800 dark:text-green-300">Schedule multiple sessions for a single patient across different dates and times</p>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Select Patient *</label>
                            <select id="singlePatientSelect" name="singlePatientSelect" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="">Choose a patient</option>
                                ${appData.patients.map(patient => `
                                    <option value="${patient.id}">${patient.firstName} ${patient.lastName} - ${patient.cprNumber}</option>
                                `).join('')}
                            </select>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Physiotherapist *</label>
                                <select id="singlePatientPhysio" name="singlePatientPhysio" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Choose physiotherapist</option>
                                    ${appData.physiotherapists.map(physio => `
                                        <option value="Dr. ${physio.firstName} ${physio.lastName}">Dr. ${physio.firstName} ${physio.lastName}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Duration per Session</label>
                                <select id="singlePatientDuration" name="singlePatientDuration" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="30">30 minutes</option>
                                    <option value="45" selected>45 minutes</option>
                                    <option value="60">60 minutes</option>
                                    <option value="90">90 minutes</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Number of Sessions</label>
                            <select id="numberOfSessions" name="numberOfSessions" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="2">2 sessions</option>
                                <option value="3">3 sessions</option>
                                <option value="4">4 sessions</option>
                                <option value="5" selected>5 sessions</option>
                                <option value="6">6 sessions</option>
                                <option value="8">8 sessions</option>
                                <option value="10">10 sessions</option>
                            </select>
                        </div>

                        <div id="sessionDateTimes" class="space-y-3 bg-gray-700 rounded-lg p-4">
                            <h6 class="text-sm font-medium text-gray-300 mb-3">Schedule Each Session:</h6>
                            <!-- Session date/time inputs will be generated here -->
                        </div>

                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Treatment Type</label>
                            <select id="singlePatientTreatment" name="singlePatientTreatment" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="Follow-up Session">Follow-up Session</option>
                                <option value="Back Pain Therapy">Back Pain Therapy</option>
                                <option value="Knee Rehabilitation">Knee Rehabilitation</option>
                                <option value="Shoulder Treatment">Shoulder Treatment</option>
                                <option value="Sports Rehabilitation">Sports Rehabilitation</option>
                                <option value="Manual Therapy">Manual Therapy</option>
                                <option value="Exercise Therapy">Exercise Therapy</option>
                            </select>
                        </div>
                    </div>

                    <!-- Recurring Section -->
                    <div id="recurringSection" class="bulk-section hidden">
                        <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 mb-4 border border-purple-200 dark:border-purple-800">
                            <h5 class="text-lg font-semibold text-purple-900 dark:text-purple-100 mb-3 flex items-center">
                                <i class="fas fa-redo text-purple-600 mr-2"></i>Recurring Appointments
                            </h5>
                            <p class="text-sm text-purple-800 dark:text-purple-300">Set up weekly or bi-weekly recurring appointments for ongoing treatment</p>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Select Patient *</label>
                            <select id="recurringPatientSelect" name="recurringPatientSelect" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="">Choose a patient</option>
                                ${appData.patients.map(patient => `
                                    <option value="${patient.id}">${patient.firstName} ${patient.lastName} - ${patient.cprNumber}</option>
                                `).join('')}
                            </select>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Physiotherapist *</label>
                                <select id="recurringPhysio" name="recurringPhysio" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Choose physiotherapist</option>
                                    ${appData.physiotherapists.map(physio => `
                                        <option value="Dr. ${physio.firstName} ${physio.lastName}">Dr. ${physio.firstName} ${physio.lastName}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Time Slot *</label>
                                <select id="recurringTime" name="recurringTime" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select time</option>
                                    <option value="08:00">08:00 AM</option>
                                    <option value="08:30">08:30 AM</option>
                                    <option value="09:00">09:00 AM</option>
                                    <option value="09:30">09:30 AM</option>
                                    <option value="10:00">10:00 AM</option>
                                    <option value="10:30">10:30 AM</option>
                                    <option value="11:00">11:00 AM</option>
                                    <option value="11:30">11:30 AM</option>
                                    <option value="12:00">12:00 PM</option>
                                    <option value="12:30">12:30 PM</option>
                                    <option value="13:00">01:00 PM</option>
                                    <option value="13:30">01:30 PM</option>
                                    <option value="14:00">02:00 PM</option>
                                    <option value="14:30">02:30 PM</option>
                                    <option value="15:00">03:00 PM</option>
                                    <option value="15:30">03:30 PM</option>
                                    <option value="16:00">04:00 PM</option>
                                    <option value="16:30">04:30 PM</option>
                                    <option value="17:00">05:00 PM</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Starting Date *</label>
                                <input type="date" id="recurringStartDate" name="recurringStartDate" required min="${new Date().toISOString().split('T')[0]}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Day of Week</label>
                                <select id="recurringDayOfWeek" name="recurringDayOfWeek" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="0">Sunday</option>
                                    <option value="1" selected>Monday</option>
                                    <option value="2">Tuesday</option>
                                    <option value="3">Wednesday</option>
                                    <option value="4">Thursday</option>
                                    <option value="5">Friday</option>
                                    <option value="6">Saturday</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Frequency</label>
                                <select id="recurringFrequency" name="recurringFrequency" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="1" selected>Weekly (every week)</option>
                                    <option value="2">Bi-weekly (every 2 weeks)</option>
                                    <option value="3">Every 3 weeks</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Number of Sessions</label>
                                <select id="recurringCount" name="recurringCount" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="4">4 sessions</option>
                                    <option value="6">6 sessions</option>
                                    <option value="8" selected>8 sessions</option>
                                    <option value="10">10 sessions</option>
                                    <option value="12">12 sessions</option>
                                </select>
                            </div>
                        </div>

                        <div id="recurringPreview" class="bg-gray-700 rounded-lg p-4 hidden">
                            <h6 class="text-sm font-medium text-gray-300 mb-3">Appointment Preview:</h6>
                            <div id="recurringPreviewList" class="space-y-2 max-h-48 overflow-y-auto"></div>
                        </div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-calendar-week text-teal-400 mr-2"></i>Bulk Appointment Scheduling
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="schedule-bulk-appointments px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-calendar-check mr-2"></i>Schedule Appointments
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const scheduleBtn = modal.querySelector('.schedule-bulk-appointments');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;

            // Set up bulk type selection
            const multiplePatientBtn = modal.querySelector('#multiplePatientBtn');
            const samePatientBtn = modal.querySelector('#samePatientBtn');
            const recurringBtn = modal.querySelector('#recurringBtn');
            
            const multiplePatientSection = modal.querySelector('#multiplePatientSection');
            const samePatientSection = modal.querySelector('#samePatientSection');
            const recurringSection = modal.querySelector('#recurringSection');

            function activateBulkType(activeBtn, activeSection) {
                // Reset all buttons
                [multiplePatientBtn, samePatientBtn, recurringBtn].forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'border-blue-600', 'bg-green-600', 'border-green-600', 'bg-purple-600', 'border-purple-600');
                    btn.classList.add('bg-gray-600', 'border-gray-600');
                });
                
                // Hide all sections
                [multiplePatientSection, samePatientSection, recurringSection].forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Activate selected
                if (activeBtn === multiplePatientBtn) {
                    activeBtn.classList.remove('bg-gray-600', 'border-gray-600');
                    activeBtn.classList.add('bg-blue-600', 'border-blue-600');
                } else if (activeBtn === samePatientBtn) {
                    activeBtn.classList.remove('bg-gray-600', 'border-gray-600');
                    activeBtn.classList.add('bg-green-600', 'border-green-600');
                } else if (activeBtn === recurringBtn) {
                    activeBtn.classList.remove('bg-gray-600', 'border-gray-600');
                    activeBtn.classList.add('bg-purple-600', 'border-purple-600');
                }
                
                activeSection.classList.remove('hidden');
            }

            multiplePatientBtn.onclick = () => activateBulkType(multiplePatientBtn, multiplePatientSection);
            samePatientBtn.onclick = () => activateBulkType(samePatientBtn, samePatientSection);
            recurringBtn.onclick = () => activateBulkType(recurringBtn, recurringSection);

            // Generate session inputs for same patient section
            const numberOfSessionsSelect = modal.querySelector('#numberOfSessions');
            const sessionDateTimesDiv = modal.querySelector('#sessionDateTimes');

            function generateSessionInputs() {
                const numSessions = parseInt(numberOfSessionsSelect.value) || 5;
                const html = Array.from({ length: numSessions }, (_, i) => `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 p-3 bg-gray-600 rounded">
                        <div>
                            <label class="block text-xs font-medium text-gray-300 mb-1">Session ${i + 1} Date</label>
                            <input type="date" name="sessionDate_${i}" min="${new Date().toISOString().split('T')[0]}" class="w-full px-3 py-2 bg-gray-700 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-300 mb-1">Session ${i + 1} Time</label>
                            <select name="sessionTime_${i}" class="w-full px-3 py-2 bg-gray-700 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500">
                                <option value="">Select time</option>
                                <option value="08:00">08:00 AM</option>
                                <option value="08:30">08:30 AM</option>
                                <option value="09:00">09:00 AM</option>
                                <option value="09:30">09:30 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="10:30">10:30 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="11:30">11:30 AM</option>
                                <option value="12:00">12:00 PM</option>
                                <option value="12:30">12:30 PM</option>
                                <option value="13:00">01:00 PM</option>
                                <option value="13:30">01:30 PM</option>
                                <option value="14:00">02:00 PM</option>
                                <option value="14:30">02:30 PM</option>
                                <option value="15:00">03:00 PM</option>
                                <option value="15:30">03:30 PM</option>
                                <option value="16:00">04:00 PM</option>
                                <option value="16:30">04:30 PM</option>
                                <option value="17:00">05:00 PM</option>
                            </select>
                        </div>
                    </div>
                `).join('');
                
                sessionDateTimesDiv.innerHTML = `
                    <h6 class="text-sm font-medium text-gray-300 mb-3">Schedule Each Session:</h6>
                    ${html}
                `;
            }

            if (numberOfSessionsSelect) {
                numberOfSessionsSelect.onchange = generateSessionInputs;
                generateSessionInputs(); // Initial generation
            }

            // Recurring appointment preview
            const recurringInputs = [
                modal.querySelector('#recurringStartDate'),
                modal.querySelector('#recurringDayOfWeek'),
                modal.querySelector('#recurringFrequency'),
                modal.querySelector('#recurringCount'),
                modal.querySelector('#recurringTime')
            ];

            function updateRecurringPreview() {
                const startDate = modal.querySelector('#recurringStartDate').value;
                const dayOfWeek = parseInt(modal.querySelector('#recurringDayOfWeek').value);
                const frequency = parseInt(modal.querySelector('#recurringFrequency').value);
                const count = parseInt(modal.querySelector('#recurringCount').value);
                const time = modal.querySelector('#recurringTime').value;
                
                const previewDiv = modal.querySelector('#recurringPreview');
                const previewList = modal.querySelector('#recurringPreviewList');
                
                if (startDate && !isNaN(dayOfWeek) && frequency && count && time) {
                    const dates = [];
                    const start = new Date(startDate);
                    
                    // Find the first occurrence of the selected day
                    let currentDate = new Date(start);
                    while (currentDate.getDay() !== dayOfWeek) {
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    // Generate appointment dates
                    for (let i = 0; i < count; i++) {
                        dates.push(new Date(currentDate));
                        currentDate.setDate(currentDate.getDate() + (frequency * 7));
                    }
                    
                    previewList.innerHTML = dates.map((date, index) => `
                        <div class="flex items-center justify-between p-2 bg-gray-600 rounded text-sm">
                            <span class="text-white">Session ${index + 1}</span>
                            <span class="text-gray-300">${date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })} at ${time}</span>
                        </div>
                    `).join('');
                    
                    previewDiv.classList.remove('hidden');
                } else {
                    previewDiv.classList.add('hidden');
                }
            }

            recurringInputs.forEach(input => {
                if (input) {
                    input.addEventListener('change', updateRecurringPreview);
                }
            });
            
            scheduleBtn.onclick = () => {
                const activeSection = modal.querySelector('.bulk-section:not(.hidden)');
                
                if (activeSection === multiplePatientSection) {
                    scheduleMultiplePatients(modal);
                } else if (activeSection === samePatientSection) {
                    scheduleSamePatientMultiple(modal);
                } else if (activeSection === recurringSection) {
                    scheduleRecurringAppointments(modal);
                }
            };
        }

        function scheduleMultiplePatients(modal) {
            const date = modal.querySelector('#multiPatientDate').value;
            const time = modal.querySelector('#multiPatientTime').value;
            const physiotherapist = modal.querySelector('#multiPatientPhysio').value;
            const duration = parseInt(modal.querySelector('#multiPatientDuration').value);
            const method = modal.querySelector('input[name="multiPatientMethod"]:checked').value;
            const notes = modal.querySelector('#multiPatientNotes').value.trim();
            
            const selectedPatients = Array.from(modal.querySelectorAll('input[name="selectedPatients"]:checked'))
                .map(checkbox => checkbox.value);
            
            if (!date || !time || !physiotherapist || selectedPatients.length === 0) {
                showNotification('⚠️ Please fill in all required fields and select at least one patient', 'error');
                return;
            }
            
            let scheduledCount = 0;
            let currentTime = time;
            
            selectedPatients.forEach((patientId, index) => {
                const patient = appData.patients.find(p => p.id === patientId);
                if (patient) {
                    const appointmentTime = method === 'same_time' ? time : currentTime;
                    
                    const newAppointment = {
                        id: `appointment-${Date.now()}-${index}`,
                        patientId,
                        patientName: `${patient.firstName} ${patient.lastName}`,
                        physiotherapist,
                        date,
                        time: appointmentTime,
                        duration,
                        treatmentType: 'Follow-up Session',
                        status: 'scheduled',
                        notes: `${notes} ${method === 'same_time' ? '(Group Session)' : '(Bulk Scheduled)'}`.trim(),
                        createdDate: new Date().toISOString()
                    };
                    
                    appData.appointments.push(newAppointment);
                    scheduledCount++;
                    
                    // Move to next time slot for consecutive scheduling
                    if (method === 'consecutive') {
                        const [hours, minutes] = currentTime.split(':').map(n => parseInt(n));
                        const nextTime = new Date();
                        nextTime.setHours(hours, minutes + duration, 0, 0);
                        currentTime = nextTime.toTimeString().slice(0, 5);
                    }
                }
            });
            
            updateAppointmentDisplay();
            showNotification(`✅ Successfully scheduled ${scheduledCount} appointments for ${date}!`, 'success');
            modal.remove();
        }

        function scheduleSamePatientMultiple(modal) {
            const patientId = modal.querySelector('#singlePatientSelect').value;
            const physiotherapist = modal.querySelector('#singlePatientPhysio').value;
            const duration = parseInt(modal.querySelector('#singlePatientDuration').value);
            const treatmentType = modal.querySelector('#singlePatientTreatment').value;
            const numSessions = parseInt(modal.querySelector('#numberOfSessions').value);
            
            if (!patientId || !physiotherapist) {
                showNotification('⚠️ Please select patient and physiotherapist', 'error');
                return;
            }
            
            const patient = appData.patients.find(p => p.id === patientId);
            if (!patient) {
                showNotification('❌ Patient not found', 'error');
                return;
            }
            
            let scheduledCount = 0;
            
            for (let i = 0; i < numSessions; i++) {
                const dateInput = modal.querySelector(`input[name="sessionDate_${i}"]`);
                const timeInput = modal.querySelector(`select[name="sessionTime_${i}"]`);
                
                if (dateInput && timeInput && dateInput.value && timeInput.value) {
                    const newAppointment = {
                        id: `appointment-${Date.now()}-${i}`,
                        patientId,
                        patientName: `${patient.firstName} ${patient.lastName}`,
                        physiotherapist,
                        date: dateInput.value,
                        time: timeInput.value,
                        duration,
                        treatmentType,
                        status: 'scheduled',
                        notes: `Session ${i + 1} of ${numSessions} (Bulk Scheduled)`,
                        createdDate: new Date().toISOString()
                    };
                    
                    appData.appointments.push(newAppointment);
                    scheduledCount++;
                }
            }
            
            if (scheduledCount > 0) {
                updateAppointmentDisplay();
                showNotification(`✅ Successfully scheduled ${scheduledCount} sessions for ${patient.firstName} ${patient.lastName}!`, 'success');
                modal.remove();
            } else {
                showNotification('⚠️ Please fill in date and time for at least one session', 'error');
            }
        }

        function scheduleRecurringAppointments(modal) {
            const patientId = modal.querySelector('#recurringPatientSelect').value;
            const physiotherapist = modal.querySelector('#recurringPhysio').value;
            const time = modal.querySelector('#recurringTime').value;
            const startDate = modal.querySelector('#recurringStartDate').value;
            const dayOfWeek = parseInt(modal.querySelector('#recurringDayOfWeek').value);
            const frequency = parseInt(modal.querySelector('#recurringFrequency').value);
            const count = parseInt(modal.querySelector('#recurringCount').value);
            
            if (!patientId || !physiotherapist || !time || !startDate) {
                showNotification('⚠️ Please fill in all required fields', 'error');
                return;
            }
            
            const patient = appData.patients.find(p => p.id === patientId);
            if (!patient) {
                showNotification('❌ Patient not found', 'error');
                return;
            }
            
            // Generate appointment dates
            const dates = [];
            const start = new Date(startDate);
            let currentDate = new Date(start);
            
            // Find the first occurrence of the selected day
            while (currentDate.getDay() !== dayOfWeek) {
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Generate all appointment dates
            for (let i = 0; i < count; i++) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + (frequency * 7));
            }
            
            // Create appointments
            dates.forEach((date, index) => {
                const newAppointment = {
                    id: `appointment-recurring-${Date.now()}-${index}`,
                    patientId,
                    patientName: `${patient.firstName} ${patient.lastName}`,
                    physiotherapist,
                    date: date.toISOString().split('T')[0],
                    time,
                    duration: 45,
                    treatmentType: 'Follow-up Session',
                    status: 'scheduled',
                    notes: `Recurring session ${index + 1} of ${count} (${frequency === 1 ? 'Weekly' : frequency === 2 ? 'Bi-weekly' : `Every ${frequency} weeks`})`,
                    createdDate: new Date().toISOString()
                };
                
                appData.appointments.push(newAppointment);
            });
            
            updateAppointmentDisplay();
            showNotification(`✅ Successfully scheduled ${count} recurring appointments for ${patient.firstName} ${patient.lastName}!`, 'success');
            modal.remove();
        }

        // Additional modal functions
        function showAddUserModal() {
            showNotification('👤 Add user modal coming soon!', 'success');
        }

        function showAddExerciseModal() {
            const content = `
                <form id="addExerciseForm" class="space-y-8">
                    <!-- Basic Exercise Information -->
                    <div id="basicInfoSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-info-circle text-teal-400 mr-2"></i>Basic Exercise Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Name *</label>
                                <input type="text" id="exerciseName" name="exerciseName" required placeholder="e.g., Shoulder Hamstring Stretch" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Code</label>
                                <input type="text" id="exerciseCode" name="exerciseCode" placeholder="e.g., SH-L-001" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Category *</label>
                                <select id="exerciseCategory" name="exerciseCategory" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Category...</option>
                                    <option value="flexibility">Flexibility</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="balance">Balance</option>
                                    <option value="rehabilitation">Rehabilitation</option>
                                    <option value="cardio">Cardiovascular</option>
                                    <option value="coordination">Coordination</option>
                                    <option value="proprioception">Proprioception</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Difficulty Level *</label>
                                <select id="exerciseDifficulty" name="exerciseDifficulty" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Difficulty...</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Equipment Required</label>
                                <select id="equipmentRequired" name="equipmentRequired" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">No Equipment</option>
                                    <option value="mat">Exercise Mat</option>
                                    <option value="resistance-band">Resistance Band</option>
                                    <option value="dumbbells">Dumbbells</option>
                                    <option value="stability-ball">Stability Ball</option>
                                    <option value="foam-roller">Foam Roller</option>
                                    <option value="theraband">Theraband</option>
                                    <option value="chair">Chair</option>
                                    <option value="wall">Wall</option>
                                    <option value="pillow">Pillow/Cushion</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Description *</label>
                            <textarea id="exerciseDescription" name="exerciseDescription" rows="4" required placeholder="Detailed description of the exercise, its purpose, and general technique..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Target Body Areas & Muscles -->
                    <div id="targetAreasSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-crosshairs text-teal-400 mr-2"></i>Target Body Areas & Muscles
                        </h4>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-3">Primary Target Areas *</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 bg-gray-700 rounded-lg p-4">
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="neck-cervical" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Neck & Cervical</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="shoulders" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Shoulders</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="upper-back" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Upper Back</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="lower-back" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Lower Back</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="arms-biceps" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Arms & Biceps</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="forearms-wrists" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Forearms & Wrists</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="core-abs" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Core & Abs</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="chest" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Chest</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="hips-pelvis" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Hips & Pelvis</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="full-body" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Full Body</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="legs" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Legs</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="targetAreas" value="balance" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Balance</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Movement Pattern</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select movement pattern...</option>
                                    <option value="flexion">Flexion</option>
                                    <option value="extension">Extension</option>
                                    <option value="rotation">Rotation</option>
                                    <option value="lateral-flexion">Lateral Flexion</option>
                                    <option value="abduction">Abduction</option>
                                    <option value="adduction">Adduction</option>
                                    <option value="stretching">Stretching</option>
                                    <option value="strengthening">Strengthening</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Type</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select exercise type...</option>
                                    <option value="static-stretch">Static Stretch</option>
                                    <option value="dynamic-stretch">Dynamic Stretch</option>
                                    <option value="isometric">Isometric</option>
                                    <option value="isotonic">Isotonic</option>
                                    <option value="functional">Functional</option>
                                    <option value="balance-training">Balance Training</option>
                                    <option value="mobilization">Mobilization</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Step-by-Step Instructions -->
                    <div id="instructionsSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-list-ol text-teal-400 mr-2"></i>Step-by-Step Instructions
                        </h4>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Starting Position</label>
                            <textarea rows="3" placeholder="Describe the proper starting position and setup..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Steps</label>
                            <textarea rows="6" placeholder="Step-by-step instructions for performing the exercise:
1. Starting position...
2. Movement execution...
3. Return to starting position...
4. Repeat as prescribed..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Breathing Instructions</label>
                            <textarea rows="3" placeholder="Breathing pattern and timing during the exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Exercise Parameters & Guidelines -->
                    <div id="parametersSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-sliders-h text-teal-400 mr-2"></i>Exercise Parameters & Guidelines
                        </h4>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Recommended Sets</label>
                                <input type="number" min="1" max="10" placeholder="3" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Recommended Reps</label>
                                <input type="text" placeholder="8-12" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Hold Duration</label>
                                <input type="text" placeholder="30 sec" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Rest Between Sets</label>
                                <input type="text" placeholder="60 sec" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Frequency (Per Week)</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select frequency...</option>
                                    <option value="daily">Daily (7x/week)</option>
                                    <option value="6x">6x per week</option>
                                    <option value="5x">5x per week</option>
                                    <option value="4x">4x per week</option>
                                    <option value="3x">3x per week</option>
                                    <option value="2x">2x per week</option>
                                    <option value="1x">1x per week</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Intensity Level</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select intensity...</option>
                                    <option value="low">Low Intensity</option>
                                    <option value="moderate">Moderate Intensity</option>
                                    <option value="high">High Intensity</option>
                                    <option value="variable">Variable</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Expected Duration</label>
                                <input type="text" placeholder="15 minutes" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Safety & Precautions -->
                    <div id="safetySection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>Safety & Precautions
                        </h4>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-3">Contraindications & Warnings</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 bg-gray-700 rounded-lg p-4">
                                <label class="flex items-center">
                                    <input type="checkbox" name="contraindications" value="acute-injury" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Acute injury/inflammation</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="contraindications" value="severe-pain" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Severe pain</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="contraindications" value="recent-surgery" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Recent surgery</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="contraindications" value="fracture-instability" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Fracture/instability</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="contraindications" value="cardiovascular-concerns" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Cardiovascular concerns</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="contraindications" value="balance-impairment" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Balance impairment</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Safety Guidelines</label>
                                <textarea rows="4" placeholder="Important safety guidelines and precautions for this exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Warning Signs to Watch</label>
                                <textarea rows="4" placeholder="Signs and symptoms that indicate the patient should stop the exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Progression & Modifications -->
                    <div id="progressionSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-chart-line text-teal-400 mr-2"></i>Progression & Modifications
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Easier Progression/Regression</label>
                                <textarea rows="4" placeholder="How to make this exercise easier for beginners or those with limitations..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Advanced Progression</label>
                                <textarea rows="4" placeholder="How to make this exercise more challenging for advanced patients..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Alternative Exercises</label>
                            <textarea rows="3" placeholder="List alternative exercises that target similar muscle groups or movement patterns..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Media & Documentation -->
                    <div id="mediaSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-photo-video text-teal-400 mr-2"></i>Media & Documentation
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-gray-700 rounded-lg p-4 text-center">
                                <i class="fas fa-camera text-blue-400 text-3xl mb-3"></i>
                                <h5 class="font-semibold text-gray-300 mb-1">Demonstration Images</h5>
                                <p class="text-xs text-gray-400 mb-3">Before/during/after poses</p>
                                <button type="button" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-colors">
                                    Upload Images
                                </button>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4 text-center">
                                <i class="fas fa-video text-green-400 text-3xl mb-3"></i>
                                <h5 class="font-semibold text-gray-300 mb-1">Video Instruction</h5>
                                <p class="text-xs text-gray-400 mb-3">Step-by-step demonstration</p>
                                <button type="button" class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 transition-colors">
                                    Upload Video
                                </button>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4 text-center">
                                <i class="fas fa-file-alt text-purple-400 text-3xl mb-3"></i>
                                <h5 class="font-semibold text-gray-300 mb-1">Supporting Documents</h5>
                                <p class="text-xs text-gray-400 mb-3">Research, handouts, forms</p>
                                <button type="button" class="bg-purple-600 text-white px-4 py-2 rounded text-sm hover:bg-purple-700 transition-colors">
                                    Upload Documents
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Clinical Application & Evidence -->
                    <div id="clinicalSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-stethoscope text-teal-400 mr-2"></i>Clinical Application & Evidence
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Clinical Indications</label>
                                <textarea rows="4" placeholder="Conditions and situations where this exercise is most beneficial..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Evidence Base</label>
                                <textarea rows="4" placeholder="Research evidence supporting the effectiveness of this exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Tips & Expert Recommendations -->
                    <div id="tipsSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-lightbulb text-teal-400 mr-2"></i>Tips & Expert Recommendations
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Teaching Tips</label>
                                <textarea rows="4" placeholder="Tips for effectively teaching and cuing this exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Common Mistakes</label>
                                <textarea rows="4" placeholder="Common errors patients make and how to correct them..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Details & Publishing -->
                    <div id="publishingSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-cog text-teal-400 mr-2"></i>Details & Publishing
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Created By</label>
                                <input type="text" value="Dr. Mariam Abdulatheem Ali" readonly class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Creation Date</label>
                                <input type="text" value="${new Date().toLocaleDateString()}" readonly class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Version</label>
                                <input type="text" value="1.0" readonly class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 text-base">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Internal Notes for Staff</label>
                            <textarea rows="3" placeholder="Private notes for clinic staff about this exercise (not visible to patients)..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div class="mt-4">
                            <label class="flex items-center">
                                <input type="checkbox" name="publishToLibrary" checked class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Publish to Exercise Library</span>
                            </label>
                            <label class="flex items-center mt-2">
                                <input type="checkbox" name="shareWithStaff" class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Share with clinic staff</span>
                            </label>
                            <label class="flex items-center mt-2">
                                <input type="checkbox" name="patientHandout" class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Generate patient handout version</span>
                            </label>
                        </div>
                    </div>
                </form>
                
                <style>
                    .exercise-section {
                        border: 1px solid #374151;
                        border-radius: 8px;
                        padding: 20px;
                        background: rgba(55, 65, 81, 0.3);
                    }
                    
                    .exercise-section h4 {
                        margin-bottom: 16px;
                        padding-bottom: 8px;
                        border-bottom: 1px solid #4B5563;
                    }
                </style>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-dumbbell text-teal-400 mr-2"></i>Add New Exercise
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-exercise px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-plus mr-2"></i>Add Exercise
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-exercise');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            
            saveBtn.onclick = () => {
                const form = document.getElementById('addExerciseForm');
                const formData = new FormData(form);
                
                const exerciseName = formData.get('exerciseName')?.trim();
                const category = formData.get('exerciseCategory');
                const difficulty = formData.get('exerciseDifficulty');
                const description = formData.get('exerciseDescription')?.trim();
                
                if (!exerciseName || !category || !difficulty || !description) {
                    showNotification('⚠️ Please fill in all required fields', 'error');
                    return;
                }
                
                // Get selected target areas
                const targetAreas = Array.from(form.querySelectorAll('input[name="targetAreas"]:checked'))
                    .map(cb => cb.value);
                
                // Create exercise data object
                const exerciseData = {
                    name: exerciseName,
                    category: category,
                    difficulty: difficulty,
                    description: description,
                    targetAreas: targetAreas,
                    equipment: formData.get('equipmentRequired') || '',
                    duration: formData.get('expectedDuration') || '15 minutes',
                    sets: parseInt(formData.get('recommendedSets')) || 3,
                    reps: formData.get('recommendedReps') || 'As prescribed'
                };
                
                // Add to shared library
                const newExercise = addExerciseToSharedLibrary(exerciseData, 'Admin User');
                
                showNotification(`✅ Exercise "${exerciseName}" added successfully to shared library! Available to all physiotherapists.`, 'success');
                closeModal();
            };
        }

        function showBulkUploadModal() {
            const content = `
                <div class="space-y-6">
                    <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                        <i class="fas fa-file-word text-teal-400 mr-2"></i>Upload Word Document
                    </h4>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800">
                        <h5 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3 flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>Bulk Exercise Import
                        </h5>
                        <p class="text-sm text-blue-800 dark:text-blue-300 mb-4">
                            Upload a Word document containing multiple exercises to automatically import them into your library.
                        </p>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4">
                            <h6 class="font-semibold text-gray-900 dark:text-white mb-2">📋 Document Format Requirements:</h6>
                            <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-disc list-inside">
                                <li>Each exercise should be separated by a line break</li>
                                <li>Exercise name should be in <strong>bold</strong> or as a heading</li>
                                <li>Include category, difficulty, and description for each exercise</li>
                                <li>Support for .docx and .doc files</li>
                                <li>Maximum file size: 10 MB</li>
                            </ul>
                        </div>
                    </div>

                    <!-- File Upload Area -->
                    <div class="bg-gray-700 rounded-lg p-6">
                        <div id="wordUploadArea" class="border-2 border-dashed border-gray-500 rounded-lg p-8 text-center hover:border-teal-400 transition-colors cursor-pointer">
                            <i class="fas fa-file-word text-blue-400 text-6xl mb-4"></i>
                            <p class="text-xl text-gray-300 mb-2">Drop your Word document here</p>
                            <p class="text-sm text-gray-400 mb-4">or click to browse and select file</p>
                            <input type="file" id="wordDocumentInput" accept=".doc,.docx" class="hidden">
                            <button type="button" onclick="document.getElementById('wordDocumentInput').click()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                <i class="fas fa-folder-open mr-2"></i>Choose Word Document
                            </button>
                        </div>
                        
                        <!-- Upload Progress -->
                        <div id="uploadProgress" class="hidden mt-4">
                            <div class="bg-gray-600 rounded-lg p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-300">Uploading...</span>
                                    <span class="text-sm text-gray-400">0%</span>
                                </div>
                                <div class="w-full bg-gray-500 rounded-full h-2">
                                    <div class="bg-teal-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Uploaded File Display -->
                        <div id="uploadedWordFile" class="hidden mt-4"></div>
                    </div>

                    <!-- Processing Options -->
                    <div class="bg-gray-700 rounded-lg p-4">
                        <h5 class="text-md font-semibold text-gray-300 mb-3">Processing Options</h5>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="autoCategorizePrintPageRange" checked class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Auto-categorize exercises based on content</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="extractImages" class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Extract embedded images as demonstration media</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="overwriteExisting" class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Overwrite existing exercises with same name</span>
                            </label>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div id="previewSection" class="hidden bg-gray-700 rounded-lg p-4">
                        <h5 class="text-md font-semibold text-gray-300 mb-3">Document Preview</h5>
                        <div id="documentPreview" class="bg-gray-600 rounded p-4 max-h-48 overflow-y-auto">
                            <!-- Document content preview will appear here -->
                        </div>
                        <div class="mt-3 flex items-center justify-between">
                            <span class="text-sm text-gray-400" id="exerciseCount">Detected: 0 exercises</span>
                            <button type="button" id="editPreviewBtn" class="text-teal-400 hover:text-teal-300 text-sm font-medium">
                                <i class="fas fa-edit mr-1"></i>Edit Before Import
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-file-word text-blue-400 mr-2"></i>Bulk Upload Word Document
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <div class="flex gap-3">
                            <button id="previewDocBtn" class="hidden px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                <i class="fas fa-eye mr-2"></i>Preview Exercises
                            </button>
                            <button id="importExercisesBtn" class="hidden px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                                <i class="fas fa-upload mr-2"></i>Import Exercises
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const previewBtn = modal.querySelector('#previewDocBtn');
            const importBtn = modal.querySelector('#importExercisesBtn');
            const wordInput = modal.querySelector('#wordDocumentInput');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            
            // Handle file selection
            if (wordInput) {
                wordInput.onchange = function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const uploadedFileDiv = modal.querySelector('#uploadedWordFile');
                        uploadedFileDiv.innerHTML = `
                            <div class="flex items-center justify-between bg-gray-600 p-4 rounded-lg">
                                <div class="flex items-center">
                                    <i class="fas fa-file-word text-blue-400 text-2xl mr-3"></i>
                                    <div>
                                        <p class="text-white font-medium">${file.name}</p>
                                        <p class="text-gray-400 text-sm">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                                    </div>
                                </div>
                                <button onclick="clearWordUpload()" class="text-red-400 hover:text-red-300">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        uploadedFileDiv.classList.remove('hidden');
                        previewBtn.classList.remove('hidden');
                        importBtn.classList.remove('hidden');
                        
                        showNotification(`📄 ${file.name} uploaded successfully!`, 'success');
                    }
                };
            }
            
            // Preview exercises
            if (previewBtn) {
                previewBtn.onclick = () => {
                    const previewSection = modal.querySelector('#previewSection');
                    const documentPreview = modal.querySelector('#documentPreview');
                    const exerciseCount = modal.querySelector('#exerciseCount');
                    
                    // Simulate exercise detection
                    documentPreview.innerHTML = `
                        <div class="space-y-3 text-sm">
                            <div class="bg-gray-700 p-3 rounded">
                                <h6 class="font-semibold text-white">1. Shoulder Strengthening</h6>
                                <p class="text-gray-300">Category: Strength Training | Difficulty: Intermediate</p>
                                <p class="text-gray-400 text-xs mt-1">Resistance band exercises to improve shoulder stability...</p>
                            </div>
                            <div class="bg-gray-700 p-3 rounded">
                                <h6 class="font-semibold text-white">2. Hamstring Stretch</h6>
                                <p class="text-gray-300">Category: Flexibility | Difficulty: Beginner</p>
                                <p class="text-gray-400 text-xs mt-1">Gentle stretching exercise to improve hamstring flexibility...</p>
                            </div>
                            <div class="bg-gray-700 p-3 rounded">
                                <h6 class="font-semibold text-white">3. Balance Training</h6>
                                <p class="text-gray-300">Category: Balance | Difficulty: Intermediate</p>
                                <p class="text-gray-400 text-xs mt-1">Single leg stands to improve proprioception...</p>
                            </div>
                        </div>
                    `;
                    
                    exerciseCount.textContent = 'Detected: 3 exercises';
                    previewSection.classList.remove('hidden');
                    
                    showNotification('📋 Document processed! 3 exercises detected.', 'success');
                };
            }
            
            // Import exercises
            if (importBtn) {
                importBtn.onclick = () => {
                    showNotification('✅ Successfully imported 3 exercises to your library!', 'success');
                    closeModal();
                };
            }
            
            // Global function for clearing upload
            window.clearWordUpload = function() {
                wordInput.value = '';
                modal.querySelector('#uploadedWordFile').classList.add('hidden');
                modal.querySelector('#previewSection').classList.add('hidden');
                previewBtn.classList.add('hidden');
                importBtn.classList.add('hidden');
                showNotification('🗑️ Upload cleared', 'success');
            };
        }

        function showSupabaseConnectionModal() {
            const content = `
                <div class="space-y-6">
                    <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-6 border border-purple-200 dark:border-purple-800">
                        <h4 class="text-lg font-semibold text-purple-900 dark:text-purple-100 mb-3 flex items-center">
                            <i class="fas fa-database text-purple-600 mr-2"></i>Connect to Supabase Database
                        </h4>
                        <p class="text-sm text-purple-800 dark:text-purple-300 mb-4">
                            Connect your PhysioTech application to a Supabase database for real-time data synchronization, 
                            backup, and multi-user support.
                        </p>
                        <div class="bg-white dark:bg-gray-700 rounded-lg p-4">
                            <h5 class="font-semibold text-gray-900 dark:text-white mb-2">🚀 Benefits of Database Connection:</h5>
                            <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-1 list-disc list-inside">
                                <li>Real-time data synchronization across devices</li>
                                <li>Automatic backup and data recovery</li>
                                <li>Multi-user access with role-based permissions</li>
                                <li>Advanced reporting and analytics</li>
                                <li>Secure data storage with encryption</li>
                                <li>API integration capabilities</li>
                            </ul>
                        </div>
                    </div>

                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                        <h5 class="font-semibold text-blue-900 dark:text-blue-100 mb-2 flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>Setup Instructions
                        </h5>
                        <div class="text-sm text-blue-800 dark:text-blue-300 space-y-2">
                            <p><strong>1.</strong> Create a free account at <a href="https://supabase.com" target="_blank" class="text-blue-600 hover:underline font-medium">supabase.com</a></p>
                            <p><strong>2.</strong> Create a new project and copy your project credentials</p>
                            <p><strong>3.</strong> Find your Project URL and API Key in Project Settings → API</p>
                            <p><strong>4.</strong> Enter the credentials below and test the connection</p>
                        </div>
                    </div>

                    <form id="supabaseConfigForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-white mb-2">
                                Supabase Project URL *
                                <span class="text-gray-400 font-normal">(e.g., https://xyz.supabase.co)</span>
                            </label>
                            <input type="url" id="supabaseUrl" name="supabaseUrl" required placeholder="https://your-project.supabase.co" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            <p class="text-xs text-gray-400 mt-1">Found in Project Settings → General → Reference ID</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-white mb-2">
                                Supabase API Key (anon/public) *
                                <span class="text-gray-400 font-normal">(Public API key)</span>
                            </label>
                            <input type="text" id="supabaseAnonKey" name="supabaseAnonKey" required placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            <p class="text-xs text-gray-400 mt-1">Found in Project Settings → API → Project API keys → anon/public</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-white mb-2">
                                Service Role Key (optional)
                                <span class="text-gray-400 font-normal">(For admin operations)</span>
                            </label>
                            <input type="password" id="supabaseServiceKey" name="supabaseServiceKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            <p class="text-xs text-gray-400 mt-1">Found in Project Settings → API → Project API keys → service_role</p>
                        </div>

                        <div class="border-t border-gray-600 pt-4">
                            <h5 class="font-semibold text-white mb-3">Database Configuration Options</h5>
                            
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" id="enableRealTimeSync" name="enableRealTimeSync" checked class="text-purple-500 focus:ring-purple-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Enable real-time synchronization</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="enableAutoBackup" name="enableAutoBackup" checked class="text-purple-500 focus:ring-purple-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Enable automatic daily backups</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="enableRowLevelSecurity" name="enableRowLevelSecurity" checked class="text-purple-500 focus:ring-purple-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Enable Row Level Security (RLS)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="enableAuditLog" name="enableAuditLog" class="text-purple-500 focus:ring-purple-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Enable audit logging for data changes</span>
                                </label>
                            </div>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800">
                            <h5 class="font-semibold text-yellow-900 dark:text-yellow-100 mb-2 flex items-center">
                                <i class="fas fa-shield-alt text-yellow-600 mr-2"></i>Security & Privacy
                            </h5>
                            <div class="text-sm text-yellow-800 dark:text-yellow-300 space-y-1">
                                <p><strong>🔒 Your credentials are secure:</strong></p>
                                <p>• Stored locally in your browser only</p>
                                <p>• Never sent to external servers</p>
                                <p>• Used only for direct Supabase communication</p>
                                <p>• Encrypted in transit with HTTPS</p>
                            </div>
                        </div>

                        <div class="bg-gray-700 rounded-lg p-4">
                            <h5 class="font-semibold text-white mb-2 flex items-center">
                                <i class="fas fa-table text-green-400 mr-2"></i>Required Database Tables
                            </h5>
                            <p class="text-sm text-gray-300 mb-3">The following tables will be created automatically if they don't exist:</p>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-xs font-mono">
                                <div class="bg-gray-600 rounded px-2 py-1 text-gray-300">patients</div>
                                <div class="bg-gray-600 rounded px-2 py-1 text-gray-300">appointments</div>
                                <div class="bg-gray-600 rounded px-2 py-1 text-gray-300">physiotherapists</div>
                                <div class="bg-gray-600 rounded px-2 py-1 text-gray-300">exercises</div>
                                <div class="bg-gray-600 rounded px-2 py-1 text-gray-300">users</div>
                                <div class="bg-gray-600 rounded px-2 py-1 text-gray-300">reports</div>
                                <div class="bg-gray-600 rounded px-2 py-1 text-gray-300">settings</div>
                                <div class="bg-gray-600 rounded px-2 py-1 text-gray-300">audit_log</div>
                            </div>
                        </div>
                    </form>

                    <!-- Connection Status -->
                    <div id="connectionTestResult" class="hidden">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <h5 class="font-semibold text-white mb-3 flex items-center">
                                <i class="fas fa-wifi text-blue-400 mr-2"></i>Connection Test Results
                            </h5>
                            <div id="connectionTestContent" class="space-y-2 text-sm"></div>
                        </div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-database text-purple-400 mr-2"></i>Connect to Supabase Database
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <button class="skip-connection px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Skip Connection (Use Local Storage)
                        </button>
                        <div class="flex gap-3">
                            <button class="test-connection px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                <i class="fas fa-plug mr-2"></i>Test Connection
                            </button>
                            <button class="save-connection px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium">
                                <i class="fas fa-save mr-2"></i>Connect & Save
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const skipBtn = modal.querySelector('.skip-connection');
            const testBtn = modal.querySelector('.test-connection');
            const saveBtn = modal.querySelector('.save-connection');
            const form = modal.querySelector('#supabaseConfigForm');
            const connectionTestResult = modal.querySelector('#connectionTestResult');
            const connectionTestContent = modal.querySelector('#connectionTestContent');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            
            skipBtn.onclick = () => {
                showNotification('🗄️ Using local storage - Supabase connection skipped', 'success');
                closeModal();
            };
            
            testBtn.onclick = () => {
                const formData = new FormData(form);
                const supabaseUrl = formData.get('supabaseUrl')?.trim();
                const supabaseAnonKey = formData.get('supabaseAnonKey')?.trim();
                
                if (!supabaseUrl || !supabaseAnonKey) {
                    showNotification('⚠️ Please enter both Project URL and API Key', 'error');
                    return;
                }
                
                // Validate URL format
                try {
                    const url = new URL(supabaseUrl);
                    if (!url.hostname.includes('supabase.co')) {
                        showNotification('⚠️ Invalid Supabase URL format. Should be https://xyz.supabase.co', 'error');
                        return;
                    }
                } catch (error) {
                    showNotification('⚠️ Invalid URL format', 'error');
                    return;
                }
                
                // Show loading state
                testBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing Connection...';
                testBtn.disabled = true;
                
                // Simulate connection test (in real implementation, this would test actual connection)
                setTimeout(() => {
                    const testResults = [
                        { test: 'URL Validation', status: 'success', message: 'Valid Supabase URL format' },
                        { test: 'API Key Format', status: 'success', message: 'API key format is valid' },
                        { test: 'Network Connectivity', status: 'success', message: 'Successfully reached Supabase servers' },
                        { test: 'Authentication', status: 'success', message: 'API key authentication successful' },
                        { test: 'Database Access', status: 'success', message: 'Database is accessible' },
                        { test: 'Required Tables', status: 'warning', message: 'Some tables need to be created' }
                    ];
                    
                    connectionTestContent.innerHTML = testResults.map(result => `
                        <div class="flex items-center justify-between p-3 rounded ${
                            result.status === 'success' ? 'bg-green-900/20 border border-green-800' :
                            result.status === 'warning' ? 'bg-yellow-900/20 border border-yellow-800' :
                            'bg-red-900/20 border border-red-800'
                        }">
                            <div class="flex items-center">
                                <i class="fas ${
                                    result.status === 'success' ? 'fa-check-circle text-green-500' :
                                    result.status === 'warning' ? 'fa-exclamation-triangle text-yellow-500' :
                                    'fa-times-circle text-red-500'
                                } mr-2"></i>
                                <span class="font-medium text-white">${result.test}</span>
                            </div>
                            <span class="text-sm ${
                                result.status === 'success' ? 'text-green-400' :
                                result.status === 'warning' ? 'text-yellow-400' :
                                'text-red-400'
                            }">${result.message}</span>
                        </div>
                    `).join('');
                    
                    connectionTestResult.classList.remove('hidden');
                    
                    testBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Connection Successful!';
                    testBtn.disabled = false;
                    testBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    testBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                    
                    showNotification('✅ Supabase connection test successful!', 'success');
                }, 2000);
            };
            
            saveBtn.onclick = () => {
                const formData = new FormData(form);
                const supabaseUrl = formData.get('supabaseUrl')?.trim();
                const supabaseAnonKey = formData.get('supabaseAnonKey')?.trim();
                const supabaseServiceKey = formData.get('supabaseServiceKey')?.trim();
                const enableRealTimeSync = formData.get('enableRealTimeSync') === 'on';
                const enableAutoBackup = formData.get('enableAutoBackup') === 'on';
                const enableRowLevelSecurity = formData.get('enableRowLevelSecurity') === 'on';
                const enableAuditLog = formData.get('enableAuditLog') === 'on';
                
                if (!supabaseUrl || !supabaseAnonKey) {
                    showNotification('⚠️ Please enter both Project URL and API Key', 'error');
                    return;
                }
                
                // Validate URL format
                try {
                    const url = new URL(supabaseUrl);
                    if (!url.hostname.includes('supabase.co')) {
                        showNotification('⚠️ Invalid Supabase URL format', 'error');
                        return;
                    }
                } catch (error) {
                    showNotification('⚠️ Invalid URL format', 'error');
                    return;
                }
                
                // Save configuration
                const supabaseConfig = {
                    url: supabaseUrl,
                    anonKey: supabaseAnonKey,
                    serviceKey: supabaseServiceKey,
                    enableRealTimeSync,
                    enableAutoBackup,
                    enableRowLevelSecurity,
                    enableAuditLog,
                    connectedAt: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem('supabaseConfig', JSON.stringify(supabaseConfig));
                    
                    // Update connection status in UI
                    updateSupabaseConnectionStatus(true, supabaseConfig);
                    
                    showNotification('✅ Supabase connected successfully! Database synchronization enabled.', 'success');
                    closeModal();
                    
                } catch (error) {
                    showNotification('❌ Failed to save Supabase configuration: ' + error.message, 'error');
                }
            };
        }

        // Report functions
        function generateCustomReport() {
            showNotification('📊 Generate custom report coming soon!', 'success');
        }

        function generatePatientReport() {
            showNotification('📋 Generate patient report coming soon!', 'success');
        }

        function generateFinancialReport() {
            showNotification('💰 Generate financial report coming soon!', 'success');
        }

        function generateAppointmentReport() {
            showNotification('📅 Generate appointment report coming soon!', 'success');
        }

        // Email Notification System Functions
        function sendAppointmentConfirmationEmail(patient, appointment) {
            // Check if patient has email
            if (!patient.email) {
                console.log(`⚠️ No email address for ${patient.firstName} ${patient.lastName}`);
                showNotification(`⚠️ No email address for ${patient.firstName} ${patient.lastName}`, 'error');
                return;
            }
            
            // Check if EmailJS is configured and initialized
            if (!emailJSInitialized || !emailJSConfig.publicKey) {
                console.log('📧 EmailJS not configured - showing preview instead');
                const emailContent = generateAppointmentEmailTemplate(patient, appointment);
                showEmailPreview(patient, appointment, emailContent);
                return;
            }
            
            // Send real email via EmailJS
            console.log('📧 Sending real email via EmailJS...');
            
            const appointmentDate = new Date(appointment.date + 'T' + appointment.time);
            const formattedDate = appointmentDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const formattedTime = appointmentDate.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });

            // Prepare email parameters for EmailJS template
            const emailParams = {
                patient_name: `${patient.firstName} ${patient.lastName}`,
                patient_email: patient.email,
                appointment_date: formattedDate,
                appointment_time: formattedTime,
                physiotherapist: appointment.physiotherapist,
                treatment_type: appointment.treatmentType,
                duration: `${appointment.duration} minutes`,
                notes: appointment.notes || 'No additional notes',
                clinic_name: 'Bahrain Mobility International',
                clinic_phone: '+973 1234 5678',
                clinic_address: 'Manama, Bahrain',
                patient_cpr: patient.cprNumber,
                patient_phone: patient.phone,
                status: appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1)
            };
            
            // Show loading notification
            showNotification('📧 Sending appointment confirmation email...', 'success');
            
            // Send email using EmailJS
            emailjs.send(emailJSConfig.serviceId, emailJSConfig.templateId, emailParams)
                .then((response) => {
                    console.log('✅ Email sent successfully!', response.status, response.text);
                    showNotification(`✅ Confirmation email sent to ${patient.firstName} ${patient.lastName}!`, 'success');
                    
                    // Show success modal with email details
                    showEmailSuccessModal(patient, appointment);
                })
                .catch((error) => {
                    console.log('❌ Failed to send email:', error);
                    showNotification(`❌ Failed to send email to ${patient.firstName} ${patient.lastName}: ${error.text || error.message}`, 'error');
                    
                    // Fallback: show email preview if sending fails
                    const emailContent = generateAppointmentEmailTemplate(patient, appointment);
                    showEmailPreview(patient, appointment, emailContent, true); // true indicates this is a fallback
                });
        }

        function generateAppointmentEmailTemplate(patient, appointment) {
            const appointmentDate = new Date(appointment.date + 'T' + appointment.time);
            const formattedDate = appointmentDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const formattedTime = appointmentDate.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });

            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Appointment Confirmation - Bahrain Mobility International</title>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px; }
                        .header { background: linear-gradient(135deg, #0F766E, #0D9488); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
                        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
                        .appointment-card { background: white; border-left: 5px solid #0F766E; padding: 20px; margin: 20px 0; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
                        .detail-row { display: flex; justify-content: space-between; margin: 10px 0; padding: 8px 0; border-bottom: 1px solid #eee; }
                        .label { font-weight: bold; color: #0F766E; }
                        .value { color: #333; }
                        .important { background: #e6f7ff; border: 1px solid #91d5ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
                        .footer { text-align: center; color: #666; font-size: 12px; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
                        .btn { background: #0F766E; color: white; padding: 12px 25px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 10px 0; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>🏥 Bahrain Mobility International</h1>
                        <h2>Appointment Confirmation</h2>
                    </div>
                    
                    <div class="content">
                        <h3>Dear ${patient.firstName} ${patient.lastName},</h3>
                        
                        <p>Your appointment has been successfully scheduled. Here are your appointment details:</p>
                        
                        <div class="appointment-card">
                            <h3 style="color: #0F766E; margin-top: 0;">📅 Appointment Details</h3>
                            
                            <div class="detail-row">
                                <span class="label">Date:</span>
                                <span class="value">${formattedDate}</span>
                            </div>
                            
                            <div class="detail-row">
                                <span class="label">Time:</span>
                                <span class="value">${formattedTime}</span>
                            </div>
                            
                            <div class="detail-row">
                                <span class="label">Duration:</span>
                                <span class="value">${appointment.duration} minutes</span>
                            </div>
                            
                            <div class="detail-row">
                                <span class="label">Physiotherapist:</span>
                                <span class="value">${appointment.physiotherapist}</span>
                            </div>
                            
                            <div class="detail-row">
                                <span class="label">Treatment Type:</span>
                                <span class="value">${appointment.treatmentType}</span>
                            </div>
                            
                            <div class="detail-row">
                                <span class="label">Status:</span>
                                <span class="value" style="text-transform: capitalize; color: #22C55E; font-weight: bold;">${appointment.status}</span>
                            </div>
                            
                            ${appointment.notes ? `
                                <div class="detail-row">
                                    <span class="label">Notes:</span>
                                    <span class="value">${appointment.notes}</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="important">
                            <h4 style="color: #0F766E; margin-top: 0;">📋 Important Information</h4>
                            <ul>
                                <li><strong>Please arrive 15 minutes early</strong> for check-in and preparation</li>
                                <li>Bring a valid ID and any relevant medical documents</li>
                                <li>Wear comfortable, loose-fitting clothing</li>
                                <li>If you need to reschedule, please call us at least 24 hours in advance</li>
                            </ul>
                        </div>
                        
                        <div style="text-align: center; margin: 30px 0;">
                            <p><strong>Need to reschedule or have questions?</strong></p>
                            <p>📞 Call us: +973 1234 5678</p>
                            <p>📧 Email: info@bahrainmobility.com</p>
                            <p>🏥 Address: Bahrain Mobility International, Manama, Bahrain</p>
                        </div>
                        
                        <div style="background: #f0f9ff; padding: 20px; border-radius: 5px; text-align: center;">
                            <h4 style="color: #0369a1; margin-top: 0;">🌟 We're Here to Help You Recover</h4>
                            <p>Our team is committed to providing you with the best physiotherapy care. We look forward to seeing you at your appointment!</p>
                        </div>
                    </div>
                    
                    <div class="footer">
                        <p>This is an automated message from Bahrain Mobility International.</p>
                        <p>Please do not reply to this email. For any inquiries, contact us using the information above.</p>
                        <p>&copy; ${new Date().getFullYear()} Bahrain Mobility International - All Rights Reserved</p>
                    </div>
                </body>
                </html>
            `;
        }

        function showEmailSuccessModal(patient, appointment) {
            const appointmentDate = new Date(appointment.date + 'T' + appointment.time);
            const formattedDate = appointmentDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const formattedTime = appointmentDate.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });

            const successModal = document.createElement('div');
            successModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            successModal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full border border-gray-200 dark:border-gray-700">
                    <div class="flex items-center justify-between p-6 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-t-xl">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-check-circle text-white mr-2"></i>
                            Email Sent Successfully!
                        </h3>
                        <button class="close-success-modal text-white hover:text-gray-200 text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="p-6">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-envelope text-green-600 text-2xl"></i>
                            </div>
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Appointment Confirmation Sent!</h4>
                            <p class="text-gray-600 dark:text-gray-400">Your patient has been notified about their upcoming appointment.</p>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-6 border border-blue-200 dark:border-blue-800">
                            <h5 class="font-semibold text-blue-900 dark:text-blue-100 mb-3 flex items-center">
                                <i class="fas fa-info-circle text-blue-600 mr-2"></i>Email Details
                            </h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-blue-700 dark:text-blue-300">Sent to:</span>
                                    <span class="font-medium text-blue-900 dark:text-blue-100">${patient.firstName} ${patient.lastName}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-blue-700 dark:text-blue-300">Email:</span>
                                    <span class="font-medium text-blue-900 dark:text-blue-100">${patient.email}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-blue-700 dark:text-blue-300">Appointment:</span>
                                    <span class="font-medium text-blue-900 dark:text-blue-100">${formattedDate} at ${formattedTime}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-blue-700 dark:text-blue-300">Treatment:</span>
                                    <span class="font-medium text-blue-900 dark:text-blue-100">${appointment.treatmentType}</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
                            <div class="flex items-start">
                                <i class="fas fa-check-circle text-green-600 mr-3 mt-0.5"></i>
                                <div>
                                    <h6 class="font-semibold text-green-900 dark:text-green-100">Email Successfully Delivered</h6>
                                    <p class="text-sm text-green-700 dark:text-green-300 mt-1">
                                        The patient will receive a comprehensive appointment confirmation with all necessary details, including clinic information and preparation instructions.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end p-6 border-t border-gray-200 dark:border-gray-700">
                        <button class="close-success-modal px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium">
                            <i class="fas fa-check mr-2"></i>Got It
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(successModal);
            
            const closeBtns = successModal.querySelectorAll('.close-success-modal');
            closeBtns.forEach(btn => {
                btn.onclick = () => successModal.remove();
            });
        }

        function showEmailPreview(patient, appointment, emailContent, isFallback = false) {
            const previewModal = document.createElement('div');
            previewModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            previewModal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                    <div class="flex items-center justify-between p-6 bg-gradient-to-r from-primary to-secondary text-white">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-envelope text-white mr-2"></i>
                            Email Sent Successfully!
                        </h3>
                        <button class="close-email-preview text-white hover:text-gray-200 text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="p-6 bg-green-50 border-b border-green-200">
                        <div class="flex items-center text-green-800">
                            <i class="fas fa-check-circle text-green-600 text-2xl mr-3"></i>
                            <div>
                                <h4 class="font-semibold text-lg">Appointment confirmation sent!</h4>
                                <p class="text-sm">Email sent to: <strong>${patient.firstName} ${patient.lastName}</strong> at <strong>${patient.email || 'No email provided'}</strong></p>
                                <p class="text-xs text-green-600 mt-1">📧 Patient will receive this confirmation email immediately</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-100">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">📧 Email Preview:</h4>
                    </div>
                    
                    <div class="overflow-y-auto max-h-96 bg-white">
                        <iframe srcdoc="${emailContent.replace(/"/g, '&quot;')}" 
                                style="width: 100%; height: 500px; border: none;" 
                                title="Email Preview">
                        </iframe>
                    </div>
                    
                    <div class="flex justify-between items-center p-6 bg-gray-50 border-t">
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-info-circle mr-1"></i>
                            This email has been automatically sent to the patient
                        </div>
                        <div class="flex gap-3">
                            <button class="resend-email px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                <i class="fas fa-paper-plane mr-1"></i>Resend Email
                            </button>
                            <button class="close-email-preview px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(previewModal);
            
            const closeBtns = previewModal.querySelectorAll('.close-email-preview');
            const resendBtn = previewModal.querySelector('.resend-email');
            
            closeBtns.forEach(btn => {
                btn.onclick = () => previewModal.remove();
            });
            
            if (resendBtn) {
                resendBtn.onclick = () => {
                    showNotification('📧 Email resent successfully!', 'success');
                    previewModal.remove();
                };
            }
        }

        function sendBulkAppointmentEmails(appointments) {
            let emailsSent = 0;
            
            appointments.forEach(appointment => {
                const patient = appData.patients.find(p => p.id === appointment.patientId);
                if (patient && patient.email) {
                    sendAppointmentConfirmationEmail(patient, appointment);
                    emailsSent++;
                }
            });
            
            if (emailsSent > 0) {
                showNotification(`📧 ${emailsSent} confirmation email${emailsSent > 1 ? 's' : ''} sent to patients!`, 'success');
            }
        }

        // Settings functions
        function saveAllSettings() {
            showNotification('💾 All settings saved successfully!', 'success');
        }

        function changeAdminPassword() {
            showNotification('🔐 Change password functionality coming soon!', 'success');
        }

        function testSupabaseConnection() {
            showNotification('🔄 Testing Supabase connection...', 'success');
        }

        function disconnectSupabase() {
            showNotification('🔌 Disconnected from Supabase', 'success');
        }

        // Export functions
        function exportPatients() {
            showNotification('📤 Exporting patient data...', 'success');
        }

        function exportUsers() {
            showNotification('📤 Exporting user data...', 'success');
        }

        function exportAppointments() {
            showNotification('📤 Exporting appointment data...', 'success');
        }

        function exportExerciseLibrary() {
            showNotification('📤 Exporting exercise library...', 'success');
        }

        function printSchedule() {
            showNotification('🖨️ Printing schedule...', 'success');
        }

        function showCalendarView() {
            showNotification('📅 Calendar view coming soon!', 'success');
        }

        // Clear filters function
        function clearPatientFilters() {
            const searchInput = document.getElementById('patientSearchInput');
            const statusFilter = document.getElementById('patientStatusFilter');
            const physioFilter = document.getElementById('patientPhysioFilter');
            
            if (searchInput) searchInput.value = '';
            if (statusFilter) statusFilter.value = '';
            if (physioFilter) physioFilter.value = '';
            
            showNotification('🧹 Filters cleared', 'success');
        }

        // Chart initialization (simplified version to avoid errors)
        let chartInstances = {};

        function initializeAllCharts() {
            // Initialize basic charts if Chart.js is available
            if (typeof Chart !== 'undefined') {
                setTimeout(() => {
                    try {
                        initializeDashboardCharts();
                        initializePatientCharts();
                        initializeAppointmentCharts();
                        initializePhysiotherapistCharts();
                        initializeExerciseCharts();
                        initializeFinancialCharts();
                        console.log('📊 All charts initialized successfully');
                    } catch (error) {
                        console.log('Chart initialization error:', error.message);
                    }
                }, 500);
            }
        }

        function initializeDashboardCharts() {
            // Patient Registration Trends Chart
            const patientCtx = document.getElementById('patientRegistrationChart');
            if (patientCtx) {
                try {
                    chartInstances.patientChart = new Chart(patientCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'New Patients',
                                data: [8, 12, 15, 10, 18, 22],
                                borderColor: '#0F766E',
                                backgroundColor: 'rgba(15, 118, 110, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Patient chart error:', error.message);
                }
            }

            // Treatment Types Distribution Chart
            const treatmentCtx = document.getElementById('treatmentTypesChart');
            if (treatmentCtx) {
                try {
                    chartInstances.treatmentChart = new Chart(treatmentCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Back Pain', 'Knee Injury', 'Shoulder Issues', 'Sports Rehab', 'Other'],
                            datasets: [{
                                data: [35, 25, 20, 15, 5],
                                backgroundColor: ['#3B82F6', '#10B981', '#8B5CF6', '#F59E0B', '#6B7280']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Treatment chart error:', error.message);
                }
            }

            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                try {
                    chartInstances.revenueChart = new Chart(revenueCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: 'Revenue (BD)',
                                data: [3200, 3800, 4100, 3700, 4500, 4900],
                                backgroundColor: 'rgba(34, 197, 94, 0.8)',
                                borderColor: '#22C55E'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Revenue chart error:', error.message);
                }
            }

            // Appointment Volume Chart
            const appointmentCtx = document.getElementById('appointmentVolumeChart');
            if (appointmentCtx) {
                try {
                    chartInstances.appointmentChart = new Chart(appointmentCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Appointments',
                                data: [25, 30, 28, 32, 27, 20, 8],
                                backgroundColor: 'rgba(59, 130, 246, 0.8)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Appointment chart error:', error.message);
                }
            }
        }

        function initializePatientCharts() {
            // Patient Age Distribution
            const ageCtx = document.getElementById('patientAgeChart');
            if (ageCtx) {
                try {
                    chartInstances.patientAgeChart = new Chart(ageCtx, {
                        type: 'bar',
                        data: {
                            labels: ['18-25', '26-35', '36-45', '46-55', '56-65', '65+'],
                            datasets: [{
                                label: 'Patients',
                                data: [8, 15, 22, 18, 12, 7],
                                backgroundColor: 'rgba(99, 102, 241, 0.8)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Patient age chart error:', error.message);
                }
            }

            // Gender Distribution
            const genderCtx = document.getElementById('patientGenderChart');
            if (genderCtx) {
                try {
                    chartInstances.patientGenderChart = new Chart(genderCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Female', 'Male'],
                            datasets: [{
                                data: [58, 42],
                                backgroundColor: ['#EC4899', '#3B82F6']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Gender chart error:', error.message);
                }
            }

            // Treatment Status
            const statusCtx = document.getElementById('treatmentStatusChart');
            if (statusCtx) {
                try {
                    chartInstances.treatmentStatusChart = new Chart(statusCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Active', 'Completed', 'On Hold', 'Cancelled'],
                            datasets: [{
                                data: [45, 38, 12, 5],
                                backgroundColor: ['#10B981', '#3B82F6', '#F59E0B', '#EF4444']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Treatment status chart error:', error.message);
                }
            }
        }

        function initializeAppointmentCharts() {
            // Appointment Status Chart
            const apptStatusCtx = document.getElementById('appointmentStatusChart');
            if (apptStatusCtx) {
                try {
                    chartInstances.appointmentStatusChart = new Chart(apptStatusCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Scheduled', 'Confirmed', 'Completed', 'Cancelled'],
                            datasets: [{
                                label: 'Appointments',
                                data: [35, 42, 78, 8],
                                backgroundColor: ['#3B82F6', '#22C55E', '#8B5CF6', '#EF4444']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Appointment status chart error:', error.message);
                }
            }

            // Daily Appointment Chart
            const dailyVolumeCtx = document.getElementById('dailyAppointmentChart');
            if (dailyVolumeCtx) {
                try {
                    chartInstances.dailyAppointmentChart = new Chart(dailyVolumeCtx, {
                        type: 'line',
                        data: {
                            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                            datasets: [{
                                label: 'Daily Appointments',
                                data: [12, 15, 18, 22],
                                borderColor: '#8B5CF6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Daily appointment chart error:', error.message);
                }
            }

            // Peak Hours Chart
            const peakHoursCtx = document.getElementById('peakHoursChart');
            if (peakHoursCtx) {
                try {
                    chartInstances.peakHoursChart = new Chart(peakHoursCtx, {
                        type: 'bar',
                        data: {
                            labels: ['8AM', '10AM', '12PM', '2PM', '4PM'],
                            datasets: [{
                                label: 'Appointments',
                                data: [5, 12, 8, 20, 14],
                                backgroundColor: 'rgba(245, 158, 11, 0.8)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Peak hours chart error:', error.message);
                }
            }
        }

        function initializePhysiotherapistCharts() {
            // Workload Chart
            const workloadCtx = document.getElementById('workloadChart');
            if (workloadCtx) {
                try {
                    chartInstances.workloadChart = new Chart(workloadCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Dr. Mariam Ali', 'Dr. Ahmad', 'Dr. Sara'],
                            datasets: [{
                                label: 'Active Patients',
                                data: [25, 18, 22],
                                backgroundColor: 'rgba(16, 185, 129, 0.8)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Workload chart error:', error.message);
                }
            }

            // Specialization Chart
            const specializationCtx = document.getElementById('specializationChart');
            if (specializationCtx) {
                try {
                    chartInstances.specializationChart = new Chart(specializationCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Orthopedic', 'Sports Medicine', 'Neurological'],
                            datasets: [{
                                data: [35, 25, 20],
                                backgroundColor: ['#3B82F6', '#22C55E', '#8B5CF6']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Specialization chart error:', error.message);
                }
            }
        }

        function initializeExerciseCharts() {
            // Exercise Categories
            const categoriesCtx = document.getElementById('exerciseCategoriesChart');
            if (categoriesCtx) {
                try {
                    chartInstances.exerciseCategoriesChart = new Chart(categoriesCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Strength', 'Flexibility', 'Balance', 'Rehab'],
                            datasets: [{
                                data: [28, 22, 18, 35],
                                backgroundColor: ['#3B82F6', '#10B981', '#8B5CF6', '#F59E0B']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Exercise categories chart error:', error.message);
                }
            }

            // Exercise Difficulty
            const difficultyCtx = document.getElementById('exerciseDifficultyChart');
            if (difficultyCtx) {
                try {
                    chartInstances.exerciseDifficultyChart = new Chart(difficultyCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Beginner', 'Intermediate', 'Advanced'],
                            datasets: [{
                                label: 'Exercises',
                                data: [45, 35, 25],
                                backgroundColor: ['#22C55E', '#3B82F6', '#F59E0B']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Exercise difficulty chart error:', error.message);
                }
            }

            // Exercise Usage
            const usageCtx = document.getElementById('exerciseUsageChart');
            if (usageCtx) {
                try {
                    chartInstances.exerciseUsageChart = new Chart(usageCtx, {
                        type: 'line',
                        data: {
                            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                            datasets: [{
                                label: 'Usage',
                                data: [125, 138, 155, 168],
                                borderColor: '#8B5CF6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Exercise usage chart error:', error.message);
                }
            }
        }

        function initializeFinancialCharts() {
            // Payment Method Chart
            const paymentCtx = document.getElementById('paymentMethodChart');
            if (paymentCtx) {
                try {
                    chartInstances.paymentMethodChart = new Chart(paymentCtx, {
                        type: 'pie',
                        data: {
                            labels: ['Insurance', 'Cash', 'Card', 'Transfer'],
                            datasets: [{
                                data: [45, 25, 20, 10],
                                backgroundColor: ['#3B82F6', '#22C55E', '#8B5CF6', '#F59E0B']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Payment method chart error:', error.message);
                }
            }

            // Monthly Revenue Comparison
            const monthlyCompareCtx = document.getElementById('monthlyRevenueCompareChart');
            if (monthlyCompareCtx) {
                try {
                    chartInstances.monthlyRevenueCompareChart = new Chart(monthlyCompareCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                            datasets: [{
                                label: '2024',
                                data: [3200, 3800, 4100, 3700, 4500, 4900],
                                borderColor: '#22C55E',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Monthly revenue chart error:', error.message);
                }
            }

            // Success Rate Chart
            const successRateCtx = document.getElementById('successRateChart');
            if (successRateCtx) {
                try {
                    chartInstances.successRateChart = new Chart(successRateCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Back Pain', 'Knee Issues', 'Shoulder'],
                            datasets: [{
                                label: 'Success Rate (%)',
                                data: [92, 88, 85],
                                backgroundColor: ['#22C55E', '#3B82F6', '#8B5CF6']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Success rate chart error:', error.message);
                }
            }

            // Treatment Duration Chart
            const durationCtx = document.getElementById('treatmentDurationChart');
            if (durationCtx) {
                try {
                    chartInstances.treatmentDurationChart = new Chart(durationCtx, {
                        type: 'scatter',
                        data: {
                            datasets: [{
                                label: 'Duration vs Success',
                                data: [{x: 2, y: 75}, {x: 4, y: 82}, {x: 6, y: 88}, {x: 8, y: 92}],
                                backgroundColor: 'rgba(59, 130, 246, 0.6)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false
                        }
                    });
                } catch (error) {
                    console.log('Treatment duration chart error:', error.message);
                }
            }
        }

        // Update chart colors when theme changes
        function updateChartsForTheme() {
            // Chart theme update logic would go here
            console.log('Chart theme updated');
        }

        // Dashboard time update
        function updateCurrentDateTime() {
            const now = new Date();
            const dateTimeEl = document.getElementById('currentDateTime');
            if (dateTimeEl) {
                dateTimeEl.textContent = now.toLocaleString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function refreshDashboard() {
            updateDashboardStats();
            updateCurrentDateTime();
            showNotification('✅ Dashboard refreshed!', 'success');
        }

        function generateReport() {
            showNotification('📊 Generating report...', 'success');
        }

        // Exercise management functions
        function updateExerciseStatistics() {
            const exercises = appData.exercises || [];
            
            // Update total exercises count
            const totalExercisesElements = document.querySelectorAll('.total-exercises-count');
            totalExercisesElements.forEach(el => {
                if (el) el.textContent = exercises.length;
            });
            
            // Update category counts
            const strengthCount = exercises.filter(ex => ex.category === 'strength').length;
            const flexibilityCount = exercises.filter(ex => ex.category === 'flexibility').length;
            const balanceCount = exercises.filter(ex => ex.category === 'balance').length;
            const rehabCount = exercises.filter(ex => ex.category === 'rehabilitation').length;
            
            // Update category displays
            const strengthElements = document.querySelectorAll('.strength-exercises-count');
            const flexibilityElements = document.querySelectorAll('.flexibility-exercises-count');
            const balanceElements = document.querySelectorAll('.balance-exercises-count');
            const rehabElements = document.querySelectorAll('.rehab-exercises-count');
            
            strengthElements.forEach(el => { if (el) el.textContent = strengthCount; });
            flexibilityElements.forEach(el => { if (el) el.textContent = flexibilityCount; });
            balanceElements.forEach(el => { if (el) el.textContent = balanceCount; });
            rehabElements.forEach(el => { if (el) el.textContent = rehabCount; });
            
            console.log(`📊 Exercise stats updated: ${exercises.length} total exercises`);
        }

        function displaySharedExerciseLibrary() {
            const exercises = appData.exercises || [];
            const physioExerciseGrid = document.getElementById('physioExerciseGrid');
            
            if (!physioExerciseGrid) return;
            
            if (exercises.length === 0) {
                physioExerciseGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-dumbbell text-gray-300 dark:text-gray-600 text-6xl mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">No Exercises Available</h3>
                        <p class="text-gray-500 dark:text-gray-500 mb-6">Start building your exercise library by adding exercises.</p>
                        <button onclick="physioAddExercise()" class="bg-secondary text-white px-6 py-3 rounded-lg hover:bg-sage transition-colors font-semibold">
                            <i class="fas fa-plus mr-2"></i>Add First Exercise
                        </button>
                    </div>
                `;
                return;
            }
            
            physioExerciseGrid.innerHTML = exercises.map(exercise => {
                const categoryColors = {
                    strength: { bg: 'bg-blue-600', badge: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300' },
                    flexibility: { bg: 'bg-green-600', badge: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' },
                    balance: { bg: 'bg-purple-600', badge: 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300' },
                    rehabilitation: { bg: 'bg-orange-600', badge: 'bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300' },
                    cardio: { bg: 'bg-red-600', badge: 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300' }
                };
                
                const colors = categoryColors[exercise.category] || categoryColors.strength;
                const difficultyColor = {
                    beginner: 'text-green-600',
                    intermediate: 'text-yellow-600', 
                    advanced: 'text-red-600'
                }[exercise.difficulty] || 'text-gray-600';
                
                return `
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center">
                            <div class="w-12 h-12 ${colors.bg} rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-dumbbell text-white"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900 dark:text-white">${exercise.name}</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    ${exercise.targetAreas ? exercise.targetAreas.join(', ') : exercise.category} • 
                                    <span class="${difficultyColor} font-medium">${exercise.difficulty.charAt(0).toUpperCase() + exercise.difficulty.slice(1)}</span>
                                </p>
                            </div>
                        </div>
                        <div class="flex flex-col items-end gap-2">
                            <span class="px-2 py-1 ${colors.badge} rounded-full text-xs font-medium">${exercise.category.charAt(0).toUpperCase() + exercise.category.slice(1)}</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400" title="Created by ${exercise.createdBy}">
                                <i class="fas fa-user mr-1"></i>${exercise.createdBy.includes('Dr.') ? exercise.createdBy.split(' ').slice(1, 2)[0] : 'Admin'}
                            </span>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3 line-clamp-2">${exercise.description}</p>
                    
                    <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-3">
                        <span>${exercise.reps || 'As prescribed'} • ${exercise.sets || 3} sets</span>
                        <span>${exercise.duration || '10-15 min'}</span>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="physioViewExercise('${exercise.id}')" class="flex-1 bg-secondary text-white px-3 py-2 rounded-lg hover:bg-sage transition-colors text-sm">
                            <i class="fas fa-eye mr-1"></i>View
                        </button>
                        <button onclick="physioAssignExercise('${exercise.id}')" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                            <i class="fas fa-plus mr-1"></i>Assign
                        </button>
                        ${exercise.createdBy === 'Dr. Mariam Abdulatheem Ali' ? `
                            <button onclick="editSharedExercise('${exercise.id}')" class="bg-yellow-600 text-white px-3 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm" title="Edit your exercise">
                                <i class="fas fa-edit mr-1"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
                `;
            }).join('');
        }

        function viewNewExercises() {
            showNotification('👁️ Viewing new exercises...', 'success');
        }

        function hideNewExercisesAlert() {
            const alertDiv = document.getElementById('newExercisesAlert');
            if (alertDiv) {
                alertDiv.classList.add('hidden');
            }
        }

        function addExerciseToSharedLibrary(exerciseData, createdBy) {
            const newExercise = {
                id: `ex-${Date.now()}`,
                name: exerciseData.name,
                category: exerciseData.category,
                difficulty: exerciseData.difficulty,
                description: exerciseData.description,
                targetAreas: exerciseData.targetAreas || [],
                equipment: exerciseData.equipment || '',
                duration: exerciseData.duration || '10-15 minutes',
                sets: exerciseData.sets || 3,
                reps: exerciseData.reps || 'As prescribed',
                createdBy: createdBy,
                createdDate: new Date().toISOString(),
                version: '1.0'
            };
            
            appData.exercises.push(newExercise);
            updateExerciseStatistics();
            displaySharedExerciseLibrary();
            
            // Show new exercise alert
            showNewExerciseAlert(newExercise);
            
            return newExercise;
        }

        function showNewExerciseAlert(exercise) {
            const alertDiv = document.getElementById('newExercisesAlert');
            const alertText = document.getElementById('newExercisesText');
            
            if (alertDiv && alertText) {
                alertText.textContent = `New exercise "${exercise.name}" added by ${exercise.createdBy}`;
                alertDiv.classList.remove('hidden');
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    alertDiv.classList.add('hidden');
                }, 10000);
            }
        }

        function editSharedExercise(exerciseId) {
            const exercise = appData.exercises.find(ex => ex.id === exerciseId);
            if (exercise) {
                showNotification(`✏️ Editing exercise: ${exercise.name}`, 'success');
            }
        }

        // Physiotherapist Exercise Functions
        function physioAddExercise() {
            const content = `
                <form id="physioAddExerciseForm" class="space-y-8">
                    <!-- Basic Exercise Information -->
                    <div id="basicInfoSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-info-circle text-teal-400 mr-2"></i>Basic Exercise Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Name *</label>
                                <input type="text" id="physioExerciseName" name="exerciseName" required placeholder="e.g., Shoulder Hamstring Stretch" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Code</label>
                                <input type="text" id="physioExerciseCode" name="exerciseCode" placeholder="e.g., SH-L-001" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Category *</label>
                                <select id="physioExerciseCategory" name="exerciseCategory" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Category...</option>
                                    <option value="flexibility">Flexibility</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="balance">Balance</option>
                                    <option value="rehabilitation">Rehabilitation</option>
                                    <option value="cardio">Cardiovascular</option>
                                    <option value="coordination">Coordination</option>
                                    <option value="proprioception">Proprioception</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Difficulty Level *</label>
                                <select id="physioExerciseDifficulty" name="exerciseDifficulty" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Difficulty...</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Equipment Required</label>
                                <select id="physioEquipmentRequired" name="equipmentRequired" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">No Equipment</option>
                                    <option value="mat">Exercise Mat</option>
                                    <option value="resistance-band">Resistance Band</option>
                                    <option value="dumbbells">Dumbbells</option>
                                    <option value="stability-ball">Stability Ball</option>
                                    <option value="foam-roller">Foam Roller</option>
                                    <option value="theraband">Theraband</option>
                                    <option value="chair">Chair</option>
                                    <option value="wall">Wall</option>
                                    <option value="pillow">Pillow/Cushion</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Description *</label>
                            <textarea id="physioExerciseDescription" name="exerciseDescription" rows="4" required placeholder="Detailed description of the exercise, its purpose, and general technique..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Target Body Areas & Muscles -->
                    <div id="targetAreasSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-crosshairs text-teal-400 mr-2"></i>Target Body Areas & Muscles
                        </h4>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-3">Primary Target Areas *</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 bg-gray-700 rounded-lg p-4">
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="neck-cervical" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Neck & Cervical</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="shoulders" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Shoulders</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="upper-back" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Upper Back</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="lower-back" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Lower Back</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="arms-biceps" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Arms & Biceps</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="forearms-wrists" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Forearms & Wrists</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="core-abs" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Core & Abs</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="chest" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Chest</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="hips-pelvis" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Hips & Pelvis</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="full-body" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Full Body</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="legs" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Legs</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioTargetAreas" value="balance" class="text-teal-500 focus:ring-teal-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Balance</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Movement Pattern</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select movement pattern...</option>
                                    <option value="flexion">Flexion</option>
                                    <option value="extension">Extension</option>
                                    <option value="rotation">Rotation</option>
                                    <option value="lateral-flexion">Lateral Flexion</option>
                                    <option value="abduction">Abduction</option>
                                    <option value="adduction">Adduction</option>
                                    <option value="stretching">Stretching</option>
                                    <option value="strengthening">Strengthening</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Type</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select exercise type...</option>
                                    <option value="static-stretch">Static Stretch</option>
                                    <option value="dynamic-stretch">Dynamic Stretch</option>
                                    <option value="isometric">Isometric</option>
                                    <option value="isotonic">Isotonic</option>
                                    <option value="functional">Functional</option>
                                    <option value="balance-training">Balance Training</option>
                                    <option value="mobilization">Mobilization</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Step-by-Step Instructions -->
                    <div id="instructionsSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-list-ol text-teal-400 mr-2"></i>Step-by-Step Instructions
                        </h4>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Starting Position</label>
                            <textarea rows="3" placeholder="Describe the proper starting position and setup..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Steps</label>
                            <textarea rows="6" placeholder="Step-by-step instructions for performing the exercise:
1. Starting position...
2. Movement execution...
3. Return to starting position...
4. Repeat as prescribed..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Breathing Instructions</label>
                            <textarea rows="3" placeholder="Breathing pattern and timing during the exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Exercise Parameters & Guidelines -->
                    <div id="parametersSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-sliders-h text-teal-400 mr-2"></i>Exercise Parameters & Guidelines
                        </h4>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Recommended Sets</label>
                                <input type="number" min="1" max="10" placeholder="3" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Recommended Reps</label>
                                <input type="text" placeholder="8-12" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Hold Duration</label>
                                <input type="text" placeholder="30 sec" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Rest Between Sets</label>
                                <input type="text" placeholder="60 sec" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Frequency (Per Week)</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select frequency...</option>
                                    <option value="daily">Daily (7x/week)</option>
                                    <option value="6x">6x per week</option>
                                    <option value="5x">5x per week</option>
                                    <option value="4x">4x per week</option>
                                    <option value="3x">3x per week</option>
                                    <option value="2x">2x per week</option>
                                    <option value="1x">1x per week</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Intensity Level</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select intensity...</option>
                                    <option value="low">Low Intensity</option>
                                    <option value="moderate">Moderate Intensity</option>
                                    <option value="high">High Intensity</option>
                                    <option value="variable">Variable</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Expected Duration</label>
                                <input type="text" placeholder="15 minutes" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Safety & Precautions -->
                    <div id="safetySection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>Safety & Precautions
                        </h4>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-300 mb-3">Contraindications & Warnings</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 bg-gray-700 rounded-lg p-4">
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioContraindications" value="acute-injury" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Acute injury/inflammation</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioContraindications" value="severe-pain" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Severe pain</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioContraindications" value="recent-surgery" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Recent surgery</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioContraindications" value="fracture-instability" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Fracture/instability</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioContraindications" value="cardiovascular-concerns" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Cardiovascular concerns</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" name="physioContraindications" value="balance-impairment" class="text-red-500 focus:ring-red-500 rounded">
                                    <span class="ml-2 text-sm text-gray-300">Balance impairment</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Safety Guidelines</label>
                                <textarea rows="4" placeholder="Important safety guidelines and precautions for this exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Warning Signs to Watch</label>
                                <textarea rows="4" placeholder="Signs and symptoms that indicate the patient should stop the exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Progression & Modifications -->
                    <div id="progressionSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-chart-line text-teal-400 mr-2"></i>Progression & Modifications
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Easier Progression/Regression</label>
                                <textarea rows="4" placeholder="How to make this exercise easier for beginners or those with limitations..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Advanced Progression</label>
                                <textarea rows="4" placeholder="How to make this exercise more challenging for advanced patients..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Alternative Exercises</label>
                            <textarea rows="3" placeholder="List alternative exercises that target similar muscle groups or movement patterns..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Media & Documentation -->
                    <div id="mediaSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-photo-video text-teal-400 mr-2"></i>Media & Documentation
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-gray-700 rounded-lg p-4 text-center">
                                <i class="fas fa-camera text-blue-400 text-3xl mb-3"></i>
                                <h5 class="font-semibold text-gray-300 mb-1">Demonstration Images</h5>
                                <p class="text-xs text-gray-400 mb-3">Before/during/after poses</p>
                                <button type="button" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-colors">
                                    Upload Images
                                </button>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4 text-center">
                                <i class="fas fa-video text-green-400 text-3xl mb-3"></i>
                                <h5 class="font-semibold text-gray-300 mb-1">Video Instruction</h5>
                                <p class="text-xs text-gray-400 mb-3">Step-by-step demonstration</p>
                                <button type="button" class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 transition-colors">
                                    Upload Video
                                </button>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4 text-center">
                                <i class="fas fa-file-alt text-purple-400 text-3xl mb-3"></i>
                                <h5 class="font-semibold text-gray-300 mb-1">Supporting Documents</h5>
                                <p class="text-xs text-gray-400 mb-3">Research, handouts, forms</p>
                                <button type="button" class="bg-purple-600 text-white px-4 py-2 rounded text-sm hover:bg-purple-700 transition-colors">
                                    Upload Documents
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Clinical Application & Evidence -->
                    <div id="clinicalSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-stethoscope text-teal-400 mr-2"></i>Clinical Application & Evidence
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Clinical Indications</label>
                                <textarea rows="4" placeholder="Conditions and situations where this exercise is most beneficial..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Evidence Base</label>
                                <textarea rows="4" placeholder="Research evidence supporting the effectiveness of this exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Tips & Expert Recommendations -->
                    <div id="tipsSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-lightbulb text-teal-400 mr-2"></i>Tips & Expert Recommendations
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Teaching Tips</label>
                                <textarea rows="4" placeholder="Tips for effectively teaching and cuing this exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Common Mistakes</label>
                                <textarea rows="4" placeholder="Common errors patients make and how to correct them..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Details & Publishing -->
                    <div id="publishingSection" class="exercise-section">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-cog text-teal-400 mr-2"></i>Details & Publishing
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Created By</label>
                                <input type="text" value="Dr. Mariam Abdulatheem Ali" readonly class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Creation Date</label>
                                <input type="text" value="${new Date().toLocaleDateString()}" readonly class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Version</label>
                                <input type="text" value="1.0" readonly class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 text-base">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Internal Notes for Staff</label>
                            <textarea rows="3" placeholder="Private notes for clinic staff about this exercise (not visible to patients)..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div class="mt-4">
                            <label class="flex items-center">
                                <input type="checkbox" name="physioPublishToLibrary" checked class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Publish to Exercise Library</span>
                            </label>
                            <label class="flex items-center mt-2">
                                <input type="checkbox" name="physioShareWithStaff" class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Share with clinic staff</span>
                            </label>
                            <label class="flex items-center mt-2">
                                <input type="checkbox" name="physioPatientHandout" class="text-teal-500 focus:ring-teal-500 rounded">
                                <span class="ml-2 text-sm text-gray-300">Generate patient handout version</span>
                            </label>
                        </div>
                    </div>
                </form>
                
                <style>
                    .exercise-section {
                        border: 1px solid #374151;
                        border-radius: 8px;
                        padding: 20px;
                        background: rgba(55, 65, 81, 0.3);
                    }
                    
                    .exercise-section h4 {
                        margin-bottom: 16px;
                        padding-bottom: 8px;
                        border-bottom: 1px solid #4B5563;
                    }
                </style>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-dumbbell text-teal-400 mr-2"></i>Add New Exercise - Dr. Mariam
                        </h3>
                        <button class="close-physio-exercise-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-physio-exercise-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-physio-exercise px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-plus mr-2"></i>Add Exercise to Library
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-physio-exercise-modal');
            const cancelBtn = modal.querySelector('.cancel-physio-exercise-modal');
            const saveBtn = modal.querySelector('.save-physio-exercise');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            
            saveBtn.onclick = () => {
                const form = document.getElementById('physioAddExerciseForm');
                const formData = new FormData(form);
                
                const exerciseName = formData.get('exerciseName')?.trim();
                const category = formData.get('exerciseCategory');
                const difficulty = formData.get('exerciseDifficulty');
                const description = formData.get('exerciseDescription')?.trim();
                
                if (!exerciseName || !category || !difficulty || !description) {
                    showNotification('⚠️ Please fill in all required fields', 'error');
                    return;
                }
                
                // Get selected target areas
                const targetAreas = Array.from(form.querySelectorAll('input[name="physioTargetAreas"]:checked'))
                    .map(cb => cb.value);
                
                // Get selected contraindications
                const contraindications = Array.from(form.querySelectorAll('input[name="physioContraindications"]:checked'))
                    .map(cb => cb.value);
                
                // Create exercise data object
                const exerciseData = {
                    name: exerciseName,
                    category: category,
                    difficulty: difficulty,
                    description: description,
                    targetAreas: targetAreas,
                    equipment: formData.get('equipmentRequired') || '',
                    duration: formData.get('expectedDuration') || '15 minutes',
                    sets: parseInt(formData.get('recommendedSets')) || 3,
                    reps: formData.get('recommendedReps') || 'As prescribed'
                };
                
                // Add to shared library
                const newExercise = addExerciseToSharedLibrary(exerciseData, 'Dr. Mariam Abdulatheem Ali');
                
                showNotification(`✅ Exercise "${exerciseName}" added to shared library! Now available to all staff members.`, 'success');
                closeModal();
            };
        }

        function physioExportExercises() {
            showNotification('📤 Exporting Dr. Mariam\'s exercise library...', 'success');
        }

        function filterPhysioExercises(category) {
            showNotification(`🔍 Filtering exercises by ${category}...`, 'success');
        }

        function physioViewExercise(exerciseId) {
            const exercise = appData.exercises.find(ex => ex.id === exerciseId);
            if (!exercise) {
                showNotification('❌ Exercise not found', 'error');
                return;
            }

            const categoryColors = {
                strength: 'from-blue-500 to-blue-600',
                flexibility: 'from-green-500 to-green-600',
                balance: 'from-purple-500 to-purple-600',
                rehabilitation: 'from-orange-500 to-orange-600',
                cardio: 'from-red-500 to-red-600'
            };
            
            const headerGradient = categoryColors[exercise.category] || categoryColors.strength;

            const content = `
                <div class="space-y-6">
                    <!-- Exercise Header -->
                    <div class="bg-gradient-to-r ${headerGradient} rounded-lg p-6 text-white">
                        <div class="flex items-center mb-4">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-xl flex items-center justify-center text-white mr-4">
                                <i class="fas fa-dumbbell text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">${exercise.name}</h3>
                                <p class="text-white text-opacity-90">
                                    ${exercise.category.charAt(0).toUpperCase() + exercise.category.slice(1)} • 
                                    ${exercise.difficulty.charAt(0).toUpperCase() + exercise.difficulty.slice(1)} Level
                                </p>
                                <p class="text-sm text-white text-opacity-75 mt-1">
                                    Created by ${exercise.createdBy} on ${new Date(exercise.createdDate).toLocaleDateString()}
                                </p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div>
                                <span class="text-white text-opacity-70">Duration:</span>
                                <span class="font-medium ml-2">${exercise.duration}</span>
                            </div>
                            <div>
                                <span class="text-white text-opacity-70">Sets:</span>
                                <span class="font-medium ml-2">${exercise.sets} sets</span>
                            </div>
                            <div>
                                <span class="text-white text-opacity-70">Reps:</span>
                                <span class="font-medium ml-2">${exercise.reps}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Description -->
                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800">
                        <h4 class="text-lg font-semibold text-blue-900 dark:text-blue-100 mb-3 flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-2"></i>Exercise Description
                        </h4>
                        <p class="text-blue-800 dark:text-blue-300">${exercise.description}</p>
                    </div>

                    <!-- Target Areas -->
                    ${exercise.targetAreas && exercise.targetAreas.length > 0 ? `
                        <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-6 border border-green-200 dark:border-green-800">
                            <h4 class="text-lg font-semibold text-green-900 dark:text-green-100 mb-3 flex items-center">
                                <i class="fas fa-crosshairs text-green-600 mr-2"></i>Target Areas
                            </h4>
                            <div class="flex flex-wrap gap-2">
                                ${exercise.targetAreas.map(area => `
                                    <span class="px-3 py-1 bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 rounded-full text-sm font-medium">
                                        ${area.replace(/[-_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Equipment & Parameters -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${exercise.equipment ? `
                            <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800">
                                <h5 class="font-semibold text-purple-900 dark:text-purple-100 mb-2 flex items-center">
                                    <i class="fas fa-tools text-purple-600 mr-2"></i>Equipment Required
                                </h5>
                                <p class="text-purple-800 dark:text-purple-300 capitalize">
                                    ${exercise.equipment.replace(/[-_]/g, ' ')}
                                </p>
                            </div>
                        ` : `
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-2 flex items-center">
                                    <i class="fas fa-hand-paper text-gray-500 mr-2"></i>Equipment Required
                                </h5>
                                <p class="text-gray-600 dark:text-gray-400">No equipment needed</p>
                            </div>
                        `}
                        
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 border border-yellow-200 dark:border-yellow-800">
                            <h5 class="font-semibold text-yellow-900 dark:text-yellow-100 mb-2 flex items-center">
                                <i class="fas fa-clipboard-list text-yellow-600 mr-2"></i>Exercise Parameters
                            </h5>
                            <div class="space-y-1 text-sm text-yellow-800 dark:text-yellow-300">
                                <div class="flex justify-between">
                                    <span>Sets:</span>
                                    <span class="font-medium">${exercise.sets}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Repetitions:</span>
                                    <span class="font-medium">${exercise.reps}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Duration:</span>
                                    <span class="font-medium">${exercise.duration}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Instructions -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 border border-gray-200 dark:border-gray-600">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                            <i class="fas fa-list-ol text-gray-600 mr-2"></i>How to Perform This Exercise
                        </h4>
                        <div class="space-y-3 text-sm text-gray-700 dark:text-gray-300">
                            <div class="flex items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-secondary text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">1</span>
                                <p><strong>Starting Position:</strong> Begin in the proper starting position as prescribed by your physiotherapist.</p>
                            </div>
                            <div class="flex items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-secondary text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">2</span>
                                <p><strong>Movement:</strong> Follow the movement pattern slowly and controlled, focusing on proper form.</p>
                            </div>
                            <div class="flex items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-secondary text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">3</span>
                                <p><strong>Breathing:</strong> Maintain steady breathing throughout the exercise.</p>
                            </div>
                            <div class="flex items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-secondary text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">4</span>
                                <p><strong>Completion:</strong> Complete ${exercise.sets} sets of ${exercise.reps} as prescribed.</p>
                            </div>
                            <div class="flex items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">!</span>
                                <p><strong>Important:</strong> Stop immediately if you experience pain and consult your physiotherapist.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Patient Instructions -->
                    <div class="bg-teal-50 dark:bg-teal-900/20 rounded-lg p-6 border border-teal-200 dark:border-teal-800">
                        <h4 class="text-lg font-semibold text-teal-900 dark:text-teal-100 mb-3 flex items-center">
                            <i class="fas fa-user-injured text-teal-600 mr-2"></i>For Patients
                        </h4>
                        <div class="space-y-2 text-sm text-teal-800 dark:text-teal-300">
                            <p><strong>✓ Warm up:</strong> Always warm up with light movement before starting</p>
                            <p><strong>✓ Progress gradually:</strong> Start with lower intensity and build up slowly</p>
                            <p><strong>✓ Listen to your body:</strong> Some discomfort is normal, but pain is not</p>
                            <p><strong>✓ Stay consistent:</strong> Regular practice leads to better results</p>
                            <p><strong>✓ Ask questions:</strong> Contact your physiotherapist if you're unsure about anything</p>
                        </div>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-eye text-teal-400 mr-2"></i>View Exercise - ${exercise.name}
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <button onclick="physioAssignExercise('${exercise.id}'); this.closest('.fixed').remove();" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium">
                            <i class="fas fa-plus mr-2"></i>Assign to Patient
                        </button>
                        <div class="flex gap-3">
                            ${exercise.createdBy === 'Dr. Mariam Abdulatheem Ali' ? `
                                <button onclick="editSharedExercise('${exercise.id}'); this.closest('.fixed').remove();" class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition-colors font-medium">
                                    <i class="fas fa-edit mr-2"></i>Edit Exercise
                                </button>
                            ` : ''}
                            <button class="close-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtns = modal.querySelectorAll('.close-modal');
            closeBtns.forEach(btn => {
                btn.onclick = () => modal.remove();
            });
        }

        function physioAssignExercise(exerciseId) {
            showNotification(`📋 Assigning exercise: ${exerciseId} to patient`, 'success');
        }

        // Set up event listeners
        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentDateTime();
            setInterval(updateCurrentDateTime, 30000);
            
            // Set up refresh dashboard button
            const refreshBtn = document.getElementById('refreshDashboard');
            if (refreshBtn) {
                refreshBtn.onclick = refreshDashboard;
            }

            // Set up clear filters button
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');
            if (clearFiltersBtn) {
                clearFiltersBtn.onclick = clearPatientFilters;
            }
        });

        // Generate Treatment Document Function
        function generateTreatmentDocument(formData) {
            const firstName = formData.get('firstName')?.trim() || '';
            const lastName = formData.get('lastName')?.trim() || '';
            const currentCondition = formData.get('currentCondition')?.trim() || '';
            const assignedPhysiotherapist = formData.get('assignedPhysiotherapist') || '';
            const dateOfBirth = formData.get('dateOfBirth') || '';
            const gender = formData.get('gender') || '';
            const phone = formData.get('phone')?.trim() || '';
            const cprNumber = formData.get('cprNumber')?.trim() || '';
            
            const currentDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Create RTF document with proper Word formatting
            const rtfContent = `{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}{\\f1 Arial;}}
{\\colortbl;\\red0\\green0\\blue0;\\red0\\green0\\blue255;\\red255\\green0\\blue0;}

\\f0\\fs24\\qc\\b\\fs32 BAHRAIN MOBILITY INTERNATIONAL\\par
\\fs28 PHYSIOTHERAPY TREATMENT PLAN\\par\\par
\\b0\\fs24\\ql

{\\b\\fs26\\ul PATIENT INFORMATION}\\par\\par

{\\b Patient Name:} ${firstName} ${lastName}\\par
{\\b CPR Number:} ${cprNumber}\\par
{\\b Date of Birth:} ${dateOfBirth}\\par
{\\b Gender:} ${gender}\\par
{\\b Phone:} ${phone}\\par
{\\b Date of Assessment:} ${currentDate}\\par\\par

{\\b\\fs26\\ul CLINICAL ASSESSMENT}\\par\\par

{\\b Primary Condition:} ${currentCondition}\\par
{\\b Assigned Physiotherapist:} ${assignedPhysiotherapist}\\par\\par

{\\b SUBJECTIVE ASSESSMENT:}\\par
\\u9744? Chief Complaint: ___________________________________________\\par
\\u9744? History of Present Illness: _________________________________\\par
\\u9744? Past Medical History: ______________________________________\\par
\\u9744? Medications: ______________________________________________\\par
\\u9744? Pain Scale (0-10): ________________________________________\\par\\par

{\\b OBJECTIVE ASSESSMENT:}\\par
\\u9744? Range of Motion: __________________________________________\\par
\\u9744? Muscle Strength: __________________________________________\\par
\\u9744? Functional Assessment: ____________________________________\\par
\\u9744? Special Tests: ____________________________________________\\par
\\u9744? Posture Analysis: _________________________________________\\par\\par

{\\b\\fs26\\ul TREATMENT PLAN}\\par\\par

{\\b SHORT-TERM GOALS (2-4 weeks):}\\par
\\u9744? _________________________________________________________\\par
\\u9744? _________________________________________________________\\par
\\u9744? _________________________________________________________\\par\\par

{\\b LONG-TERM GOALS (6-12 weeks):}\\par
\\u9744? _________________________________________________________\\par
\\u9744? _________________________________________________________\\par
\\u9744? _________________________________________________________\\par\\par

{\\b TREATMENT INTERVENTIONS:}\\par
\\u9744? Manual Therapy: ___________________________________________\\par
\\u9744? Exercise Therapy: _________________________________________\\par
\\u9744? Electrotherapy: ___________________________________________\\par
\\u9744? Education/Advice: _________________________________________\\par
\\u9744? Home Exercise Program: ____________________________________\\par\\par

{\\b\\fs26\\ul SESSION TRACKING}\\par\\par

{\\b Session 1 - Date:} ____________\\par
{\\b Treatment:} ________________________________________________\\par
{\\b Progress Notes:} ___________________________________________\\par
{\\b Pain Level:} _______ {\\b Next Session:} ____________________\\par\\par

{\\b Session 2 - Date:} ____________\\par
{\\b Treatment:} ________________________________________________\\par
{\\b Progress Notes:} ___________________________________________\\par
{\\b Pain Level:} _______ {\\b Next Session:} ____________________\\par\\par

{\\b Session 3 - Date:} ____________\\par
{\\b Treatment:} ________________________________________________\\par
{\\b Progress Notes:} ___________________________________________\\par
{\\b Pain Level:} _______ {\\b Next Session:} ____________________\\par\\par

{\\b Session 4 - Date:} ____________\\par
{\\b Treatment:} ________________________________________________\\par
{\\b Progress Notes:} ___________________________________________\\par
{\\b Pain Level:} _______ {\\b Next Session:} ____________________\\par\\par

{\\b Session 5 - Date:} ____________\\par
{\\b Treatment:} ________________________________________________\\par
{\\b Progress Notes:} ___________________________________________\\par
{\\b Pain Level:} _______ {\\b Next Session:} ____________________\\par\\par

{\\b\\fs26\\ul HOME EXERCISE PROGRAM}\\par\\par

{\\b Exercise 1:} _______________________________________________\\par
{\\b Frequency:} _________ {\\b Repetitions:} ____________________\\par
{\\b Instructions:} _____________________________________________\\par\\par

{\\b Exercise 2:} _______________________________________________\\par
{\\b Frequency:} _________ {\\b Repetitions:} ____________________\\par
{\\b Instructions:} _____________________________________________\\par\\par

{\\b Exercise 3:} _______________________________________________\\par
{\\b Frequency:} _________ {\\b Repetitions:} ____________________\\par
{\\b Instructions:} _____________________________________________\\par\\par

{\\b Exercise 4:} _______________________________________________\\par
{\\b Frequency:} _________ {\\b Repetitions:} ____________________\\par
{\\b Instructions:} _____________________________________________\\par\\par

{\\b\\fs26\\ul PATIENT EDUCATION & PRECAUTIONS}\\par\\par

\\u9744? Activity Modifications: ____________________________________\\par
\\u9744? Ergonomic Advice: _________________________________________\\par
\\u9744? Pain Management Strategies: _______________________________\\par
\\u9744? Warning Signs to Report: __________________________________\\par
\\u9744? Return to Sport/Activity Guidelines: ______________________\\par\\par

{\\b\\fs26\\ul DISCHARGE PLANNING}\\par\\par

{\\b Expected Treatment Duration:} _______________________________\\par
{\\b Frequency of Sessions:} ____________________________________\\par
{\\b Reassessment Date:} ________________________________________\\par
{\\b Discharge Criteria:} _______________________________________\\par\\par

{\\b\\fs26\\ul PHYSIOTHERAPIST SIGNATURE & STAMP}\\par\\par

{\\b Physiotherapist:} ${assignedPhysiotherapist}\\par
{\\b License Number:} ___________________________________________\\par
{\\b Signature:} _______________________________________________\\par
{\\b Date:} ${currentDate}\\par
{\\b Stamp:} __________________________________________________\\par\\par

\\qc\\fs18\\i This document serves as the official treatment plan for the above-mentioned patient.\\par
All treatments should be conducted according to professional physiotherapy standards.\\par\\par
\\u169? ${new Date().getFullYear()} Bahrain Mobility International - All Rights Reserved\\par
}`;

            // Create a downloadable RTF file
            const blob = new Blob([rtfContent], { type: 'application/rtf' });
            const url = URL.createObjectURL(blob);
            
            // Create download link
            const link = document.createElement('a');
            link.href = url;
            link.download = `Treatment_Plan_${firstName}_${lastName}_${new Date().toISOString().split('T')[0]}.rtf`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up
            URL.revokeObjectURL(url);
            
            showNotification(`✅ Treatment document generated for ${firstName} ${lastName}! Opens in Microsoft Word.`, 'success');
        }

        // Set up button event listeners
        function setupExerciseButtonListeners() {
            // Admin Exercise buttons
            const uploadWordBtn = document.getElementById('uploadWordDocBtn');
            const addExerciseBtn = document.getElementById('addExerciseBtn');
            const exportExerciseBtn = document.getElementById('exportExerciseBtn');
            
            if (uploadWordBtn) {
                uploadWordBtn.addEventListener('click', function() {
                    console.log('Upload Word Doc button clicked');
                    showBulkUploadModal();
                });
            }
            
            if (addExerciseBtn) {
                addExerciseBtn.addEventListener('click', function() {
                    console.log('Add Exercise button clicked');
                    showAddExerciseModal();
                });
            }
            
            if (exportExerciseBtn) {
                exportExerciseBtn.addEventListener('click', function() {
                    console.log('Export Library button clicked');
                    exportExerciseLibrary();
                });
            }
        }

        // Initialize button listeners when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(setupExerciseButtonListeners, 1000);
        });

        // Also set up listeners when exercise view is shown
        const originalShowView = showView;
        showView = function(viewName) {
            originalShowView(viewName);
            if (viewName === 'exercises') {
                setTimeout(setupExerciseButtonListeners, 100);
            }
        };

        // Supabase Connection Status Functions
        function updateSupabaseConnectionStatus(isConnected, config = null) {
            const connectedDiv = document.getElementById('supabaseConnected');
            const disconnectedDiv = document.getElementById('supabaseDisconnected');
            const detailsDiv = document.getElementById('supabaseDetails');
            const projectUrlSpan = document.getElementById('supabaseProjectUrl');
            
            if (isConnected && config) {
                if (connectedDiv) connectedDiv.classList.remove('hidden');
                if (disconnectedDiv) disconnectedDiv.classList.add('hidden');
                if (detailsDiv) detailsDiv.classList.remove('hidden');
                
                if (projectUrlSpan) {
                    try {
                        const url = new URL(config.url);
                        projectUrlSpan.textContent = `Project: ${url.hostname}`;
                    } catch (error) {
                        projectUrlSpan.textContent = `Project: ${config.url}`;
                    }
                }
                
                const connectionStatus = document.getElementById('connectionStatus');
                const lastConnected = document.getElementById('lastConnected');
                const dataSyncStatus = document.getElementById('dataSyncStatus');
                
                if (connectionStatus) connectionStatus.textContent = 'Active';
                if (lastConnected) lastConnected.textContent = 'Just now';
                if (dataSyncStatus) dataSyncStatus.textContent = config.enableRealTimeSync ? 'Real-time' : 'Manual';
                
            } else {
                if (connectedDiv) connectedDiv.classList.add('hidden');
                if (disconnectedDiv) disconnectedDiv.classList.remove('hidden');
                if (detailsDiv) detailsDiv.classList.add('hidden');
            }
        }

        // Check for existing Supabase configuration on startup
        function checkSupabaseConnection() {
            try {
                const savedConfig = localStorage.getItem('supabaseConfig');
                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    updateSupabaseConnectionStatus(true, config);
                }
            } catch (error) {
                console.log('Failed to load Supabase config:', error.message);
            }
        }

        // Load EmailJS configuration on startup
        loadEmailJSConfig();
        
        // Check Supabase connection on startup
        checkSupabaseConnection();
        
        console.log('✅ PhysioTech Application fully loaded and ready!');
    </script>
</body>
</html>
