<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhysioTech - Physiotherapy Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#0F766E',
                        secondary: '#0D9488',
                        medical: '#2C7A7B',
                        sage: '#10B981',
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <!-- User Type Selection -->
    <div id="userTypeSelection" class="min-h-screen flex items-center justify-center relative overflow-hidden bg-gradient-to-br from-slate-50 to-cyan-50">
        <div class="max-w-4xl mx-4 bg-white rounded-3xl shadow-2xl overflow-hidden relative z-10">
            <div class="p-8 lg:p-12 text-center">
                <div class="mb-8">
                    <div class="inline-flex items-center justify-center w-24 h-24 bg-white rounded-2xl mb-6 shadow-lg border-2 border-gray-100">
                        <img src="https://pfst.cf2.poecdn.net/base/image/8b6401e48101612f660ccec8b51614f103f2770892e0de9e4ad8f101949526a1?w=225&h=225"
                             alt="Bahrain Mobility International"
                             class="w-20 h-20 object-contain rounded-xl">
                    </div>
                    <h1 class="text-4xl font-bold text-gray-900 mb-2">Welcome to PhysioTech</h1>
                    <p class="text-gray-600">Choose your login type</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                    <button id="adminLoginBtn" class="group p-8 border-2 border-gray-200 rounded-2xl hover:border-primary hover:shadow-lg transition-all duration-200">
                        <div class="w-16 h-16 bg-primary bg-opacity-10 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-opacity-20 transition-colors">
                            <i class="fas fa-user-shield text-3xl text-primary"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">Administrator</h3>
                        <p class="text-gray-600">Access admin dashboard and manage the system</p>
                    </button>

                    <button id="physioLoginBtn" class="group p-8 border-2 border-gray-200 rounded-2xl hover:border-secondary hover:shadow-lg transition-all duration-200">
                        <div class="w-16 h-16 bg-secondary bg-opacity-10 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:bg-opacity-20 transition-colors">
                            <i class="fas fa-user-md text-3xl text-secondary"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">Physiotherapist</h3>
                        <p class="text-gray-600">Access your schedule and patient information</p>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Page -->
    <div id="adminLoginPage" class="hidden min-h-screen flex items-center justify-center relative overflow-hidden bg-gradient-to-br from-slate-50 to-cyan-50">
        <div class="flex w-full max-w-6xl mx-4 bg-white rounded-3xl shadow-2xl overflow-hidden relative z-10">
            <div class="w-full lg:w-1/2 p-8 lg:p-12">
                <div class="max-w-md mx-auto">
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-24 h-24 bg-white rounded-2xl mb-6 shadow-lg border-2 border-gray-100">
                            <img src="https://pfst.cf2.poecdn.net/base/image/8b6401e48101612f660ccec8b51614f103f2770892e0de9e4ad8f101949526a1?w=225&h=225"
                                 alt="Bahrain Mobility International"
                                 class="w-20 h-20 object-contain rounded-xl">
                        </div>
                        <h1 class="text-4xl font-bold text-gray-900 mb-2">Admin Login</h1>
                        <p class="text-gray-600">Welcome back to Bahrain Mobility International</p>
                    </div>

                    <form id="loginForm" class="space-y-6">
                        <div>
                            <label for="loginEmail" class="block text-sm font-semibold text-gray-700 mb-3">Email</label>
                            <div class="relative">
                                <input type="email" id="loginEmail" name="email" required autocomplete="email" placeholder="Enter your email address" class="w-full px-4 py-4 pl-12 border-2 border-gray-200 rounded-xl bg-white text-gray-900 text-base focus:ring-2 focus:ring-primary focus:border-primary focus:outline-none transition-colors z-10 relative">
                                <i class="fas fa-envelope absolute left-4 top-5 text-gray-400 pointer-events-none z-0"></i>
                            </div>
                        </div>

                        <div>
                            <label for="loginPassword" class="block text-sm font-semibold text-gray-700 mb-3">Password</label>
                            <div class="relative">
                                <input type="password" id="loginPassword" name="password" required autocomplete="current-password" placeholder="Enter your password" class="w-full px-4 py-4 pl-12 pr-12 border-2 border-gray-200 rounded-xl bg-white text-gray-900 text-base focus:ring-2 focus:ring-primary focus:border-primary focus:outline-none transition-colors z-10 relative">
                                <i class="fas fa-lock absolute left-4 top-5 text-gray-400 pointer-events-none z-0"></i>
                                <button type="button" id="togglePassword" class="absolute right-4 top-5 text-gray-400 hover:text-gray-600 focus:outline-none z-20">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-primary to-secondary text-white py-4 px-4 rounded-xl hover:from-secondary hover:to-medical transition-all duration-200 font-semibold text-lg shadow-lg">
                            Log In
                        </button>

                        <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm"></div>
                    </form>

                    <div class="mt-8 text-center">
                        <button id="backToSelectionFromAdmin" class="text-primary hover:text-secondary font-medium">‚Üê Back to login selection</button>
                    </div>
                </div>
            </div>

            <div class="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary via-secondary to-sage items-center justify-center p-12 relative">
                <div class="text-center text-white z-10">
                    <h2 class="text-4xl font-bold mb-6">Welcome to PhysioTech</h2>
                    <p class="text-xl text-white text-opacity-90 mb-8 leading-relaxed">Professional physiotherapy management system for modern healthcare providers</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Physiotherapist Login Page -->
    <div id="physioLoginPage" class="hidden min-h-screen flex items-center justify-center relative overflow-hidden bg-gradient-to-br from-teal-50 to-emerald-50">
        <div class="flex w-full max-w-5xl mx-4 bg-white rounded-3xl shadow-2xl overflow-hidden relative z-10">
            <div class="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-secondary via-sage to-primary items-center justify-center p-12 relative">
                <div class="text-center text-white z-10">
                    <div class="w-24 h-24 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-user-md text-4xl"></i>
                    </div>
                    <h2 class="text-4xl font-bold mb-6">Physiotherapist Portal</h2>
                    <p class="text-xl text-white text-opacity-90 mb-8 leading-relaxed">Access your schedule, patient information, and treatment tools</p>
                </div>
            </div>

            <div class="w-full lg:w-1/2 p-8 lg:p-12">
                <div class="max-w-md mx-auto">
                    <button id="backToSelection" class="mb-6 text-gray-600 hover:text-gray-800 flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span>Back to login selection</span>
                    </button>

                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-secondary bg-opacity-10 rounded-2xl mb-6">
                            <i class="fas fa-user-md text-3xl text-secondary"></i>
                        </div>
                        <h1 class="text-4xl font-bold text-gray-900 mb-2">Physiotherapist Login</h1>
                        <p class="text-gray-600">Enter your credentials to access your dashboard</p>
                    </div>

                    <form id="physioLoginForm" class="space-y-6">
                        <div>
                            <label for="physioLoginEmail" class="block text-sm font-semibold text-gray-700 mb-3">Email</label>
                            <div class="relative">
                                <input type="email" id="physioLoginEmail" name="email" required autocomplete="email" placeholder="Enter your email address" class="w-full px-4 py-4 pl-12 border-2 border-gray-200 rounded-xl bg-white text-gray-900 text-base focus:ring-2 focus:ring-secondary focus:border-secondary focus:outline-none transition-colors z-10 relative">
                                <i class="fas fa-envelope absolute left-4 top-5 text-gray-400 pointer-events-none z-0"></i>
                            </div>
                        </div>

                        <div>
                            <label for="physioLoginPassword" class="block text-sm font-semibold text-gray-700 mb-3">Password</label>
                            <div class="relative">
                                <input type="password" id="physioLoginPassword" name="password" required autocomplete="current-password" placeholder="Enter your password" class="w-full px-4 py-4 pl-12 pr-12 border-2 border-gray-200 rounded-xl bg-white text-gray-900 text-base focus:ring-2 focus:ring-secondary focus:border-secondary focus:outline-none transition-colors z-10 relative">
                                <i class="fas fa-lock absolute left-4 top-5 text-gray-400 pointer-events-none z-0"></i>
                                <button type="button" id="togglePhysioPassword" class="absolute right-4 top-5 text-gray-400 hover:text-gray-600 focus:outline-none z-20">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-gradient-to-r from-secondary to-sage text-white py-4 px-4 rounded-xl hover:from-sage hover:to-primary transition-all duration-200 font-semibold text-lg shadow-lg">
                            <i class="fas fa-sign-in-alt mr-2"></i>Log In
                        </button>

                        <div id="physioLoginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <nav class="bg-gradient-to-r from-primary via-secondary to-primary shadow-2xl fixed top-0 left-0 right-0 z-50">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <div class="flex items-center">
                        <i class="fas fa-heartbeat text-white text-3xl mr-4 animate-pulse"></i>
                        <span class="text-white text-2xl font-bold">PhysioTech - Admin</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-3 text-white">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-lg"></i>
                            </div>
                            <div class="hidden lg:block">
                                <p class="text-sm font-medium">Admin User</p>
                                <p class="text-xs text-gray-200">Administrator</p>
                            </div>
                        </div>
                        
                        <button id="adminLogoutBtn" class="bg-red-500 text-white px-4 py-3 rounded-lg hover:bg-red-600 transition-colors text-sm font-semibold">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex pt-16">
            <div class="w-64 bg-gray-50 dark:bg-gray-800 min-h-screen p-4 fixed left-0 top-16 bottom-0 overflow-y-auto z-40">
                <nav class="space-y-2">
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors bg-primary text-white" data-view="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="patients">
                        <i class="fas fa-users mr-3"></i>Patients
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="appointments">
                        <i class="fas fa-calendar mr-3"></i>Appointments
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="physiotherapists">
                        <i class="fas fa-user-md mr-3"></i>Physiotherapists
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="users">
                        <i class="fas fa-users-cog mr-3"></i>Users & Admins
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="exercises">
                        <i class="fas fa-dumbbell mr-3"></i>Exercises
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="reports">
                        <i class="fas fa-chart-bar mr-3"></i>Reports
                    </button>
                    <button class="nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="settings">
                        <i class="fas fa-cog mr-3"></i>Settings
                    </button>
                </nav>
            </div>

            <div class="flex-1 ml-64 p-6 min-h-screen">
                <!-- Dashboard View -->
                <div id="dashboard" class="view">
                    <!-- Dashboard Header -->
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
                        <div>
                            <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">Admin Dashboard</h1>
                            <p class="text-gray-600 dark:text-gray-400">Welcome back! Here's what's happening today.</p>
                        </div>
                        <div class="flex items-center space-x-3 mt-4 lg:mt-0">
                            <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                <i class="fas fa-clock mr-2"></i>
                                <span id="currentDateTime">Loading...</span>
                            </div>
                            <button id="refreshDashboard" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Enhanced Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showView('patients')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-blue-100 text-sm font-medium">Total Patients</p>
                                    <p class="text-3xl font-bold" id="totalPatientsCount">0</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-xs mr-1"></i>
                                        <span class="text-xs text-blue-100">+2 this week</span>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                    <i class="fas fa-users text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showView('appointments')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm font-medium">Appointments Today</p>
                                    <p class="text-3xl font-bold" id="todayAppointmentsCount">8</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-xs mr-1"></i>
                                        <span class="text-xs text-green-100">+3 pending</span>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                    <i class="fas fa-calendar-day text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-purple-100 text-sm font-medium">Active Treatments</p>
                                    <p class="text-3xl font-bold" id="activeTreatmentsCount">25</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-xs mr-1"></i>
                                        <span class="text-xs text-purple-100">+5 this month</span>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                    <i class="fas fa-stethoscope text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow cursor-pointer" onclick="showView('reports')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-orange-100 text-sm font-medium">Monthly Revenue</p>
                                    <p class="text-3xl font-bold" id="monthlyRevenue">BD 4,250</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-xs mr-1"></i>
                                        <span class="text-xs text-orange-100">+12% vs last month</span>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                    <i class="fas fa-chart-line text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Dashboard Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                        <!-- Left Column - Charts and Analytics -->
                        <div class="lg:col-span-2 space-y-8">
                            <!-- Patient Registration Trends -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                        <i class="fas fa-chart-line text-primary mr-2"></i>
                                        Patient Registration Trends
                                    </h3>
                                    <select id="chartTimeRange" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700">
                                        <option value="7">Last 7 days</option>
                                        <option value="30" selected>Last 30 days</option>
                                        <option value="90">Last 90 days</option>
                                    </select>
                                </div>
                                <div class="h-80">
                                    <canvas id="patientRegistrationChart"></canvas>
                                </div>
                            </div>

                            <!-- Treatment Types Distribution -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-chart-pie text-secondary mr-2"></i>
                                    Treatment Types Distribution
                                </h3>
                                <div class="h-80">
                                    <canvas id="treatmentTypesChart"></canvas>
                                </div>
                            </div>

                            <!-- Monthly Revenue Trend -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-chart-area text-green-600 mr-2"></i>
                                    Monthly Revenue Trends
                                </h3>
                                <div class="h-80">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>

                            <!-- Appointment Volume Analytics -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
                                    Weekly Appointment Volume
                                </h3>
                                <div class="h-80">
                                    <canvas id="appointmentVolumeChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Activity Feed and Quick Actions -->
                        <div class="space-y-8">
                            <!-- System Status -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
                                    <i class="fas fa-server text-green-600 mr-2"></i>
                                    System Status
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Database</span>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-green-600">Online</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">API Services</span>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-green-600">Operational</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Backup System</span>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-yellow-600">Syncing</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Security</span>
                                        <div class="flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                            <span class="text-sm text-green-600">Secure</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-bolt text-yellow-600 mr-2"></i>
                                    Quick Actions
                                </h3>
                                <div class="space-y-3">
                                    <button onclick="showAddPatientModal()" class="w-full flex items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors group">
                                        <div class="bg-blue-600 text-white p-3 rounded-lg mr-4 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-user-plus"></i>
                                        </div>
                                        <div class="text-left">
                                            <p class="font-semibold text-blue-900 dark:text-blue-100">Add New Patient</p>
                                            <p class="text-sm text-blue-600 dark:text-blue-300">Register patient information</p>
                                        </div>
                                    </button>

                                    <button onclick="showScheduleAppointmentModal()" class="w-full flex items-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors group">
                                        <div class="bg-green-600 text-white p-3 rounded-lg mr-4 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-calendar-plus"></i>
                                        </div>
                                        <div class="text-left">
                                            <p class="font-semibold text-green-900 dark:text-green-100">Schedule Appointment</p>
                                            <p class="text-sm text-green-600 dark:text-green-300">Book new session</p>
                                        </div>
                                    </button>

                                    <button onclick="showAddPhysiotherapistModal()" class="w-full flex items-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-colors group">
                                        <div class="bg-purple-600 text-white p-3 rounded-lg mr-4 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-user-md"></i>
                                        </div>
                                        <div class="text-left">
                                            <p class="font-semibold text-purple-900 dark:text-purple-100">Add Staff Member</p>
                                            <p class="text-sm text-purple-600 dark:text-purple-300">Register physiotherapist</p>
                                        </div>
                                    </button>

                                    <button onclick="generateReport()" class="w-full flex items-center p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/30 transition-colors group">
                                        <div class="bg-orange-600 text-white p-3 rounded-lg mr-4 group-hover:scale-110 transition-transform">
                                            <i class="fas fa-file-alt"></i>
                                        </div>
                                        <div class="text-left">
                                            <p class="font-semibold text-orange-900 dark:text-orange-100">Generate Report</p>
                                            <p class="text-sm text-orange-600 dark:text-orange-300">Create analytics report</p>
                                        </div>
                                    </button>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-6">
                                    <i class="fas fa-clock text-gray-600 mr-2"></i>
                                    Recent Activity
                                </h3>
                                <div class="space-y-4" id="recentActivityList">
                                    <div class="flex items-start space-x-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-user-plus text-blue-600"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">New patient registered</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Fatima Al-Zahra joined the system</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="text-xs text-gray-400">2 min ago</span>
                                        </div>
                                    </div>

                                    <div class="flex items-start space-x-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-calendar-check text-green-600"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Appointment completed</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Ahmed Al-Khalifa session finished</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="text-xs text-gray-400">1 hour ago</span>
                                        </div>
                                    </div>

                                    <div class="flex items-start space-x-3 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-file-medical text-purple-600"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Treatment plan updated</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Dr. Mariam updated therapy schedule</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <span class="text-xs text-gray-400">3 hours ago</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Schedule Preview -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
                                <i class="fas fa-calendar-day text-primary mr-2"></i>
                                Today's Schedule Preview
                            </h3>
                            <button onclick="showView('appointments')" class="text-primary hover:text-secondary font-semibold text-sm">
                                View All Appointments ‚Üí
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="todaysSchedule">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-semibold text-primary">10:00 AM</span>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">upcoming</span>
                                </div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-1">Ahmed Al-Khalifa</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Back Pain Therapy</p>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>60 min</span>
                                </div>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-semibold text-primary">11:30 AM</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">confirmed</span>
                                </div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-1">Fatima Al-Zahra</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Knee Rehabilitation</p>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>45 min</span>
                                </div>
                            </div>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-semibold text-primary">2:00 PM</span>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">upcoming</span>
                                </div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-1">Dhari Fakhroo</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Follow-up Session</p>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>45 min</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Patient Satisfaction</h4>
                                <i class="fas fa-star text-yellow-500"></i>
                            </div>
                            <div class="flex items-end">
                                <span class="text-3xl font-bold text-yellow-500">4.8</span>
                                <span class="text-sm text-gray-500 ml-2 mb-1">/5.0</span>
                            </div>
                            <p class="text-sm text-green-600">+0.2 from last month</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Treatment Success</h4>
                                <i class="fas fa-check-circle text-green-500"></i>
                            </div>
                            <div class="flex items-end">
                                <span class="text-3xl font-bold text-green-500">92</span>
                                <span class="text-sm text-gray-500 ml-2 mb-1">%</span>
                            </div>
                            <p class="text-sm text-green-600">+3% improvement</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Avg Session Time</h4>
                                <i class="fas fa-clock text-blue-500"></i>
                            </div>
                            <div class="flex items-end">
                                <span class="text-3xl font-bold text-blue-500">45</span>
                                <span class="text-sm text-gray-500 ml-2 mb-1">min</span>
                            </div>
                            <p class="text-sm text-blue-600">Optimal duration</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Equipment Usage</h4>
                                <i class="fas fa-dumbbell text-purple-500"></i>
                            </div>
                            <div class="flex items-end">
                                <span class="text-3xl font-bold text-purple-500">78</span>
                                <span class="text-sm text-gray-500 ml-2 mb-1">%</span>
                            </div>
                            <p class="text-sm text-purple-600">High utilization</p>
                        </div>
                    </div>
                </div>

                <!-- Patients View -->
                <div id="patients" class="view hidden">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Patient Management</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage patient records, medical history, and treatment plans</p>
                        </div>
                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400 mt-4 lg:mt-0">
                            <i class="fas fa-users mr-2"></i>
                            <span id="patientCount">Total: 0 patients</span>
                        </div>
                    </div>

                    <!-- Patient Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Active Patients</p>
                                    <p class="text-2xl font-bold text-green-600" id="activePatientsCount">0</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-user-check text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">New This Week</p>
                                    <p class="text-2xl font-bold text-blue-600" id="newPatientsCount">2</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-user-plus text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Avg Age</p>
                                    <p class="text-2xl font-bold text-purple-600">32</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-birthday-cake text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Recovery Rate</p>
                                    <p class="text-2xl font-bold text-yellow-600">89%</p>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3">
                                    <i class="fas fa-chart-line text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Patient Analytics Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-bar text-blue-600 mr-2"></i>Age Distribution
                            </h3>
                            <div class="h-64">
                                <canvas id="patientAgeChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-pie text-pink-600 mr-2"></i>Gender Distribution
                            </h3>
                            <div class="h-64">
                                <canvas id="patientGenderChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-doughnut text-green-600 mr-2"></i>Treatment Status
                            </h3>
                            <div class="h-64">
                                <canvas id="treatmentStatusChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Search and Filter Bar -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
                            <div class="flex-1 w-full lg:w-auto">
                                <div class="relative">
                                    <input type="text" id="patientSearchInput" placeholder="Search by name, CPR, phone, or condition..." class="w-full px-4 py-3 pl-12 pr-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <select id="patientStatusFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Status</option>
                                    <option value="active">Active Treatment</option>
                                    <option value="completed">Treatment Completed</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                
                                <select id="patientPhysioFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Physiotherapists</option>
                                    <option value="Dr. Mariam Abdulatheem Ali">Dr. Mariam Abdulatheem Ali</option>
                                </select>
                                
                                <button id="clearFiltersBtn" class="px-4 py-3 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    <i class="fas fa-times mr-2"></i>Clear
                                </button>
                                
                                <button onclick="exportPatients()" class="bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                    <i class="fas fa-download mr-2"></i>Export
                                </button>
                                
                                <button onclick="showAddPatientModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                    <i class="fas fa-user-plus mr-2"></i>Add New Patient
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Patients Grid -->
                    <div id="patientsGrid">
                        <div id="patientsGridContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                        <div id="noPatientsFound" class="text-center py-12">
                            <div class="max-w-md mx-auto">
                                <i class="fas fa-users text-gray-300 dark:text-gray-600 text-6xl mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">No Patients Yet</h3>
                                <p class="text-gray-500 dark:text-gray-500 mb-6">Add your first patient to get started with comprehensive patient management.</p>
                                <button onclick="showAddPatientModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                    <i class="fas fa-user-plus mr-2"></i>Add First Patient
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Appointments View -->
                <div id="appointments" class="view hidden">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Appointment Management</h1>
                            <p class="text-gray-600 dark:text-gray-400">Schedule and manage patient appointments with calendar integration</p>
                        </div>
                        <div class="flex gap-3 mt-4 lg:mt-0">
                            <button onclick="showCalendarView()" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-calendar-alt mr-2"></i>Calendar View
                            </button>
                            <button onclick="showScheduleAppointmentModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-calendar-plus mr-2"></i>Schedule Appointment
                            </button>
                        </div>
                    </div>

                    <!-- Appointment Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Today</p>
                                    <p class="text-2xl font-bold text-blue-600" id="todayAppointments">3</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-calendar-day text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">This Week</p>
                                    <p class="text-2xl font-bold text-green-600">18</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-calendar-week text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Pending</p>
                                    <p class="text-2xl font-bold text-yellow-600">5</p>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3">
                                    <i class="fas fa-clock text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Completed</p>
                                    <p class="text-2xl font-bold text-purple-600">42</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-check-circle text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Cancelled</p>
                                    <p class="text-2xl font-bold text-red-600">2</p>
                                </div>
                                <div class="bg-red-100 dark:bg-red-900/30 rounded-lg p-3">
                                    <i class="fas fa-times-circle text-red-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Appointment Filters and Search -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
                            <div class="flex-1 w-full">
                                <div class="relative">
                                    <input type="text" id="appointmentSearchInput" placeholder="Search appointments..." class="w-full px-4 py-3 pl-12 pr-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <input type="date" id="appointmentDateFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                
                                <select id="appointmentStatusFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Status</option>
                                    <option value="scheduled">Scheduled</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                
                                <select id="appointmentPhysioFilter" class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Physiotherapists</option>
                                    <option value="Dr. Mariam Abdulatheem Ali">Dr. Mariam Abdulatheem Ali</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Today's Appointments Highlight -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg p-6 mb-6 border border-blue-200 dark:border-blue-800">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-blue-900 dark:text-blue-100">
                                <i class="fas fa-calendar-day text-blue-600 mr-2"></i>
                                Today's Schedule - ${new Date().toLocaleDateString('en-GB')}
                            </h3>
                            <span class="px-3 py-1 bg-blue-600 text-white rounded-full text-sm font-medium">
                                3 appointments
                            </span>
                        </div>
                        <div class="text-center py-8">
                            <i class="fas fa-calendar-times text-gray-300 dark:text-gray-600 text-4xl mb-4"></i>
                            <h4 class="text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2">No Appointments Today</h4>
                            <p class="text-gray-500 dark:text-gray-500 mb-4">Your schedule is clear for today. Time to catch up on administrative tasks!</p>
                            <button onclick="showScheduleAppointmentModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-calendar-plus mr-2"></i>Schedule First Appointment
                            </button>
                        </div>
                    </div>

                    <!-- Appointment Analytics Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-bar text-blue-600 mr-2"></i>Appointment Status
                            </h3>
                            <div class="h-64">
                                <canvas id="appointmentStatusChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-line text-purple-600 mr-2"></i>Daily Volume (30 days)
                            </h3>
                            <div class="h-64">
                                <canvas id="dailyAppointmentChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-radar text-yellow-600 mr-2"></i>Peak Hours Analysis
                            </h3>
                            <div class="h-64">
                                <canvas id="peakHoursChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Appointments Table -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">All Appointments</h3>
                            <div class="flex gap-2">
                                <button onclick="exportAppointments()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                    <i class="fas fa-download mr-1"></i>Export
                                </button>
                                <button onclick="printSchedule()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm">
                                    <i class="fas fa-print mr-1"></i>Print
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date & Time</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Patient</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Physiotherapist</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Treatment</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Duration</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="appointmentsTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="mt-6 flex items-center justify-between">
                            <div class="flex items-center text-sm text-gray-500 dark:text-gray-400">
                                <span>Showing <span class="font-medium text-gray-900 dark:text-white">1</span> to <span class="font-medium text-gray-900 dark:text-white">10</span> of <span class="font-medium text-gray-900 dark:text-white">20</span> results</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="px-3 py-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="px-3 py-2 bg-primary text-white border border-primary rounded-lg text-sm">1</button>
                                <button class="px-3 py-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">2</button>
                                <button class="px-3 py-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Appointments Alert -->
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mt-6">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-yellow-600 mr-3"></i>
                            <div>
                                <h4 class="text-sm font-semibold text-yellow-800 dark:text-yellow-200">Reminder</h4>
                                <p class="text-sm text-yellow-700 dark:text-yellow-300">You have 3 appointments starting in the next 2 hours. Review patient files and prepare treatment rooms.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Physiotherapists View -->
                <div id="physiotherapists" class="view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Physiotherapist Management</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage your physiotherapy staff</p>
                        </div>
                        <button onclick="showAddPhysiotherapistModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                            <i class="fas fa-user-plus mr-2"></i>Add New Physiotherapist
                        </button>
                    </div>

                    <!-- Physiotherapist Analytics Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-bar text-green-600 mr-2"></i>Workload Distribution
                            </h3>
                            <div class="h-64">
                                <canvas id="workloadChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-area text-purple-600 mr-2"></i>Specialization Distribution
                            </h3>
                            <div class="h-64">
                                <canvas id="specializationChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div id="physiotherapistsGrid">
                        <div id="physiotherapistsGridContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                        <div id="noPhysiotherapistsFound" class="text-center py-12">
                            <div class="max-w-md mx-auto">
                                <i class="fas fa-user-md text-gray-300 dark:text-gray-600 text-6xl mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">No Physiotherapists Yet</h3>
                                <p class="text-gray-500 dark:text-gray-500 mb-6">Add your first physiotherapist.</p>
                                <button onclick="showAddPhysiotherapistModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                    <i class="fas fa-user-plus mr-2"></i>Add First Physiotherapist
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users & Admins View -->
                <div id="users" class="view hidden">
                    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Users & Admins</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage system administrators and user permissions</p>
                        </div>
                        <div class="flex gap-3 mt-4 lg:mt-0">
                            <button onclick="showAddUserModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-user-plus mr-2"></i>Add New Admin
                            </button>
                            <button onclick="exportUsers()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold">
                                <i class="fas fa-download mr-2"></i>Export Users
                            </button>
                            <div class="flex gap-2">
                                <button class="bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 transition-colors">
                                    <i class="fas fa-cogs mr-2"></i>Bulk Actions
                                </button>
                                <button class="bg-orange-600 text-white px-4 py-3 rounded-lg hover:bg-orange-700 transition-colors">
                                    <i class="fas fa-key mr-2"></i>Permissions
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Search and Filters -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center">
                            <div class="flex-1 w-full lg:w-auto">
                                <div class="relative">
                                    <input type="text" placeholder="Search users by name, email, or role..." class="w-full px-4 py-3 pl-12 pr-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-3">
                                <select class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Roles</option>
                                    <option value="administrator">Administrator</option>
                                    <option value="physiotherapist">Physiotherapist</option>
                                    <option value="manager">Manager</option>
                                    <option value="staff">Staff</option>
                                </select>
                                
                                <select class="px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="pending">Pending</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Users Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total Admins</p>
                                    <p class="text-2xl font-bold text-red-600">1</p>
                                </div>
                                <div class="bg-red-100 dark:bg-red-900/30 rounded-lg p-3">
                                    <i class="fas fa-user-shield text-red-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total Staff</p>
                                    <p class="text-2xl font-bold text-blue-600">1</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Active Users</p>
                                    <p class="text-2xl font-bold text-green-600">2</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Last 24h Logins</p>
                                    <p class="text-2xl font-bold text-purple-600">3</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-sign-in-alt text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Two Column Layout for User Categories -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <!-- Administrators Section -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-red-500 to-red-600 px-6 py-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i class="fas fa-user-shield text-white text-xl mr-3"></i>
                                        <div>
                                            <h3 class="text-lg font-semibold text-white">Administrators</h3>
                                            <p class="text-red-100 text-sm">1 Admin</p>
                                        </div>
                                    </div>
                                    <span class="bg-red-400 text-white px-3 py-1 rounded-full text-sm font-medium">1 Admin</span>
                                </div>
                            </div>

                            <div class="p-6">
                                <!-- Admin Card: Dhari Admin -->
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center text-white font-bold mr-3">
                                                DA
                                            </div>
                                            <div>
                                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Dhari Admin</h4>
                                                <p class="text-sm text-red-600 dark:text-red-400 font-medium">Super Administrator</p>
                                            </div>
                                        </div>
                                        <span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400 rounded-full text-xs font-medium flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                                            Online
                                        </span>
                                    </div>

                                    <div class="space-y-2 mb-4">
                                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-envelope w-4 mr-2 text-gray-500"></i>
                                            <span>DhariBmi@gmail.com</span>
                                        </div>
                                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-shield-alt w-4 mr-2 text-gray-500"></i>
                                            <span>Full system access</span>
                                        </div>
                                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-clock w-4 mr-2 text-gray-500"></i>
                                            <span>Since Dec 2024</span>
                                        </div>
                                    </div>

                                    <div class="flex gap-2">
                                        <button onclick="viewUserDetails('admin-001')" class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                                            <i class="fas fa-eye mr-1"></i>View
                                        </button>
                                        <button onclick="editUser('admin-001')" class="bg-yellow-600 text-white px-3 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                            <i class="fas fa-edit mr-1"></i>Edit
                                        </button>
                                        <button onclick="managePermissions('admin-001')" class="bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm">
                                            <i class="fas fa-key mr-1"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-4 text-center">
                                    <button onclick="showAddUserModal()" class="text-red-600 hover:text-red-800 font-medium text-sm">
                                        <i class="fas fa-plus mr-1"></i>Add New Administrator
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Staff Members Section -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i class="fas fa-users text-white text-xl mr-3"></i>
                                        <div>
                                            <h3 class="text-lg font-semibold text-white">Staff Members</h3>
                                            <p class="text-blue-100 text-sm">1 Staff</p>
                                        </div>
                                    </div>
                                    <span class="bg-blue-400 text-white px-3 py-1 rounded-full text-sm font-medium">1 Staff</span>
                                </div>
                            </div>

                            <div class="p-6">
                                <!-- Staff Card: Dr. Mariam -->
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 hover:shadow-md transition-shadow">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-3">
                                                MA
                                            </div>
                                            <div>
                                                <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Dr. Mariam Abdulatheem Ali</h4>
                                                <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Physiotherapist</p>
                                            </div>
                                        </div>
                                        <span class="px-2 py-1 bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400 rounded-full text-xs font-medium flex items-center">
                                            <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                                            Active
                                        </span>
                                    </div>

                                    <div class="space-y-2 mb-4">
                                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-envelope w-4 mr-2 text-gray-500"></i>
                                            <span>Mariambmi@gmail.com</span>
                                        </div>
                                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-phone w-4 mr-2 text-gray-500"></i>
                                            <span>+973 3333 9999</span>
                                        </div>
                                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                            <i class="fas fa-certificate w-4 mr-2 text-gray-500"></i>
                                            <span>8 years experience</span>
                                        </div>
                                    </div>

                                    <div class="flex flex-wrap gap-1 mb-4">
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full font-medium">Orthopedic</span>
                                        <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium">Sports Medicine</span>
                                        <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full font-medium">Manual Therapy</span>
                                    </div>

                                    <div class="flex gap-2">
                                        <button onclick="viewUserDetails('physio-001')" class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                                            <i class="fas fa-eye mr-1"></i>View
                                        </button>
                                        <button onclick="editUser('physio-001')" class="bg-yellow-600 text-white px-3 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                            <i class="fas fa-edit mr-1"></i>Edit
                                        </button>
                                        <button onclick="assignPatients('physio-001')" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                            <i class="fas fa-user-plus mr-1"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-4 text-center">
                                    <button onclick="showAddPhysiotherapistModal()" class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                                        <i class="fas fa-plus mr-1"></i>Add New Staff Member
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System Security & Audit Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- System Activity Log -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                    <i class="fas fa-clock text-gray-600 mr-2"></i>Recent User Activity
                                </h3>
                                <button onclick="viewFullAuditLog()" class="text-primary hover:text-secondary font-medium text-sm">
                                    View All ‚Üí
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex items-start space-x-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                    <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center">
                                        <i class="fas fa-sign-in-alt text-white text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Admin login successful</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Dhari Admin logged in from Bahrain</p>
                                        <p class="text-xs text-gray-500">2 minutes ago</p>
                                    </div>
                                </div>

                                <div class="flex items-start space-x-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user-check text-white text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">Physiotherapist accessed patient files</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Dr. Mariam viewed 2 patient records</p>
                                        <p class="text-xs text-gray-500">12 hours ago</p>
                                    </div>
                                </div>

                                <div class="flex items-start space-x-4 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800">
                                    <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center">
                                        <i class="fas fa-cogs text-white text-sm"></i>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900 dark:text-white">System settings updated</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Admin modified notification preferences</p>
                                        <p class="text-xs text-gray-500">1 day ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Security & Permissions Overview -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                    <i class="fas fa-shield-alt text-green-600 mr-2"></i>Security & Audit Log
                                </h3>
                                <div class="flex gap-2">
                                    <button onclick="showAuditLog()" class="bg-yellow-600 text-white px-3 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                        <i class="fas fa-clipboard-list mr-1"></i>Audit Log
                                    </button>
                                    <button onclick="showSecuritySettings()" class="bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                        <i class="fas fa-cog mr-1"></i>Security Settings
                                    </button>
                                </div>
                            </div>

                            <!-- Security Status Cards -->
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                    <div class="flex items-center">
                                        <i class="fas fa-check-shield text-green-600 mr-3"></i>
                                        <span class="text-sm font-medium text-green-900 dark:text-green-100">Two-Factor Authentication</span>
                                    </div>
                                    <span class="text-xs text-green-700 dark:text-green-300">Enabled</span>
                                </div>

                                <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                    <div class="flex items-center">
                                        <i class="fas fa-lock text-green-600 mr-3"></i>
                                        <span class="text-sm font-medium text-green-900 dark:text-green-100">Password Policy</span>
                                    </div>
                                    <span class="text-xs text-green-700 dark:text-green-300">Strong</span>
                                </div>

                                <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                                    <div class="flex items-center">
                                        <i class="fas fa-history text-blue-600 mr-3"></i>
                                        <span class="text-sm font-medium text-blue-900 dark:text-blue-100">Session Timeout</span>
                                    </div>
                                    <span class="text-xs text-blue-700 dark:text-blue-300">30 minutes</span>
                                </div>

                                <div class="flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800">
                                    <div class="flex items-center">
                                        <i class="fas fa-eye text-purple-600 mr-3"></i>
                                        <span class="text-sm font-medium text-purple-900 dark:text-purple-100">Audit Logging</span>
                                    </div>
                                    <span class="text-xs text-purple-700 dark:text-purple-300">Active</span>
                                </div>

                                <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
                                    <div class="flex items-center">
                                        <i class="fas fa-exclamation-triangle text-yellow-600 mr-3"></i>
                                        <span class="text-sm font-medium text-yellow-900 dark:text-yellow-100">Failed Login Attempts</span>
                                    </div>
                                    <span class="text-xs text-yellow-700 dark:text-yellow-300">0 today</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Exercises View -->
                <div id="exercises" class="view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Exercise Library</h1>
                            <p class="text-gray-600 dark:text-gray-400">Manage exercises and track patient progress</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="showBulkUploadModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                                <i class="fas fa-file-word mr-2"></i>Upload Word Doc
                            </button>
                            <button onclick="showAddExerciseModal()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-plus mr-2"></i>Add New Exercise
                            </button>
                            <button onclick="exportExerciseLibrary()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold">
                                <i class="fas fa-download mr-2"></i>Export Library
                            </button>
                        </div>
                    </div>

                    <!-- New Exercises Alert -->
                    <div id="newExercisesAlert" class="hidden bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg p-4 mb-6 border border-green-200 dark:border-green-800">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-plus-circle text-green-600 text-xl mr-3"></i>
                                <div>
                                    <h3 class="text-lg font-semibold text-green-900 dark:text-green-100">New Exercises Added!</h3>
                                    <p class="text-sm text-green-700 dark:text-green-300" id="newExercisesText">3 new exercises have been added to your library</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="viewNewExercises()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium">
                                    <i class="fas fa-eye mr-2"></i>View New Exercises
                                </button>
                                <button onclick="hideNewExercisesAlert()" class="text-green-600 hover:text-green-800 p-2">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total Exercises</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">42</p>
                                </div>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3">
                                    <i class="fas fa-dumbbell text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Categories</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">8</p>
                                </div>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded-lg p-3">
                                    <i class="fas fa-list text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Completed Sessions</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">157</p>
                                </div>
                                <div class="bg-purple-100 dark:bg-purple-900/30 rounded-lg p-3">
                                    <i class="fas fa-check-circle text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Progress Rate</p>
                                    <p class="text-2xl font-bold text-gray-900 dark:text-white">85%</p>
                                </div>
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 rounded-lg p-3">
                                    <i class="fas fa-trophy text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Analytics Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-doughnut text-blue-600 mr-2"></i>Categories Distribution
                            </h3>
                            <div class="h-64">
                                <canvas id="exerciseCategoriesChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-bar text-green-600 mr-2"></i>Difficulty Breakdown
                            </h3>
                            <div class="h-64">
                                <canvas id="exerciseDifficultyChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-line text-purple-600 mr-2"></i>Usage Frequency (Weekly)
                            </h3>
                            <div class="h-64">
                                <canvas id="exerciseUsageChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Categories -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Exercise Categories</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-blue-900 dark:text-blue-100">Strength Training</h4>
                                    <i class="fas fa-dumbbell text-blue-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-blue-900 dark:text-blue-100">12</p>
                                <p class="text-sm text-blue-600 dark:text-blue-300">Exercises</p>
                            </div>

                            <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-green-900 dark:text-green-100">Flexibility</h4>
                                    <i class="fas fa-expand-arrows-alt text-green-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-green-900 dark:text-green-100">8</p>
                                <p class="text-sm text-green-600 dark:text-green-300">Exercises</p>
                            </div>

                            <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4 border border-purple-200 dark:border-purple-800">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-purple-900 dark:text-purple-100">Balance</h4>
                                    <i class="fas fa-balance-scale text-purple-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-purple-900 dark:text-purple-100">6</p>
                                <p class="text-sm text-purple-600 dark:text-purple-300">Exercises</p>
                            </div>

                            <div class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4 border border-orange-200 dark:border-orange-800">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold text-orange-900 dark:text-orange-100">Rehabilitation</h4>
                                    <i class="fas fa-heart text-orange-600"></i>
                                </div>
                                <p class="text-2xl font-bold text-orange-900 dark:text-orange-100">16</p>
                                <p class="text-sm text-orange-600 dark:text-orange-300">Exercises</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Exercise Activity -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Recent Exercise Activity</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-dumbbell text-white text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-900 dark:text-white">Shoulder Strengthening</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Completed by Ahmed Al-Khalifa</p>
                                    </div>
                                </div>
                                <span class="text-sm text-gray-500 dark:text-gray-400">2 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports View -->
                <div id="reports" class="view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">Reports & Analytics</h1>
                            <p class="text-gray-600 dark:text-gray-400">Generate comprehensive reports and analyze clinic performance</p>
                        </div>
                        <button onclick="generateCustomReport()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                            <i class="fas fa-chart-line mr-2"></i>Generate Custom Report
                        </button>
                    </div>

                    <!-- Report Types -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-users text-blue-600 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Patient Reports</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Generate detailed patient progress and treatment reports.</p>
                            <button onclick="generatePatientReport()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-file-pdf mr-2"></i>Generate Report
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-dollar-sign text-green-600 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Financial Reports</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Track revenue, expenses, and financial performance.</p>
                            <button onclick="generateFinancialReport()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-chart-bar mr-2"></i>Generate Report
                            </button>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center mr-4">
                                    <i class="fas fa-calendar-alt text-purple-600 text-xl"></i>
                                </div>
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Appointment Reports</h3>
                            </div>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">Analyze appointment trends and scheduling patterns.</p>
                            <button onclick="generateAppointmentReport()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                <i class="fas fa-calendar-check mr-2"></i>Generate Report
                            </button>
                        </div>
                    </div>

                    <!-- Comprehensive Financial Reports Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-pie text-green-600 mr-2"></i>Revenue by Payment Method
                            </h3>
                            <div class="h-80">
                                <canvas id="paymentMethodChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-line text-blue-600 mr-2"></i>Year-over-Year Revenue Comparison
                            </h3>
                            <div class="h-80">
                                <canvas id="monthlyRevenueCompareChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Treatment Outcomes Analytics -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-bar text-purple-600 mr-2"></i>Success Rate by Condition
                            </h3>
                            <div class="h-80">
                                <canvas id="successRateChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                                <i class="fas fa-chart-scatter text-orange-600 mr-2"></i>Treatment Duration vs Success Rate
                            </h3>
                            <div class="h-80">
                                <canvas id="treatmentDurationChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Analytics Summary -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">Performance Summary & KPIs</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <div class="text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600 mb-1">94%</div>
                                <div class="text-sm text-blue-600">Patient Satisfaction</div>
                            </div>
                            <div class="text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-green-600 mb-1">89%</div>
                                <div class="text-sm text-green-600">Treatment Success</div>
                            </div>
                            <div class="text-center p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600 mb-1">76%</div>
                                <div class="text-sm text-purple-600">Patient Return Rate</div>
                            </div>
                            <div class="text-center p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                <div class="text-2xl font-bold text-orange-600 mb-1">12.5</div>
                                <div class="text-sm text-orange-600">Avg Sessions/Patient</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">This Month's Performance</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">New Patients:</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">12</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Appointments:</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">156</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Revenue:</span>
                                        <span class="font-semibold text-green-600">BD 4,250</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Completed Treatments:</span>
                                        <span class="font-semibold text-blue-600">142</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-white mb-3">Quality Metrics</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Avg Treatment Duration:</span>
                                        <span class="font-semibold text-gray-900 dark:text-white">8.2 weeks</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Cancellation Rate:</span>
                                        <span class="font-semibold text-red-600">4.2%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">No-show Rate:</span>
                                        <span class="font-semibold text-red-600">2.1%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Equipment Utilization:</span>
                                        <span class="font-semibold text-purple-600">78%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings View -->
                <div id="settings" class="view hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">System Settings</h1>
                            <p class="text-gray-600 dark:text-gray-400">Configure system preferences and clinic settings</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="showSupabaseConnectionModal()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors font-semibold">
                                <i class="fas fa-database mr-2"></i>Connect Supabase
                            </button>
                            <button onclick="saveAllSettings()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-colors font-semibold">
                                <i class="fas fa-save mr-2"></i>Save All Settings
                            </button>
                        </div>
                    </div>

                    <!-- Supabase Connection Status -->
                    <div id="supabaseStatusCard" class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-database text-purple-600 mr-2"></i>Database Connection Status
                        </h3>
                        
                        <div id="supabaseConnected" class="hidden">
                            <div class="flex items-center justify-between p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3 animate-pulse"></div>
                                    <div>
                                        <p class="text-sm font-medium text-green-900 dark:text-green-100">Connected to Supabase</p>
                                        <p class="text-xs text-green-700 dark:text-green-300" id="supabaseProjectUrl">Project: Loading...</p>
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="testSupabaseConnection()" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                        <i class="fas fa-check-circle mr-1"></i>Test Connection
                                    </button>
                                    <button onclick="disconnectSupabase()" class="bg-red-600 text-white px-3 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                        <i class="fas fa-unlink mr-1"></i>Disconnect
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="supabaseDisconnected">
                            <div class="flex items-center justify-between p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                    <div>
                                        <p class="text-sm font-medium text-yellow-900 dark:text-yellow-100">Not Connected to Database</p>
                                        <p class="text-xs text-yellow-700 dark:text-yellow-300">Connect to Supabase to enable real-time data synchronization</p>
                                    </div>
                                </div>
                                <button onclick="showSupabaseConnectionModal()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium">
                                    <i class="fas fa-plug mr-2"></i>Connect Now
                                </button>
                            </div>
                        </div>

                        <!-- Connection Details -->
                        <div id="supabaseDetails" class="hidden mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-500 dark:text-gray-400">Connection Status:</span>
                                    <span class="font-medium text-green-600" id="connectionStatus">Active</span>
                                </div>
                                <div>
                                    <span class="text-gray-500 dark:text-gray-400">Last Connected:</span>
                                    <span class="font-medium text-gray-900 dark:text-white" id="lastConnected">Just now</span>
                                </div>
                                <div>
                                    <span class="text-gray-500 dark:text-gray-400">Data Sync:</span>
                                    <span class="font-medium text-blue-600" id="dataSyncStatus">Real-time</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- General Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">General Settings</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Clinic Name</label>
                                    <input type="text" value="Bahrain Mobility International" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Default Session Duration</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="30">30 minutes</option>
                                        <option value="45" selected>45 minutes</option>
                                        <option value="60">60 minutes</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Time Zone</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="GMT+3" selected>GMT+3 (Bahrain)</option>
                                        <option value="GMT+4">GMT+4 (UAE)</option>
                                        <option value="GMT+2">GMT+2 (Egypt)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Notification Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Notification Settings</h3>
                            <div class="space-y-4">
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Email Notifications</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">SMS Reminders</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Push Notifications</span>
                                    <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Appointment Reminders</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                            </div>
                        </div>

                        <!-- System Preferences -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">System Preferences</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Language</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="en" selected>English</option>
                                        <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                                        <option value="fr">Fran√ßais</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date Format</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Currency</label>
                                    <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                        <option value="BHD" selected>Bahraini Dinar (BD)</option>
                                        <option value="USD">US Dollar ($)</option>
                                        <option value="EUR">Euro (‚Ç¨)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Security Settings -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Security Settings</h3>
                            <div class="space-y-4">
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Require Strong Passwords</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Two-Factor Authentication</span>
                                    <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <label class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Auto Logout (30 min)</span>
                                    <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2">
                                </label>
                                <button onclick="changeAdminPassword()" class="w-full bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">
                                    <i class="fas fa-key mr-2"></i>Change Admin Password
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Physiotherapist Dashboard -->
    <div id="physioDashboard" class="hidden">
        <nav class="bg-gradient-to-r from-secondary via-sage to-secondary shadow-2xl fixed top-0 left-0 right-0 z-50">
            <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-20">
                    <div class="flex items-center">
                        <i class="fas fa-user-md text-white text-3xl mr-4 animate-pulse"></i>
                        <span class="text-white text-2xl font-bold">PhysioTech - Dr. Mariam Portal</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="flex items-center space-x-3 text-white">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                                <i class="fas fa-user-md text-lg"></i>
                            </div>
                            <div class="hidden lg:block">
                                <p class="text-sm font-medium">Dr. Mariam Abdulatheem Ali</p>
                                <p class="text-xs text-gray-200">Physiotherapist</p>
                            </div>
                        </div>
                        
                        <button id="physioLogoutBtn" class="bg-red-500 text-white px-4 py-3 rounded-lg hover:bg-red-600 transition-colors text-sm font-semibold">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex pt-16">
            <div class="w-64 bg-gray-50 dark:bg-gray-800 min-h-screen p-4 fixed left-0 top-16 bottom-0 overflow-y-auto z-40">
                <nav class="space-y-2">
                    <button class="physio-nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors bg-secondary text-white" data-view="physio-dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                    </button>
                    <button class="physio-nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="physio-patients">
                        <i class="fas fa-users mr-3"></i>My Patients
                    </button>
                    <button class="physio-nav-btn w-full text-left p-3 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" data-view="physio-schedule">
                        <i class="fas fa-calendar mr-3"></i>Schedule
                    </button>
                </nav>
            </div>

            <div class="flex-1 ml-64 p-6 min-h-screen">
                <!-- Physiotherapist Dashboard View -->
                <div id="physio-dashboard" class="physio-view">
                    <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-8">Dr. Mariam's Dashboard</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-semibold">Today's Appointments</h3>
                            <p class="text-3xl font-bold">3</p>
                        </div>
                        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-semibold">My Active Patients</h3>
                            <p class="text-3xl font-bold" id="physioActivePatients">12</p>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-semibold">Active Treatments</h3>
                            <p class="text-3xl font-bold">18</p>
                        </div>
                        <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-lg font-semibold">Success Rate</h3>
                            <p class="text-3xl font-bold">94%</p>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">Welcome, Dr. Mariam!</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">Here's your personalized physiotherapist dashboard to manage your patients and appointments.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="showPhysioView('physio-patients')" class="bg-secondary text-white px-6 py-3 rounded-lg hover:bg-sage transition-colors">
                                <i class="fas fa-users mr-2"></i>View My Patients
                            </button>
                            <button onclick="showPhysioView('physio-schedule')" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-calendar mr-2"></i>View Schedule
                            </button>
                        </div>
                    </div>
                </div>

                <!-- My Patients View -->
                <div id="physio-patients" class="physio-view hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">My Patients</h1>
                        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                            <i class="fas fa-users mr-2"></i>
                            <span id="physioPatientCount">Assigned: 0 patients</span>
                        </div>
                    </div>

                    <div id="physioMyPatientsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                    <div id="physioNoPatientsFound" class="text-center py-12 hidden">
                        <div class="max-w-md mx-auto">
                            <i class="fas fa-user-md text-gray-300 dark:text-gray-600 text-6xl mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">No Patients Assigned</h3>
                            <p class="text-gray-500 dark:text-gray-500 mb-6">Ask your administrator to assign patients to you.</p>
                        </div>
                    </div>
                </div>

                <!-- Schedule View -->
                <div id="physio-schedule" class="physio-view hidden">
                    <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-6">My Schedule</h1>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Weekly Schedule</h3>
                        <p class="text-gray-600 dark:text-gray-400">Schedule functionality coming soon!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode setup with error handling
        try {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            if (window.matchMedia) {
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    try {
                        if (event.matches) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                        // Update charts when theme changes
                        if (typeof updateChartsForTheme === 'function') {
                            updateChartsForTheme();
                        }
                    } catch (error) {
                        console.log('Dark mode change error:', error.message);
                    }
                });
            }
        } catch (error) {
            console.log('Dark mode setup error:', error.message);
        }

        // Initialize application
        console.log('‚úÖ PhysioTech Application loaded successfully');
        console.log('üìß Admin login: DhariBmi@gmail.com / Dharui1979');
        console.log('üë©‚Äç‚öïÔ∏è Physiotherapist login: Mariambmi@gmail.com / Mariam1979!');

        // Data Store - Clean system with only Dr. Mariam Abdulatheem Ali
        const appData = {
            patients: [],
            appointments: [],
            physiotherapists: [
                {
                    id: 'physio-001',
                    firstName: 'Mariam',
                    lastName: 'Abdulatheem Ali',
                    email: 'Mariambmi@gmail.com',
                    phone: '+973 3333 9999',
                    licenseNumber: 'BH-PT-2024-001',
                    specializations: ['Orthopedic', 'Sports Medicine', 'Manual Therapy'],
                    experience: '8 years',
                    status: 'active',
                    assignedPatients: 0
                }
            ]
        };

        // Utility Functions
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">Cancel</button>
                        <button class="confirm-btn px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            const cancelBtn = modal.querySelector('.cancel-btn');
            const confirmBtn = modal.querySelector('.confirm-btn');
            
            cancelBtn.onclick = () => modal.remove();
            confirmBtn.onclick = () => {
                modal.remove();
                if (typeof onConfirm === 'function') onConfirm();
            };
        }

        // Login Functions
        document.getElementById('adminLoginBtn').onclick = () => {
            document.getElementById('userTypeSelection').classList.add('hidden');
            document.getElementById('adminLoginPage').classList.remove('hidden');
        };

        document.getElementById('physioLoginBtn').onclick = () => {
            document.getElementById('userTypeSelection').classList.add('hidden');
            document.getElementById('physioLoginPage').classList.remove('hidden');
        };

        document.getElementById('backToSelection').onclick = () => {
            document.getElementById('physioLoginPage').classList.add('hidden');
            document.getElementById('userTypeSelection').classList.remove('hidden');
        };

        document.getElementById('backToSelectionFromAdmin').onclick = () => {
            document.getElementById('adminLoginPage').classList.add('hidden');
            document.getElementById('userTypeSelection').classList.remove('hidden');
        };

        document.getElementById('togglePassword').onclick = function() {
            const passwordInput = document.getElementById('loginPassword');
            const icon = this.querySelector('i');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        };

        document.getElementById('togglePhysioPassword').onclick = function() {
            const passwordInput = document.getElementById('physioLoginPassword');
            const icon = this.querySelector('i');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        };

        // Login handlers
        document.getElementById('loginForm').onsubmit = (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');

            if (email === 'DhariBmi@gmail.com' && password === 'Dharui1979') {
                document.getElementById('adminLoginPage').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                setTimeout(() => {
                    initializeDashboard();
                    setupNavigation();
                }, 100);
                showNotification('‚úÖ Admin login successful!', 'success');
            } else {
                errorDiv.textContent = '‚ùå Invalid credentials. Use: DhariBmi@gmail.com / Dharui1979';
                errorDiv.classList.remove('hidden');
                setTimeout(() => errorDiv.classList.add('hidden'), 5000);
            }
        };

        document.getElementById('physioLoginForm').onsubmit = (e) => {
            e.preventDefault();
            const email = document.getElementById('physioLoginEmail').value.trim();
            const password = document.getElementById('physioLoginPassword').value;
            const errorDiv = document.getElementById('physioLoginError');

            if (email === 'Mariambmi@gmail.com' && password === 'Mariam1979!') {
                document.getElementById('physioLoginPage').classList.add('hidden');
                document.getElementById('physioDashboard').classList.remove('hidden');
                setTimeout(() => initializePhysioDashboard(), 100);
                showNotification('‚úÖ Welcome back, Dr. Mariam!', 'success');
            } else {
                errorDiv.textContent = '‚ùå Invalid credentials. Use: Mariambmi@gmail.com / Mariam1979!';
                errorDiv.classList.remove('hidden');
                setTimeout(() => errorDiv.classList.add('hidden'), 5000);
            }
        };

        // Logout handlers
        document.getElementById('adminLogoutBtn').onclick = () => {
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('userTypeSelection').classList.remove('hidden');
            showNotification('üëã Logged out successfully', 'success');
        };

        document.getElementById('physioLogoutBtn').onclick = () => {
            document.getElementById('physioDashboard').classList.add('hidden');
            document.getElementById('userTypeSelection').classList.remove('hidden');
            showNotification('üëã Logged out successfully', 'success');
        };

        // Navigation
        function setupNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.onclick = () => {
                    const view = btn.dataset.view;
                    showView(view);
                    document.querySelectorAll('.nav-btn').forEach(b => {
                        b.classList.remove('bg-primary', 'text-white');
                    });
                    btn.classList.add('bg-primary', 'text-white');
                };
            });
        }

        function showView(viewName) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            const targetView = document.getElementById(viewName);
            if (targetView) {
                targetView.classList.remove('hidden');
                if (viewName === 'patients') {
                    updatePatientsDisplay();
                }
                if (viewName === 'appointments') {
                    updateAppointmentDisplay();
                }
                if (viewName === 'physiotherapists') {
                    updatePhysiotherapistsDisplay();
                }
            }
        }

        // Dashboard Functions
        function initializeDashboard() {
            updateDashboardStats();
            console.log('üìä Dashboard initialized successfully');
        }

        function updateDashboardStats() {
            const patients = appData.patients || [];
            const totalPatientsEl = document.getElementById('totalPatientsCount');
            if (totalPatientsEl) {
                totalPatientsEl.textContent = patients.length;
            }
            const patientCountEl = document.getElementById('patientCount');
            if (patientCountEl) {
                patientCountEl.textContent = `Total: ${patients.length} patient${patients.length !== 1 ? 's' : ''}`;
            }
        }

        // Patient Management
        function updatePatientsDisplay() {
            const patients = appData.patients || [];
            const gridContainer = document.getElementById('patientsGridContainer');
            const emptyState = document.getElementById('noPatientsFound');
            const patientCountEl = document.getElementById('patientCount');

            if (patientCountEl) {
                patientCountEl.textContent = `Total: ${patients.length} patient${patients.length !== 1 ? 's' : ''}`;
            }

            if (patients.length === 0) {
                if (gridContainer) gridContainer.innerHTML = '';
                if (emptyState) emptyState.style.display = 'block';
            } else {
                if (emptyState) emptyState.style.display = 'none';
                
                if (gridContainer) {
                    gridContainer.innerHTML = patients.map(patient => `
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-primary rounded-full flex items-center justify-center text-white font-bold mr-3">
                                        ${patient.firstName.charAt(0)}${patient.lastName.charAt(0)}
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                            ${patient.firstName} ${patient.lastName}
                                        </h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            CPR: ${patient.cprNumber}
                                        </p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 ${patient.treatmentStatus === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} rounded-full text-xs font-semibold">
                                    ${(patient.treatmentStatus || 'Active').charAt(0).toUpperCase() + (patient.treatmentStatus || 'active').slice(1)}
                                </span>
                            </div>

                            <div class="space-y-2 mb-4">
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-envelope w-5 mr-2"></i>
                                    <span>${patient.email}</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-phone w-5 mr-2"></i>
                                    <span>${patient.phone}</span>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">
                                    <strong>Current Condition:</strong>
                                </p>
                                <p class="text-sm text-gray-600 dark:text-gray-400">
                                    ${patient.currentCondition}
                                </p>
                            </div>

                            <div class="flex gap-2 mt-4">
                                <button onclick="viewPatientDetails('${patient.id}')" class="flex-1 bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-colors text-sm">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                <button onclick="editPatient('${patient.id}')" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                                <button onclick="deletePatientWithConfirm('${patient.id}')" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                    <i class="fas fa-trash mr-1"></i>Delete
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            }
            updateDashboardStats();
        }

        function showAddPatientModal() {
            const content = `
                <form id="addPatientForm" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-user text-teal-400 mr-2"></i>Personal Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">First Name *</label>
                                <input type="text" id="firstName" name="firstName" required placeholder="Enter first name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Last Name *</label>
                                <input type="text" id="lastName" name="lastName" required placeholder="Enter last name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" required placeholder="+973 XXXX XXXX" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">CPR Number *</label>
                                <input type="text" id="cprNumber" name="cprNumber" required placeholder="000000000" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date of Birth *</label>
                                <input type="date" id="dateOfBirth" name="dateOfBirth" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Gender *</label>
                                <select id="gender" name="gender" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
                            <textarea id="address" name="address" rows="3" placeholder="Full Address" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-phone text-teal-400 mr-2"></i>Contact Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                                <input type="email" id="email" name="email" placeholder="patient@example.com" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Alternative Phone</label>
                                <input type="tel" id="altPhone" name="altPhone" placeholder="+973 XXXX XXXX" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Medical History -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-notes-medical text-teal-400 mr-2"></i>Medical History & Current Condition
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Medical History</label>
                            <textarea id="medicalHistory" name="medicalHistory" rows="3" placeholder="Describe medical history, allergies, or previous treatments..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Current Condition *</label>
                            <textarea id="currentCondition" name="currentCondition" rows="3" required placeholder="Describe the patient's current condition, symptoms, and reason for treatment..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Emergency Contact Name</label>
                                <input type="text" id="emergencyContactName" name="emergencyContactName" placeholder="Emergency contact full name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Emergency Contact Phone</label>
                                <input type="tel" id="emergencyContactPhone" name="emergencyContactPhone" placeholder="+973 XXXX XXXX" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Assign to Physiotherapist -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-user-md text-teal-400 mr-2"></i>Assign to Physiotherapist/Physiologist
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Select a physiotherapist *</label>
                            <select id="assignedPhysiotherapist" name="assignedPhysiotherapist" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="">Choose physiotherapist to be assigned to this patient</option>
                                ${appData.physiotherapists.map(physio => `
                                    <option value="Dr. ${physio.firstName} ${physio.lastName}">Dr. ${physio.firstName} ${physio.lastName} - ${physio.specializations.join(', ')}</option>
                                `).join('')}
                            </select>
                            <p class="text-xs text-gray-400 mt-1">This patient will appear in the selected physiotherapist's dashboard</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Assignment Notes</label>
                            <textarea id="assignmentNotes" name="assignmentNotes" rows="3" placeholder="Add any specific notes for the assigned physiotherapist..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Treatment Status -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-heartbeat text-teal-400 mr-2"></i>Treatment Status
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Initial Treatment Status</label>
                            <select id="treatmentStatus" name="treatmentStatus" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="active" selected>Active Treatment</option>
                                <option value="assessment">Initial Assessment</option>
                                <option value="planning">Treatment Planning</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>

                    <!-- Patient Sessions -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-calendar text-teal-400 mr-2"></i>Patient Sessions
                        </h4>
                        
                        <div class="bg-gray-700 border border-gray-600 rounded-lg p-6 text-center">
                            <i class="fas fa-calendar-times text-gray-400 text-3xl mb-2"></i>
                            <p class="text-gray-400 text-sm">No sessions yet - Sessions can be scheduled after patient creation</p>
                        </div>
                    </div>

                    <!-- Generate Treatment Document -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-file-medical text-teal-400 mr-2"></i>Generate Treatment Document
                        </h4>
                        
                        <div class="bg-gray-700 border border-gray-600 rounded-lg p-4">
                            <p class="text-sm text-gray-300 mb-3">Create a professional treatment form template</p>
                            <button type="button" onclick="generateTreatmentTemplate()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-file-plus mr-2"></i>Generate Template
                            </button>
                        </div>
                    </div>

                    <!-- Upload Treatment Documents -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-upload text-teal-400 mr-2"></i>Upload Treatment Documents
                        </h4>
                        
                        <div class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center bg-gray-700/50">
                            <i class="fas fa-cloud-upload-alt text-gray-400 text-4xl mb-4"></i>
                            <p class="text-gray-400 mb-2">Upload treatment documents</p>
                            <p class="text-xs text-gray-500 mb-4">PNG, JPG, PDF up to 10MB</p>
                            <button type="button" onclick="uploadTreatmentDocs()" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-folder-open mr-2"></i>Choose Documents
                            </button>
                        </div>
                    </div>

                    <!-- Profile Photo & Patient Video -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Profile Photo -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                                <i class="fas fa-camera text-teal-400 mr-2"></i>Profile Photo
                            </h4>
                            
                            <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                <i class="fas fa-camera text-gray-400 text-2xl mb-2"></i>
                                <p class="text-xs text-gray-500 mb-3">Add patient photo</p>
                                <button type="button" onclick="uploadProfilePhoto()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                    <i class="fas fa-upload mr-1"></i>Upload Photo
                                </button>
                            </div>
                        </div>

                        <!-- Patient Video -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                                <i class="fas fa-video text-teal-400 mr-2"></i>Patient Video
                            </h4>
                            
                            <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                <i class="fas fa-video text-gray-400 text-2xl mb-2"></i>
                                <p class="text-xs text-gray-500 mb-3">Record patient video</p>
                                <button type="button" onclick="uploadPatientVideo()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                    <i class="fas fa-upload mr-1"></i>Upload Video
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            `;
            
            // Create custom modal with dark theme
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-user-plus text-teal-400 mr-2"></i>Add New Patient
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-modal px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-user-plus mr-2"></i>Add Patient
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-modal');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            saveBtn.onclick = () => {
                const form = document.getElementById('addPatientForm');
                const formData = new FormData(form);
                
                // Validate required fields
                const firstName = formData.get('firstName')?.trim();
                const lastName = formData.get('lastName')?.trim();
                const phone = formData.get('phone')?.trim();
                const cprNumber = formData.get('cprNumber')?.trim();
                const dateOfBirth = formData.get('dateOfBirth');
                const gender = formData.get('gender');
                const currentCondition = formData.get('currentCondition')?.trim();
                const assignedPhysiotherapist = formData.get('assignedPhysiotherapist');

                if (!firstName || !lastName || !phone || !cprNumber || !dateOfBirth || !gender || !currentCondition || !assignedPhysiotherapist) {
                    showNotification('‚ö†Ô∏è Please fill in all required fields', 'error');
                    return;
                }

                // Create new patient object
                const newPatient = {
                    id: `patient-${Date.now()}`,
                    firstName,
                    lastName,
                    phone,
                    cprNumber,
                    dateOfBirth,
                    gender,
                    email: formData.get('email')?.trim() || '',
                    altPhone: formData.get('altPhone')?.trim() || '',
                    address: formData.get('address')?.trim() || '',
                    medicalHistory: formData.get('medicalHistory')?.trim() || '',
                    currentCondition,
                    emergencyContactName: formData.get('emergencyContactName')?.trim() || '',
                    emergencyContactPhone: formData.get('emergencyContactPhone')?.trim() || '',
                    assignedPhysiotherapist,
                    assignmentNotes: formData.get('assignmentNotes')?.trim() || '',
                    treatmentStatus: formData.get('treatmentStatus') || 'active',
                    dateRegistered: new Date().toISOString()
                };

                // Add patient to data store
                appData.patients.push(newPatient);
                
                // Update assignedPatients count for the physiotherapist
                const assignedPhysio = appData.physiotherapists.find(p => 
                    `Dr. ${p.firstName} ${p.lastName}` === assignedPhysiotherapist
                );
                if (assignedPhysio) {
                    assignedPhysio.assignedPatients = (assignedPhysio.assignedPatients || 0) + 1;
                }

                // Update displays
                updatePatientsDisplay();
                loadPhysioPatients(); // Update physiotherapist's patient list
                
                showNotification(`‚úÖ Patient ${firstName} ${lastName} registered successfully and assigned to ${assignedPhysiotherapist}!`, 'success');
                closeModal();
            };
        }

        function viewPatientDetails(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`üëÅÔ∏è Viewing ${patient.firstName} ${patient.lastName}`, 'success');
            }
        }

        function editPatient(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`‚úèÔ∏è Editing ${patient.firstName} ${patient.lastName}`, 'success');
            }
        }

        function deletePatientWithConfirm(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showConfirmDialog(
                    `Are you sure you want to delete ${patient.firstName} ${patient.lastName}?`,
                    () => {
                        appData.patients = appData.patients.filter(p => p.id !== patientId);
                        updatePatientsDisplay();
                        showNotification(`‚úÖ Patient ${patient.firstName} ${patient.lastName} deleted`, 'success');
                    }
                );
            }
        }

        // Enhanced Appointment Management
        function updateAppointmentDisplay() {
            const appointments = [...appData.appointments];
            
            const tbody = document.getElementById('appointmentsTableBody');
            
            if (tbody) {
                if (appointments.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                                <i class="fas fa-calendar-times text-4xl mb-4 block"></i>
                                No appointments scheduled yet
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = appointments.map(appointment => {
                        const appointmentDate = new Date(appointment.appointmentDate);
                        const statusColors = {
                            'scheduled': 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300',
                            'confirmed': 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300',
                            'completed': 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300',
                            'cancelled': 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300'
                        };

                        return `
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900 dark:text-white">
                                        ${appointmentDate.toLocaleDateString('en-GB')}
                                    </div>
                                    <div class="text-sm text-gray-500 dark:text-gray-400">
                                        ${appointmentDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center mr-3 text-xs font-bold">
                                            ${appointment.patientName.split(' ').map(n => n[0]).join('')}
                                        </div>
                                        <div class="text-sm font-medium text-gray-900 dark:text-white">
                                            ${appointment.patientName}
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900 dark:text-white">
                                        ${appointment.physiotherapistName}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900 dark:text-white">
                                        ${appointment.treatmentType}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900 dark:text-white">
                                        ${appointment.duration} min
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusColors[appointment.status]}">
                                        ${appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1)}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <div class="flex space-x-2">
                                        <button onclick="viewAppointment('${appointment.id}')" class="text-blue-600 hover:text-blue-900 p-1 rounded" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="editAppointment('${appointment.id}')" class="text-yellow-600 hover:text-yellow-900 p-1 rounded" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="confirmAppointment('${appointment.id}')" class="text-green-600 hover:text-green-900 p-1 rounded" title="Confirm">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button onclick="cancelAppointment('${appointment.id}')" class="text-red-600 hover:text-red-900 p-1 rounded" title="Cancel">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            }
        }

        function showScheduleAppointmentModal() {
            const content = `
                <form id="scheduleAppointmentForm" class="space-y-8">
                    <!-- Patient Selection Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-user text-primary mr-2"></i>Patient Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Patient *</label>
                                <select required id="patientSelect" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Choose existing patient</option>
                                    <option value="Ahmed Al-Khalifa" data-condition="Chronic lower back pain" data-phone="+973 3333 1111">Ahmed Al-Khalifa - CPR: 900101234</option>
                                    <option value="Fatima Al-Zahra" data-condition="Post-surgical knee rehabilitation" data-phone="+973 3333 3333">Fatima Al-Zahra - CPR: 950505678</option>
                                    <option value="Sara Al-Mahmood" data-condition="Shoulder impingement" data-phone="+973 3333 5555">Sara Al-Mahmood - CPR: 880808888</option>
                                    <option value="new-patient">+ Add New Patient</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Appointment Type</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="regular">Regular Appointment</option>
                                    <option value="follow-up">Follow-up Visit</option>
                                    <option value="consultation">Initial Consultation</option>
                                    <option value="emergency">Emergency Session</option>
                                    <option value="assessment">Re-assessment</option>
                                </select>
                            </div>
                        </div>

                        <!-- Patient Quick Info Display -->
                        <div id="selectedPatientInfo" class="mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 hidden">
                            <div class="flex items-center">
                                <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                                <div>
                                    <p class="text-sm font-medium text-blue-900 dark:text-blue-100">Selected Patient Details</p>
                                    <p class="text-sm text-blue-700 dark:text-blue-300" id="patientInfoText"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Staff & Resources Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-user-md text-secondary mr-2"></i>Staff & Resources Assignment
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Physiotherapist *</label>
                                <select required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Select Physiotherapist</option>
                                    <option value="Dr. Mariam Abdulatheem Ali" data-specialization="Orthopedic, Sports Medicine">Dr. Mariam Abdulatheem Ali</option>
                                    <option value="Dr. Ahmad Al-Rashid" data-specialization="Pediatric, Neurological">Dr. Ahmad Al-Rashid</option>
                                    <option value="Dr. Sara Mohammed" data-specialization="Women's Health, Pelvic Floor">Dr. Sara Mohammed</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Treatment Room</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Auto-assign room</option>
                                    <option value="room-1">Treatment Room 1 (General)</option>
                                    <option value="room-2">Treatment Room 2 (Specialized)</option>
                                    <option value="room-3">Exercise Room 3 (Group)</option>
                                    <option value="room-4">Hydrotherapy Pool</option>
                                    <option value="room-5">Private Suite</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Assistant Required</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">No assistant needed</option>
                                    <option value="physiotherapy-assistant">Physiotherapy Assistant</option>
                                    <option value="sports-therapist">Sports Therapist</option>
                                    <option value="rehabilitation-nurse">Rehabilitation Nurse</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Scheduling Details Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-calendar-alt text-blue-600 mr-2"></i>Scheduling Details
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Appointment Date *</label>
                                <input type="date" required min="${new Date().toISOString().split('T')[0]}" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Start Time *</label>
                                <select required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Select Time</option>
                                    <option value="08:00" data-available="true">08:00 AM - Available</option>
                                    <option value="08:30" data-available="false">08:30 AM - Occupied</option>
                                    <option value="09:00" data-available="true">09:00 AM - Available</option>
                                    <option value="09:30" data-available="true">09:30 AM - Available</option>
                                    <option value="10:00" data-available="false">10:00 AM - Occupied</option>
                                    <option value="10:30" data-available="true">10:30 AM - Available</option>
                                    <option value="11:00" data-available="true">11:00 AM - Available</option>
                                    <option value="11:30" data-available="false">11:30 AM - Occupied</option>
                                    <option value="14:00" data-available="true">02:00 PM - Available</option>
                                    <option value="14:30" data-available="true">02:30 PM - Available</option>
                                    <option value="15:00" data-available="true">03:00 PM - Available</option>
                                    <option value="15:30" data-available="true">03:30 PM - Available</option>
                                    <option value="16:00" data-available="true">04:00 PM - Available</option>
                                    <option value="16:30" data-available="true">04:30 PM - Available</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Session Duration *</label>
                                <select required id="durationSelect" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Select Duration</option>
                                    <option value="30" data-cost="25">30 minutes - BD 25</option>
                                    <option value="45" data-cost="35">45 minutes - BD 35</option>
                                    <option value="60" data-cost="45">60 minutes - BD 45</option>
                                    <option value="90" data-cost="65">90 minutes - BD 65</option>
                                    <option value="120" data-cost="80">120 minutes - BD 80</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Appointment Priority</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="routine">Routine</option>
                                    <option value="urgent">Urgent</option>
                                    <option value="emergency">Emergency</option>
                                    <option value="follow-up">Follow-up Required</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Recurring Appointment</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">No recurrence</option>
                                    <option value="weekly">Weekly (same time)</option>
                                    <option value="biweekly">Every 2 weeks</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="custom">Custom schedule</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Treatment Details Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-stethoscope text-green-600 mr-2"></i>Treatment & Session Details
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Treatment Type *</label>
                                <select required class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Select Treatment Type</option>
                                    <optgroup label="Assessment & Evaluation">
                                        <option value="initial-assessment">Initial Assessment</option>
                                        <option value="follow-up-assessment">Follow-up Assessment</option>
                                        <option value="progress-evaluation">Progress Evaluation</option>
                                        <option value="discharge-planning">Discharge Planning</option>
                                    </optgroup>
                                    <optgroup label="Therapeutic Treatments">
                                        <option value="manual-therapy">Manual Therapy</option>
                                        <option value="exercise-therapy">Exercise Therapy</option>
                                        <option value="electrotherapy">Electrotherapy</option>
                                        <option value="hydrotherapy">Hydrotherapy</option>
                                        <option value="massage-therapy">Therapeutic Massage</option>
                                    </optgroup>
                                    <optgroup label="Specialized Treatments">
                                        <option value="back-pain-therapy">Back Pain Therapy</option>
                                        <option value="neck-therapy">Neck & Cervical Therapy</option>
                                        <option value="knee-rehabilitation">Knee Rehabilitation</option>
                                        <option value="shoulder-therapy">Shoulder Therapy</option>
                                        <option value="ankle-rehabilitation">Ankle Rehabilitation</option>
                                        <option value="hip-therapy">Hip Therapy</option>
                                        <option value="sports-rehabilitation">Sports Rehabilitation</option>
                                        <option value="post-surgical-rehab">Post-Surgical Rehabilitation</option>
                                    </optgroup>
                                    <optgroup label="Specialized Programs">
                                        <option value="balance-training">Balance & Coordination Training</option>
                                        <option value="gait-training">Gait Training</option>
                                        <option value="pain-management">Chronic Pain Management</option>
                                        <option value="posture-correction">Posture Correction</option>
                                        <option value="workplace-ergonomics">Workplace Ergonomics</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Treatment Category</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Select Category</option>
                                    <option value="orthopedic">Orthopedic</option>
                                    <option value="neurological">Neurological</option>
                                    <option value="pediatric">Pediatric</option>
                                    <option value="geriatric">Geriatric</option>
                                    <option value="sports">Sports Medicine</option>
                                    <option value="womens-health">Women's Health</option>
                                    <option value="cardiac">Cardiac Rehabilitation</option>
                                    <option value="respiratory">Respiratory</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Primary Focus Area</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Select Focus Area</option>
                                    <option value="pain-relief">Pain Relief</option>
                                    <option value="strength-building">Strength Building</option>
                                    <option value="flexibility-improvement">Flexibility Improvement</option>
                                    <option value="balance-coordination">Balance & Coordination</option>
                                    <option value="functional-movement">Functional Movement</option>
                                    <option value="mobility-restoration">Mobility Restoration</option>
                                    <option value="injury-prevention">Injury Prevention</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Session Intensity</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="light">Light Intensity</option>
                                    <option value="moderate" selected>Moderate Intensity</option>
                                    <option value="high">High Intensity</option>
                                    <option value="variable">Variable Intensity</option>
                                </select>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Session Goals & Objectives</label>
                            <textarea rows="3" placeholder="Specific goals for this session, expected outcomes, therapeutic objectives..." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary"></textarea>
                        </div>
                    </div>

                    <!-- Equipment & Special Requirements Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-tools text-purple-600 mr-2"></i>Equipment & Special Requirements
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Required Equipment</label>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Exercise Mat & Pillows</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Resistance Bands & Weights</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Ultrasound Machine</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">TENS Unit</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Balance Training Equipment</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Hydrotherapy Pool Access</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Special Accommodations</label>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Wheelchair Accessibility</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Language Interpreter</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Private Treatment Room</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Extended Rest Periods</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Family Member Present</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Special Equipment Notes</label>
                            <textarea rows="2" placeholder="Any specific equipment requirements, setup instructions, or accessibility needs..." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary"></textarea>
                        </div>
                    </div>

                    <!-- Medical Considerations Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-heartbeat text-red-600 mr-2"></i>Medical Considerations & Safety
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Pre-session Requirements</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">No special requirements</option>
                                    <option value="medical-clearance">Medical Clearance Required</option>
                                    <option value="pain-assessment">Pain Level Assessment</option>
                                    <option value="vitals-check">Vital Signs Check</option>
                                    <option value="range-motion-test">Range of Motion Test</option>
                                    <option value="strength-assessment">Strength Assessment</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Medical Precautions</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Standard precautions</option>
                                    <option value="cardiac-monitoring">Cardiac Monitoring</option>
                                    <option value="blood-pressure-watch">Blood Pressure Monitoring</option>
                                    <option value="fall-risk">Fall Risk Precautions</option>
                                    <option value="infection-control">Enhanced Infection Control</option>
                                    <option value="pain-monitoring">Continuous Pain Monitoring</option>
                                </select>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Contraindications & Warnings</label>
                            <textarea rows="2" placeholder="Any medical contraindications, movement restrictions, or safety warnings for this session..." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary"></textarea>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Expected Pain Level During Session</label>
                            <div class="flex items-center space-x-4">
                                <input type="range" min="0" max="10" value="3" class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="expectedPainLevel">
                                <span class="text-lg font-bold text-gray-900 dark:text-white min-w-[2rem]" id="expectedPainValue">3</span>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>No discomfort expected</span>
                                <span>Significant discomfort expected</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payment & Insurance Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-credit-card text-green-600 mr-2"></i>Payment & Insurance Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Method</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">Select Payment Method</option>
                                    <option value="insurance">Insurance Coverage</option>
                                    <option value="cash">Cash Payment</option>
                                    <option value="card">Credit/Debit Card</option>
                                    <option value="bank-transfer">Bank Transfer</option>
                                    <option value="company-billing">Company Billing</option>
                                    <option value="payment-plan">Payment Plan</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Insurance Verification</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="verified">Insurance Verified ‚úì</option>
                                    <option value="pending">Verification Pending</option>
                                    <option value="not-covered">Not Covered</option>
                                    <option value="partial-coverage">Partial Coverage</option>
                                    <option value="requires-approval">Requires Pre-approval</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Estimated Cost</label>
                                <div class="relative">
                                    <input type="text" readonly value="BD 35.00" class="w-full px-4 py-3 pl-12 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white text-base">
                                    <span class="absolute left-4 top-4 text-gray-500">BD</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                <div>
                                    <p class="text-sm font-medium text-green-900 dark:text-green-100">Insurance Coverage Status</p>
                                    <p class="text-sm text-green-700 dark:text-green-300">This treatment is covered under the patient's current insurance plan with BD 5.00 co-payment.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communication & Notifications Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-bell text-yellow-600 mr-2"></i>Communication & Reminders
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Notification Preferences</label>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Send Appointment Confirmation</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">24-Hour Reminder</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">2-Hour Reminder</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Post-Session Follow-up</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Reminder Method</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary mb-4">
                                    <option value="both">SMS + Email</option>
                                    <option value="sms">SMS Only</option>
                                    <option value="email">Email Only</option>
                                    <option value="phone">Phone Call</option>
                                    <option value="whatsapp">WhatsApp Message</option>
                                </select>
                                
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Language for Communications</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="english">English</option>
                                    <option value="arabic">Arabic</option>
                                    <option value="hindi">Hindi</option>
                                    <option value="urdu">Urdu</option>
                                    <option value="tagalog">Tagalog</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Documentation & Follow-up Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-clipboard-list text-blue-600 mr-2"></i>Documentation & Follow-up Planning
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Documentation Requirements</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="standard">Standard Documentation</option>
                                    <option value="detailed">Detailed Progress Notes</option>
                                    <option value="insurance-report">Insurance Report Required</option>
                                    <option value="legal-documentation">Legal Documentation</option>
                                    <option value="research-data">Research Data Collection</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Progress Tracking Method</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="standard">Standard Tracking</option>
                                    <option value="photos">Progress Photos</option>
                                    <option value="measurements">Detailed Measurements</option>
                                    <option value="functional-tests">Functional Tests</option>
                                    <option value="patient-reported">Patient-Reported Outcomes</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Planned Follow-up</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">No follow-up scheduled</option>
                                    <option value="1-week">1 Week Follow-up</option>
                                    <option value="2-weeks">2 Weeks Follow-up</option>
                                    <option value="1-month">1 Month Follow-up</option>
                                    <option value="as-needed">As Needed Basis</option>
                                    <option value="treatment-plan">Part of Treatment Plan</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Home Exercise Program</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="">No home exercises</option>
                                    <option value="basic">Basic Exercise Plan</option>
                                    <option value="intermediate">Intermediate Program</option>
                                    <option value="advanced">Advanced Program</option>
                                    <option value="custom">Custom Exercise Plan</option>
                                    <option value="maintenance">Maintenance Program</option>
                                </select>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Session Notes & Instructions</label>
                            <textarea rows="4" placeholder="Detailed session plan, treatment goals, special instructions for physiotherapist, patient preparation requirements..." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary"></textarea>
                        </div>
                    </div>

                    <!-- Administrative Details Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-cogs text-gray-600 mr-2"></i>Administrative Details
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Booking Source</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="walk-in">Walk-in</option>
                                    <option value="phone">Phone Booking</option>
                                    <option value="online">Online Booking</option>
                                    <option value="referral">Doctor Referral</option>
                                    <option value="recurring">Recurring Treatment</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Appointment Status</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="scheduled">Scheduled</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="tentative">Tentative</option>
                                    <option value="waitlist">Waitlist</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Created By</label>
                                <input type="text" readonly value="Admin User" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white text-base">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Referral Information</label>
                                <input type="text" placeholder="Referring doctor or source (if applicable)" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Internal Notes</label>
                                <input type="text" placeholder="Internal staff notes (not visible to patient)" class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                            </div>
                        </div>
                    </div>

                    <!-- Pre-appointment Checklist Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-tasks text-orange-600 mr-2"></i>Pre-appointment Preparation
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Patient Preparation Required</label>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Wear comfortable clothing</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Bring previous medical reports</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Arrive 15 minutes early</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Bring insurance card</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Fast for 2 hours (if required)</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Staff Preparation Required</label>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Review patient file</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Prepare specialized equipment</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Setup treatment room</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mr-3">
                                        <span class="text-sm text-gray-700 dark:text-gray-300">Coordinate with other departments</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Special Preparation Instructions</label>
                            <textarea rows="3" placeholder="Any special preparation instructions for patient or staff, medical clearance requirements, coordination with other healthcare providers..." class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary"></textarea>
                        </div>
                    </div>

                    <!-- Treatment Plan Integration Section -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-route text-purple-600 mr-2"></i>Treatment Plan Integration
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Session Number</label>
                                <div class="relative">
                                    <input type="number" min="1" max="50" placeholder="1" class="w-full px-4 py-3 pr-16 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <span class="absolute right-4 top-4 text-gray-500 text-sm">of 12</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Treatment Phase</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="initial">Initial Phase</option>
                                    <option value="intermediate">Intermediate Phase</option>
                                    <option value="advanced">Advanced Phase</option>
                                    <option value="maintenance">Maintenance Phase</option>
                                    <option value="discharge-prep">Discharge Preparation</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Expected Outcome</label>
                                <select class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base focus:ring-2 focus:ring-primary focus:border-primary">
                                    <option value="pain-reduction">Pain Reduction</option>
                                    <option value="mobility-improvement">Mobility Improvement</option>
                                    <option value="strength-gain">Strength Gain</option>
                                    <option value="functional-improvement">Functional Improvement</option>
                                    <option value="maintenance">Status Maintenance</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Appointment Summary & Confirmation -->
                    <div class="bg-gradient-to-r from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 rounded-lg p-6 border border-blue-200 dark:border-blue-800">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-clipboard-check text-green-600 mr-2"></i>Appointment Summary & Confirmation
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Estimated Duration:</span>
                                    <span class="text-sm font-semibold text-gray-900 dark:text-white" id="summaryDuration">45 minutes</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Session Cost:</span>
                                    <span class="text-sm font-semibold text-green-600" id="summaryCost">BD 35.00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Insurance Coverage:</span>
                                    <span class="text-sm font-semibold text-blue-600" id="summaryInsurance">BD 30.00</span>
                                </div>
                                <div class="flex justify-between border-t pt-2">
                                    <span class="text-sm font-semibold text-gray-900 dark:text-white">Patient Pays:</span>
                                    <span class="text-sm font-bold text-primary" id="summaryPatientCost">BD 5.00</span>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Room Setup Time:</span>
                                    <span class="text-sm font-semibold text-gray-900 dark:text-white">10 minutes</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Documentation Time:</span>
                                    <span class="text-sm font-semibold text-gray-900 dark:text-white">15 minutes</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Total Blocked Time:</span>
                                    <span class="text-sm font-semibold text-gray-900 dark:text-white" id="summaryTotalTime">70 minutes</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="mt-6 pt-4 border-t border-blue-200 dark:border-blue-700">
                            <div class="flex flex-wrap gap-3">
                                <button type="button" onclick="checkAvailability()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                    <i class="fas fa-search mr-1"></i>Check Availability
                                </button>
                                <button type="button" onclick="suggestAlternativeTimes()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm">
                                    <i class="fas fa-clock mr-1"></i>Suggest Times
                                </button>
                                <button type="button" onclick="addToWaitlist()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                    <i class="fas fa-list mr-1"></i>Add to Waitlist
                                </button>
                                <button type="button" onclick="scheduleRecurring()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                    <i class="fas fa-repeat mr-1"></i>Recurring Setup
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Final Confirmations -->
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-6">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                            <i class="fas fa-check-double text-green-600 mr-2"></i>Final Confirmations
                        </h4>
                        
                        <div class="space-y-4">
                            <label class="flex items-start">
                                <input type="checkbox" required class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mt-0.5 mr-3">
                                <span class="text-sm text-gray-700 dark:text-gray-300">
                                    <strong>Schedule Confirmation:</strong> I confirm that all appointment details are accurate and the time slot is available. *
                                </span>
                            </label>
                            
                            <label class="flex items-start">
                                <input type="checkbox" checked class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mt-0.5 mr-3">
                                <span class="text-sm text-gray-700 dark:text-gray-300">
                                    <strong>Patient Notification:</strong> Send appointment confirmation and preparation instructions to patient via preferred communication method.
                                </span>
                            </label>
                            
                            <label class="flex items-start">
                                <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mt-0.5 mr-3">
                                <span class="text-sm text-gray-700 dark:text-gray-300">
                                    <strong>Calendar Integration:</strong> Add appointment to physiotherapist's calendar and sync with clinic scheduling system.
                                </span>
                            </label>
                            
                            <label class="flex items-start">
                                <input type="checkbox" class="w-5 h-5 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary focus:ring-2 mt-0.5 mr-3">
                                <span class="text-sm text-gray-700 dark:text-gray-300">
                                    <strong>Resource Booking:</strong> Reserve treatment room and book required equipment for the scheduled time.
                                </span>
                            </label>
                        </div>

                        <!-- Important Notice -->
                        <div class="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800">
                            <div class="flex items-start">
                                <i class="fas fa-exclamation-triangle text-yellow-600 mt-0.5 mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-yellow-900 dark:text-yellow-100">Appointment Scheduling Notice</h5>
                                    <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">
                                        Please ensure all patient information is up-to-date and verify insurance coverage before confirming the appointment. 
                                        Cancellations require at least 24 hours notice to avoid charges.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            `;
            
            showModal('Schedule New Appointment - Comprehensive Booking', content, () => {
                showNotification('‚úÖ Appointment scheduled successfully with all details confirmed!', 'success');
                updateAppointmentDisplay();
            });

            // Add interactive functionality after modal loads
            setTimeout(() => {
                // Patient selection change handler
                const patientSelect = document.getElementById('patientSelect');
                const patientInfo = document.getElementById('selectedPatientInfo');
                const patientInfoText = document.getElementById('patientInfoText');

                if (patientSelect) {
                    patientSelect.addEventListener('change', function() {
                        if (this.value && this.value !== 'new-patient') {
                            const selectedOption = this.options[this.selectedIndex];
                            const condition = selectedOption.dataset.condition;
                            const phone = selectedOption.dataset.phone;
                            
                            patientInfoText.textContent = `Condition: ${condition} | Phone: ${phone}`;
                            patientInfo.classList.remove('hidden');
                        } else if (this.value === 'new-patient') {
                            showNotification('üÜï Redirecting to new patient registration...', 'success');
                            setTimeout(() => {
                                document.querySelector('.close-modal').click();
                                showAddPatientModal();
                            }, 1000);
                        } else {
                            patientInfo.classList.add('hidden');
                        }
                    });
                }

                // Duration change handler for cost calculation
                const durationSelect = document.getElementById('durationSelect');
                const summaryCost = document.getElementById('summaryCost');
                const summaryDuration = document.getElementById('summaryDuration');
                const summaryTotalTime = document.getElementById('summaryTotalTime');

                if (durationSelect) {
                    durationSelect.addEventListener('change', function() {
                        if (this.value) {
                            const selectedOption = this.options[this.selectedIndex];
                            const cost = selectedOption.dataset.cost;
                            const duration = parseInt(this.value);
                            
                            if (summaryCost) summaryCost.textContent = `BD ${cost}.00`;
                            if (summaryDuration) summaryDuration.textContent = `${duration} minutes`;
                            if (summaryTotalTime) summaryTotalTime.textContent = `${duration + 25} minutes`; // Include setup and documentation time
                        }
                    });
                }

                // Pain level slider
                const painSlider = document.getElementById('expectedPainLevel');
                const painValue = document.getElementById('expectedPainValue');

                if (painSlider && painValue) {
                    painSlider.addEventListener('input', () => {
                        painValue.textContent = painSlider.value;
                    });
                }

                // Time slot availability checking
                const timeSelects = document.querySelectorAll('select');
                timeSelects.forEach(select => {
                    if (select.querySelector('[data-available]')) {
                        select.addEventListener('change', function() {
                            const selectedOption = this.options[this.selectedIndex];
                            if (selectedOption && selectedOption.dataset.available === 'false') {
                                showNotification('‚ö†Ô∏è This time slot is occupied. Please select an available time.', 'error');
                                this.value = '';
                            }
                        });
                    }
                });
            }, 100);
        }

        function viewAppointment(appointmentId) {
            showNotification('üëÅÔ∏è View appointment details coming soon!', 'success');
        }

        function editAppointment(appointmentId) {
            showNotification('‚úèÔ∏è Edit appointment coming soon!', 'success');
        }

        function deleteAppointment(appointmentId) {
            showNotification('üóëÔ∏è Delete appointment coming soon!', 'success');
        }

        // Physiotherapist Management
        function updatePhysiotherapistsDisplay() {
            const physiotherapists = appData.physiotherapists || [];
            const gridContainer = document.getElementById('physiotherapistsGridContainer');
            const emptyState = document.getElementById('noPhysiotherapistsFound');

            if (physiotherapists.length === 0) {
                if (gridContainer) gridContainer.innerHTML = '';
                if (emptyState) emptyState.style.display = 'block';
            } else {
                if (emptyState) emptyState.style.display = 'none';
                
                if (gridContainer) {
                    gridContainer.innerHTML = physiotherapists.map(physio => `
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-secondary rounded-full flex items-center justify-center text-white font-bold mr-3">
                                        ${physio.firstName.charAt(0)}${physio.lastName.charAt(0)}
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                            Dr. ${physio.firstName} ${physio.lastName}
                                        </h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            License: ${physio.licenseNumber}
                                        </p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 ${physio.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} rounded-full text-xs font-semibold">
                                    ${physio.status.charAt(0).toUpperCase() + physio.status.slice(1)}
                                </span>
                            </div>

                            <div class="space-y-2 mb-4">
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-envelope w-5 mr-2"></i>
                                    <span>${physio.email}</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-phone w-5 mr-2"></i>
                                    <span>${physio.phone}</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-briefcase w-5 mr-2"></i>
                                    <span>${physio.experience} experience</span>
                                </div>
                            </div>

                            <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-2">
                                    <strong>Specializations:</strong>
                                </p>
                                <div class="flex flex-wrap gap-1">
                                    ${physio.specializations.map(spec => `
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                                            ${spec}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="flex gap-2 mt-4">
                                <button onclick="viewPhysioDetails('${physio.id}')" class="flex-1 bg-secondary text-white px-4 py-2 rounded-lg hover:bg-sage transition-colors text-sm">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                <button onclick="editPhysio('${physio.id}')" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                    <i class="fas fa-edit mr-1"></i>Edit
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        function showAddPhysiotherapistModal() {
            const content = `
                <form id="addPhysiotherapistForm" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-user text-teal-400 mr-2"></i>Personal Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Title *</label>
                                <select required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select title...</option>
                                    <option value="Dr.">Dr.</option>
                                    <option value="Mr.">Mr.</option>
                                    <option value="Ms.">Ms.</option>
                                    <option value="Mrs.">Mrs.</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">First Name *</label>
                                <input type="text" required placeholder="Enter first name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Last Name *</label>
                                <input type="text" required placeholder="Enter last name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date of Birth</label>
                                <input type="date" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Gender</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select gender...</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">CPR/ID Number</label>
                                <input type="text" placeholder="Enter CPR/ID number" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Nationality</label>
                            <input type="text" placeholder="e.g., Bahraini, Indian, Filipino" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-phone text-teal-400 mr-2"></i>Contact Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Email *</label>
                                <input type="email" required placeholder="physiotherapist@email.com" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Secondary Email</label>
                                <input type="email" placeholder="personal@email.com" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Phone *</label>
                                <input type="tel" required placeholder="97123456" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">WhatsApp Number</label>
                                <input type="tel" placeholder="97123456" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
                            <textarea rows="3" placeholder="Full residential address" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                    </div>

                    <!-- Professional Credentials -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-certificate text-teal-400 mr-2"></i>Professional Credentials
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">License Number *</label>
                                <input type="text" required placeholder="PT-2024-XXX" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">License Expiry Date</label>
                                <input type="date" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Years of Experience *</label>
                                <input type="number" required min="0" max="50" placeholder="5" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Registration Body</label>
                                <input type="text" placeholder="e.g., National Health Regulatory Authority" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Degree/Qualification</label>
                                <input type="text" placeholder="e.g., Bachelor of Physiotherapy" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">University/Institution</label>
                                <input type="text" placeholder="e.g., University of Bahrain" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Specializations & Skills -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-stethoscope text-teal-400 mr-2"></i>Specializations & Skills
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Primary Specializations *</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Orthopedic</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Sports Medicine</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Neurological</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Pediatric</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Geriatric</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Manual Therapy</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Cardiopulmonary</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Women's Health</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Aquatic Therapy</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Languages Spoken</label>
                                <input type="text" placeholder="e.g., English, Arabic, Hindi" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Additional Certifications</label>
                                <input type="text" placeholder="e.g., Dry Needling, McKenzie Method" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Employment Details -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-briefcase text-teal-400 mr-2"></i>Employment Details
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Employment Type *</label>
                                <select required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select type...</option>
                                    <option value="full-time">Full Time</option>
                                    <option value="part-time">Part Time</option>
                                    <option value="contract">Contract</option>
                                    <option value="consultant">Consultant</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Position *</label>
                                <select required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select position...</option>
                                    <option value="senior">Senior Physiotherapist</option>
                                    <option value="junior">Junior Physiotherapist</option>
                                    <option value="specialist">Specialist Physiotherapist</option>
                                    <option value="lead">Lead Physiotherapist</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Department</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select department...</option>
                                    <option value="outpatient">Outpatient Services</option>
                                    <option value="inpatient">Inpatient Services</option>
                                    <option value="sports">Sports Medicine</option>
                                    <option value="pediatric">Pediatric Unit</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Start Date *</label>
                                <input type="date" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Hourly Rate</label>
                                <div class="relative">
                                    <input type="number" step="0.01" placeholder="25.00" class="w-full px-4 py-3 pl-12 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <span class="absolute left-4 top-4 text-gray-400">BD</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Working Schedule -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-calendar-alt text-teal-400 mr-2"></i>Working Schedule
                        </h4>
                        
                        <div class="space-y-4">
                            <label class="flex items-center">
                                <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Schedule Appointment Slots</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">View Reports</span>
                            </label>
                        </div>

                        <!-- Weekly Schedule Configuration -->
                        <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                            <h5 class="text-sm font-medium text-gray-300 mb-3">Configure default working days and hours:</h5>
                            
                            <div class="space-y-3">
                                <!-- Monday -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                                    <div class="flex items-center">
                                        <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-2">
                                        <span class="text-sm text-gray-300">Monday</span>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-400 mb-1">Start Time</label>
                                        <input type="time" value="09:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-400 mb-1">End Time</label>
                                        <input type="time" value="17:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-400 mb-1">Status</label>
                                        <select class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                            <option value="available">Available</option>
                                            <option value="partial">Partial</option>
                                            <option value="off">Off</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Tuesday -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                                    <div class="flex items-center">
                                        <input type="checkbox" checked class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-2">
                                        <span class="text-sm text-gray-300">Tuesday</span>
                                    </div>
                                    <div>
                                        <input type="time" value="09:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <input type="time" value="17:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <select class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                            <option value="available">Available</option>
                                            <option value="partial">Partial</option>
                                            <option value="off">Off</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Wednesday -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                                    <div class="flex items-center">
                                        <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-2">
                                        <span class="text-sm text-gray-300">Wednesday</span>
                                    </div>
                                    <div>
                                        <input type="time" value="09:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <input type="time" value="17:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <select class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                            <option value="available">Available</option>
                                            <option value="partial">Partial</option>
                                            <option value="off">Off</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Thursday -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                                    <div class="flex items-center">
                                        <input type="checkbox" checked class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-2">
                                        <span class="text-sm text-gray-300">Thursday</span>
                                    </div>
                                    <div>
                                        <input type="time" value="09:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <input type="time" value="17:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <select class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                            <option value="available">Available</option>
                                            <option value="partial">Partial</option>
                                            <option value="off">Off</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Friday -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                                    <div class="flex items-center">
                                        <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-2">
                                        <span class="text-sm text-gray-300">Friday</span>
                                    </div>
                                    <div>
                                        <input type="time" value="14:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <input type="time" value="17:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <select class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                            <option value="available">Available</option>
                                            <option value="partial">Partial</option>
                                            <option value="off">Off</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Saturday -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                                    <div class="flex items-center">
                                        <input type="checkbox" checked class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-2">
                                        <span class="text-sm text-gray-300">Saturday</span>
                                    </div>
                                    <div>
                                        <input type="time" value="09:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <input type="time" value="17:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <select class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                            <option value="available">Available</option>
                                            <option value="partial">Partial</option>
                                            <option value="off">Off</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Sunday -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-center">
                                    <div class="flex items-center">
                                        <input type="checkbox" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 rounded focus:ring-teal-500 focus:ring-2 mr-2">
                                        <span class="text-sm text-gray-300">Sunday</span>
                                    </div>
                                    <div>
                                        <input type="time" value="09:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <input type="time" value="17:00" class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    </div>
                                    <div>
                                        <select class="w-full px-2 py-2 bg-gray-600 border border-gray-500 rounded text-white text-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                            <option value="available">Available</option>
                                            <option value="partial">Partial</option>
                                            <option value="off">Off</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile & Documentation Upload -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-upload text-teal-400 mr-2"></i>Profile & Documentation Upload
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Profile Photo -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-300">Profile Photo</label>
                                <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                    <i class="fas fa-camera text-gray-400 text-2xl mb-2"></i>
                                    <p class="text-xs text-gray-500 mb-3">Upload profile photo</p>
                                    <button type="button" onclick="uploadProfilePhoto()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                        <i class="fas fa-upload mr-1"></i>Upload Photo
                                    </button>
                                </div>
                            </div>

                            <!-- Professional Documents -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-300">Professional Documents</label>
                                <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                    <i class="fas fa-file-upload text-gray-400 text-2xl mb-2"></i>
                                    <p class="text-xs text-gray-500 mb-3">Upload certificates & documents</p>
                                    <button type="button" onclick="uploadProfessionalDocs()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                        <i class="fas fa-folder-open mr-1"></i>Choose Documents
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-teal-600 rounded-lg p-4 text-center">
                            <p class="text-white text-sm font-medium">Weekly Schedule Summary</p>
                            <p class="text-teal-100 text-xs mt-1">5 days available with 40 hours per week</p>
                        </div>
                    </div>

                    <!-- System Access & Permissions -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-key text-teal-400 mr-2"></i>System Access & Permissions
                        </h4>
                        
                        <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                            <h5 class="text-sm font-medium text-gray-300 mb-3">Account Access Level</h5>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="accessLevel" value="basic" checked class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Basic Physiotherapist Access</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="accessLevel" value="advanced" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Advanced Practitioner Access</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="accessLevel" value="admin" class="w-4 h-4 text-teal-500 bg-gray-600 border-gray-500 focus:ring-teal-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Administrative Access</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-sticky-note text-teal-400 mr-2"></i>Additional Information
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Comments</label>
                            <textarea rows="3" placeholder="Any additional information, special requirements, or administrative notes..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Emergency Contact</label>
                            <input type="text" placeholder="Name and contact information for emergency situations" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                        </div>
                    </div>
                </form>
            `;
            
            // Create custom modal with dark theme
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-user-md text-teal-400 mr-2"></i>Add New Physiotherapist
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-modal px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-user-plus mr-2"></i>Add Physiotherapist
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-modal');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            saveBtn.onclick = () => {
                showNotification('‚úÖ New physiotherapist added successfully!', 'success');
                updatePhysiotherapistsDisplay();
                closeModal();
            };
        }

        function viewPhysioDetails(physioId) {
            showNotification('üëÅÔ∏è View physiotherapist details coming soon!', 'success');
        }

        function editPhysio(physioId) {
            showNotification('‚úèÔ∏è Edit physiotherapist coming soon!', 'success');
        }

        // Physiotherapist Dashboard
        function initializePhysioDashboard() {
            setupPhysioNavigation();
            loadPhysioPatients();
            console.log('üë©‚Äç‚öïÔ∏è Physiotherapist dashboard initialized');
        }

        function setupPhysioNavigation() {
            const navButtons = document.querySelectorAll('.physio-nav-btn');
            navButtons.forEach(btn => {
                btn.onclick = () => {
                    const view = btn.dataset.view;
                    showPhysioView(view);
                    document.querySelectorAll('.physio-nav-btn').forEach(b => {
                        b.classList.remove('bg-secondary', 'text-white');
                    });
                    btn.classList.add('bg-secondary', 'text-white');
                };
            });
        }

        function showPhysioView(viewName) {
            document.querySelectorAll('.physio-view').forEach(view => {
                view.classList.add('hidden');
            });
            const targetView = document.getElementById(viewName);
            if (targetView) {
                targetView.classList.remove('hidden');
                if (viewName === 'physio-patients') {
                    loadPhysioPatients();
                }
            }
        }

        function loadPhysioPatients() {
            const patientsGrid = document.getElementById('physioMyPatientsGrid');
            const emptyState = document.getElementById('physioNoPatientsFound');
            const patientCountEl = document.getElementById('physioPatientCount');
            
            const assignedPatients = appData.patients.filter(p => 
                p.assignedPhysiotherapist === 'Dr. Mariam Abdulatheem Ali'
            );

            if (patientCountEl) {
                patientCountEl.textContent = `Assigned: ${assignedPatients.length} patient${assignedPatients.length !== 1 ? 's' : ''}`;
            }

            const physioActivePatientsEl = document.getElementById('physioActivePatients');
            if (physioActivePatientsEl) {
                physioActivePatientsEl.textContent = assignedPatients.length;
            }

            if (assignedPatients.length === 0) {
                if (patientsGrid) patientsGrid.innerHTML = '';
                if (emptyState) emptyState.classList.remove('hidden');
            } else {
                if (emptyState) emptyState.classList.add('hidden');
                
                if (patientsGrid) {
                    patientsGrid.innerHTML = assignedPatients.map(patient => `
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow border-l-4 border-secondary">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-secondary rounded-full flex items-center justify-center text-white font-bold mr-3">
                                        ${patient.firstName.charAt(0)}${patient.lastName.charAt(0)}
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                                            ${patient.firstName} ${patient.lastName}
                                        </h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            CPR: ${patient.cprNumber}
                                        </p>
                                    </div>
                                </div>
                                <span class="px-3 py-1 bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 rounded-full text-xs font-semibold">
                                    ${(patient.treatmentStatus || 'Active').charAt(0).toUpperCase() + (patient.treatmentStatus || 'active').slice(1)}
                                </span>
                            </div>

                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 mb-4">
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-1">
                                    <strong>Current Condition:</strong>
                                </p>
                                <p class="text-sm text-blue-800 dark:text-blue-300">
                                    ${patient.currentCondition}
                                </p>
                            </div>
                            
                            <div class="space-y-2 mb-4">
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-phone w-4 mr-2"></i>
                                    <span>${patient.phone}</span>
                                </div>
                                ${patient.email ? `
                                    <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                        <i class="fas fa-envelope w-4 mr-2"></i>
                                        <span>${patient.email}</span>
                                    </div>
                                ` : ''}
                                <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                                    <i class="fas fa-calendar w-4 mr-2"></i>
                                    <span>Registered: ${new Date(patient.dateRegistered).toLocaleDateString()}</span>
                                </div>
                                ${patient.assignmentNotes ? `
                                    <div class="flex items-start text-sm text-gray-600 dark:text-gray-400">
                                        <i class="fas fa-sticky-note w-4 mr-2 mt-0.5"></i>
                                        <span class="italic">${patient.assignmentNotes}</span>
                                    </div>
                                ` : ''}
                            </div>

                            <div class="flex gap-2">
                                <button onclick="physioViewPatient('${patient.id}')" class="flex-1 bg-secondary text-white px-4 py-2 rounded-lg hover:bg-sage transition-colors text-sm">
                                    <i class="fas fa-eye mr-1"></i>View Details
                                </button>
                                <button onclick="physioUpdateProgress('${patient.id}')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                    <i class="fas fa-chart-line mr-1"></i>Progress
                                </button>
                                <button onclick="physioScheduleSession('${patient.id}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                    <i class="fas fa-calendar-plus mr-1"></i>Schedule
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        function physioViewPatient(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showEditPatientModal(patient, true); // true indicates this is for physiotherapist
            }
        }

        function showEditPatientModal(patient, isPhysiotherapist = false) {
            const userTitle = isPhysiotherapist ? 'Dr. Mariam - Edit Patient' : 'Admin - Edit Patient';
            const content = `
                <form id="editPatientForm" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-user text-teal-400 mr-2"></i>Personal Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">First Name *</label>
                                <input type="text" id="editFirstName" name="firstName" required placeholder="Enter first name" value="${patient.firstName}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Last Name *</label>
                                <input type="text" id="editLastName" name="lastName" required placeholder="Enter last name" value="${patient.lastName}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number *</label>
                                <input type="tel" id="editPhone" name="phone" required placeholder="+973 XXXX XXXX" value="${patient.phone}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">CPR Number *</label>
                                <input type="text" id="editCprNumber" name="cprNumber" required placeholder="000000000" value="${patient.cprNumber}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Date of Birth *</label>
                                <input type="date" id="editDateOfBirth" name="dateOfBirth" required value="${patient.dateOfBirth || ''}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Gender *</label>
                                <select id="editGender" name="gender" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                    <option value="">Select Gender</option>
                                    <option value="male" ${patient.gender === 'male' ? 'selected' : ''}>Male</option>
                                    <option value="female" ${patient.gender === 'female' ? 'selected' : ''}>Female</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
                            <textarea id="editAddress" name="address" rows="3" placeholder="Full Address" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">${patient.address || ''}</textarea>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-phone text-teal-400 mr-2"></i>Contact Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                                <input type="email" id="editEmail" name="email" placeholder="patient@example.com" value="${patient.email || ''}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Alternative Phone</label>
                                <input type="tel" id="editAltPhone" name="altPhone" placeholder="+973 XXXX XXXX" value="${patient.altPhone || ''}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Medical History -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-notes-medical text-teal-400 mr-2"></i>Medical History & Current Condition
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Medical History</label>
                            <textarea id="editMedicalHistory" name="medicalHistory" rows="3" placeholder="Describe medical history, allergies, or previous treatments..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">${patient.medicalHistory || ''}</textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Current Condition *</label>
                            <textarea id="editCurrentCondition" name="currentCondition" rows="3" required placeholder="Describe the patient's current condition, symptoms, and reason for treatment..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">${patient.currentCondition}</textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Emergency Contact Name</label>
                                <input type="text" id="editEmergencyContactName" name="emergencyContactName" placeholder="Emergency contact full name" value="${patient.emergencyContactName || ''}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Emergency Contact Phone</label>
                                <input type="tel" id="editEmergencyContactPhone" name="emergencyContactPhone" placeholder="+973 XXXX XXXX" value="${patient.emergencyContactPhone || ''}" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                            </div>
                        </div>
                    </div>

                    <!-- Assign to Physiotherapist -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-user-md text-teal-400 mr-2"></i>Assign to Physiotherapist/Physiologist
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Select a physiotherapist *</label>
                            <select id="editAssignedPhysiotherapist" name="assignedPhysiotherapist" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="">Choose physiotherapist to be assigned to this patient</option>
                                ${appData.physiotherapists.map(physio => {
                                    const physioName = `Dr. ${physio.firstName} ${physio.lastName}`;
                                    return `<option value="${physioName}" ${patient.assignedPhysiotherapist === physioName ? 'selected' : ''}>${physioName} - ${physio.specializations.join(', ')}</option>`;
                                }).join('')}
                            </select>
                            <p class="text-xs text-gray-400 mt-1">This patient will appear in the selected physiotherapist's dashboard</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Assignment Notes</label>
                            <textarea id="editAssignmentNotes" name="assignmentNotes" rows="3" placeholder="Add any specific notes for the assigned physiotherapist..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">${patient.assignmentNotes || ''}</textarea>
                        </div>
                    </div>

                    <!-- Treatment Status -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-heartbeat text-teal-400 mr-2"></i>Treatment Status
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Current Treatment Status</label>
                            <select id="editTreatmentStatus" name="treatmentStatus" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                <option value="active" ${patient.treatmentStatus === 'active' ? 'selected' : ''}>Active Treatment</option>
                                <option value="assessment" ${patient.treatmentStatus === 'assessment' ? 'selected' : ''}>Initial Assessment</option>
                                <option value="planning" ${patient.treatmentStatus === 'planning' ? 'selected' : ''}>Treatment Planning</option>
                                <option value="completed" ${patient.treatmentStatus === 'completed' ? 'selected' : ''}>Treatment Completed</option>
                                <option value="inactive" ${patient.treatmentStatus === 'inactive' ? 'selected' : ''}>Inactive</option>
                            </select>
                        </div>
                    </div>

                    <!-- Generate Treatment Document -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-file-medical text-teal-400 mr-2"></i>Generate Treatment Document
                        </h4>
                        
                        <div class="bg-gray-700 border border-gray-600 rounded-lg p-4">
                            <p class="text-sm text-gray-300 mb-3">Create a professional treatment form template for ${patient.firstName} ${patient.lastName}</p>
                            <button type="button" onclick="generatePatientTreatmentDocument('${patient.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-file-plus mr-2"></i>Generate Template
                            </button>
                            <div id="treatmentDocOutput" class="hidden mt-4 p-3 bg-green-900/20 border border-green-800 rounded-lg">
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-green-400 mr-2"></i>
                                    <span class="text-green-300 text-sm">Treatment document generated successfully!</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Treatment Documents -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                            <i class="fas fa-upload text-teal-400 mr-2"></i>Upload Treatment Documents
                        </h4>
                        
                        <div class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center bg-gray-700/50">
                            <i class="fas fa-cloud-upload-alt text-gray-400 text-4xl mb-4"></i>
                            <p class="text-gray-400 mb-2">Upload treatment documents for ${patient.firstName} ${patient.lastName}</p>
                            <p class="text-xs text-gray-500 mb-4">PNG, JPG, PDF up to 10MB</p>
                            <button type="button" onclick="uploadPatientTreatmentDocs('${patient.id}')" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-folder-open mr-2"></i>Choose Documents
                            </button>
                        </div>
                        
                        <!-- Existing Documents Display -->
                        <div id="existingTreatmentDocs" class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                            <h5 class="text-sm font-medium text-gray-300 mb-3">Previously Uploaded Documents:</h5>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between p-2 bg-gray-700 rounded border border-gray-600">
                                    <div class="flex items-center">
                                        <i class="fas fa-file-pdf text-red-400 mr-2"></i>
                                        <span class="text-sm text-gray-300">Initial Assessment Report.pdf</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs text-gray-400">2.3 MB</span>
                                        <button onclick="downloadTreatmentDoc('${patient.id}', 'assessment')" class="text-blue-400 hover:text-blue-300 p-1" title="Download">
                                            <i class="fas fa-download"></i>
                                        </button>
                                        <button onclick="deleteTreatmentDoc('${patient.id}', 'assessment')" class="text-red-400 hover:text-red-300 p-1" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between p-2 bg-gray-700 rounded border border-gray-600">
                                    <div class="flex items-center">
                                        <i class="fas fa-file-image text-green-400 mr-2"></i>
                                        <span class="text-sm text-gray-300">Progress Photos - Week 2.jpg</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs text-gray-400">1.8 MB</span>
                                        <button onclick="viewTreatmentDoc('${patient.id}', 'photos')" class="text-blue-400 hover:text-blue-300 p-1" title="View">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button onclick="downloadTreatmentDoc('${patient.id}', 'photos')" class="text-blue-400 hover:text-blue-300 p-1" title="Download">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Photo & Patient Video -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Profile Photo -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                                <i class="fas fa-camera text-teal-400 mr-2"></i>Profile Photo
                            </h4>
                            
                            <!-- Current Profile Photo -->
                            <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600 mb-4">
                                <div class="flex items-center justify-center mb-3">
                                    <div class="w-24 h-24 bg-teal-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">
                                        ${patient.firstName.charAt(0)}${patient.lastName.charAt(0)}
                                    </div>
                                </div>
                                <p class="text-xs text-gray-400 text-center">Current Profile Photo</p>
                            </div>
                            
                            <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                <i class="fas fa-camera text-gray-400 text-2xl mb-2"></i>
                                <p class="text-xs text-gray-500 mb-3">Update patient photo</p>
                                <button type="button" onclick="updateProfilePhoto('${patient.id}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                    <i class="fas fa-upload mr-1"></i>Upload New Photo
                                </button>
                            </div>
                        </div>

                        <!-- Patient Video -->
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-teal-400 mb-4 flex items-center">
                                <i class="fas fa-video text-teal-400 mr-2"></i>Patient Video
                            </h4>
                            
                            <!-- Current Patient Video -->
                            <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600 mb-4">
                                <div class="flex items-center justify-center mb-3">
                                    <div class="w-full h-32 bg-gray-600 rounded-lg flex items-center justify-center">
                                        <div class="text-center">
                                            <i class="fas fa-play-circle text-gray-400 text-4xl mb-2"></i>
                                            <p class="text-xs text-gray-400">Initial Assessment Video</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex justify-center space-x-2">
                                    <button onclick="playPatientVideo('${patient.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                        <i class="fas fa-play mr-1"></i>Play
                                    </button>
                                    <button onclick="downloadPatientVideo('${patient.id}')" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                        <i class="fas fa-download mr-1"></i>Download
                                    </button>
                                </div>
                            </div>
                            
                            <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                <i class="fas fa-video text-gray-400 text-2xl mb-2"></i>
                                <p class="text-xs text-gray-500 mb-3">Record new patient video</p>
                                <button type="button" onclick="updatePatientVideo('${patient.id}')" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                    <i class="fas fa-upload mr-1"></i>Upload New Video
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Treatment Progress (only for physiotherapist) -->
                    ${isPhysiotherapist ? `
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-blue-400 mb-4 flex items-center">
                            <i class="fas fa-chart-line text-blue-400 mr-2"></i>Treatment Progress & Notes
                        </h4>
                        
                        <div class="bg-blue-900/20 rounded-lg p-4 border border-blue-800">
                            <h5 class="text-sm font-medium text-blue-200 mb-3">Physiotherapist Treatment Notes</h5>
                            <textarea rows="4" placeholder="Add your treatment notes, patient progress observations, and recommendations..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Pain Level (Current Session)</label>
                                <div class="flex items-center space-x-4">
                                    <input type="range" min="0" max="10" value="4" class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="currentPainLevel">
                                    <span class="text-lg font-bold text-white min-w-[2rem]" id="currentPainValue">4</span>
                                </div>
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>No pain</span>
                                    <span>Severe pain</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Progress Rating</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select progress rating</option>
                                    <option value="excellent">Excellent Progress</option>
                                    <option value="good">Good Progress</option>
                                    <option value="moderate">Moderate Progress</option>
                                    <option value="slow">Slow Progress</option>
                                    <option value="no-change">No Change</option>
                                    <option value="declining">Condition Declining</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Recommended Next Steps</label>
                            <textarea rows="3" placeholder="Recommendations for future treatment sessions, exercises, or referrals..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>
                    ` : ''}

                    <!-- Patient Registration Information (Read-only for reference) -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-400 mb-4 flex items-center">
                            <i class="fas fa-info-circle text-gray-400 mr-2"></i>Registration Information
                        </h4>
                        
                        <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">Patient ID:</span>
                                    <span class="font-medium text-white ml-2">${patient.id}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Date Registered:</span>
                                    <span class="font-medium text-white ml-2">${new Date(patient.dateRegistered).toLocaleDateString('en-GB')}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Last Updated:</span>
                                    <span class="font-medium text-white ml-2">Just now</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            `;
            
            // Create modal with same design as admin add patient
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-user-edit text-teal-400 mr-2"></i>${userTitle}
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button class="save-modal px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors font-medium">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-modal');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            saveBtn.onclick = () => {
                const form = document.getElementById('editPatientForm');
                const formData = new FormData(form);
                
                // Update patient data
                const patientIndex = appData.patients.findIndex(p => p.id === patient.id);
                if (patientIndex !== -1) {
                    const updatedPatient = { ...appData.patients[patientIndex] };
                    
                    updatedPatient.firstName = formData.get('firstName').trim();
                    updatedPatient.lastName = formData.get('lastName').trim();
                    updatedPatient.phone = formData.get('phone').trim();
                    updatedPatient.cprNumber = formData.get('cprNumber').trim();
                    updatedPatient.dateOfBirth = formData.get('dateOfBirth');
                    updatedPatient.gender = formData.get('gender');
                    updatedPatient.email = formData.get('email')?.trim() || '';
                    updatedPatient.altPhone = formData.get('altPhone')?.trim() || '';
                    updatedPatient.address = formData.get('address')?.trim() || '';
                    updatedPatient.medicalHistory = formData.get('medicalHistory')?.trim() || '';
                    updatedPatient.currentCondition = formData.get('currentCondition').trim();
                    updatedPatient.emergencyContactName = formData.get('emergencyContactName')?.trim() || '';
                    updatedPatient.emergencyContactPhone = formData.get('emergencyContactPhone')?.trim() || '';
                    updatedPatient.assignedPhysiotherapist = formData.get('assignedPhysiotherapist');
                    updatedPatient.assignmentNotes = formData.get('assignmentNotes')?.trim() || '';
                    updatedPatient.treatmentStatus = formData.get('treatmentStatus');
                    updatedPatient.lastUpdated = new Date().toISOString();
                    
                    appData.patients[patientIndex] = updatedPatient;
                    
                    // Update displays
                    updatePatientsDisplay();
                    loadPhysioPatients();
                    
                    const userType = isPhysiotherapist ? 'Dr. Mariam' : 'Admin';
                    showNotification(`‚úÖ ${userType} successfully updated ${updatedPatient.firstName} ${updatedPatient.lastName}'s information!`, 'success');
                }
                closeModal();
            };

            // Setup interactive elements for the edit modal
            setTimeout(() => {
                // Pain level slider for physiotherapists
                const painSlider = document.getElementById('currentPainLevel');
                const painValue = document.getElementById('currentPainValue');

                if (painSlider && painValue) {
                    painSlider.addEventListener('input', () => {
                        painValue.textContent = painSlider.value;
                    });
                }
            }, 100);

            // Add media management functions
            window.generatePatientTreatmentDocument = function(patientId) {
                const outputDiv = document.getElementById('treatmentDocOutput');
                if (outputDiv) {
                    outputDiv.classList.remove('hidden');
                    showNotification('üìÑ Treatment document generated and ready for download!', 'success');
                }
            };

            window.uploadPatientTreatmentDocs = function(patientId) {
                showNotification('üìÅ Treatment document upload functionality - Files will be associated with patient record', 'success');
            };

            window.downloadTreatmentDoc = function(patientId, docType) {
                showNotification(`üì• Downloading ${docType} document for patient`, 'success');
            };

            window.deleteTreatmentDoc = function(patientId, docType) {
                showConfirmDialog(
                    'Are you sure you want to delete this document? This action cannot be undone.',
                    () => showNotification(`üóëÔ∏è ${docType} document deleted successfully`, 'success')
                );
            };

            window.viewTreatmentDoc = function(patientId, docType) {
                showNotification(`üëÅÔ∏è Viewing ${docType} document in new window`, 'success');
            };

            window.updateProfilePhoto = function(patientId) {
                showNotification('üì∏ Profile photo update functionality - New photo will replace current profile image', 'success');
            };

            window.updatePatientVideo = function(patientId) {
                showNotification('üé• Patient video update functionality - New video will be saved to patient record', 'success');
            };

            window.playPatientVideo = function(patientId) {
                showNotification('‚ñ∂Ô∏è Playing patient assessment video', 'success');
            };

            window.downloadPatientVideo = function(patientId) {
                showNotification('üì• Downloading patient video file', 'success');
            };
        }

        function physioUpdateProgress(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`üìà Updating progress for: ${patient.firstName} ${patient.lastName}`, 'success');
            }
        }

        function physioScheduleSession(patientId) {
            const patient = appData.patients.find(p => p.id === patientId);
            if (patient) {
                showNotification(`üìÖ Scheduling session for: ${patient.firstName} ${patient.lastName}`, 'success');
            }
        }

        // Additional Functions Referenced in UI
        function showAddUserModal() {
            const content = `
                <form id="addUserForm" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-user text-red-400 mr-2"></i>Personal Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Full Name *</label>
                                <input type="text" required placeholder="Enter full name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Employee ID *</label>
                                <input type="text" required placeholder="ADM-2024-001" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Email Address *</label>
                                <input type="email" required placeholder="admin@bahraninmobility.com" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                                <input type="tel" placeholder="97123456" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Department</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                    <option value="">Select department...</option>
                                    <option value="administration">Administration</option>
                                    <option value="clinical">Clinical Services</option>
                                    <option value="finance">Finance</option>
                                    <option value="hr">Human Resources</option>
                                    <option value="it">IT & Systems</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Job Title</label>
                                <input type="text" placeholder="e.g., System Administrator" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>
                    </div>

                    <!-- Administrative Role & Level -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-shield-alt text-red-400 mr-2"></i>Administrative Role & Level
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Administrator Level *</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <label class="flex items-start p-4 bg-gray-700 rounded-lg border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors">
                                    <input type="radio" name="adminLevel" value="super" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 focus:ring-red-500 focus:ring-2 mt-1 mr-3">
                                    <div>
                                        <span class="text-sm font-medium text-gray-300 block">Super Administrator</span>
                                        <span class="text-xs text-gray-400">Complete system access and management</span>
                                    </div>
                                </label>
                                <label class="flex items-start p-4 bg-gray-700 rounded-lg border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors">
                                    <input type="radio" name="adminLevel" value="admin" checked class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 focus:ring-red-500 focus:ring-2 mt-1 mr-3">
                                    <div>
                                        <span class="text-sm font-medium text-gray-300 block">Administrator</span>
                                        <span class="text-xs text-gray-400">Standard administrative privileges</span>
                                    </div>
                                </label>
                                <label class="flex items-start p-4 bg-gray-700 rounded-lg border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors">
                                    <input type="radio" name="adminLevel" value="manager" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 focus:ring-red-500 focus:ring-2 mt-1 mr-3">
                                    <div>
                                        <span class="text-sm font-medium text-gray-300 block">Manager</span>
                                        <span class="text-xs text-gray-400">Departmental level management access</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Reports To</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                    <option value="">Select supervisor...</option>
                                    <option value="dhari-admin">Dhari Admin (Super Administrator)</option>
                                    <option value="other">Other Administrator</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Start Date</label>
                                <input type="date" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>
                    </div>

                    <!-- System Permissions & Access -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-key text-red-400 mr-2"></i>System Permissions & Access
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Core System Access</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">User Management</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">System Settings</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Patient Management</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Appointment Management</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Staff Management</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Financial Reports</span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Advanced Permissions</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Database Direct Access</span>
                                </label>
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Security & Audit Logs</span>
                                </label>
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">System Backup/Restore</span>
                                </label>
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Bulk Operations</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Login Credentials & Security -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-lock text-red-400 mr-2"></i>Login Credentials & Security
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Username *</label>
                                <input type="text" required placeholder="DhariBmi@gmail.com" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Login Email *</label>
                                <input type="email" required placeholder="Same as primary email" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Password *</label>
                                <div class="relative">
                                    <input type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 pr-12 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                    <button type="button" class="absolute right-4 top-4 text-gray-400 hover:text-gray-300" onclick="togglePasswordVisibility(this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-400 mt-1">Minimum 8 characters, letters, numbers, and symbols</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Confirm Password *</label>
                                <div class="relative">
                                    <input type="password" required placeholder="Confirm password" class="w-full px-4 py-3 pr-12 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                    <button type="button" class="absolute right-4 top-4 text-gray-400 hover:text-gray-300" onclick="togglePasswordVisibility(this)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Security Settings</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Require password change on first login</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Enable two-factor authentication (recommended)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Enable automatic session timeout (30 minutes)</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Contact & Emergency Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-phone text-red-400 mr-2"></i>Contact & Emergency Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Secondary Phone</label>
                                <input type="tel" placeholder="Alternative phone number" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">WhatsApp Number</label>
                                <input type="tel" placeholder="WhatsApp number" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Emergency Contact Name</label>
                                <input type="text" placeholder="Emergency contact name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Emergency Contact Phone</label>
                                <input type="tel" placeholder="Emergency phone number" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>
                    </div>

                    <!-- Account Status & Notes -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-clipboard-list text-red-400 mr-2"></i>Account Status & Notes
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Account Status</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                    <option value="active">Active - Ready for immediate use</option>
                                    <option value="pending">Pending - Awaiting approval</option>
                                    <option value="inactive">Inactive - Temporarily disabled</option>
                                    <option value="suspended">Suspended - Access revoked</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Account Expiry</label>
                                <input type="date" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500">
                                <p class="text-xs text-gray-400 mt-1">Leave blank for no expiry</p>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Administrative Notes</label>
                            <textarea rows="4" placeholder="Internal notes for HR and management purposes..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-red-500 focus:border-red-500"></textarea>
                        </div>
                    </div>

                    <!-- Notification Preferences -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                            <i class="fas fa-bell text-purple-400 mr-2"></i>Notification Preferences
                        </h4>
                        
                        <div class="bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-lg p-4 border border-purple-700">
                            <p class="text-sm text-purple-200 mb-4">Configure how this administrator receives system notifications</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-purple-200 mb-3">Email Notifications</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                            <span class="text-sm text-purple-100">System alerts and errors</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                            <span class="text-sm text-purple-100">User login/logout activity</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                            <span class="text-sm text-purple-100">Weekly summary reports</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-purple-200 mb-3">SMS Notifications</label>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                            <span class="text-sm text-purple-100">Critical system failures</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                            <span class="text-sm text-purple-100">Security breach alerts</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Final Confirmations -->
                    <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                        <h5 class="text-sm font-medium text-gray-300 mb-3">Administrator Creation Confirmation</h5>
                        <div class="space-y-2">
                            <label class="flex items-start">
                                <input type="checkbox" required class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mt-0.5 mr-3">
                                <span class="text-sm text-gray-300">
                                    I confirm that all information provided is accurate and I have the authority to create this administrator account. *
                                </span>
                            </label>
                            <label class="flex items-start">
                                <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mt-0.5 mr-3">
                                <span class="text-sm text-gray-300">
                                    Send welcome email with login credentials and setup instructions to the new administrator.
                                </span>
                            </label>
                        </div>
                    </div>
                </form>
            `;
            
            // Create custom modal with dark theme
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-user-shield text-red-400 mr-2"></i>Add New Administrator
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <div class="flex space-x-3">
                            <button class="preview-modal px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                <i class="fas fa-eye mr-2"></i>Preview Credentials
                            </button>
                            <button class="save-modal px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
                                <i class="fas fa-user-plus mr-2"></i>Create Administrator
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const previewBtn = modal.querySelector('.preview-modal');
            const saveBtn = modal.querySelector('.save-modal');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            previewBtn.onclick = () => showNotification('üëÅÔ∏è Preview credentials functionality', 'success');
            saveBtn.onclick = () => {
                showNotification('‚úÖ New administrator created successfully!', 'success');
                closeModal();
            };

            // Add password visibility toggle functionality
            window.togglePasswordVisibility = function(button) {
                const input = button.previousElementSibling;
                const icon = button.querySelector('i');
                
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            };
        }

        function viewUserDetails(userId) {
            showNotification('üëÅÔ∏è View user details coming soon!', 'success');
        }

        function editUser(userId) {
            showNotification('‚úèÔ∏è Edit user coming soon!', 'success');
        }

        function showAddExerciseModal() {
            const content = `
                <form id="addExerciseForm" class="space-y-6">
                    <!-- Basic Exercise Information -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-blue-400 mb-4 flex items-center">
                            <i class="fas fa-dumbbell text-blue-400 mr-2"></i>Basic Exercise Information
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Name *</label>
                                <input type="text" required placeholder="e.g., Shoulder Flexion Stretch" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Code</label>
                                <input type="text" placeholder="e.g., SH-FL-001" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Category *</label>
                                <select required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select category...</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="flexibility">Flexibility & Stretching</option>
                                    <option value="balance">Balance & Coordination</option>
                                    <option value="cardio">Cardiovascular</option>
                                    <option value="rehabilitation">Rehabilitation</option>
                                    <option value="functional">Functional Movement</option>
                                    <option value="core">Core Stability</option>
                                    <option value="posture">Posture Correction</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Difficulty Level *</label>
                                <select required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select difficulty...</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                    <option value="expert">Expert</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Equipment Required</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="none">No Equipment</option>
                                    <option value="resistance-bands">Resistance Bands</option>
                                    <option value="dumbbells">Dumbbells</option>
                                    <option value="exercise-ball">Exercise Ball</option>
                                    <option value="balance-board">Balance Board</option>
                                    <option value="foam-roller">Foam Roller</option>
                                    <option value="mat">Exercise Mat</option>
                                    <option value="theraband">Theraband</option>
                                    <option value="multiple">Multiple Equipment</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Description *</label>
                            <textarea rows="4" required placeholder="Detailed description of the exercise, its purpose, and general technique..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Target Body Areas -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-blue-400 mb-4 flex items-center">
                            <i class="fas fa-crosshairs text-blue-400 mr-2"></i>Target Body Areas & Muscles
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Primary Target Areas *</label>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Neck & Cervical</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Shoulders</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Upper Back</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Lower Back</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Arms & Biceps</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Forearms & Wrists</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Core & Abs</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Chest</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Hips & Pelvis</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Thighs & Quads</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Knees</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Calves & Ankles</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Feet</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Full Body</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Spine</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Posture</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Primary Movement Pattern</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select movement pattern...</option>
                                    <option value="flexion">Flexion</option>
                                    <option value="extension">Extension</option>
                                    <option value="abduction">Abduction</option>
                                    <option value="adduction">Adduction</option>
                                    <option value="rotation">Rotation</option>
                                    <option value="lateral-flexion">Lateral Flexion</option>
                                    <option value="circumduction">Circumduction</option>
                                    <option value="stabilization">Stabilization</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Type</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select exercise type...</option>
                                    <option value="static">Static Hold</option>
                                    <option value="dynamic">Dynamic Movement</option>
                                    <option value="isometric">Isometric</option>
                                    <option value="isotonic">Isotonic</option>
                                    <option value="plyometric">Plyometric</option>
                                    <option value="range-of-motion">Range of Motion</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise Instructions -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-blue-400 mb-4 flex items-center">
                            <i class="fas fa-list-ol text-blue-400 mr-2"></i>Step-by-Step Instructions
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Starting Position</label>
                            <textarea rows="3" placeholder="Describe the proper starting position and setup..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Steps *</label>
                            <textarea rows="5" required placeholder="Step-by-step instructions for performing the exercise:
1. Begin in the starting position...
2. Slowly move...
3. Hold for X seconds...
4. Return to starting position...
5. Repeat..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Breathing Instructions</label>
                            <textarea rows="2" placeholder="Breathing pattern and timing during the exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Exercise Parameters -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-blue-400 mb-4 flex items-center">
                            <i class="fas fa-sliders-h text-blue-400 mr-2"></i>Exercise Parameters & Guidelines
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Recommended Sets</label>
                                <div class="flex gap-2">
                                    <input type="number" min="1" max="10" placeholder="2" class="flex-1 px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <span class="px-3 py-3 bg-gray-600 text-gray-300 rounded-lg text-sm">sets</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Recommended Reps</label>
                                <div class="flex gap-2">
                                    <input type="text" placeholder="8-12" class="flex-1 px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <span class="px-3 py-3 bg-gray-600 text-gray-300 rounded-lg text-sm">reps</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Hold Duration</label>
                                <div class="flex gap-2">
                                    <input type="number" min="0" placeholder="30" class="flex-1 px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <span class="px-3 py-3 bg-gray-600 text-gray-300 rounded-lg text-sm">sec</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Rest Between Sets</label>
                                <div class="flex gap-2">
                                    <input type="number" min="0" placeholder="60" class="flex-1 px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <span class="px-3 py-3 bg-gray-600 text-gray-300 rounded-lg text-sm">sec</span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Frequency (Per Week)</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select frequency...</option>
                                    <option value="daily">Daily (7x/week)</option>
                                    <option value="6x">6 times per week</option>
                                    <option value="5x">5 times per week</option>
                                    <option value="4x">4 times per week</option>
                                    <option value="3x">3 times per week</option>
                                    <option value="2x">2 times per week</option>
                                    <option value="1x">Once per week</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Intensity Level</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select intensity...</option>
                                    <option value="low">Low Intensity</option>
                                    <option value="moderate">Moderate Intensity</option>
                                    <option value="high">High Intensity</option>
                                    <option value="variable">Variable Intensity</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Expected Duration</label>
                                <div class="flex gap-2">
                                    <input type="number" min="1" placeholder="15" class="flex-1 px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <select class="px-3 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="minutes">minutes</option>
                                        <option value="seconds">seconds</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Safety & Precautions -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>Safety & Precautions
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Contraindications & Warnings</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Acute injury/inflammation</span>
                                </label>
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Severe pain</span>
                                </label>
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Recent surgery</span>
                                </label>
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Fracture/instability</span>
                                </label>
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Cardiovascular concerns</span>
                                </label>
                                <label class="flex items-center p-3 bg-red-900/20 rounded-lg border border-red-800">
                                    <input type="checkbox" class="w-4 h-4 text-red-500 bg-gray-600 border-gray-500 rounded focus:ring-red-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-red-300">Balance impairment</span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Safety Instructions</label>
                            <textarea rows="3" placeholder="Important safety guidelines and precautions for this exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">When to Stop Exercise</label>
                            <textarea rows="2" placeholder="Signs and symptoms that indicate the patient should stop the exercise..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Progressions & Modifications -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-green-400 mb-4 flex items-center">
                            <i class="fas fa-arrow-up text-green-400 mr-2"></i>Progressions & Modifications
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Easier Variations (Regression)</label>
                                <textarea rows="4" placeholder="How to make this exercise easier for beginners or those with limitations..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Advanced Variations (Progression)</label>
                                <textarea rows="4" placeholder="How to make this exercise more challenging for advanced patients..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Alternative Exercises</label>
                            <textarea rows="3" placeholder="Similar exercises that can be substituted if this one is not suitable..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Media & Documentation -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                            <i class="fas fa-camera text-purple-400 mr-2"></i>Media & Documentation
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Exercise Images -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-300">Exercise Images</label>
                                <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                    <i class="fas fa-images text-gray-400 text-2xl mb-2"></i>
                                    <p class="text-xs text-gray-500 mb-3">Upload demonstration images</p>
                                    <button type="button" onclick="uploadExerciseImages()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                        <i class="fas fa-upload mr-1"></i>Upload Images
                                    </button>
                                </div>
                            </div>

                            <!-- Exercise Video -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-300">Demonstration Video</label>
                                <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                    <i class="fas fa-video text-gray-400 text-2xl mb-2"></i>
                                    <p class="text-xs text-gray-500 mb-3">Upload exercise video</p>
                                    <button type="button" onclick="uploadExerciseVideo()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                        <i class="fas fa-video mr-1"></i>Upload Video
                                    </button>
                                </div>
                            </div>

                            <!-- Exercise Diagrams -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-300">Anatomical Diagrams</label>
                                <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center bg-gray-700/50">
                                    <i class="fas fa-file-medical text-gray-400 text-2xl mb-2"></i>
                                    <p class="text-xs text-gray-500 mb-3">Upload anatomy diagrams</p>
                                    <button type="button" onclick="uploadExerciseDiagrams()" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-xs font-medium transition-colors">
                                        <i class="fas fa-upload mr-1"></i>Upload Diagrams
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Video URL (Optional)</label>
                                <input type="url" placeholder="https://youtube.com/watch?v=" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Reference Source</label>
                                <input type="text" placeholder="Exercise source or reference" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Clinical Application -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-yellow-400 mb-4 flex items-center">
                            <i class="fas fa-stethoscope text-yellow-400 mr-2"></i>Clinical Application & Evidence
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-3">Recommended For (Conditions)</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Lower back pain</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Neck pain</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Shoulder impingement</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Knee osteoarthritis</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Post-surgical rehab</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Sports injury</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Balance disorders</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Chronic pain</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-700 rounded-lg border border-gray-600">
                                    <input type="checkbox" class="w-4 h-4 text-yellow-500 bg-gray-600 border-gray-500 rounded focus:ring-yellow-500 focus:ring-2 mr-3">
                                    <span class="text-sm text-gray-300">Posture dysfunction</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Treatment Phase</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select treatment phase...</option>
                                    <option value="acute">Acute Phase (0-72 hours)</option>
                                    <option value="subacute">Subacute Phase (3 days - 6 weeks)</option>
                                    <option value="chronic">Chronic Phase (6+ weeks)</option>
                                    <option value="maintenance">Maintenance Phase</option>
                                    <option value="prevention">Prevention/Wellness</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Evidence Level</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select evidence level...</option>
                                    <option value="level-1">Level 1 - High Quality RCT</option>
                                    <option value="level-2">Level 2 - Lower Quality RCT</option>
                                    <option value="level-3">Level 3 - Systematic Review</option>
                                    <option value="level-4">Level 4 - Case-Control Study</option>
                                    <option value="level-5">Level 5 - Case Series</option>
                                    <option value="expert">Expert Opinion</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Clinical Notes & Research</label>
                            <textarea rows="3" placeholder="Clinical effectiveness, research findings, outcome measures, and evidence-based rationale..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- Exercise Tags & Keywords -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-indigo-400 mb-4 flex items-center">
                            <i class="fas fa-tags text-indigo-400 mr-2"></i>Tags & Search Keywords
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Tags</label>
                                <input type="text" placeholder="e.g., stretching, strengthening, mobility" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <p class="text-xs text-gray-400 mt-1">Separate tags with commas</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Search Keywords</label>
                                <input type="text" placeholder="e.g., shoulder, ROM, flexibility" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <p class="text-xs text-gray-400 mt-1">Keywords for search functionality</p>
                            </div>
                        </div>
                    </div>

                    <!-- Review & Publishing -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-gray-400 mb-4 flex items-center">
                            <i class="fas fa-check-circle text-gray-400 mr-2"></i>Review & Publishing
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Exercise Status</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="draft">Draft</option>
                                    <option value="review">Under Review</option>
                                    <option value="approved">Approved</option>
                                    <option value="published">Published</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Created By</label>
                                <input type="text" readonly value="Admin User" class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-400 text-base">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Creation Date</label>
                                <input type="date" readonly value="${new Date().toISOString().split('T')[0]}" class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-400 text-base">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Internal Notes</label>
                            <textarea rows="2" placeholder="Internal notes for review process, updates, or administrative purposes..." class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <!-- Final Confirmations -->
                        <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                            <h5 class="text-sm font-medium text-gray-300 mb-3">Exercise Creation Confirmation</h5>
                            <div class="space-y-2">
                                <label class="flex items-start">
                                    <input type="checkbox" required class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mt-0.5 mr-3">
                                    <span class="text-sm text-gray-300">
                                        I confirm that all exercise information is accurate and follows evidence-based practice guidelines. *
                                    </span>
                                </label>
                                <label class="flex items-start">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mt-0.5 mr-3">
                                    <span class="text-sm text-gray-300">
                                        Make this exercise available to all physiotherapists in the system.
                                    </span>
                                </label>
                                <label class="flex items-start">
                                    <input type="checkbox" class="w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mt-0.5 mr-3">
                                    <span class="text-sm text-gray-300">
                                        Send for peer review before publishing.
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            `;
            
            // Create custom modal with dark theme
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-dumbbell text-blue-400 mr-2"></i>Add New Exercise to Library
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <div class="flex space-x-3">
                            <button class="preview-modal px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium">
                                <i class="fas fa-eye mr-2"></i>Preview Exercise
                            </button>
                            <button class="save-modal px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                <i class="fas fa-plus mr-2"></i>Add Exercise
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const previewBtn = modal.querySelector('.preview-modal');
            const saveBtn = modal.querySelector('.save-modal');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            previewBtn.onclick = () => showNotification('üëÅÔ∏è Exercise preview functionality coming soon!', 'success');
            saveBtn.onclick = () => {
                showNotification('‚úÖ New exercise added to library successfully!', 'success');
                closeModal();
            };

            // Add media upload functionality placeholders
            window.uploadExerciseImages = function() {
                showNotification('üì∏ Exercise images upload functionality', 'success');
            };

            window.uploadExerciseVideo = function() {
                showNotification('üé• Exercise video upload functionality', 'success');
            };

            window.uploadExerciseDiagrams = function() {
                showNotification('üìä Anatomical diagrams upload functionality', 'success');
            };
        }

        function exportExerciseLibrary() {
            showNotification('üì§ Export exercise library coming soon!', 'success');
        }

        // Bulk Upload and New Exercise Management
        let newExercisesFromUpload = [];

        function showBulkUploadModal() {
            const content = `
                <form id="bulkUploadForm" class="space-y-6">
                    <!-- Upload Section -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-blue-400 mb-4 flex items-center">
                            <i class="fas fa-file-word text-blue-400 mr-2"></i>Upload Exercise Document
                        </h4>
                        
                        <div class="border-2 border-dashed border-blue-500 rounded-lg p-8 text-center bg-blue-50 dark:bg-blue-900/20">
                            <i class="fas fa-cloud-upload-alt text-blue-500 text-4xl mb-4"></i>
                            <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2">Upload Word Document</h3>
                            <p class="text-blue-600 dark:text-blue-300 mb-4">Support for .docx files with exercise descriptions</p>
                            
                            <div class="space-y-3">
                                <input type="file" id="exerciseFileInput" accept=".docx,.doc,.pdf,.txt" class="hidden">
                                <button type="button" onclick="document.getElementById('exerciseFileInput').click()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                    <i class="fas fa-folder-open mr-2"></i>Choose Document
                                </button>
                                
                                <div class="text-sm text-blue-600 dark:text-blue-400">
                                    Or drag and drop your file here
                                </div>
                            </div>
                        </div>

                        <div id="fileInfo" class="hidden bg-gray-100 dark:bg-gray-800 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-file-word text-blue-600 text-xl mr-3"></i>
                                    <div>
                                        <p class="font-medium text-gray-900 dark:text-white" id="fileName"></p>
                                        <p class="text-sm text-gray-500 dark:text-gray-400" id="fileSize"></p>
                                    </div>
                                </div>
                                <button type="button" onclick="removeFile()" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Processing Options -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-green-400 mb-4 flex items-center">
                            <i class="fas fa-cog text-green-400 mr-2"></i>Processing Options
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Document Type</label>
                                <select id="documentType" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                    <option value="structured">Structured Exercise List</option>
                                    <option value="unstructured">Free Text Document</option>
                                    <option value="template">PhysioTech Template</option>
                                    <option value="clinical-notes">Clinical Notes</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Default Category</label>
                                <select id="defaultCategory" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                    <option value="">Auto-detect from content</option>
                                    <option value="strength">Strength Training</option>
                                    <option value="flexibility">Flexibility & Stretching</option>
                                    <option value="balance">Balance & Coordination</option>
                                    <option value="rehabilitation">Rehabilitation</option>
                                    <option value="functional">Functional Movement</option>
                                </select>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="autoExtractImages" checked class="w-4 h-4 text-green-500 bg-gray-600 border-gray-500 rounded focus:ring-green-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Extract images from document</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="validateExercises" checked class="w-4 h-4 text-green-500 bg-gray-600 border-gray-500 rounded focus:ring-green-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Validate exercise information</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="suggestTags" checked class="w-4 h-4 text-green-500 bg-gray-600 border-gray-500 rounded focus:ring-green-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Auto-suggest tags and keywords</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="duplicateCheck" checked class="w-4 h-4 text-green-500 bg-gray-600 border-gray-500 rounded focus:ring-green-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Check for duplicate exercises</span>
                            </label>
                        </div>
                    </div>

                    <!-- AI Processing (Mock) -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                            <i class="fas fa-brain text-purple-400 mr-2"></i>AI-Powered Processing
                        </h4>
                        
                        <div class="bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-lg p-4 border border-purple-700">
                            <p class="text-sm text-purple-200 mb-4">Our AI system can automatically extract and structure exercise information from your document</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <i class="fas fa-search text-white"></i>
                                    </div>
                                    <p class="text-xs text-purple-100">Text Recognition</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <i class="fas fa-cogs text-white"></i>
                                    </div>
                                    <p class="text-xs text-blue-100">Structure Extraction</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <i class="fas fa-check-double text-white"></i>
                                    </div>
                                    <p class="text-xs text-green-100">Quality Validation</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div id="extractionPreview" class="hidden space-y-4">
                        <h4 class="text-lg font-semibold text-yellow-400 mb-4 flex items-center">
                            <i class="fas fa-eye text-yellow-400 mr-2"></i>Extracted Exercises Preview
                        </h4>
                        
                        <div id="extractedExercises" class="space-y-3">
                            <!-- Preview content will be populated here -->
                        </div>
                    </div>

                    <!-- Upload Progress -->
                    <div id="uploadProgress" class="hidden">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-300">Processing document...</span>
                                <span class="text-sm text-blue-400" id="progressText">0%</span>
                            </div>
                            <div class="w-full bg-gray-600 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full transition-all duration-300" id="progressBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </form>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-upload text-blue-400 mr-2"></i>Bulk Upload Exercises from Document
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <div class="flex space-x-3">
                            <button id="processBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-cogs mr-2"></i>Process Document
                            </button>
                            <button id="importBtn" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                <i class="fas fa-download mr-2"></i>Import Exercises
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const processBtn = modal.querySelector('#processBtn');
            const importBtn = modal.querySelector('#importBtn');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            processBtn.onclick = processUploadedDocument;
            importBtn.onclick = () => {
                importExtractedExercises();
                closeModal();
            };

            // File input handling
            const fileInput = document.getElementById('exerciseFileInput');
            fileInput.addEventListener('change', handleFileSelection);
            
            // Drag and drop handling
            const uploadArea = modal.querySelector('.border-dashed');
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('border-blue-600', 'bg-blue-100');
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-blue-600', 'bg-blue-100');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-blue-600', 'bg-blue-100');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelection({ target: { files } });
                }
            });

            window.removeFile = function() {
                document.getElementById('fileInfo').classList.add('hidden');
                document.getElementById('exerciseFileInput').value = '';
                document.getElementById('processBtn').disabled = true;
                document.getElementById('importBtn').disabled = true;
            };
        }

        function handleFileSelection(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const processBtn = document.getElementById('processBtn');

            fileName.textContent = file.name;
            fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
            
            fileInfo.classList.remove('hidden');
            processBtn.disabled = false;
        }

        function processUploadedDocument() {
            const progressDiv = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const previewDiv = document.getElementById('extractionPreview');
            const extractedDiv = document.getElementById('extractedExercises');

            // Show progress
            progressDiv.classList.remove('hidden');
            
            // Simulate document processing
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                progressText.textContent = Math.round(progress) + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Hide progress and show results
                    setTimeout(() => {
                        progressDiv.classList.add('hidden');
                        showExtractedExercises();
                    }, 500);
                }
            }, 200);
        }

        function showExtractedExercises() {
            const previewDiv = document.getElementById('extractionPreview');
            const extractedDiv = document.getElementById('extractedExercises');
            const importBtn = document.getElementById('importBtn');

            // Get current user info
            const currentUser = getCurrentUser();
            const currentDateTime = new Date().toISOString();

            // Mock extracted exercises with user tracking
            const mockExercises = [
                {
                    name: 'Shoulder Flexion Stretch',
                    description: 'Gentle stretching exercise to improve shoulder flexibility and range of motion',
                    category: 'flexibility',
                    difficulty: 'beginner',
                    duration: '30 seconds',
                    instructions: '1. Sit or stand with good posture\n2. Slowly raise arm forward\n3. Hold at comfortable stretch\n4. Lower slowly',
                    targetAreas: ['shoulder', 'upper back'],
                    uploadedBy: currentUser.name,
                    uploadedById: currentUser.id,
                    userRole: currentUser.role,
                    uploadDate: currentDateTime,
                    uploadMethod: 'document_upload'
                },
                {
                    name: 'Knee Strengthening Exercise',
                    description: 'Isometric quadriceps strengthening for knee rehabilitation',
                    category: 'strength',
                    difficulty: 'intermediate',
                    duration: '10 repetitions',
                    instructions: '1. Sit with legs extended\n2. Tighten thigh muscles\n3. Hold for 5 seconds\n4. Relax and repeat',
                    targetAreas: ['knee', 'quadriceps'],
                    uploadedBy: currentUser.name,
                    uploadedById: currentUser.id,
                    userRole: currentUser.role,
                    uploadDate: currentDateTime,
                    uploadMethod: 'document_upload'
                },
                {
                    name: 'Balance Training on One Leg',
                    description: 'Single leg balance exercise to improve stability and proprioception',
                    category: 'balance',
                    difficulty: 'intermediate',
                    duration: '30 seconds each leg',
                    instructions: '1. Stand near a wall for support\n2. Lift one leg off ground\n3. Maintain balance\n4. Switch legs',
                    targetAreas: ['ankle', 'core', 'hip'],
                    uploadedBy: currentUser.name,
                    uploadedById: currentUser.id,
                    userRole: currentUser.role,
                    uploadDate: currentDateTime,
                    uploadMethod: 'document_upload'
                }
            ];

            newExercisesFromUpload = mockExercises;

            extractedDiv.innerHTML = mockExercises.map((exercise, index) => `
                <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <input type="checkbox" checked class="w-4 h-4 text-green-500 bg-gray-600 border-gray-500 rounded focus:ring-green-500 focus:ring-2 mr-3" data-exercise="${index}">
                                <h5 class="font-medium text-white">${exercise.name}</h5>
                                <span class="ml-2 px-2 py-1 bg-${exercise.difficulty === 'beginner' ? 'green' : exercise.difficulty === 'intermediate' ? 'yellow' : 'red'}-100 text-${exercise.difficulty === 'beginner' ? 'green' : exercise.difficulty === 'intermediate' ? 'yellow' : 'red'}-800 rounded-full text-xs font-medium">${exercise.difficulty}</span>
                            </div>
                            <p class="text-sm text-gray-300 mb-2">${exercise.description}</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-xs">
                                <div>
                                    <span class="text-gray-400">Category:</span>
                                    <span class="text-blue-300 ml-1">${exercise.category}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Duration:</span>
                                    <span class="text-green-300 ml-1">${exercise.duration}</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Target:</span>
                                    <span class="text-purple-300 ml-1">${exercise.targetAreas.join(', ')}</span>
                                </div>
                            </div>
                        </div>
                        <div class="ml-4 space-x-2">
                            <button onclick="previewExercise(${index})" class="text-blue-400 hover:text-blue-300 p-1" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="editExtractedExercise(${index})" class="text-yellow-400 hover:text-yellow-300 p-1" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            previewDiv.classList.remove('hidden');
            importBtn.disabled = false;

            window.previewExercise = function(index) {
                const exercise = mockExercises[index];
                showNotification(`üëÅÔ∏è Preview: ${exercise.name}`, 'success');
            };

            window.editExtractedExercise = function(index) {
                const exercise = mockExercises[index];
                showNotification(`‚úèÔ∏è Edit: ${exercise.name}`, 'success');
            };

            showNotification('‚úÖ Successfully extracted 3 exercises from document!', 'success');
        }

        function importExtractedExercises() {
            const selectedCheckboxes = document.querySelectorAll('input[data-exercise]:checked');
            const selectedCount = selectedCheckboxes.length;
            
            if (selectedCount === 0) {
                showNotification('‚ö†Ô∏è Please select at least one exercise to import', 'error');
                return;
            }

            // Show import progress
            showNotification(`üì• Importing ${selectedCount} exercise${selectedCount !== 1 ? 's' : ''} to library...`, 'success');
            
            // Simulate import process
            setTimeout(() => {
                // Show the new exercises alert
                showNewExercisesAlert(selectedCount);
                showNotification(`‚úÖ Successfully imported ${selectedCount} new exercise${selectedCount !== 1 ? 's' : ''} to your library!`, 'success');
            }, 1500);
        }

        function showNewExercisesAlert(count) {
            const alertDiv = document.getElementById('newExercisesAlert');
            const textSpan = document.getElementById('newExercisesText');
            
            if (alertDiv && textSpan) {
                textSpan.textContent = `${count} new exercise${count !== 1 ? 's have' : ' has'} been added to your library`;
                alertDiv.classList.remove('hidden');
                
                // Auto-hide after 10 seconds
                setTimeout(() => {
                    alertDiv.classList.add('hidden');
                }, 10000);
            }
        }

        function viewNewExercises() {
            const alertDiv = document.getElementById('newExercisesAlert');
            alertDiv.classList.add('hidden');
            
            // Show a modal or section highlighting the new exercises
            showNewExercisesDisplay();
        }

        function showNewExercisesDisplay() {
            const content = `
                <div class="space-y-6">
                    <div class="text-center">
                        <i class="fas fa-plus-circle text-green-500 text-4xl mb-4"></i>
                        <h3 class="text-2xl font-bold text-green-600 mb-2">New Exercises Added!</h3>
                        <p class="text-gray-600 dark:text-gray-400">Here are the exercises that were recently added to your library</p>
                    </div>

                    <div class="space-y-4">
                        ${newExercisesFromUpload.map((exercise, index) => `
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border-l-4 border-green-500">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <div class="flex items-center mb-2">
                                            <span class="inline-flex items-center justify-center w-6 h-6 bg-green-500 text-white text-xs font-bold rounded-full mr-3">
                                                ${index + 1}
                                            </span>
                                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">${exercise.name}</h4>
                                            <span class="ml-2 px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">NEW</span>
                                        </div>
                                        <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">${exercise.description}</p>
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                                            <div class="flex items-center">
                                                <i class="fas fa-tag text-blue-500 mr-2"></i>
                                                <span class="text-gray-600 dark:text-gray-400">Category:</span>
                                                <span class="ml-1 font-medium text-blue-600">${exercise.category}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <i class="fas fa-signal text-purple-500 mr-2"></i>
                                                <span class="text-gray-600 dark:text-gray-400">Level:</span>
                                                <span class="ml-1 font-medium text-purple-600">${exercise.difficulty}</span>
                                            </div>
                                            <div class="flex items-center">
                                                <i class="fas fa-clock text-orange-500 mr-2"></i>
                                                <span class="text-gray-600 dark:text-gray-400">Duration:</span>
                                                <span class="ml-1 font-medium text-orange-600">${exercise.duration}</span>
                                            </div>
                                        </div>

                                        <div class="mt-3">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">Target Areas:</span>
                                            <div class="flex flex-wrap gap-2 mt-1">
                                                ${exercise.targetAreas.map(area => `
                                                    <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">${area}</span>
                                                `).join('')}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="ml-4 space-y-2">
                                        <button onclick="viewFullExercise('${exercise.name}')" class="w-full bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                            <i class="fas fa-eye mr-1"></i>View Details
                                        </button>
                                        <button onclick="editExercise('${exercise.name}')" class="w-full bg-yellow-600 text-white px-3 py-2 rounded-lg hover:bg-yellow-700 transition-colors text-sm">
                                            <i class="fas fa-edit mr-1"></i>Edit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800">
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-green-600 mr-2"></i>
                            <div>
                                <p class="text-sm font-medium text-green-800 dark:text-green-200">Successfully Added to Library</p>
                                <p class="text-xs text-green-600 dark:text-green-300">These exercises are now available for use with all patients and treatment plans.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center">
                            <i class="fas fa-star text-green-500 mr-2"></i>Recently Added Exercises
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700">
                        <button class="close-modal px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                            Close
                        </button>
                        <button onclick="goToExerciseLibrary()" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary transition-colors">
                            <i class="fas fa-dumbbell mr-2"></i>Go to Exercise Library
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtns = modal.querySelectorAll('.close-modal');
            closeBtns.forEach(btn => {
                btn.onclick = () => modal.remove();
            });

            window.viewFullExercise = function(exerciseName) {
                modal.remove();
                showNotification(`üëÅÔ∏è Viewing exercise: ${exerciseName}`, 'success');
            };

            window.editExercise = function(exerciseName) {
                modal.remove();
                showNotification(`‚úèÔ∏è Editing exercise: ${exerciseName}`, 'success');
            };

            window.goToExerciseLibrary = function() {
                modal.remove();
                showNotification('üìö Redirecting to exercise library...', 'success');
            };
        }

        function hideNewExercisesAlert() {
            const alertDiv = document.getElementById('newExercisesAlert');
            alertDiv.classList.add('hidden');
        }

        function generateCustomReport() {
            showNotification('üìä Generate custom report coming soon!', 'success');
        }

        function generatePatientReport() {
            showNotification('üìã Generate patient report coming soon!', 'success');
        }

        function generateFinancialReport() {
            showNotification('üí∞ Generate financial report coming soon!', 'success');
        }

        function generateAppointmentReport() {
            showNotification('üìÖ Generate appointment report coming soon!', 'success');
        }

        function saveAllSettings() {
            showNotification('üíæ All settings saved successfully!', 'success');
        }

        function changeAdminPassword() {
            showNotification('üîê Change password functionality coming soon!', 'success');
        }

        // Dashboard-specific functions
        function updateCurrentDateTime() {
            const now = new Date();
            const dateTimeEl = document.getElementById('currentDateTime');
            if (dateTimeEl) {
                dateTimeEl.textContent = now.toLocaleString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function refreshDashboard() {
            updateDashboardStats();
            updateCurrentDateTime();
            showNotification('‚úÖ Dashboard refreshed!', 'success');
        }

        function generateReport() {
            showNotification('üìä Generating comprehensive report...', 'success');
        }

        // Initialize dashboard with real-time updates
        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentDateTime();
            setInterval(updateCurrentDateTime, 30000); // Update every 30 seconds
            
            // Set up refresh dashboard button
            const refreshBtn = document.getElementById('refreshDashboard');
            if (refreshBtn) {
                refreshBtn.onclick = refreshDashboard;
            }
        });

        // Enhanced Patient Management Functions
        function exportPatients() {
            showNotification('üì§ Exporting patient data to CSV...', 'success');
        }

        function exportUsers() {
            showNotification('üì§ Exporting user data to CSV...', 'success');
        }

        function clearPatientFilters() {
            const searchInput = document.getElementById('patientSearchInput');
            const statusFilter = document.getElementById('patientStatusFilter');
            const physioFilter = document.getElementById('patientPhysioFilter');
            
            if (searchInput) searchInput.value = '';
            if (statusFilter) statusFilter.value = '';
            if (physioFilter) physioFilter.value = '';
            
            updatePatientsDisplay();
            showNotification('üßπ Filters cleared', 'success');
        }

        // Enhanced Appointment Management Functions
        function showCalendarView() {
            showNotification('üìÖ Calendar view with weekly/monthly layouts coming soon!', 'success');
        }

        function exportAppointments() {
            showNotification('üì§ Exporting appointment schedule to Excel...', 'success');
        }

        function printSchedule() {
            showNotification('üñ®Ô∏è Preparing printable schedule...', 'success');
        }

        function confirmAppointment(appointmentId) {
            showNotification('‚úÖ Appointment confirmed and patient notified!', 'success');
        }

        function cancelAppointment(appointmentId) {
            showConfirmDialog(
                'Are you sure you want to cancel this appointment? The patient will be notified.',
                () => showNotification('‚ùå Appointment cancelled and patient notified', 'success')
            );
        }

        // Modal and Form Functions
        function showModal(title, content, onSave) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">${title}</h3>
                        <button class="close-modal text-gray-400 hover:text-gray-600 text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button class="save-modal px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary transition-colors">
                            Save Changes
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const saveBtn = modal.querySelector('.save-modal');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            saveBtn.onclick = () => {
                if (typeof onSave === 'function') onSave();
                closeModal();
            };
        }

        // Set up comprehensive event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Patient search and filters
            const patientSearch = document.getElementById('patientSearchInput');
            const patientStatusFilter = document.getElementById('patientStatusFilter');
            const patientPhysioFilter = document.getElementById('patientPhysioFilter');
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');
            
            if (patientSearch) patientSearch.oninput = () => filterPatients();
            if (patientStatusFilter) patientStatusFilter.onchange = () => filterPatients();
            if (patientPhysioFilter) patientPhysioFilter.onchange = () => filterPatients();
            if (clearFiltersBtn) clearFiltersBtn.onclick = clearPatientFilters;
            
            // Appointment search and filters
            const appointmentSearch = document.getElementById('appointmentSearchInput');
            const appointmentDateFilter = document.getElementById('appointmentDateFilter');
            const appointmentStatusFilter = document.getElementById('appointmentStatusFilter');
            const appointmentPhysioFilter = document.getElementById('appointmentPhysioFilter');
            
            if (appointmentSearch) appointmentSearch.oninput = () => filterAppointments();
            if (appointmentDateFilter) appointmentDateFilter.onchange = () => filterAppointments();
            if (appointmentStatusFilter) appointmentStatusFilter.onchange = () => filterAppointments();
            if (appointmentPhysioFilter) appointmentPhysioFilter.onchange = () => filterAppointments();
        });

        function filterPatients() {
            // Advanced patient filtering logic
            updatePatientsDisplay();
        }

        function filterAppointments() {
            // Advanced appointment filtering logic  
            updateAppointmentDisplay();
        }

        // Supabase Connection Functions
        let supabaseClient = null;
        let isSupabaseConnected = false;

        function showSupabaseConnectionModal() {
            const content = `
                <form id="supabaseConnectionForm" class="space-y-6">
                    <!-- Connection Details -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                            <i class="fas fa-database text-purple-400 mr-2"></i>Supabase Project Details
                        </h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Project URL *</label>
                            <input type="url" id="supabaseUrl" required placeholder="https://your-project.supabase.co" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            <p class="text-xs text-gray-400 mt-1">Find this in your Supabase project settings</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">API Key (anon/public) *</label>
                            <div class="relative">
                                <input type="password" id="supabaseKey" required placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." class="w-full px-4 py-3 pr-12 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                <button type="button" class="absolute right-4 top-4 text-gray-400 hover:text-gray-300" onclick="toggleSupabaseKeyVisibility()">
                                    <i class="fas fa-eye" id="supabaseKeyToggle"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">Your project's public API key</p>
                        </div>
                    </div>

                    <!-- Connection Options -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                            <i class="fas fa-cog text-purple-400 mr-2"></i>Connection Configuration
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Connection Name</label>
                                <input type="text" id="connectionName" placeholder="PhysioTech Production" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Environment</label>
                                <select id="connectionEnv" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    <option value="production">Production</option>
                                    <option value="staging">Staging</option>
                                    <option value="development">Development</option>
                                    <option value="testing">Testing</option>
                                </select>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="enableRealtime" checked class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Enable Real-time Subscriptions</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="enableAuth" class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Use Supabase Authentication</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="enableStorage" class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Enable File Storage</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="autoReconnect" checked class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Auto-reconnect on Connection Loss</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="saveCredentials" class="w-4 h-4 text-purple-500 bg-gray-600 border-gray-500 rounded focus:ring-purple-500 focus:ring-2 mr-3">
                                <span class="text-sm text-gray-300">Save Credentials Locally (Encrypted)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Database Schema Preview -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                            <i class="fas fa-table text-purple-400 mr-2"></i>Expected Database Schema
                        </h4>
                        
                        <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                            <p class="text-sm text-gray-300 mb-3">The system expects the following tables in your Supabase database:</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-table text-blue-400 mr-2"></i>
                                        <span class="text-blue-300 font-medium">patients</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-table text-green-400 mr-2"></i>
                                        <span class="text-green-300 font-medium">appointments</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-table text-purple-400 mr-2"></i>
                                        <span class="text-purple-300 font-medium">physiotherapists</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-table text-yellow-400 mr-2"></i>
                                        <span class="text-yellow-300 font-medium">exercises</span>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-table text-orange-400 mr-2"></i>
                                        <span class="text-orange-300 font-medium">treatments</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-table text-red-400 mr-2"></i>
                                        <span class="text-red-300 font-medium">reports</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-table text-indigo-400 mr-2"></i>
                                        <span class="text-indigo-300 font-medium">users</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-table text-pink-400 mr-2"></i>
                                        <span class="text-pink-300 font-medium">settings</span>
                                    </div>
                                </div>
                            </div>

                            <button type="button" onclick="generateSQLSchema()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                <i class="fas fa-download mr-2"></i>Download SQL Schema
                            </button>
                        </div>
                    </div>

                    <!-- Security & Performance -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                            <i class="fas fa-shield-alt text-purple-400 mr-2"></i>Security & Performance Settings
                        </h4>
                        
                        <div class="bg-yellow-900/20 rounded-lg p-4 border border-yellow-800">
                            <div class="flex items-start">
                                <i class="fas fa-exclamation-triangle text-yellow-500 mt-0.5 mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-yellow-200">Security Recommendations</h5>
                                    <ul class="text-sm text-yellow-100 mt-2 space-y-1">
                                        <li>‚Ä¢ Enable Row Level Security (RLS) on all tables</li>
                                        <li>‚Ä¢ Use service role key only for server-side operations</li>
                                        <li>‚Ä¢ Configure proper database policies for user access</li>
                                        <li>‚Ä¢ Enable database backups and point-in-time recovery</li>
                                        <li>‚Ä¢ Monitor connection limits and usage patterns</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Connection Pool Size</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    <option value="5">5 connections</option>
                                    <option value="10" selected>10 connections</option>
                                    <option value="15">15 connections</option>
                                    <option value="20">20 connections</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Connection Timeout</label>
                                <select class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white text-base focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    <option value="5">5 seconds</option>
                                    <option value="10" selected>10 seconds</option>
                                    <option value="30">30 seconds</option>
                                    <option value="60">60 seconds</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Connection Test Results -->
                    <div id="connectionTestResults" class="space-y-4 hidden">
                        <h4 class="text-lg font-semibold text-green-400 mb-4 flex items-center">
                            <i class="fas fa-check-circle text-green-400 mr-2"></i>Connection Test Results
                        </h4>
                        
                        <div id="testResults" class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                            <!-- Test results will be populated here -->
                        </div>
                    </div>
                </form>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto border border-gray-700">
                    <div class="flex items-center justify-between p-6 border-b border-gray-700">
                        <h3 class="text-xl font-semibold text-white flex items-center">
                            <i class="fas fa-database text-purple-400 mr-2"></i>Connect to Supabase Database
                        </h3>
                        <button class="close-modal text-gray-400 hover:text-white text-2xl transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="flex justify-between space-x-3 p-6 border-t border-gray-700">
                        <button class="cancel-modal px-6 py-3 text-gray-300 border border-gray-600 rounded-lg hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <div class="flex space-x-3">
                            <button class="test-connection-btn px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                <i class="fas fa-vial mr-2"></i>Test Connection
                            </button>
                            <button class="save-modal px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium">
                                <i class="fas fa-link mr-2"></i>Connect to Supabase
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            const closeBtn = modal.querySelector('.close-modal');
            const cancelBtn = modal.querySelector('.cancel-modal');
            const testBtn = modal.querySelector('.test-connection-btn');
            const saveBtn = modal.querySelector('.save-modal');
            
            const closeModal = () => modal.remove();
            
            closeBtn.onclick = closeModal;
            cancelBtn.onclick = closeModal;
            testBtn.onclick = testSupabaseConnectionModal;
            saveBtn.onclick = () => {
                connectToSupabase();
                closeModal();
            };

            // Add toggle functionality for API key visibility
            window.toggleSupabaseKeyVisibility = function() {
                const keyInput = document.getElementById('supabaseKey');
                const toggleIcon = document.getElementById('supabaseKeyToggle');
                
                if (keyInput.type === 'password') {
                    keyInput.type = 'text';
                    toggleIcon.classList.remove('fa-eye');
                    toggleIcon.classList.add('fa-eye-slash');
                } else {
                    keyInput.type = 'password';
                    toggleIcon.classList.remove('fa-eye-slash');
                    toggleIcon.classList.add('fa-eye');
                }
            };

            // Auto-populate from saved credentials if available
            const savedCredentials = getSavedSupabaseCredentials();
            if (savedCredentials) {
                document.getElementById('supabaseUrl').value = savedCredentials.url || '';
                document.getElementById('supabaseKey').value = savedCredentials.key || '';
                document.getElementById('connectionName').value = savedCredentials.name || '';
                document.getElementById('connectionEnv').value = savedCredentials.environment || 'production';
            }
        }

        function testSupabaseConnectionModal() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();
            
            if (!url || !key) {
                showNotification('‚ö†Ô∏è Please enter both URL and API key to test connection', 'error');
                return;
            }

            const testBtn = document.querySelector('.test-connection-btn');
            const originalText = testBtn.innerHTML;
            testBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Testing...';
            testBtn.disabled = true;

            // Simulate connection test
            setTimeout(() => {
                const testResultsDiv = document.getElementById('connectionTestResults');
                const resultsDiv = document.getElementById('testResults');
                
                // Mock test results for demo
                const mockResults = {
                    connection: true,
                    latency: Math.floor(Math.random() * 100) + 50,
                    version: '1.24.3',
                    region: 'us-east-1',
                    tables: ['patients', 'appointments', 'physiotherapists', 'exercises'],
                    rls: true
                };

                resultsDiv.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-300">Connection Status:</span>
                            <span class="flex items-center text-green-400">
                                <i class="fas fa-check-circle mr-2"></i>Connected
                            </span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-300">Response Time:</span>
                            <span class="text-blue-400">${mockResults.latency}ms</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-300">Database Version:</span>
                            <span class="text-purple-400">${mockResults.version}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-300">Region:</span>
                            <span class="text-yellow-400">${mockResults.region}</span>
                        </div>
                        <div class="flex items-start justify-between">
                            <span class="text-sm text-gray-300">Available Tables:</span>
                            <div class="text-right">
                                ${mockResults.tables.map(table => `<div class="text-sm text-green-400">${table} ‚úì</div>`).join('')}
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-300">Row Level Security:</span>
                            <span class="flex items-center text-green-400">
                                <i class="fas fa-shield-alt mr-2"></i>Enabled
                            </span>
                        </div>
                    </div>
                `;
                
                testResultsDiv.classList.remove('hidden');
                testBtn.innerHTML = originalText;
                testBtn.disabled = false;
                
                showNotification('‚úÖ Connection test completed successfully!', 'success');
            }, 2000);
        }

        function connectToSupabase() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();
            const name = document.getElementById('connectionName').value.trim() || 'Default Connection';
            const environment = document.getElementById('connectionEnv').value;
            const saveCredentials = document.getElementById('saveCredentials').checked;
            
            if (!url || !key) {
                showNotification('‚ö†Ô∏è Please enter both URL and API key', 'error');
                return;
            }

            // Save credentials if requested
            if (saveCredentials) {
                saveSupabaseCredentials({ url, key, name, environment });
            }

            // Initialize Supabase client (mock for demo)
            try {
                supabaseClient = { url, key }; // Mock client
                isSupabaseConnected = true;
                
                updateSupabaseConnectionUI();
                showNotification('üéâ Successfully connected to Supabase!', 'success');
                
                // Update connection details
                const projectUrl = document.getElementById('supabaseProjectUrl');
                if (projectUrl) {
                    projectUrl.textContent = `Project: ${new URL(url).hostname}`;
                }
                
                const lastConnected = document.getElementById('lastConnected');
                if (lastConnected) {
                    lastConnected.textContent = new Date().toLocaleString();
                }
                
            } catch (error) {
                showNotification('‚ùå Failed to connect to Supabase: ' + error.message, 'error');
            }
        }

        function updateSupabaseConnectionUI() {
            const connectedDiv = document.getElementById('supabaseConnected');
            const disconnectedDiv = document.getElementById('supabaseDisconnected');
            const detailsDiv = document.getElementById('supabaseDetails');
            
            if (isSupabaseConnected) {
                if (connectedDiv) connectedDiv.classList.remove('hidden');
                if (disconnectedDiv) disconnectedDiv.classList.add('hidden');
                if (detailsDiv) detailsDiv.classList.remove('hidden');
            } else {
                if (connectedDiv) connectedDiv.classList.add('hidden');
                if (disconnectedDiv) disconnectedDiv.classList.remove('hidden');
                if (detailsDiv) detailsDiv.classList.add('hidden');
            }
        }

        function testSupabaseConnection() {
            if (!isSupabaseConnected) {
                showNotification('‚ö†Ô∏è No active Supabase connection to test', 'error');
                return;
            }

            showNotification('üîÑ Testing Supabase connection...', 'success');
            
            // Simulate connection test
            setTimeout(() => {
                showNotification('‚úÖ Supabase connection is healthy and responding normally', 'success');
                
                const connectionStatus = document.getElementById('connectionStatus');
                const dataSyncStatus = document.getElementById('dataSyncStatus');
                
                if (connectionStatus) connectionStatus.textContent = 'Active';
                if (dataSyncStatus) dataSyncStatus.textContent = 'Real-time';
            }, 1500);
        }

        function disconnectSupabase() {
            showConfirmDialog(
                'Are you sure you want to disconnect from Supabase? This will stop real-time data synchronization.',
                () => {
                    supabaseClient = null;
                    isSupabaseConnected = false;
                    updateSupabaseConnectionUI();
                    showNotification('üîå Disconnected from Supabase', 'success');
                }
            );
        }

        // In-memory storage for credentials (since localStorage is not available in sandbox)
        let savedSupabaseCredentials = null;

        function saveSupabaseCredentials(credentials) {
            try {
                // Store in memory for this session
                savedSupabaseCredentials = credentials;
                console.log('üìÅ Credentials saved for current session');
            } catch (error) {
                console.log('Could not save credentials:', error);
            }
        }

        function getSavedSupabaseCredentials() {
            return savedSupabaseCredentials;
        }

        function generateSQLSchema() {
            const schema = `-- PhysioTech Database Schema for Supabase
-- Generated on ${new Date().toISOString()}

-- Enable necessary extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create patients table
CREATE TABLE patients (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(255),
    phone VARCHAR(20),
    cpr_number VARCHAR(20) UNIQUE,
    date_of_birth DATE,
    gender VARCHAR(10),
    address TEXT,
    medical_history TEXT,
    current_condition TEXT,
    emergency_contact TEXT,
    assigned_physiotherapist_id UUID,
    treatment_status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create physiotherapists table
CREATE TABLE physiotherapists (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20),
    license_number VARCHAR(50) UNIQUE,
    specializations TEXT[],
    experience INTEGER,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create appointments table
CREATE TABLE appointments (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    patient_id UUID REFERENCES patients(id) ON DELETE CASCADE,
    physiotherapist_id UUID REFERENCES physiotherapists(id) ON DELETE CASCADE,
    appointment_date TIMESTAMP WITH TIME ZONE NOT NULL,
    duration INTEGER DEFAULT 60,
    treatment_type VARCHAR(255),
    status VARCHAR(20) DEFAULT 'scheduled',
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create exercises table
CREATE TABLE exercises (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(100),
    difficulty_level VARCHAR(20),
    target_areas TEXT[],
    instructions TEXT,
    duration INTEGER,
    repetitions VARCHAR(20),
    equipment_required VARCHAR(255),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create treatments table
CREATE TABLE treatments (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    patient_id UUID REFERENCES patients(id) ON DELETE CASCADE,
    physiotherapist_id UUID REFERENCES physiotherapists(id) ON DELETE CASCADE,
    appointment_id UUID REFERENCES appointments(id) ON DELETE CASCADE,
    exercises_prescribed JSONB,
    progress_notes TEXT,
    treatment_outcome VARCHAR(255),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create users table (for system authentication)
CREATE TABLE users (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    full_name VARCHAR(255),
    role VARCHAR(50) NOT NULL,
    status VARCHAR(20) DEFAULT 'active',
    last_login TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create system settings table
CREATE TABLE settings (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    key VARCHAR(100) UNIQUE NOT NULL,
    value JSONB,
    description TEXT,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Enable Row Level Security on all tables
ALTER TABLE patients ENABLE ROW LEVEL SECURITY;
ALTER TABLE physiotherapists ENABLE ROW LEVEL SECURITY;
ALTER TABLE appointments ENABLE ROW LEVEL SECURITY;
ALTER TABLE exercises ENABLE ROW LEVEL SECURITY;
ALTER TABLE treatments ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE settings ENABLE ROW LEVEL SECURITY;

-- Create indexes for better performance
CREATE INDEX idx_patients_assigned_physiotherapist ON patients(assigned_physiotherapist_id);
CREATE INDEX idx_appointments_patient_id ON appointments(patient_id);
CREATE INDEX idx_appointments_physiotherapist_id ON appointments(physiotherapist_id);
CREATE INDEX idx_appointments_date ON appointments(appointment_date);
CREATE INDEX idx_treatments_patient_id ON treatments(patient_id);

-- Insert sample data (optional)
INSERT INTO physiotherapists (first_name, last_name, email, license_number, specializations, experience) VALUES
('Mariam', 'Abdulatheem Ali', 'mariam.ali@bmi.com.bh', 'BH-PT-2024-001', ARRAY['Orthopedic', 'Sports Medicine', 'Manual Therapy'], 8);

-- Insert system settings
INSERT INTO settings (key, value, description) VALUES
('clinic_name', '"Bahrain Mobility International"', 'Primary clinic name'),
('default_appointment_duration', '45', 'Default appointment duration in minutes'),
('currency', '"BHD"', 'System currency code');
`;

            // Create and download the schema file
            const blob = new Blob([schema], { type: 'text/sql' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'physiotech_supabase_schema.sql';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('üì• Database schema downloaded successfully!', 'success');
        }

        // Initialize Supabase connection status on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateSupabaseConnectionUI();
            
            // Check for saved credentials and auto-connect if available
            const savedCredentials = getSavedSupabaseCredentials();
            if (savedCredentials && savedCredentials.url && savedCredentials.key) {
                // Auto-connect in background
                setTimeout(() => {
                    supabaseClient = { url: savedCredentials.url, key: savedCredentials.key };
                    isSupabaseConnected = true;
                    updateSupabaseConnectionUI();
                    
                    const projectUrl = document.getElementById('supabaseProjectUrl');
                    if (projectUrl) {
                        try {
                            projectUrl.textContent = `Project: ${new URL(savedCredentials.url).hostname}`;
                        } catch (e) {
                            projectUrl.textContent = `Project: ${savedCredentials.name || 'Connected'}`;
                        }
                    }
                }, 1000);
            }
        });

        // Chart.js Configuration and Initialization
        let chartInstances = {};

        function initializeDashboardCharts() {
            // Patient Registration Trends Chart
            const patientCtx = document.getElementById('patientRegistrationChart');
            if (patientCtx) {
                chartInstances.patientChart = new Chart(patientCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'New Patient Registrations',
                            data: [8, 12, 15, 10, 18, 22, 25, 20, 28, 32, 35, 40],
                            borderColor: '#0F766E',
                            backgroundColor: 'rgba(15, 118, 110, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }

            // Treatment Types Distribution Chart
            const treatmentCtx = document.getElementById('treatmentTypesChart');
            if (treatmentCtx) {
                chartInstances.treatmentChart = new Chart(treatmentCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Back Pain', 'Knee Injury', 'Shoulder Issues', 'Sports Rehab', 'Other'],
                        datasets: [{
                            data: [35, 25, 20, 15, 5],
                            backgroundColor: [
                                '#3B82F6',
                                '#10B981',
                                '#8B5CF6',
                                '#F59E0B',
                                '#6B7280'
                            ],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151',
                                    usePointStyle: true,
                                    padding: 20
                                }
                            }
                        }
                    }
                });
            }

            // Monthly Revenue Trend Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                chartInstances.revenueChart = new Chart(revenueCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'Revenue (BD)',
                            data: [3200, 3800, 4100, 3700, 4500, 4900, 5200, 4800, 5500, 5800, 6100, 6500],
                            backgroundColor: 'rgba(34, 197, 94, 0.8)',
                            borderColor: '#22C55E',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280',
                                    callback: function(value) {
                                        return 'BD ' + value.toLocaleString();
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }

            // Appointment Volume Chart
            const appointmentCtx = document.getElementById('appointmentVolumeChart');
            if (appointmentCtx) {
                chartInstances.appointmentChart = new Chart(appointmentCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],
                        datasets: [
                            {
                                label: 'Scheduled',
                                data: [25, 30, 28, 32, 27, 20, 8],
                                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                borderColor: '#3B82F6',
                                borderWidth: 1
                            },
                            {
                                label: 'Completed',
                                data: [23, 28, 26, 30, 25, 18, 7],
                                backgroundColor: 'rgba(34, 197, 94, 0.8)',
                                borderColor: '#22C55E',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }
        }

        function initializePatientCharts() {
            // Patient Age Distribution Chart
            const ageCtx = document.getElementById('patientAgeChart');
            if (ageCtx) {
                chartInstances.patientAgeChart = new Chart(ageCtx, {
                    type: 'bar',
                    data: {
                        labels: ['18-25', '26-35', '36-45', '46-55', '56-65', '65+'],
                        datasets: [{
                            label: 'Number of Patients',
                            data: [8, 15, 22, 18, 12, 7],
                            backgroundColor: 'rgba(99, 102, 241, 0.8)',
                            borderColor: '#6366F1',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }

            // Patient Gender Distribution
            const genderCtx = document.getElementById('patientGenderChart');
            if (genderCtx) {
                chartInstances.patientGenderChart = new Chart(genderCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Female', 'Male'],
                        datasets: [{
                            data: [58, 42],
                            backgroundColor: ['#EC4899', '#3B82F6'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151',
                                    padding: 20
                                }
                            }
                        }
                    }
                });
            }

            // Treatment Status Overview
            const statusCtx = document.getElementById('treatmentStatusChart');
            if (statusCtx) {
                chartInstances.treatmentStatusChart = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Active Treatment', 'Completed', 'On Hold', 'Cancelled'],
                        datasets: [{
                            data: [45, 38, 12, 5],
                            backgroundColor: ['#10B981', '#3B82F6', '#F59E0B', '#EF4444'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151',
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }
        }

        function initializeAppointmentCharts() {
            // Appointment Status Distribution
            const apptStatusCtx = document.getElementById('appointmentStatusChart');
            if (apptStatusCtx) {
                chartInstances.appointmentStatusChart = new Chart(apptStatusCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Scheduled', 'Confirmed', 'Completed', 'Cancelled', 'No-show'],
                        datasets: [{
                            label: 'Number of Appointments',
                            data: [35, 42, 78, 8, 3],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(107, 114, 128, 0.8)'
                            ],
                            borderColor: [
                                '#3B82F6',
                                '#22C55E',
                                '#8B5CF6',
                                '#EF4444',
                                '#6B7280'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }

            // Daily Appointment Volume
            const dailyVolumeCtx = document.getElementById('dailyAppointmentChart');
            if (dailyVolumeCtx) {
                chartInstances.dailyAppointmentChart = new Chart(dailyVolumeCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 30}, (_, i) => `Day ${i + 1}`),
                        datasets: [{
                            label: 'Daily Appointments',
                            data: [12, 15, 8, 18, 22, 16, 25, 19, 14, 20, 23, 17, 26, 21, 13, 19, 24, 18, 27, 20, 15, 22, 25, 19, 16, 23, 28, 21, 17, 24],
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }

            // Peak Hours Analysis
            const peakHoursCtx = document.getElementById('peakHoursChart');
            if (peakHoursCtx) {
                try {
                    chartInstances.peakHoursChart = new Chart(peakHoursCtx, {
                        type: 'radar',
                        data: {
                            labels: ['8 AM', '9 AM', '10 AM', '11 AM', '12 PM', '1 PM', '2 PM', '3 PM', '4 PM', '5 PM'],
                            datasets: [{
                                label: 'Appointment Volume',
                                data: [5, 12, 18, 15, 8, 6, 20, 22, 19, 14],
                                backgroundColor: 'rgba(245, 158, 11, 0.2)',
                                borderColor: '#F59E0B',
                                borderWidth: 2,
                                pointBackgroundColor: '#F59E0B',
                                pointBorderColor: '#ffffff',
                                pointRadius: 5
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: {
                                        color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                    }
                                }
                            },
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    grid: {
                                        color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                    },
                                    pointLabels: {
                                        color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                    },
                                    ticks: {
                                        color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280',
                                        backdropColor: 'transparent'
                                    }
                                }
                            }
                        }
                    });
                } catch (error) {
                    console.log('Peak hours radar chart error:', error.message);
                    // Fallback to bar chart if radar fails
                    chartInstances.peakHoursChart = new Chart(peakHoursCtx, {
                        type: 'bar',
                        data: {
                            labels: ['8 AM', '9 AM', '10 AM', '11 AM', '12 PM', '1 PM', '2 PM', '3 PM', '4 PM', '5 PM'],
                            datasets: [{
                                label: 'Appointment Volume',
                                data: [5, 12, 18, 15, 8, 6, 20, 22, 19, 14],
                                backgroundColor: 'rgba(245, 158, 11, 0.8)',
                                borderColor: '#F59E0B',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    labels: {
                                        color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                    },
                                    ticks: {
                                        color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                    },
                                    ticks: {
                                        color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                    }
                                }
                            }
                        }
                    });
                }
            }
        }

        function initializePhysiotherapistCharts() {
            // Workload Distribution Chart
            const workloadCtx = document.getElementById('workloadChart');
            if (workloadCtx) {
                chartInstances.workloadChart = new Chart(workloadCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Dr. Mariam Ali', 'Dr. Ahmad Al-Rashid', 'Dr. Sara Mohammed', 'Dr. Khalid Hassan'],
                        datasets: [{
                            label: 'Active Patients',
                            data: [25, 18, 22, 15],
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: '#10B981',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }

            // Specialization Distribution
            const specializationCtx = document.getElementById('specializationChart');
            if (specializationCtx) {
                chartInstances.specializationChart = new Chart(specializationCtx, {
                    type: 'polarArea',
                    data: {
                        labels: ['Orthopedic', 'Sports Medicine', 'Neurological', 'Pediatric', 'Geriatric'],
                        datasets: [{
                            data: [35, 25, 20, 12, 8],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(34, 197, 94, 0.7)',
                                'rgba(139, 92, 246, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                                'rgba(236, 72, 153, 0.7)'
                            ],
                            borderColor: [
                                '#3B82F6',
                                '#22C55E',
                                '#8B5CF6',
                                '#F59E0B',
                                '#EC4899'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151',
                                    padding: 15
                                }
                            }
                        },
                        scales: {
                            r: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                pointLabels: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280',
                                    backdropColor: 'transparent'
                                }
                            }
                        }
                    }
                });
            }
        }

        function initializeExerciseCharts() {
            // Exercise Categories Chart
            const categoriesCtx = document.getElementById('exerciseCategoriesChart');
            if (categoriesCtx) {
                chartInstances.exerciseCategoriesChart = new Chart(categoriesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Strength Training', 'Flexibility', 'Balance', 'Rehabilitation', 'Cardio', 'Functional'],
                        datasets: [{
                            data: [28, 22, 18, 35, 12, 15],
                            backgroundColor: [
                                '#3B82F6',
                                '#10B981',
                                '#8B5CF6',
                                '#F59E0B',
                                '#EF4444',
                                '#06B6D4'
                            ],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151',
                                    usePointStyle: true,
                                    padding: 20
                                }
                            }
                        }
                    }
                });
            }

            // Exercise Difficulty Distribution
            const difficultyCtx = document.getElementById('exerciseDifficultyChart');
            if (difficultyCtx) {
                chartInstances.exerciseDifficultyChart = new Chart(difficultyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Beginner', 'Intermediate', 'Advanced', 'Expert'],
                        datasets: [{
                            label: 'Number of Exercises',
                            data: [45, 35, 25, 8],
                            backgroundColor: [
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderColor: [
                                '#22C55E',
                                '#3B82F6',
                                '#F59E0B',
                                '#EF4444'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }

            // Exercise Usage Frequency
            const usageCtx = document.getElementById('exerciseUsageChart');
            if (usageCtx) {
                chartInstances.exerciseUsageChart = new Chart(usageCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
                        datasets: [{
                            label: 'Times Used',
                            data: [125, 138, 142, 155, 168, 175, 182, 195],
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }
        }

        function initializeFinancialCharts() {
            // Revenue by Payment Method
            const paymentCtx = document.getElementById('paymentMethodChart');
            if (paymentCtx) {
                chartInstances.paymentMethodChart = new Chart(paymentCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Insurance', 'Cash', 'Card', 'Bank Transfer', 'Corporate'],
                        datasets: [{
                            data: [45, 25, 20, 7, 3],
                            backgroundColor: [
                                '#3B82F6',
                                '#22C55E',
                                '#8B5CF6',
                                '#F59E0B',
                                '#EF4444'
                            ],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151',
                                    padding: 20
                                }
                            }
                        }
                    }
                });
            }

            // Monthly Revenue Comparison
            const monthlyCompareCtx = document.getElementById('monthlyRevenueCompareChart');
            if (monthlyCompareCtx) {
                chartInstances.monthlyRevenueCompareChart = new Chart(monthlyCompareCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [
                            {
                                label: '2024',
                                data: [3200, 3800, 4100, 3700, 4500, 4900, 5200, 4800, 5500, 5800, 6100, 6500],
                                borderColor: '#22C55E',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                borderWidth: 3,
                                fill: false
                            },
                            {
                                label: '2023',
                                data: [2800, 3200, 3500, 3100, 3800, 4200, 4500, 4100, 4700, 5000, 5300, 5600],
                                borderColor: '#6B7280',
                                backgroundColor: 'rgba(107, 114, 128, 0.1)',
                                borderWidth: 2,
                                fill: false,
                                borderDash: [5, 5]
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280',
                                    callback: function(value) {
                                        return 'BD ' + value.toLocaleString();
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }
        }

        function initializeTreatmentOutcomeCharts() {
            // Success Rate by Condition
            const successRateCtx = document.getElementById('successRateChart');
            if (successRateCtx) {
                chartInstances.successRateChart = new Chart(successRateCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Back Pain', 'Knee Issues', 'Shoulder Problems', 'Neck Pain', 'Sports Injuries', 'Post-Surgery'],
                        datasets: [{
                            label: 'Success Rate (%)',
                            data: [92, 88, 85, 90, 94, 87],
                            backgroundColor: [
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(236, 72, 153, 0.8)'
                            ],
                            borderColor: [
                                '#22C55E',
                                '#3B82F6',
                                '#8B5CF6',
                                '#F59E0B',
                                '#10B981',
                                '#EC4899'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Treatment Duration Analysis
            const durationCtx = document.getElementById('treatmentDurationChart');
            if (durationCtx) {
                chartInstances.treatmentDurationChart = new Chart(durationCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Treatment Duration vs Success Rate',
                            data: [
                                {x: 2, y: 75}, {x: 4, y: 82}, {x: 6, y: 88}, {x: 8, y: 92},
                                {x: 10, y: 94}, {x: 12, y: 95}, {x: 14, y: 93}, {x: 16, y: 91},
                                {x: 18, y: 89}, {x: 20, y: 87}, {x: 22, y: 85}, {x: 24, y: 84}
                            ],
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: '#3B82F6',
                            borderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Success Rate (%)',
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                },
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            },
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Treatment Duration (weeks)',
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                },
                                grid: {
                                    color: document.documentElement.classList.contains('dark') ? '#374151' : '#e5e7eb'
                                },
                                ticks: {
                                    color: document.documentElement.classList.contains('dark') ? '#9ca3af' : '#6b7280'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Helper function to get current user info
        function getCurrentUser() {
            // In a real app, this would get from authenticated session
            return {
                id: 'admin-001',
                name: 'Admin User',
                role: 'administrator'
            };
        }

        // Initialize all charts when dashboard is loaded
        function initializeAllCharts() {
            // Delay chart initialization to ensure DOM is ready
            setTimeout(() => {
                try {
                    initializeDashboardCharts();
                } catch (error) {
                    console.log('Dashboard charts initialization error:', error.message);
                }
                
                try {
                    initializePatientCharts();
                } catch (error) {
                    console.log('Patient charts initialization error:', error.message);
                }
                
                try {
                    initializeAppointmentCharts();
                } catch (error) {
                    console.log('Appointment charts initialization error:', error.message);
                }
                
                try {
                    initializePhysiotherapistCharts();
                } catch (error) {
                    console.log('Physiotherapist charts initialization error:', error.message);
                }
                
                try {
                    initializeExerciseCharts();
                } catch (error) {
                    console.log('Exercise charts initialization error:', error.message);
                }
                
                try {
                    initializeFinancialCharts();
                } catch (error) {
                    console.log('Financial charts initialization error:', error.message);
                }
                
                try {
                    initializeTreatmentOutcomeCharts();
                } catch (error) {
                    console.log('Treatment outcome charts initialization error:', error.message);
                }
            }, 500);
        }

        // Update chart colors when dark mode changes
        function updateChartsForTheme() {
            Object.values(chartInstances).forEach(chart => {
                if (chart && chart.options) {
                    const isDark = document.documentElement.classList.contains('dark');
                    const textColor = isDark ? '#ffffff' : '#374151';
                    const gridColor = isDark ? '#374151' : '#e5e7eb';
                    const tickColor = isDark ? '#9ca3af' : '#6b7280';

                    // Update legend colors
                    if (chart.options.plugins && chart.options.plugins.legend) {
                        chart.options.plugins.legend.labels.color = textColor;
                    }

                    // Update scale colors
                    if (chart.options.scales) {
                        Object.values(chart.options.scales).forEach(scale => {
                            if (scale.grid) scale.grid.color = gridColor;
                            if (scale.ticks) scale.ticks.color = tickColor;
                            if (scale.title) scale.title.color = tickColor;
                            if (scale.pointLabels) scale.pointLabels.color = tickColor;
                        });
                    }

                    chart.update('none');
                }
            });
        }

        // Listen for dark mode changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateChartsForTheme);

        // Override the existing initializeDashboard function to include charts
        const originalInitializeDashboard = initializeDashboard;
        initializeDashboard = function() {
            originalInitializeDashboard();
            initializeAllCharts();
        };

        console.log('‚úÖ PhysioTech Application fully loaded and ready!');
        console.log('üìä Chart.js integration complete - All reports have interactive charts');
        console.log('üîå Supabase connection features available');
    </script>
</body>
</html>
